/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/library","jquery.sap.global","sap/ui/core/Control","sap/ui/model/ChangeReason","sap/base/util/values","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","sap/ui/core/ResizeHandler","./InnerGanttChart","./GanttHeader","./GanttSyncedControl","../control/AssociateContainer","../axistime/ProportionZoomStrategy","./SelectionModel","./ExpandModel","./ShapeScheme","./GanttExtension","./GanttScrollExtension","./GanttZoomExtension","./GanttPointerExtension","./GanttDragDropExtension","./GanttPopoverExtension","./GanttConnectExtension","./GanttResizeExtension","./GanttLassoExtension","./GanttUtils","./RenderUtils","../misc/Format","../misc/Utility","../config/TimeHorizon","sap/ui/export/Spreadsheet","sap/m/OverflowToolbar",'sap/ui/core/Core','sap/base/util/uid','sap/m/Dialog','sap/m/Input','sap/m/Label','sap/m/VBox','sap/m/Button','sap/ui/model/json/JSONModel','sap/m/Menu','sap/m/MenuButton','sap/m/MenuItem',"./GanttChartWithTableRenderer"],function(l,q,C,c,v,S,d,R,I,G,e,A,P,f,E,g,h,j,k,m,n,o,p,r,s,t,u,F,U,T,w,O,x,y,D,z,L,V,B,J,M,H,K){"use strict";var N=l.simple.GanttChartWithTableDisplayType,Q=l.simple.VisibleHorizonUpdateType,W=l.simple.exportTableCustomDataType;var X=Object.freeze({"totalHorizonUpdated":Q.TotalHorizonUpdated,"mouseWheelZoom":Q.MouseWheelZoom,"syncVisibleHorizon":Q.SyncVisibleHorizon,"initialRender":Q.InitialRender,"horizontalScroll":Q.HorizontalScroll,"zoomLevelChanged":Q.ZoomLevelChanged,"timePeriodZooming":Q.TimePeriodZooming});var Y=x.getLibraryResourceBundle("sap.gantt");var Z=10;var $=60;function _(a,b){return a+b;}function a1(a,b){return Math.abs(a-b)<Z;}var b1=C.extend("sap.gantt.simple.GanttChartWithTable",{metadata:{library:"sap.gantt",properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},shapeSelectionMode:{type:"sap.gantt.SelectionMode",defaultValue:l.SelectionMode.MultiWithKeyboard},shapeOverRelationship:{type:"boolean",defaultValue:true},shapeSelectionSettings:{type:"object",defaultValue:null},enableCursorLine:{type:"boolean",defaultValue:true},enableNowLine:{type:"boolean",defaultValue:true},nowLineInUTC:{type:"boolean",defaultValue:true},enableVerticalLine:{type:"boolean",defaultValue:true},enableAdhocLine:{type:"boolean",defaultValue:true},adhocLineLayer:{type:"string",defaultValue:l.AdhocLineLayer.Top},enableDeltaLine:{type:"boolean",defaultValue:true},enableNonWorkingTime:{type:"boolean",defaultValue:true},enableChartDeltaAreaHighlight:{type:"boolean",defaultValue:true},deltaLineLayer:{type:"string",defaultValue:l.DeltaLineLayer.Bottom},datePattern:{type:"string",defaultValue:l.config.DEFAULT_DATE_PATTERN},timePattern:{type:"string",defaultValue:l.config.DEFAULT_TIME_PATTERN},enableExpandedRowBorders:{type:"boolean",defaultValue:true},enableExpandedRowBackground:{type:"boolean",defaultValue:true},expandedRowHeight:{type:"int"},dragOrientation:{type:"sap.gantt.DragOrientation",defaultValue:l.DragOrientation.Free},ghostAlignment:{type:"string",defaultValue:l.dragdrop.GhostAlignment.None},showShapeTimeOnDrag:{type:"boolean",defaultValue:false},selectionPanelSize:{type:"sap.ui.core.CSSSize",defaultValue:"30%"},displayType:{type:"sap.gantt.simple.GanttChartWithTableDisplayType",defaultValue:N.Both},disableShapeDoubleClickEvent:{type:"boolean",defaultValue:false},showExportTableToExcel:{type:"boolean",defaultValue:false},enableSelectAndDrag:{type:"boolean",defaultValue:true},deltaAreaHighlightColor:{type:"string",defaultValue:"@sapUiListSelectionBackgroundColor"},enableLassoInvert:{type:"boolean",defaultValue:false},showParentRowOnExpand:{type:"boolean",defaultValue:true}},aggregations:{table:{type:"sap.ui.table.Table",multiple:false},adhocLines:{type:"sap.gantt.AdhocLine",multiple:true,singularName:"adhocLine",bindable:"bindable",visibility:"public"},simpleAdhocLines:{type:"sap.gantt.simple.AdhocLine",multiple:true,singularName:"simpleAdhocLine",bindable:"bindable",visibility:"public"},deltaLines:{type:"sap.gantt.simple.DeltaLine",multiple:true,singularName:"deltaLine",bindable:"bindable",visibility:"public"},svgDefs:{type:"sap.gantt.def.SvgDefs",multiple:false,singularName:"svgDef"},shapeSchemes:{type:"sap.gantt.simple.ShapeScheme",multiple:true,singularName:"shapeScheme"},calendarDef:{type:"sap.gantt.def.cal.CalendarDefs",multiple:false,bindable:"bindable"},axisTimeStrategy:{type:"sap.gantt.axistime.AxisTimeStrategyBase",multiple:false,bindable:"bindable"},locale:{type:"sap.gantt.config.Locale",multiple:false},_splitter:{type:"sap.ui.layout.Splitter",multiple:false,visibility:"hidden"},_header:{type:"sap.gantt.simple.GanttHeader",multiple:false,defaultValue:null,visibility:"hidden"},_innerGantt:{type:"sap.gantt.simple.InnerGanttChart",multiple:false,visibility:"hidden"}},events:{shapeSelectionChange:{parameters:{shapeUids:{type:"string[]"}}},shapeResize:{parameters:{shapeUid:{type:"string"},shape:{type:"sap.gantt.simple.BaseShape"},rowObject:{type:"object"},oldTime:{type:"string[]"},newTime:{type:"string[]"}}},shapeMouseEnter:{parameters:{shape:{type:"sap.gantt.simple.BaseShape"},pageX:{type:"int"},pageY:{type:"int"}}},shapeMouseLeave:{parameters:{shape:{type:"sap.gantt.simple.BaseShape"},originEvent:{type:"object"}}},shapePress:{parameters:{popoverOffsetX:{type:"int"},rowSettings:{type:"sap.gantt.simple.GanttRowSettings"},shape:{type:"sap.gantt.simple.BaseShape"}},allowPreventDefault:true},shapeDoubleClick:{parameters:{popoverOffsetX:{type:"int"},rowSettings:{type:"sap.gantt.simple.GanttRowSettings"},shape:{type:"sap.gantt.simple.BaseShape"}}},shapeContextMenu:{parameters:{pageX:{type:"int"},pageY:{type:"int"},popoverOffsetX:{type:"int"},rowSettings:{type:"sap.gantt.simple.GanttRowSettings"},shape:{type:"sap.gantt.simple.BaseShape"}}},dragStart:{parameters:{sourceGanttChart:{type:"sap.gantt.simple.GanttChartWithTable"},draggedShapeDates:{type:"object"},lastDraggedShapeUid:{type:"string"},cursorDateTime:{type:"object"}}},shapeDrop:{parameters:{sourceGanttChart:{type:"sap.gantt.simple.GanttChartWithTable"},targetGanttChart:{type:"sap.gantt.simple.GanttChartWithTable"},draggedShapeDates:{type:"object"},lastDraggedShapeUid:{type:"string"},targetRow:{type:"sap.ui.table.Row"},cursorDateTime:{type:"object"},newDateTime:{type:"object"},targetShape:{type:"sap.gantt.simple.BaseShape"}}},shapeConnect:{parameters:{fromShapeUid:{type:"string"},toShapeUid:{type:"string"},type:{type:"sap.gantt.simple.RelationshipType"}}},visibleHorizonUpdate:{parameters:{type:{type:"sap.gantt.simple.VisibleHorizonUpdateType"},lastVisibleHorizon:{type:"sap.gantt.config.TimeHorizon"},currentVisibleHorizon:{type:"sap.gantt.config.TimeHorizon"}}}}}});b1.prototype.init=function(){this.iGanttRenderedWidth=-1;this._bExtensionsInitialized=false;this._oExpandModel=new E();this._aExpandedIndices=[];this._oSplitter=new S({id:this.getId()+"-ganttChartSplitter"});this.setAggregation("_splitter",this._oSplitter);this._oSyncedControl=new e();this.setAggregation("_innerGantt",new I());this.setAggregation("_header",new G());this._sPreviousDisplayType=this.getDisplayType();};b1.prototype.getInnerGantt=function(){return this.getAggregation("_innerGantt");};b1.prototype.onSplitterResize=function(a){var b=a.getParameter("oldSizes"),i=a.getParameter("newSizes"),c1=b.length>0&&i.length>0&&b[0]!==i[0],d1=this.getDisplayType(),e1=i[0];if(c1){if(d1===N.Both){this._onResize(c1);}var f1=function(g1){return this.getSelectionPanelSize().startsWith("0")||g1[0]!==0;}.bind(this);if(a1(b.reduce(_),i.reduce(_))&&b[0]!==i[0]&&f1(b)){this.setProperty("selectionPanelSize",e1+"px",true);this.fireEvent("_selectionPanelResize",{newWidth:e1,displayType:d1});}this._draw();}};b1.prototype.setLayoutData=function(a){this.setAggregation("layoutData",a,true);this.fireEvent("_layoutDataChange");return this;};b1.prototype.setDisplayType=function(a){this._sPreviousDisplayType=this.getDisplayType();if(this._sPreviousDisplayType===N.Both&&a!==N.Both){this._iLastTableAreaSize=this.getAggregation("_splitter").getCalculatedSizes()[0];}this.setProperty("displayType",a,false);if(a===N.Table){this.setProperty("selectionPanelSize","auto",true);}else{delete this._bPreventInitialRender;}this._setupDisplayType();return this;};b1.prototype.setSelectionPanelSize=function(a){this.setProperty("selectionPanelSize",a,false);delete this._iLastTableAreaSize;this._setSplitterLayoutData(a,"auto");return this;};b1.prototype.applySettings=function(a,b){a=a||{};this._applyMissingSettings(a);C.prototype.applySettings.call(this,a,b);this._initSelectionModel(this.getProperty("shapeSelectionMode"));};b1.prototype._applyMissingSettings=function(a){if(!a.axisTimeStrategy){a.axisTimeStrategy=new P();}if(!a.locale){a.locale=l.config.DEFAULT_LOCALE_CET.clone();}if(!a.shapeSchemes){a.shapeSchemes=[new g({key:"default",primary:true})];}else{var b=a.shapeSchemes.some(function(i){return i.getPrimary();});if(!b){q.sap.log.warning("you need set a ShapeSheme with primary:true");}}};b1.prototype.getPrimaryShapeScheme=function(){return this.getShapeSchemes().filter(function(a){return a.getPrimary();})[0];};b1.prototype.getSyncedControl=function(){return this._oSyncedControl;};b1.prototype.getTableRowHeights=function(){return this.getSyncedControl().getRowHeights();};b1.prototype.setTable=function(a){this.setAggregation("table",a);a._bVariableRowHeightEnabled=true;var b=this._oSplitter.removeContentArea(0);this._oSplitter.insertContentArea(new A({content:a,enableRootDiv:true,layoutData:a.getLayoutData()?a.getLayoutData().clone():new d({size:this.getSelectionPanelSize()})}),0);if(b==null){this._oSyncedControl.syncWith(a);this._oSplitter.addContentArea(this._oSyncedControl);}else if(b&&b.getContent()!==a.getId()){this._oSyncedControl.syncWith(a);}a.detachEvent("_rowsUpdated",this._onTableRowsUpdated,this);a.attachEvent("_rowsUpdated",this._onTableRowsUpdated,this);};b1.prototype.setEnableVariableRowHeight=function(b){if(this.getTable()){this.getTable()._bVariableRowHeightEnabled=b;}else{q.sap.log.warning("you need to set table aggregation first");}};b1.prototype.setLargeDataScrolling=function(b){if(this.getTable()){this.getTable()._setLargeDataScrolling(b);}else{q.sap.log.warning("you need to set table aggregation first");}};b1.prototype.getRenderedTimeRange=function(){return this.getAxisTime().getTimeRangeSlice(0,this.iGanttRenderedWidth);};b1.prototype._initSelectionModel=function(a){if(this.oSelection){this.oSelection.detachSelectionChanged(this._onSelectionChanged,this);}this.oSelection=new f(a);this.oSelection.attachSelectionChanged(this._onSelectionChanged,this);return this;};b1.prototype.setShapeSelectionMode=function(a){this.setProperty("shapeSelectionMode",a);if(this.oSelection){this.oSelection.setSelectionMode(a);}return this;};b1.prototype.getSelectedShapeUid=function(){return this.oSelection.allUid();};b1.prototype.setSelectedShapeUid=function(a){return this.selectShapes(a,true);};b1.prototype.selectShapes=function(a,b){if(!this.oSelection){return this;}if((!a||a.length===0)&&b){this.oSelection.clear(true);return this;}if(b){this.oSelection.clear(false);}this._updateShapes(a,true);return this;};b1.prototype.deselectShapes=function(a){if(!this.oSelection||!a||a.length===0){return this;}this._updateShapes(a,false);return this;};b1.prototype._updateShapes=function(a,b){var c1={};var d1=t.getShapesWithUid(this.getId(),a);for(var i=0;i<a.length;i++){c1[a[i]]={selected:b,ctrl:false};if(d1[i]){c1.draggable=d1[i].getDraggable();c1.time=d1[i].getTime();c1.endTime=d1[i].getEndTime();}}this.oSelection.updateShapes(c1);};b1.prototype._onSelectionChanged=function(a){var b=a.getParameter("shapeUid"),i=a.getParameter("deselectedUid"),c1=a.getParameter("silent");this._updateShapeSelections(b,i);if(!c1){this.fireShapeSelectionChange({shapeUids:b});}};b1.prototype.handleShapePress=function(a){var b=a.shape,i=b.getShapeUid(),c1=a.ctrlOrMeta,d1=this._getDragDropExtension();var e1=!b.getSelected();if(d1.shapeSelectedOnMouseDown&&!d1.initiallySelected&&!this.getEnableSelectAndDrag()){e1=d1.shapeSelectedOnMouseDown;}this.oSelection.updateShape(i,{selected:e1,ctrl:c1,draggable:b.getDraggable(),time:b.getTime(),endTime:b.getEndTime()});d1.shapeSelectedOnMouseDown=false;};b1.prototype.handleShapeMouseEnter=function(a){if(!this.getEnableSelectAndDrag()){var b=a.shape,i=this._getResizeExtension();if(!b.getSelected()){i.addResizerOnMouseOver(b);}var c1=this._getDragDropExtension();if(b.getDraggable()){c1.updateCursorStyle("move");}}};b1.prototype.handleShapeMouseLeave=function(a){if(!this.getEnableSelectAndDrag()){var b=this._getDragDropExtension();b.updateCursorStyle("default");}};b1.prototype._updateShapeSelections=function(a,b){var i=this.getShapeSelectionMode();if(i===l.SelectionMode.None){return;}u.updateShapeSelections(this,a,b);};b1.prototype.getSelection=function(){return this.oSelection;};b1.prototype.getExpandedBackgroundData=function(){if(this._oExpandModel.hasExpandedRows()){var a=this.getTable().getRows();var b=a.length;var c1=this.getTable().getFirstVisibleRow();var d1=[];for(var i=0;i<b;i++){if(a[i].getIndex()>=c1){var e1=a[i].getAggregation("_settings");d1.push(e1.getRowUid());}}return this._oExpandModel.collectExpandedBgData(d1,this.getExpandedRowHeight());}};b1.prototype.setAxisTimeStrategy=function(a){a.attachEvent("_redrawRequest",this._onRedrawRequest,this);delete this._bPreventInitialRender;return this.setAggregation("axisTimeStrategy",a,false);};b1.prototype._onTableRowsUpdated=function(a){if(!this.getVisible()){return;}var b=a.getParameter("reason"),i=this.getInnerGantt();var c1=v(c).slice();var d1=c1.concat(["Render","FirstVisibleRowChange","Resize"]);if(d1.indexOf(b)!==-1){this.getSyncedControl().setAllowContentScroll(false);i.invalidate();}else if(b==="VerticalScroll"){}else{i.getRenderer().renderImmediately(this);}};b1.prototype.syncVisibleHorizon=function(a,i,b,c1){var d1=this.getAxisTimeStrategy();var e1=d1.getTotalHorizon();var f1;var g1=this.getVisibleWidth();if(i!==undefined){if(g1===undefined){return;}if(b){var h1=d1.getVisibleHorizon();var i1=F.abapTimestampToDate(h1.getStartTime());f1=U.calculateHorizonByWidth(a,i,g1,i1);}else{f1=U.calculateHorizonByWidth(a,i,g1);}}else{f1=a;}if(e1.getEndTime()<f1.getEndTime()){var j1=F.abapTimestampToDate(f1.getEndTime()).getTime()-F.abapTimestampToDate(f1.getStartTime()).getTime();var k1=F.abapTimestampToDate(e1.getEndTime());var l1=new Date();l1.setTime(k1.getTime()-j1);f1=new T({startTime:l1,endTime:k1});}this._updateVisibleHorizon(f1,c1||"syncVisibleHorizon",g1);};b1.prototype._updateVisibleHorizon=function(a,b,i){var c1=this.getAxisTimeStrategy();c1.updateGanttVisibleWidth(i);if(a&&(a.getStartTime()||a.getEndTime())){c1.setVisibleHorizonWithReason(a,b);}};b1.prototype.syncMouseWheelZoom=function(a){this._getZoomExtension().performMouseWheelZooming(a.originEvent,true);};b1.prototype.syncTimePeriodZoomOperation=function(a,b,i){this._getZoomExtension().syncTimePeriodZoomOperation(a,b,i);};b1.prototype._onRedrawRequest=function(a){var b=a.getParameter("valueBeforeChange");var i=a.getParameter("reasonCode");if(b&&i!=="totalHorizonUpdated"&&i!=="initialRender"&&i!=="syncVisibleHorizon"){this._syncContainerGanttCharts(i,a.getParameter("originEvent"));}this.fireVisibleHorizonUpdate({type:X[i],lastVisibleHorizon:b,currentVisibleHorizon:this.getAxisTimeStrategy().getVisibleHorizon()});this.redraw(i);this._setupDisplayType();};b1.prototype.redraw=function(a){this._draw(a);};b1.prototype._draw=function(a){var i=this.getVisibleWidth();if(!i){return;}var b=this.getAxisTimeStrategy().syncContext(i);if(this.getAxisTimeStrategy().initialSettings!=null&&this.getAxisTimeStrategy().initialSettings.zoomLevel!=null&&this.getAxisTimeStrategy().initialSettings.zoomLevel!=0&&a=="initialRender"&&!this.getAxisTimeStrategy().isA("sap.gantt.axistime.FullScreenStrategy")&&!this.isPrint){var c1=this.getAxisTimeStrategy();var d1=c1.initialSettings.zoomLevel;c1.setProperty("zoomLevel",d1,true);b.zoomLevel=d1;var e1=c1.calVisibleHorizonByRate(c1._aZoomRate[d1]);c1.updateInitialVisibleHorizon(e1,d1);}this.fireEvent("_zoomInfoUpdated",b);var f1=this._getScrollExtension();if(b.axisTimeChanged){f1.clearOffsetWidth();}f1.needRerenderGantt(function(){this.getInnerGantt().getRenderer().renderImmediately(this);}.bind(this),a);};b1.prototype._syncContainerGanttCharts=function(a,b){var i=this.getParent();if(i&&i.isA("sap.gantt.simple.GanttChartContainer")&&i.getGanttCharts().length>1){this.fireEvent("_initialRenderGanttChartsSync",{reasonCode:a,visibleHorizon:this.getAxisTimeStrategy().getVisibleHorizon(),visibleWidth:this.getVisibleWidth(),originEvent:b});}};b1.prototype.onBeforeRendering=function(a){this._updateRowHeightInExpandModel(this.getTable());h.detachEvents(this);this._oSplitter.detachResize(this.onSplitterResize,this);if(this._sResizeHandlerId){R.deregister(this._sResizeHandlerId);}if(this.getDisplayType()!==N.Table){this.getInnerGantt().invalidate();}var b=this.getTable();if(this.getShowExportTableToExcel()){if(this.oExportTableToExcelButton==null){this.oExportTableToExcelButton=new H(this.getId()+"-exportTableToExcelButton",{icon:"sap-icon://excel-attachment",tooltip:Y.getText("EXPORT_BUTTON_TEXT"),type:sap.m.ButtonType.Transparent,buttonMode:sap.m.MenuButtonMode.Split,useDefaultActionOnly:true,defaultAction:[function(){this._exportTableToExcel();},this],menu:[new M({items:[new K({text:Y.getText("QUICK_EXPORT"),press:[function(){this._exportTableToExcel();},this]}),new K({text:Y.getText("EXPORT_WITH_SETTINGS"),press:[function(){this._createExportDialogBox();},this]})]})]});}t.addToolbarToTable(this,b,true);}else if(!this.getShowExportTableToExcel()&&(b.getExtension().length>0&&!(b.getExtension()[0].getContent().indexOf(this.oExportTableToExcelButton)===-1))){if(b.getExtension()[0].getContent().length==1){b.removeExtension(b.getExtension()[0]);}else if(b.getExtension()[0].getContent().length>1){b.getExtension()[0].removeContent(this.oExportTableToExcelButton);}}};b1.prototype.onAfterRendering=function(a){this._attachExtensions();h.attachEvents(this);this._oSplitter.attachResize(this.onSplitterResize,this);this._sResizeHandlerId=R.register(this,this._onResize.bind(this));if((this.mProperties.hasOwnProperty("height")||this.getParent().mProperties.hasOwnProperty("height"))){this.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Auto);this.getTable().setMinAutoRowCount(1);}};b1.prototype._onResize=function(i){if(this.getDisplayType()!==N.Both){return;}var a=this.getAggregation("_splitter");if(a.getContentAreas()[0]&&a.getContentAreas()[0].getLayoutData()){var b=a.getContentAreas()[0],c1=b.getLayoutData(),d1=this.getDomRef().offsetWidth,e1;if(d1<$*2){e1=d1/2;e1=e1+"px";}else{var f1=b.getDomRef().offsetWidth;if(f1>$){return;}if(this.getSelectionPanelSize()!=null&&f1==0&&i!=true){e1=this.getSelectionPanelSize();}else{e1=Math.max(Math.min(f1,d1-$),$);e1=e1+"px";}}c1.setSize(e1);}};b1.prototype._setupDisplayType=function(){var a=this.getDisplayType();if(a===N.Table){var i=this.getSyncedControl().$().find(".sapGanttBackgroundVScrollContentArea").width();this._setSplitterLayoutData("auto",i+"px");}else if(a===N.Chart){this._setSplitterLayoutData("0px","auto");}else if(a!==this._sPreviousDisplayType){this._setSplitterLayoutData(this._iLastTableAreaSize?this._iLastTableAreaSize+"px":this.getSelectionPanelSize(),"auto");}};b1.prototype._setSplitterLayoutData=function(a,b){var i=this._oSplitter.getContentAreas();if(i.length>1){var c1=i[0].getLayoutData(),d1=i[1].getLayoutData(),e1=this.getDisplayType()===N.Both;c1.setSize(a).setResizable(e1);d1.setSize(b).setResizable(e1);}};b1.prototype._updateRowHeightInExpandModel=function(a){var i=a.getRowHeight();if(i===0){i=a._getDefaultRowHeight();}this._oExpandModel.setBaseRowHeight(i);};b1.prototype.jumpToPosition=function(a){if(Object.prototype.toString.call(a)==="[object Date]"||typeof a==="string"){this._updateVisibleHorizon(new T({startTime:a}),"jumpToPosition",this.getVisibleWidth());}else if(Array.isArray(a)){this._updateVisibleHorizon(new T({startTime:a[0],endTime:a[1]}),"jumpToPosition",this.getVisibleWidth());}else if(a===undefined){this._updateVisibleHorizon(this.getAxisTimeStrategy().getTotalHorizon(),"jumpToPosition",this.getVisibleWidth());}};b1.prototype.exit=function(){if(this._sResizeHandlerId){R.deregister(this._sResizeHandlerId);}this._detachExtensions();delete this._bPreventInitialRender;};b1.prototype._attachExtensions=function(){if(this._bExtensionsInitialized){return;}h.enrich(this,j);h.enrich(this,k);h.enrich(this,m);h.enrich(this,n);h.enrich(this,o);h.enrich(this,p);h.enrich(this,r);h.enrich(this,s);this._bExtensionsInitialized=true;};b1.prototype._detachExtensions=function(){h.cleanup(this);};b1.prototype.getAxisTime=function(){var a=this.getAxisTimeStrategy().getAxisTime();if(!a){this.getAxisTimeStrategy().createAxisTime(this.getLocale());a=this.getAxisTimeStrategy().getAxisTime();}return a;};b1.prototype.getContentWidth=function(){var a=this.getAxisTime(),b=a.getViewRange();return(Math.abs(Math.ceil(b[1])-Math.ceil(b[0]))-1);};b1.prototype.getVisibleWidth=function(){return this._getScrollExtension?this._getScrollExtension().getVisibleWidth():undefined;};b1.prototype.expand=function(a,b){this.toggleShapeScheme(true,a,b);this._aExpandedIndices=this._aExpandedIndices.concat(b);this._aExpandedIndices=Array.from(new Set(this._aExpandedIndices));};b1.prototype.collapse=function(a,b){this.toggleShapeScheme(false,a,b);var i=[];i=i.concat(b);this._aExpandedIndices=this._aExpandedIndices.filter(function(c1){return!i.includes(c1);});};b1.prototype.toggleShapeScheme=function(b,a,i){var c1=[];if(typeof i==="number"){c1=[i];}else if(Array.isArray(i)){c1=i;}if(c1.length===0||!a){return;}var d1=this.getShapeSchemes().filter(function(g1){return g1.getKey()===a;});if(d1==null||d1.length===0||d1.length>1){return;}var e1=this.getPrimaryShapeScheme();var f1=this._oExpandModel.isTableRowHeightNeedChange(b,this.getTable(),c1,e1,d1[0]);if(f1){this.getTable().invalidate();}};b1.prototype.isShapeVisible=function(a){if(a&&a.isVisible()){return true;}if(!a.getVisible()){return false;}var b=this.getRenderedTimeRange(),i=b[0],c1=b[1];var d1=a.getTime(),e1=a.getEndTime();var f1=function(g1){return(g1>=i&&g1<=c1);};if(a.getSelected()||!d1||!e1){return true;}else if(d1&&e1){return f1(d1)||f1(e1)||(d1<=i&&e1>=c1);}else if(d1&&!e1){return f1(d1);}else if(!d1&&e1){return f1(e1);}};b1.prototype.doBirdEye=function(i){var a=this._getZoomExtension();a.doBirdEye(i);};b1.prototype._exportTableToExcel=function(a){var b,i,c1,d1,e1,f1;e1=this.getTable();if(e1){f1=e1.getBinding(e1._sAggregation);}if(f1.getModel().isA('sap.ui.model.json.JSONModel')){d1=true;}b=this._createColumnConfig();var g1=f1.getModel();i={workbook:{columns:b},fileName:a&&a.fileName?a.fileName:"GanttTableExport.xlsx",worker:false};if(d1){i.dataSource=this._createJSONDataSource(e1);}else{i.dataSource={type:"odata",dataUrl:f1.getDownloadUrl?f1.getDownloadUrl():null,serviceUrl:this._sServiceUrl,headers:g1.getHeaders?g1.getHeaders():null,count:f1.getLength?f1.getLength():null};}if(e1.getColumns()[0].data("exportTableColumnConfig")&&e1.getColumns()[0].data("exportTableColumnConfig").hierarchyNodeLevel){i.workbook.hierarchyLevel=e1.getColumns()[0].data("exportTableColumnConfig").hierarchyNodeLevel;}c1=new w(i);c1.build().finally(function(){c1.destroy();});};b1.prototype._createExportDialogBox=function(){this._getExportSettingsViaDialog().then(function(a){this._exportTableToExcel(a);}.bind(this));};b1.prototype._getExportSettingsViaDialog=function(a){return new Promise(function(b,i){var c1;var d1=new J();var e1={fileName:"GanttTableExport",fileType:[{key:"xlsx"}],selectedFileType:"xlsx"};d1.setData(e1);var f1=y();c1=new D({id:f1,title:Y.getText("EXPORT_SETTINGS_TITLE"),content:[new V({renderType:"Bare",width:"100%",items:[new L({text:Y.getText("FILE_NAME"),labelFor:f1+"-fileName"}),new z({id:f1+"-fileName",value:"{/fileName}",liveChange:function(g1){var h1=g1.getSource();var i1=g1.getParameter("value");var j1=/[\\/:|?"*<>]/;var k1=x.byId(f1+"-export");var l1=j1.test(i1);if(l1){h1.setValueState(sap.ui.core.ValueState.Error);h1.setValueStateText(Y.getText("FILENAME_ERROR"));}else if(i1.length>100){h1.setValueState(sap.ui.core.ValueState.Warning);h1.setValueStateText(Y.getText("FILENAME_WARNING"));}else{h1.setValueState(sap.ui.core.ValueState.None);h1.setValueStateText(null);}k1.setEnabled(!l1);}}).addStyleClass("sapUiTinyMarginBottom")]}).addStyleClass("sapUiExportSettingsLabel")],endButton:new B({id:f1+"-cancel",text:Y.getText("CANCEL_BUTTON"),press:function(){c1.close();}}),beginButton:new B({id:f1+"-export",text:Y.getText("QUICK_EXPORT"),type:sap.m.ButtonType.Emphasized,press:function(){if(c1){c1._bSuccess=true;c1.close();b(d1.getData());}}}),afterClose:function(){if(!c1._bSuccess){q.sap.log.warning("sap.gantt.simple.GanttChartWithTable ","Cancel Click on Export to Excel PopOver",this);i(null);}c1.destroy();c1=null;}});c1.addStyleClass("sapUiContentPadding sapUiExportSettings");c1.setModel(d1);c1.open();if(a){a(c1);}});};b1.prototype._createColumnConfig=function(){var a,i,b,c1,d1,e1,f1,g1,h1,i1=[],j1,k1,l1;this._oTable=this.getTable();a=this._oTable.getColumns();b=a.length;for(i=0;i<b;i++){f1=null;j1=null;k1=null;l1=null;h1=null;c1=a[i];if(c1.getVisible()){d1=c1.data("exportTableColumnConfig");if(!f1&&d1){f1=d1["leadingProperty"];}if(Array.isArray(f1)){f1=f1[0];}if(f1){e1=this._getColumnLabel(c1);g1=c1.getWidth().toLowerCase()||d1.width||"";g1=this._getColumnWidthNumber(g1);if(d1.unitProperty){h1=d1.isCurrency?sap.ui.export.EdmType.Currency:sap.ui.export.EdmType.Number;}else if(d1.isDigitSequence){h1=sap.ui.export.EdmType.Number;}if(!h1){switch(d1.dataType){case W.Numeric:h1=sap.ui.export.EdmType.Number;break;case W.DateTime:h1=sap.ui.export.EdmType.DateTime;l1=d1.displayFormat;break;case W.StringDate:case W.Date:h1=sap.ui.export.EdmType.Date;l1=d1.displayFormat;break;case W.Boolean:h1=sap.ui.export.EdmType.Boolean;j1="false";k1="true";break;case W.String:h1=sap.ui.export.EdmType.String;break;case W.Time:h1=sap.ui.export.EdmType.Time;break;default:h1=sap.ui.export.EdmType.String;break;}}i1.push({columnId:c1.getId(),property:f1,type:h1,format:l1?l1:undefined,label:e1?e1:f1,width:g1,textAlign:c1.getHAlign(),trueValue:(h1===sap.ui.export.EdmType.Boolean&&k1)?k1:undefined,falseValue:(h1===sap.ui.export.EdmType.Boolean&&j1)?j1:undefined,unitProperty:(h1===sap.ui.export.EdmType.Currency||(h1===sap.ui.export.EdmType.Number))?d1.unitProperty:undefined,displayUnit:h1===sap.ui.export.EdmType.Currency,unit:d1.unit?d1.unit:undefined,precision:d1.precision?d1.precision:undefined,scale:d1.scale?d1.scale:undefined,wrap:d1.wrap?d1.wrap:false});}}}return i1;};b1.prototype._getColumnLabel=function(a){var b;if(!a){return null;}if(a.getLabel){b=a.getLabel();}if(a.getHeader){b=a.getHeader();}return(b&&b.getText)?b.getText():null;};b1.prototype._getColumnWidthNumber=function(a){if(a.indexOf("em")>0){return Math.round(parseFloat(a));}if(a.indexOf("px")>0){return Math.round(parseInt(a,10)/16);}return"";};b1.prototype._createJSONDataSource=function(a){var b,i,c1,d1=[];b=a.getBinding(a._sAggregation).mParameters.arrayNames[0];i=a.getBinding().sPath;c1=a.getModel().getProperty(i);d1=this._generateJSONRowData(c1[b],b,d1);return d1;};b1.prototype._generateJSONRowData=function(a,b,c1){if(!a){return[];}if(!c1){c1=[];}for(var i=0;i<a.length;i++){c1.push(a[i]);if(a[i][b]){this._generateJSONRowData(a[i][b],b,c1);}}return c1;};return b1;},true);
