<core:FragmentDefinition
	xmlns:uxap="sap.uxap"
	xmlns:core="sap.ui.core"
	xmlns:template="http://schemas.sap.com/sapui5/extension/sap.ui.core.template/1"
	xmlns:fpm="sap.fe.macros.fpm"
	xmlns:macro="sap.fe.macros"
	xmlns:dt="sap.ui.dt"
	xmlns="sap.m"
	xmlns:opcontrol="sap.fe.templates.ObjectPage.controls"
	template:require="{
		fpm: 'sap/fe/macros/fpm/fpm',
		MODEL: 'sap/ui/model/odata/v4/AnnotationHelper',
		OP: 'sap/fe/templates/ObjectPage/AnnotationHelper',
		COMMON: 'sap/fe/macros/CommonHelper',
		ID: 'sap/fe/core/helpers/StableIdHelper'
	}"
>
		<!-- We want to ensure that statically non visible sections are non visible-->
         <template:if test="{subSection>visible}">
            <template:if test="{= ${subSection>type} === 'XMLFragment'}">
                <template:then>
                    <core:Fragment fragmentName="sap.fe.templates.ObjectPage.view.fragments.FormActions" type="XML" />
                    <fpm:CustomSection
					id="{subSection>id}"
					contextPath="{entitySet>}"
					section="{subSection>}"
					editMode="{ui>/editMode}"
					fragmentName="{subSection>template}"
					fragmentType="XML"
				/>
                </template:then>
                <template:elseif test="{= ${subSection>type} === 'Form'}">
                    <core:Fragment fragmentName="sap.fe.templates.ObjectPage.view.fragments.FormActions" type="XML" />
                    <uxap:blocks>
                    <opcontrol:SubSectionBlock>
                        <opcontrol:content>
                            <macro:Form
								id="{= ID.generate([${subSection>formDefinition/id}, 'Content']) }"
								facet="{subSection>annotationPath}"
								entitySet="{entitySet>}"
								useFormContainerLabels="{= ${subSection>formDefinition/useFormContainerLabels}}"
								partOfPreview="true"
								valueHelpRequestGroupId="$auto.Workers"
							/>
                        </opcontrol:content>
                    </opcontrol:SubSectionBlock>
                    </uxap:blocks>
                    <template:if test="{subSection>formDefinition/hasFacetsNotPartOfPreview}">
                        <template:then>
                            <!-- Button "Show More / Less" is displayed for a collection facets that contains at least one reference facets with annotation "PartOfPreview === TRUE" -->
                            <uxap:moreBlocks>
                                <template:if test="{= ${subSection>level} === 2}">
                                    <Title text="{subSection>title}" />
                                </template:if>
                                <opcontrol:SubSectionBlock>
                                    <opcontrol:content>
                                        <macro:Form
										id="{= ID.generate([${subSection>formDefinition/id}, 'MoreContent']) }"
										facet="{subSection>annotationPath}"
										entitySet="{entitySet>}"
										useFormContainerLabels="{= ${subSection>formDefinition/useFormContainerLabels}}"
										partOfPreview="false"
										valueHelpRequestGroupId="$auto.Workers"
									/>
                                    </opcontrol:content>
                                </opcontrol:SubSectionBlock>
                            </uxap:moreBlocks>
                        </template:then>
                    </template:if>
                </template:elseif>
                <template:elseif test="{= ${subSection>type} === 'DataVisualization'}">
                    <uxap:blocks>
                        <template:if test="{= ${subSection>level} === 2}">
                            <Title
							text="{subSection>title}"
							visible="{= ${subSection>visible} &amp;&amp; ${subSection>title} !=='undefined' &amp;&amp; ${subSection>showTitle} ? true : false}"
						/>
                        </template:if>
                         <opcontrol:SubSectionBlock visible="{subSection>visible}">
                            <opcontrol:content>
                                <template:with path="subSection>presentation" var="presentationContext">
									<template:repeat list="{presentationContext>visualizations}" var="visualizationDefinition">
										<core:Fragment fragmentName="sap.fe.templates.controls.{visualizationDefinition>type}" type="XML" />
									</template:repeat>
                                </template:with>
                            </opcontrol:content>
                        </opcontrol:SubSectionBlock>
                    </uxap:blocks>
                </template:elseif>
                <template:elseif test="{= ${subSection>type} === 'Unknown'}">
                    <Text text="{subSection>text}" />
                </template:elseif>
                <template:else>

                </template:else>
            </template:if>
         </template:if>
</core:FragmentDefinition>
