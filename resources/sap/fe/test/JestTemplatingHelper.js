sap.ui.define(["sap/fe/macros/internal/Field.metadata","sap/fe/macros/PhantomUtil","sap/ui/model/odata/v4/lib/_MetadataRequestor","sap/ui/model/odata/v4/ODataMetaModel","sap/ui/core/util/XMLPreprocessor","sap/base/Log","xpath","fs","@sap/cds-compiler","prettier","sap/ui/base/BindingParser","sap/ui/model/json/JSONModel","sap/ui/core/InvisibleText","sap/fe/core/converters/ConverterContext","sap/base/util/merge"],function(F,P,_,O,X,L,x,f,c,p,B,J,I,C,m){"use strict";var a={};var b=C.createConverterContext;var d=p.format;var t=c.to;var g=c.compileSources;var h=c.compactModel;P.register(F);L.setLevel(1,"sap.ui.core.util.XMLPreprocessor");jest.setTimeout(40000);var n={"control":"sap.fe.core.controls","core":"sap.ui.core","m":"sap.m","mdc":"sap.ui.mdc","mdcField":"sap.ui.mdc.field","u":"sap.ui.unified"};var s=x.useNamespaces(n);var r=function(e){P.register(e);};a.registerMacro=r;var i=function(e,D){return s(e,D);};expect.extend({toHaveControl:function(e,D){var E=i("/root".concat(D),e);return{message:function(){var G=k(e);return"did not find controls matching ".concat(D," in generated xml:\n ").concat(G);},pass:E&&E.length>=1};},toNotHaveControl:function(e,D){var E=i("/root".concat(D),e);return{message:function(){var G=k(e);return"There is a control matching ".concat(D," in generated xml:\n ").concat(G);},pass:E&&E.length===0};}});a.runXPathQuery=i;var j=function(e,D,E){var G="string(/root".concat(e,"/@").concat(D,")");return i(G,E);};a.getControlAttribute=j;var k=function(e){var D=new window.XMLSerializer();var E=D.serializeToString(e).replace(/(?:[\t ]*(?:\r?\n|\r))+/g,"\n").replace(/\\"/g,'"');return d(E,{parser:"html"});};a.serializeXML=k;var l=function(e){var D=f.readFileSync(e,"UTF8");var E=g({"string.cds":D},{});var G=h(E);var H=t.edmx(G,{service:"sap.fe.test.JestService"});var K=e.replace(".cds",".xml");K=K.replace(/\/([^\/]*)$/,"/gen/"+"$1");var M=K.slice(0,K.lastIndexOf("/"));if(!f.existsSync(M)){f.mkdirSync(M);}f.writeFileSync(K,H);return K;};a.compileCDS=l;var o=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"compact";return{getContentDensity:function(){return e;}};};a.getFakeShellService=o;var q=function(){var e=[];return{addIssue:function(D,E,G){e.push({issueCategory:D,issueSeverity:E,details:G});},getIssues:function(){return e;},checkIfIssueExists:function(D,E,G){return e.find(function(H){H.issueCategory===D&&H.issueSeverity===E&&H.details===G;});}};};a.getFakeDiagnostics=q;var u=function(e,D,E){var G=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"compact";var H=e.entitySets.find(function(M){return M.name===D.entitySet;});var K=w(H,H);return b(e,D,E,o(G),q(),m,K);};a.getConverterContext=u;var v=function(M){try{var R=_.create({},"4.0",{});var D=new O(R,M,undefined,null);return Promise.resolve(D.fetchEntityContainer()).then(function(){return D;});}catch(e){return Promise.reject(e);}};a.getMetaModel=v;var w=function(e,D){var E={startingEntitySet:e,navigationProperties:[],targetObject:D,targetEntitySet:e,targetEntityType:e.entityType};E.contextLocation=E;return E;};a.getDataModelObjectPathForProperty=w;var y=function(e){var D=B.complexParser(e);for(var E=arguments.length,G=new Array(E>1?E-1:0),H=1;H<E;H++){G[H-1]=arguments[H];}return D.formatter.apply(undefined,G);};a.evaluateBinding=y;var z=function(e,D){var E=B.complexParser(e);var G=new J(D);var H=new I();H.bindProperty("text",E);H.setModel(G);H.setBindingContext(G.createBindingContext("/"));return H.getText();};a.evaluateBindingWithModel=z;var A=function(D,M,E,G){try{var H="<root>".concat(D,"</root>");var K=new window.DOMParser();var N=K.parseFromString(H,"text/xml");return Promise.resolve(v(M)).then(function(Q){var R={models:Object.assign({metaModel:Q},G),bindingContexts:{}};Object.keys(E).forEach(function(S){expect(typeof Q.getObject(E[S])).toBeDefined();var T=G[S]||Q;R.bindingContexts[S]=T.createBindingContext(E[S]);R.models[S]=T;});if(R.models["this"]){R.bindingContexts["this"]=R.models["this"].createBindingContext("/");}return X.process(N.firstElementChild,{name:"Test Fragment"},R);});}catch(e){return Promise.reject(e);}};a.getTemplatingResult=A;return a;},false);
