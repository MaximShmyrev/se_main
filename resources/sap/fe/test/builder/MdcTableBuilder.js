sap.ui.define(["sap/ui/test/OpaBuilder","./FEBuilder","./MacroFieldBuilder","./OverflowToolbarBuilder","./DialogBuilder","sap/fe/test/Utils","sap/ui/table/library","sap/ui/test/matchers/Interactable","sap/ui/core/SortOrder","sap/ui/test/actions/EnterText"],function(O,F,M,a,D,U,G,I,S,E){"use strict";var R=G.RowActionType;function _(m){return m.getType().isA("sap.ui.mdc.table.GridTableType");}function b(m){return _(m)?"rows":"items";}function c(C,m){var k=Number(C);return Number.isNaN(k)?m.getColumns().findIndex(function(o){return o.getHeader()===C||o.getDataProperty()===C;}):k;}function d(t){var m=t;while(m&&!m.isA("sap.ui.mdc.Table")){m=m.getParent();}return m;}function e(C,r){var m=d(r);return m?c(C,m):-1;}function f(r,C){if(!r){return null;}if(r.isA("sap.ui.mdc.table.CreationRow")){return r._oInnerCreationRow._getCell(C);}if(r.isA("sap.ui.table.CreationRow")){return r._getCell(C);}return r.getCells()[C];}function g(C,B){var s={controlType:"sap.m.Button"},o;if(B){s.text=B;}o=F.Matchers.states(s);return o(C)?[C]:O.Matchers.children(o)(C);}function h(C,r){var k=Number(C);if(Number.isNaN(k)){return r.getCells().reduce(function(p,o){return p.concat(g(o,C));},[]);}return g(f(r,k));}function i(r){var o=r.getRowAction();return o.getItems().reduce(function(k,A,l){if(!k&&A.getType()===R.Navigation){k=o.getAggregation("_icons")[l];}return k;},null);}function j(r){var k=[new I(),F.Matchers.bound()];if(U.isOfType(r,Object)){r=T.Row.Matchers.cellValues(r);}if(r){k=k.concat(r);}return k;}var T=function(){return F.apply(this,arguments).hasType("sap.ui.mdc.Table");};T.create=function(o){return new T(o);};T.prototype=Object.create(F.prototype);T.prototype.constructor=T;T.prototype.getStatesMatcher=function(s){return T.Matchers.states(s);};T.prototype.hasColumns=function(C,k){if(!C||Object.keys(C).length===0){return this;}return this.has(T.Matchers.columnsMatcher(C,k));};T.prototype.hasRows=function(r,k){r=j(r);return k?this.has(T.Matchers.rows(r)):this.has(T.Matchers.rowsMatcher(r));};T.prototype.doOnRows=function(r,v){if(arguments.length===1){v=r;r=undefined;}if(!v){return this;}return this.hasRows(r,true).do(O.Actions.executor(v));};T.prototype.doClickOnCell=function(r,C){return this.doOnRows(r,T.Row.Actions.onCell(C,O.Actions.press()));};T.prototype.doScroll=function(s){return this.has(function(t){switch(s){case"up":t.scrollToIndex(0);break;case"down":t.scrollToIndex(-1);break;default:t.scrollToIndex(-1);break;}return typeof t.scrollToIndex==="function";});};T.prototype.doPressKeyboardShortcut=function(s,r,C){if(r&&C){return this.doOnRows(r,T.Row.Actions.onCell(C,F.Actions.keyboardShortcut(s,"input")));}return this.do(F.Actions.keyboardShortcut(s));};T.prototype.doEditValues=function(r,C){if(arguments.length===1){C=r;r=undefined;}return this.hasColumns(C,true).doOnRows(r,T.Row.Actions.editCells(C));};T.prototype.doEditCreationRowValues=function(C){return this.hasColumns(C,true).has(O.Matchers.aggregation("creationRow")).do(T.Row.Actions.editCells(C));};T.prototype.doSelect=function(r){return this.doOnRows(r,function(o){if(o.getMetadata().getName()==="sap.ui.table.Row"){var t=o.getParent(),k=t.indexOfRow(o);return O.Actions.press("rowsel"+k).executeOn(t);}return O.Actions.press().executeOn(o.getMultiSelectControl());});};T.prototype.doSelectAll=function(){return this.do(function(t){var k=_(t);if(k){return O.Actions.press("selall").executeOn(t.getAggregation("_content"));}return O.Actions.press("sa").executeOn(t.getAggregation("_content"));});};T.prototype.doNavigate=function(r){return this.doOnRows(r,function(o){if(o.getMetadata().getName()==="sap.ui.table.Row"){return O.Actions.press().executeOn(i(o));}return O.Actions.press("imgNav").executeOn(o);});};T.prototype.hasOverlay=function(H){return this.has(T.Matchers.overlay(H));};T.prototype.hasNumberOfRows=function(n){return this.has(function(t){var r=t.getRowBinding(),H=T.Matchers.overlay(true)(t);return((r&&!H&&(n===undefined?r.getLength()!==0:r.getLength()===n))||((!r||H)&&n===0));});};T.prototype.hasQuickFilterItems=function(n){return this.has(function(t){var q=t.getQuickFilter();if(q){var k=q.getSelector().getItems();if(U.isOfType(k,Array)){return k.length===n;}return false;}return false;});};T.prototype.doSelectQuickFilter=function(o){return this.has(function(t){return t.getQuickFilter().getSelector();}).doConditional(F.Matchers.state("controlType","sap.m.Select"),O.Actions.press()).success(function(q){return F.create(this).hasId([].concat(q)[0].getId()).doOnAggregation("items",o,O.Actions.press()).execute();}.bind(this));};T.prototype.doOpenOverflow=function(){return a.openOverflow(this,"toolbar");};T.prototype.doCloseOverflow=function(){return a.closeOverflow(this,"toolbar");};T.prototype.doExecuteAction=function(A){var s=new T(this.getOpaInstance(),this.build()).doOnAggregation("actions",A,O.Actions.press());return this.doOpenOverflow().success(s);};T.prototype.doOpenColumnAdaptation=function(){return this.doOpenOverflow().success(function(t){return O.create().hasType("sap.m.Button").hasId(/-settings$/).has(O.Matchers.ancestor(t)).doPress().execute();});};T.prototype.doOpenColumnSorting=function(){return this.doOpenOverflow().success(function(t){return O.create().hasType("sap.m.Button").hasId(/-sort$/).has(O.Matchers.ancestor(t)).doPress().execute();});};T.prototype.doOpenFilterDialog=function(){return this.doOpenOverflow().success(function(t){return O.create().hasType("sap.m.Button").hasId(/-filter$/).has(O.Matchers.ancestor(t)).doPress().execute();});};T.prototype.doExecuteInlineAction=function(r,C){return this.doOnRows(r,T.Row.Actions.pressInlineAction(C));};T.prototype.doPasteData=function(k){return this.do(function(m){m.firePaste({data:k});});};T.createAdaptationDialogBuilder=function(o){return D.create(o).has(O.Matchers.resourceBundle("title","sap.ui.mdc","table.SETTINGS_COLUMN"));};T.createSortingDialogBuilder=function(o){return D.create(o).has(O.Matchers.resourceBundle("title","sap.ui.mdc","table.SETTINGS_SORT"));};T.createFilteringDialogBuilder=function(o){return D.create(o).has(O.Matchers.resourceBundle("title","sap.ui.mdc","filter.PERSONALIZATION_DIALOG_TITLE"));};T.Cell={Matchers:{state:function(n,v){switch(n){case"editor":case"editors":return function(C){return M.Matchers.states(v)(C);};default:return F.Matchers.state(n,v);}},states:function(s){return F.Matchers.states(s,T.Cell.Matchers.state);}}};T.Column={Matchers:{state:function(n,v){switch(n){case"sortOrder":return T.Column.Matchers.sortOrder(v);case"template":case"creationTemplate":return function(C){return M.Matchers.states(v)(C.getAggregation(n));};default:return F.Matchers.state(n,v);}},states:function(s){return F.Matchers.states(s,T.Column.Matchers.state);},sortOrder:function(s){return function(m){var o=m.getParent(),k=_(o),p={};if(k){p.sorted=s===S.None?false:true;if(s!==S.None){p.sortOrder=s;}}else{p.sortIndicator=s;}return F.controlsExist(F.create().hasId(m.getId()+"-innerColumn").hasProperties(p));};}}};T.Row={Matchers:{cell:function(C){return function(r){var k=e(C,r);return f(r,k);};},cellValue:function(C,v){return function(r){var o=T.Row.Matchers.cell(C)(r);return M.Matchers.value(v)(o);};},cellValues:function(C){if(!C){return O.Matchers.TRUE;}return F.Matchers.match(Object.keys(C).map(function(s){return T.Row.Matchers.cellValue(s,C[s]);}));},cellProperty:function(C,o){return function(r){var k=T.Row.Matchers.cell(C)(r);return T.Cell.Matchers.states(o)(k);};},cellProperties:function(C){if(!C){return O.Matchers.TRUE;}return F.Matchers.match(Object.keys(C).map(function(s){return T.Row.Matchers.cellProperty(s,C[s]);}));},selected:function(s){return function(r){var t=r.getParent(),m=t.getParent(),k=_(m),l=k?t.getSelectedIndices.includes(t.indexOfRow(r)):r.getSelected();return s?l:!l;};},navigated:function(n){return function(r){var k;if(r.getMetadata().getName()==="sap.ui.table.Row"){k=r.getAggregation("_settings").getNavigated();}else{k=r.getNavigated();}return n?k:!k;};},focused:function(){return function(r){var k=[r];if(r.getMetadata().getName()==="sap.ui.table.Row"){k.push(i(r));}return k.some(O.Matchers.focused(true));};},highlighted:function(H){return function(r){var s;if(r.getMetadata().getName()==="sap.ui.table.Row"){s=r.getAggregation("_settings").getHighlight();}else{s=r.getHighlight();}return H===s;};},states:function(s){if(!U.isOfType(s,Object)){return O.Matchers.TRUE;}return F.Matchers.match(Object.keys(s).map(function(p){switch(p){case"selected":return T.Row.Matchers.selected(s.selected);case"focused":return T.Row.Matchers.focused();case"navigated":return T.Row.Matchers.navigated(s.navigated);case"highlight":return T.Row.Matchers.highlighted(s.highlight);default:return F.Matchers.state(p,s[p]);}}));}},Actions:{onCell:function(C,v){return function(r){var k=e(C,r),o=f(r,k);if(o.isA("sap.fe.core.controls.FieldWrapper")){o=o.getEditMode()==="Display"?o.getContentDisplay():o.getContentEdit()[0];}if(o.isA("sap.fe.core.controls.LinkWrapper")){o=o.getHasTargetsAvailable()?o.getContentTargets():o.getContentNoTargets();}if(v.executeOn){v.executeOn(o);}else{v(o);}};},editCell:function(C,v){return T.Row.Actions.onCell(C,new E({text:v,clearTextFirst:true,keepFocus:false,idSuffix:null,pressEnterKey:true}));},editCells:function(C){return Object.keys(C).map(function(s){return T.Row.Actions.editCell(s,C[s]);});},onCellInlineAction:function(C,v){return function(r){var B=h(C,r);return O.Actions.executor(v)(B);};},pressInlineAction:function(C){return T.Row.Actions.onCellInlineAction(C,O.Actions.press());}}};T.Matchers={isGridTable:function(){return _;},rows:function(r){return function(m){if(T.Matchers.overlay(true)(m)){return[];}return O.Matchers.aggregation(b(m),r)(m._oTable);};},rowsMatcher:function(r){var m=T.Matchers.rows(r);return function(o){return m(o).length>0;};},columns:function(C,k){return function(m){var l=Object.keys(C).map(function(v){return{index:c(v,m),states:C[v]};}),n=U.getAggregation(m,"columns");return l.reduce(function(r,o){if(o.index===-1){if(o.states&&o.states.visible===false){r.push(null);}}else{var p=n[o.index];if(p&&(k||!o.states||F.Matchers.match(T.Column.Matchers.states(o.states))(p))){r.push(p);}}return r;},[]);};},columnsMatcher:function(C,k){var m=T.Matchers.columns(C,k);return function(o){return m(o).length===Object.keys(C).length;};},overlay:function(H){if(H===undefined){H=true;}return function(m){return m&&m._oTable.getShowOverlay()===H;};},state:function(n,v){switch(n){case"overlay":return T.Matchers.overlay(v);default:return F.Matchers.state(n,v);}},states:function(s){return F.Matchers.states(s,T.Matchers.state);}};T.Actions={};return T;});
