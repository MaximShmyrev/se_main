/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/model/json/JSONModel","sap/fe/macros/CommonHelper","sap/fe/core/library","sap/fe/core/helpers/StableIdHelper","sap/fe/core/AnnotationHelper","sap/ui/model/odata/v4/AnnotationHelper","sap/fe/core/converters/ConverterContext","sap/fe/macros/SizeHelper"],function(J,C,F,S,A,O,a,b){"use strict";var c=F.CreationMode;var T={_isStaticAction:function(o,s){if(o){var d=Array.isArray(o)?o[0]:o;}if(s&&s.indexOf("(")>-1){var p=s.split("(");var e=p[1].slice(0,-1);if(d&&d.getModel().getMetaModel().getMetaContext(d.getPath()).getObject("$Type")!==e){return true;}}if(d&&d.$IsBound&&d.$Parameter[0].$isCollection){return true;}},createButtonTemplating:function(t,d){var o=t.collection,s=t.creationMode,n,N,e=t.navigationPath,f=C.getTargetCollection(t.collection,t.navigationPath),r=t.parentEntitySet.getObject(t.parentEntitySet.getPath()+"@Org.OData.Capabilities.V1.NavigationRestrictions/RestrictedProperties");for(var i in r){n=r[i];if(n.NavigationProperty.$NavigationPropertyPath===e&&n.InsertRestrictions&&n.InsertRestrictions.Insertable){N=n.InsertRestrictions.Insertable;}}if(t.showCreate==="false"){return false;}if(s===c.CreationRow&&d===false){return false;}else if(o.getObject(f+"@com.sap.vocabularies.Session.v1.StickySessionSupported/NewAction")){return(o.getObject(f+"@com.sap.vocabularies.Session.v1.StickySessionSupported/NewAction@Org.OData.Core.V1.OperationAvailable")!==false);}else if(o.getObject(f+"@com.sap.vocabularies.Common.v1.DraftRoot/NewAction")){return(o.getObject(f+"@com.sap.vocabularies.Common.v1.DraftRoot/NewAction@Org.OData.Core.V1.OperationAvailable")!==false);}else if(N===false){return false;}else if(N){return true;}else if(s===c.External){return true;}return(o.getObject(f+"@Org.OData.Capabilities.V1.InsertRestrictions/Insertable")!==false);},deleteButtonTemplating:function(t){if(t.showDelete!==undefined&&t.showDelete!==null){return t.showDelete;}else{return true;}},addPresentationVariantToSelectQuery:function(p,P){var r=[];if(!(p&&C._isPresentationVariantAnnotation(P)&&p.RequestAtLeast&&p.RequestAtLeast.length>0)){return"";}p.RequestAtLeast.forEach(function(R){r.push(R.$PropertyPath);});return r.join(",");},addOperationAvailableFieldsToSelectQuery:function(l,o){var s=[],d="";l.forEach(function(r){var e=r.Action;if(r.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&e.indexOf("/")<0&&!r.Determining){if(C.getActionPath(o.context,false,e,true)===null){s.push(e);}else{var R=C.getActionPath(o.context,false,e);if(R.sProperty){s.push(R.sProperty.substr(R.sBindingParameter.length+1));}}}});d=s.join(",");return d;},addFieldsHavingTextArrangementToSelectQuery:function(l,o){var s=[],d=[],e="",n=0,p=o.context.getPath();l.forEach(function(r){if(r.$Type==="com.sap.vocabularies.UI.v1.DataField"||r.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){var f=o.context.getObject(p+"/"+n+"/Value/$Path@");if(f&&f["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"]&&f["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"].$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly"){s.push(r.Value.$Path);}else{var g=o.context.getObject(p+"/"+n+"/Target/$AnnotationPath@/Data/");if(f===undefined&&g){g.forEach(function(f,i){if(f.$Type==="com.sap.vocabularies.UI.v1.DataField"){return d.push(o.context.getObject(p+"/"+n+"/Target/$AnnotationPath@/Data/"+i+"/Value/$Path@"));}});if(d.length>0){for(var h in d){if(d[h]["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"]&&d[h]["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"].$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly"){s.push(h.Value.$Path);}}}}}}n++;});e=s.join(",");return e;},getOperationAvailableMap:function(l,o){var d={},r;l.forEach(function(R){var s=R.Action;if(R.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&s.indexOf("/")<0&&!R.Determining){r=C.getActionPath(o.context,false,s,true);if(r===null){d[s]=null;}else{r=C.getActionPath(o.context,false,s);if(r.sProperty){d[s]=r.sProperty.substr(r.sBindingParameter.length+1);}}}});return JSON.stringify(d);},getMultiSelectDisabledActions:function(l,o){var m=[],s,d,e,p,f;var g=l.filter(function(i){return i.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction";});g.forEach(function(h){d=h.Action;s=C.getActionPath(o.context,true,d,false);f=o.context.getObject(s+"/@$ui5.overload/0");if(f&&f.$Parameter&&f.$IsBound){for(var n in f.$Parameter){e=s+"/"+f.$Parameter[n].$Name+"@";p=o.context.getObject(e);if(p&&((p["@com.sap.vocabularies.UI.v1.Hidden"]&&p["@com.sap.vocabularies.UI.v1.Hidden"].$Path)||(p["@com.sap.vocabularies.Common.v1.FieldControl"]&&p["@com.sap.vocabularies.Common.v1.FieldControl"].$Path))){m.push(d);break;}}}});return m;},getUiLineItem:function(p){var P=p.getObject(p.sPath),o=C.createPresentationPathContext(p),m=p.getModel();if(C._isPresentationVariantAnnotation(o.getPath())){var l="@com.sap.vocabularies.UI.v1.LineItem",v=P.Visualizations;if(Array.isArray(v)){for(var i=0;i<v.length;i++){if(v[i].$AnnotationPath.indexOf(l)!==-1){l=v[i].$AnnotationPath;break;}}}return m.getMetaContext(p.getPath().split("@")[0]+l);}return p;},getCollectionFields:function(e,m){var p=[],o,E;E=m.getObject(e+"/");for(var k in E){o=E[k];if(o&&o.$kind==="Property"){p.push({name:k,label:m.getObject(e+"/"+k+"@com.sap.vocabularies.Common.v1.Label"),type:o.$Type});}}return p;},create$Select:function(o,s,p,P,d){var e=T.addPresentationVariantToSelectQuery(p,P);var f=(s?s:"")+(s&&e?",":"")+e;if(d){d.forEach(function(g){f+=f?","+g.$PropertyPath:g.$PropertyPath;});}if(o&&o["@Org.OData.Capabilities.V1.DeleteRestrictions"]&&o["@Org.OData.Capabilities.V1.DeleteRestrictions"].Deletable.$Path){var r=o["@Org.OData.Capabilities.V1.DeleteRestrictions"].Deletable.$Path;f+=f?","+r:r;}return!f?"":", $select: '"+f+"'";},getColumnMinWidth:function(o,d,n,D,f){var e,h=o&&o.hasOwnProperty("@com.sap.vocabularies.Common.v1.Text"),i=typeof o!=="undefined"&&(o.hasOwnProperty("@Org.OData.Measures.V1.Unit")||o.hasOwnProperty("@Org.OData.Measures.V1.ISOCurrency"));if(d==="Edm.String"&&!h&&n&&n<10){n+=0.75;if(n<3){n=3;}e=n;}else if(d==="Edm.Decimal"&&i){if(C.getEditMode(o,D,f)!=="Display"){e=20;}else{e=12;}}if(e){return e;}else{return 8;}},getColumnWidth:function(d,o,D,f,s,n,e,g){var w,h=false;if(d){return d;}else if(s==="Edm.Date"||s==="Edm.TimeOfDay"||D==="Edm.Date"||D==="Edm.TimeOfDay"){w="9em";}else if(s==="Edm.DateTimeOffset"||D==="Edm.DateTimeOffset"){w="14em";}else if(s==="Edm.Boolean"||D==="Edm.Boolean"){w="8em";}else if(C.getEditMode(o,D,f)==="Display"){h=o&&o.hasOwnProperty("@com.sap.vocabularies.Common.v1.Text");if(s==="Edm.Stream"&&!h&&o.hasOwnProperty("@Org.OData.Core.V1.MediaType")&&o["@Org.OData.Core.V1.MediaType"].includes("image/")){w="7em";}}else if(o&&((o.hasOwnProperty("@com.sap.vocabularies.UI.v1.IsImageURL")&&o.hasOwnProperty("@com.sap.vocabularies.UI.v1.IsImageURL")===true)||(o.hasOwnProperty("@Org.OData.Core.V1.MediaType")&&o["@Org.OData.Core.V1.MediaType"].includes("image/")))){w="7em";}else if(D==="com.sap.vocabularies.UI.v1.DataFieldForAction"||D==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||D==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){var i,j;if(g&&g.length>=e.Label.length){i=b.getButtonWidth(g);}else if(e){i=b.getButtonWidth(e.Label);}else{i=b.getButtonWidth(o.Label);}if(n){j=n*2;}if(!isNaN(j)&&j>i){w=j+"em";}else if(g||(o&&(o.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||o.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"))){i+=2;w=i+"em";}}if(w){return w;}else{return"auto";}},getMarginClass:function(o,d,v){var e=true;for(var i=0;i<o.length;i++){if(o[i]["@com.sap.vocabularies.UI.v1.Hidden"]!==undefined&&o[i]["@com.sap.vocabularies.UI.v1.Hidden"]!==false){e=false;}}if(e){if(JSON.stringify(o[o.length-1])==JSON.stringify(d)){if(v=="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){return"sapUiNoMarginBottom sapUiNoMarginTop";}return"";}else{if(v=="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){return"sapUiNoMarginTop";}return"sapUiTinyMarginBottom";}}else{return undefined;}},getVBoxVisibility:function(o){var d=true;var h=[];for(var i=0;i<o.length;i++){if(o[i]["@com.sap.vocabularies.UI.v1.Hidden"]!==undefined&&o[i]["@com.sap.vocabularies.UI.v1.Hidden"]!==false){if(o[i]["@com.sap.vocabularies.UI.v1.Hidden"]!==true){h.push(o[i]["@com.sap.vocabularies.UI.v1.Hidden"].$Path);d=false;}else{h.push(o[i]["@com.sap.vocabularies.UI.v1.Hidden"]);}}else{h.push(false);}}if(h.length>0&&d!==true){var e="{parts:[";for(var j=0;j<h.length;j++){if(j!==h.length-1){if(typeof h[j]==="boolean"){e=e+"{value: '"+h[j]+"'},";}else{e=e+"{path: '"+h[j]+"'},";}}else{if(typeof h[j]==="boolean"){e=e+"{value: '"+h[j]+"'}], formatter: 'sap.fe.macros.table.TableRuntime.getVBoxVisibility'}";}else{e=e+"{path: '"+h[j]+"'}], formatter: 'sap.fe.macros.table.TableRuntime.getVBoxVisibility'}";}}}return e;}else if(h.length>0&&h.indexOf(false)===-1&&d){return false;}else{return true;}},formatHiddenFilters:function(h){if(h){try{return JSON.stringify(h);}catch(e){return undefined;}}return undefined;},getColumnStableId:function(i,d){return i?S.generate([i,"C",(d.Target&&d.Target.$AnnotationPath)||(d.Value&&d.Value.$Path)||(d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"?d:"")]):undefined;},getRowsBindingInfo:function(t,o,s,d,l,p,P,e,f){var r={ui5object:true,suspended:false,path:C.addSingleQuotes((o.$kind==="EntitySet"?"/":"")+(t.navigationPath||s)),parameters:{$count:true},events:{}};if(f&&l!==""){l=l+","+f;}else if(f){l=f;}var g=T.create$Select(d,l,p,P,e);if(g){r.parameters.$select=g.split(": ")[1];}r.parameters.$$groupId=C.addSingleQuotes("$auto.Workers");r.parameters.$$updateGroupId=C.addSingleQuotes("$auto");if(t.onPatchSent){r.events.patchSent=C.addSingleQuotes(t.onPatchSent);}if(t.onPatchCompleted){r.events.patchCompleted=C.addSingleQuotes(t.onPatchCompleted);}if(t.onDataReceived){r.events.dataReceived=C.addSingleQuotes(t.onDataReceived);}if(t.onContextChange){r.events.change=C.addSingleQuotes(t.onContextChange);}return C.objectToString(r);},filterLineItemsForColumn:function(d,i){return((!d.Action&&!d.SemanticObject&&!d.Inline)||(d.Inline&&((i&&d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction")||d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"))||d.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath");},creationRowApplyEnabled:function(t,o,s,p,d){var e=A.getNavigationInsertableRestrictions(o,s,p,d,true);if(typeof e==="string"&&(t.disableAddRowButtonForEmptyData==="true"||t.disableAddRowButtonForEmptyData===true)){e=e.substring(0,e.length-1);return(e+" && ${path: 'creationRowFieldValidity' , model: 'internal', formatter: 'RUNTIME.validateCreationRowFields'}}");}return e;},creationRowVisible:function(s,d){if(s&&s==="{=  ${ui>/editMode} === 'Editable'}"){return s;}else{return s.replace(d+"/","");}},validateCreationRowFields:function(f){if(!f){return false;}return(Object.keys(f).length>0&&Object.keys(f).every(function(k){return f[k]["validity"];}));},pressEventDataFieldForActionButton:function(t,d,e,o,f,i,E){var s,g;s=this._isStaticAction(f,d.Action);g="${internal>selectedContexts}";var I=d.InvocationGrouping&&d.InvocationGrouping.$EnumMember==="com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated";var p={contexts:g,bStaticAction:s?s:undefined,entitySetName:C.addSingleQuotes(e),invocationGrouping:C.addSingleQuotes(I),prefix:C.addSingleQuotes(t.id),operationAvailableMap:C.addSingleQuotes(o),model:"${$source>/}.getModel()",label:C.addSingleQuotes(d.Label),applicableContext:"${internal>dynamicActions/"+d.Action+"/aApplicable/}",notApplicableContext:"${internal>dynamicActions/"+d.Action+"/aNotApplicable/}",isNavigable:i,enableAutoScroll:E};return C.generateFunction(".editFlow.invokeAction",C.addSingleQuotes(d.Action),C.objectToString(p));},isDataFieldForActionEnabled:function(t,d,r,i,o,s){var e=this._isStaticAction(o,d.Action);if(!r||e){return true;}var D="";if(i){D="%{internal>numberOfSelectedContexts} >= 1";}else{if(s==="single"){var n="${internal>numberOfSelectedContexts} === 1";}else{var n="${internal>numberOfSelectedContexts} > 0";}var f="${internal>dynamicActions/"+d.Action+"/bEnabled"+"}";D=n+" && "+f;}return"{= "+D+"}";},pressEventForCreateButton:function(t,d){var s=t.creationMode,p,m=d?"${$source>}.getParent()":"${$source>}.getParent().getParent().getParent()",r=m+".getRowBinding() || "+m+".getRowsBindingInfo().path";switch(s){case c.External:p={creationMode:C.addSingleQuotes(c.External),outbound:C.addSingleQuotes(t.createOutbound)};break;case c.CreationRow:p={creationMode:C.addSingleQuotes(c.CreationRow),creationRow:"${$source>}",createAtEnd:t.createAtEnd!==undefined?t.createAtEnd:false};r="${$source>}.getParent()._getRowBinding()";break;case c.NewPage:case c.Inline:p={creationMode:C.addSingleQuotes(s),createAtEnd:t.createAtEnd!==undefined?t.createAtEnd:false,tableId:C.addSingleQuotes(t.id)};if(t.createNewAction){p.newAction=C.addSingleQuotes(t.createNewAction);}break;default:return undefined;}return C.generateFunction(".editFlow.createDocument",r,C.objectToString(p));},pasteEvent:function(t){if(!t.onPaste){return undefined;}var s=t.createAtEnd,d=s!==undefined?s:false;return C.generateFunction(t.onPaste,"$event",d);},getIBNData:function(t){var o=t.createOutboundDetail;if(o){var i={semanticObject:C.addSingleQuotes(o.semanticObject),action:C.addSingleQuotes(o.action)};return C.objectToString(i);}},isCreateButtonEnabled:function(o,s,r,i){var I=o.$kind==="EntitySet";return I?undefined:A.getNavigationInsertableRestrictions(o,s,r,i,false);},pressEventForDeleteButton:function(t,e){var d="${internal>deletableContexts}";var p={id:C.addSingleQuotes(t.id),entitySetName:C.addSingleQuotes(e),numberOfSelectedContexts:"${internal>selectedContexts}.length",unSavedContexts:"${internal>unSavedContexts}",lockedContexts:"${internal>lockedContexts}",controlId:"${internal>controlId}"};return C.generateFunction(".editFlow.deleteMultipleDocuments",d,C.objectToString(p));},isDeleteButtonEnabled:function(t){var d="%{internal>deletableContexts}",n=d+".length > 0",D="("+d+" && "+n+")",u="%{internal>unSavedContexts}",N=u+".length > 0",U="("+u+" && "+N+")",s="("+D+" || "+U+")",e="%{internal>deleteEnabled}",f="%{internal>numberOfSelectedContexts}",p=t.parentEntityDeleteEnabled;var E;if(p==="true"){E="{= "+f+" ? "+true+" : false}";}else if(p!=="false"&&typeof p==="string"){E="{= "+f+" ? "+p+": false}";}else{E="{= "+s+" ? "+e+" : false}";}return E;},handleTableDeleteEnablementForSideEffects:function(t,I){if(t&&I){var d=T.getDeletablePathForTable(t),s=t.getSelectedContexts(),D=[],e=I.getProperty("deletableContexts")||[];for(var i=0;i<s.length;i++){if(d!==undefined){var o=s[i];if(o&&o.getProperty(d)){I.setProperty("deleteEnabled",true);D.push(o);}else{I.setProperty("deleteEnabled",false);}}}if(!e.length&&D.length>0){I.setProperty("deletableContexts",D);}}},getDeletablePathForTable:function(t){var m=t&&t.getModel()&&t.getModel().getMetaModel(),p=t.getRowBinding()&&t.getRowBinding().getPath();if(m&&t&&!m.getObject(p)){var s=t.getRowBinding()&&t.getRowBinding().getContext()&&t.getRowBinding().getContext().getPath(),M=m.getMetaPath(s);p=m.getObject(M)&&m.getObject(M)["$NavigationPropertyBinding"]&&m.getObject(M)["$NavigationPropertyBinding"][p];p="/"+p;}var d=m&&m.getObject(p+"@Org.OData.Capabilities.V1.DeleteRestrictions/Deletable");return d&&d.$Path;},pressEventForPasteButton:function(t){var m="${$source>}.getParent().getParent().getParent()";return C.generateFunction(t.onPasteButtonPressed,m);},filterLineItems:function(d){return(d.Inline!==true&&d.Determining!==true&&d["@com.sap.vocabularies.UI.v1.Hidden"]!==true);},getHiddenPathExpressionForTableActionsAndIBN:function(h,d){var o=d.context,p=o.getPath(),e=O.getNavigationPath(p);if(h.indexOf("/")>0){var s=h.split("/");var n=s[0];if(o.getObject(e+"/$Partner")===n){return"{= !%{"+s.slice(1).join("/")+"} }";}}return true;},setHeaderLabelVisibility:function(d,e){if(!e){if(d.$Type.indexOf("DataFieldForAction")>-1&&d.Inline){return false;}if(d.$Type.indexOf("DataFieldForIntentBasedNavigation")>-1&&d.Inline){return false;}return true;}return e.some(function(D){if((D.$Type==="com.sap.vocabularies.UI.v1.DataField"||D.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation")&&D["@com.sap.vocabularies.UI.v1.Hidden"]!==true){return true;}});},getValueOnRatingField:function(d,o){if(d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){if(o.context.getObject("Target/$AnnotationPath").indexOf("@com.sap.vocabularies.UI.v1.DataPoint")>-1&&o.context.getObject("Target/$AnnotationPath/$Type")=="com.sap.vocabularies.UI.v1.DataPointType"&&o.context.getObject("Target/$AnnotationPath/Visualization/$EnumMember")=="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){return o.context.getObject("Target/$AnnotationPath/TargetValue");}if(o.context.getObject("Target/$AnnotationPath").indexOf("@com.sap.vocabularies.UI.v1.FieldGroup")>-1){var p="Target/$AnnotationPath/Data/";for(var i in o.context.getObject(p)){if(o.context.getObject(p+i+"/$Type")==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&o.context.getObject(p+i+"/Target/$AnnotationPath").indexOf("@com.sap.vocabularies.UI.v1.DataPoint")>-1&&o.context.getObject(p+i+"/Target/$AnnotationPath/$Type")=="com.sap.vocabularies.UI.v1.DataPointType"&&o.context.getObject(p+i+"/Target/$AnnotationPath/Visualization/$EnumMember")=="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){return o.context.getObject(p+i+"/Target/$AnnotationPath/TargetValue");}}}}},getTextOnActionField:function(d,o){if(d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){return d.Label;}if(d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&o.context.getObject("Target/$AnnotationPath").indexOf("@com.sap.vocabularies.UI.v1.FieldGroup")>-1){var p="Target/$AnnotationPath/Data/";for(var i in o.context.getObject(p)){if(o.context.getObject(p+i+"/$Type")==="com.sap.vocabularies.UI.v1.DataFieldForAction"||o.context.getObject(p+i+"/$Type")==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){return o.context.getObject(p+i+"/Label");}}}},_getResponsiveTableColumnSettings:function(t,o){if(t.tableType==="ResponsiveTable"){return o.settings;}return null;},getChartSize:function(t,o){var s=this._getResponsiveTableColumnSettings(t,o);if(s&&s.microChartSize){return s.microChartSize;}return"XS";},getChartRenderLabels:function(t,o){var s=this._getResponsiveTableColumnSettings(t,o);if(s&&s.showMicroChartLabel){return s.showMicroChartLabel;}return false;}};T.getOperationAvailableMap.requiresIContext=true;T.addOperationAvailableFieldsToSelectQuery.requiresIContext=true;T.addFieldsHavingTextArrangementToSelectQuery.requiresIContext=true;T.getValueOnRatingField.requiresIContext=true;T.getTextOnActionField.requiresIContext=true;return T;},true);
