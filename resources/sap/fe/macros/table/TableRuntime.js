/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/model/json/JSONModel","sap/fe/macros/CommonHelper","sap/fe/core/CommonUtils","sap/fe/core/library","sap/base/Log","sap/ui/mdc/enum/ConditionValidated","sap/fe/macros/field/FieldRuntime","sap/ui/core/ValueState"],function(J,C,a,F,L,b,c,V){"use strict";var d=F.CreationMode;var T={displayTableSettings:function(e){var p=e.getSource().getParent(),s=sap.ui.getCore().byId(p.getId()+"-settings");C.fireButtonPress(s);},executeConditionalActionShortcut:function(B,s){var p=s.getParent();if(B!==d.CreationRow){var o=p.getActions().find(function(E){return E.getId().endsWith(B);});C.fireButtonPress(o);}else{var e=p.getAggregation("creationRow");if(e&&e.getApplyEnabled()&&e.getVisible()){e.fireApply();}}},setContexts:function(t,D,o,s,A){var e=A?A.split(","):[];var f=JSON.parse(s);var S=t.getSelectedContexts();var g=false;var h=[];var u=[];var l=[];var j={};var k={};var m;var I=t.getBindingContext("internal");k.aUnsavedContexts=[];k.aLockedContexts=[];I.setProperty("",{selectedContexts:S,numberOfSelectedContexts:S.length,dynamicActions:j,deleteEnabled:true,deletableContexts:[],unSavedContexts:[],lockedContexts:[]});for(var i=0;i<S.length;i++){var n=S[i];var p=n.getObject();for(var q in p){if(q.indexOf("#")===0){var r=q;r=r.substring(1,r.length);m=I.getObject();m.dynamicActions[r]={enabled:true};I.setProperty("",m);}}m=I.getObject();if(D!="undefined"){if(n&&n.getProperty(D)){if(o!=="undefined"&&p.IsActiveEntity===true&&p.HasDraftEntity===true){k=v(p,n);}else{h.push(n);k.isDeletable=true;}}m["deleteEnabled"]=k.isDeletable;}else if(o!=="undefined"&&p.IsActiveEntity===true&&p.HasDraftEntity===true){k=v(p,n);}else{h.push(n);}}function v(p,n){if(p.DraftAdministrativeData.InProcessByUser){l.push(n);}else{u.push(n);g=true;}return{aLockedContexts:l,aUnsavedContexts:u,isDeletable:g};}a.setActionEnablement(I,f,S);if(S.length>1){this.disableAction(e,j);}m["deletableContexts"]=h;m["unSavedContexts"]=k.aUnsavedContexts;m["lockedContexts"]=k.aLockedContexts;m["controlId"]=t.getId();I.setProperty("",m);},disableAction:function(A,D){A.forEach(function(s){D[s]={bEnabled:false};});},onFieldChangeInCreationRow:function(o,e,n){var s=e.getSource();var f=s.getId();var i=s.isA("sap.ui.mdc.Field");var p=e.getParameter("promise")||Promise.resolve();var I=s.getBindingContext("internal");var m=I.getProperty("creationRowFieldValidity"),N=Object.assign({},m),g=e.getParameter("valid"),h;if(i){p.then(function(v){if(s.getMaxConditions()===1&&g===undefined){g=s.getConditions()[0]&&s.getConditions()[0].validated===b.Validated;}if(g===undefined&&s.getValue()===""&&!s.getProperty("required")){g=true;}}).catch(function(E){L.error("Error while resolving field value",E);g=false;}).finally(function(){h=s.getValue();N[f]={fieldValue:h,validity:!!g};I.setProperty("creationRowFieldValidity",N);}).catch(function(E){L.error("Error while resolving field value",E);});}else{var v=s.getBinding("value")||e.getBinding("selected");N[f]={fieldValue:v.getValue(),validity:v.getDataState()?v.getDataState().getMessages().length===0:true};I.setProperty("creationRowFieldValidity",N);}c.handleChange(o,e);},getVBoxVisibility:function(){var i=this.getItems();var l=false;for(var e=i.length-1;e>=0;e--){if(!l){if(arguments[e]!==true){l=true;if(C._isRatingIndicator(i[e])){C._updateStyleClassForRatingIndicator(i[e],true);}else{i[e].removeStyleClass("sapUiTinyMarginBottom");}}}else{if(C._isRatingIndicator(i[e])){C._updateStyleClassForRatingIndicator(i[e],false);}else{i[e].addStyleClass("sapUiTinyMarginBottom");}}}return true;}};return T;},true);
