sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution","sap/fe/navigation/SelectionVariant","sap/fe/core/helpers/ModelHelper","sap/base/Log"],function(C,O,S,M,L){"use strict";return C.extend("sap.fe.core.controllerextensions.InternalInternalBasedNavigation",{metadata:{methods:{navigate:{"final":true,"public":true},getEntitySet:{"final":false,"public":false}}},navigate:function(s,a,n){var N=n&&n.navigationContexts,b=N&&!Array.isArray(N)?[N]:N,v=n&&n.semanticObjectMapping,t={semanticObject:s,action:a};if(s&&a){var c,o=new S(),d=this;if(b&&b.length){c=b.map(function(h){if(h.isA&&h.isA("sap.ui.model.odata.v4.Context")){var j=h.getObject(),k=d._oMetaModel.getMetaPath(h.getPath());return d._removeSensitiveData(j,k);}else if(typeof h==="object"){return d._removeSensitiveData(h.data,h.metaPath);}});}if(c&&c.length){o=this._oNavigationService.mixAttributesAndSelectionVariant(c,o.toJSONString());}var m=this._oView.getModel(),e=this.getEntitySet(),f=e?this._oNavigationService.constructContextUrl(e,m):undefined;if(f){o.setFilterContextUrl(f);}this.base.getView().getController().intentBasedNavigation.adaptNavigationContext(o,t);if(v){this._applySemanticObjectMappings(o,v);}this._removeTechnicalParameters(o);var B=this._oView.getBindingContext&&this._oView.getBindingContext(),i=false;if(B){var I=M.isStickySessionSupported(B.getModel().getMetaModel());if(I){i=this._oView.getModel("ui").getProperty("/isEditable");}}if(i){this._oView.getModel("internal").setProperty("/IBN_OpenInNewTable",true);}var g=function(){sap.ui.require(["sap/m/MessageBox"],function(h){var r=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core");h.show(r.getText("C_COMMON_HELPER_NAVIGATION_ERROR_MESSAGE"),{title:r.getText("C_COMMON_NAVIGATION_ERROR_TITLE")});});};this._oNavigationService.navigate(s,a,o.toJSONString(),null,g,null,i?"explace":"inplace",i);}else{throw new Error("Semantic Object/action is not provided");}},_removeTechnicalParameters:function(s){s.removeSelectOption("@odata.context");s.removeSelectOption("@odata.metadataEtag");s.removeSelectOption("SAP__Messages");},getEntitySet:function(){return this._oView.getViewData().entitySet;},_removeSensitiveData:function(a,m){var p=Object.keys(a);if(p.length){delete a["@odata.context"];delete a["@odata.metadataEtag"];delete a["SAP__Messages"];for(var j=0;j<p.length;j++){var P=p[j],b=this._oMetaModel.getObject(m+"/"+P+"@");if(b){if(b["@com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"]||b["@com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext"]||b["@com.sap.vocabularies.Analytics.v1.Measure"]){delete a[P];}else if(b["@com.sap.vocabularies.Common.v1.FieldControl"]){var f=b["@com.sap.vocabularies.Common.v1.FieldControl"];if(f["$EnumMember"]&&f["$EnumMember"].split("/")[1]==="Inapplicable"){delete a[P];}else if(f["$Path"]&&this._isFieldControlPathInapplicable(f["$Path"],a)){delete a[P];}}}}}return a;},_isFieldControlPathInapplicable:function(f,a){var i=false,p=f.split("/");if(p.length>1){i=a[p[0]]&&a[p[0]].hasOwnProperty(p[1])&&a[p[0]][p[1]]===0;}else{i=a[f]===0;}return i;},_applySemanticObjectMappings:function(s,m){var o=typeof m==="string"?JSON.parse(m):m;for(var i=0;i<o.length;i++){var l=(o[i]["LocalProperty"]&&o[i]["LocalProperty"]["$PropertyPath"])||(o[i]["@com.sap.vocabularies.Common.v1.LocalProperty"]&&o[i]["@com.sap.vocabularies.Common.v1.LocalProperty"]["$Path"]);var a=o[i]["SemanticObjectProperty"]||o[i]["@com.sap.vocabularies.Common.v1.SemanticObjectProperty"];if(s.getSelectOption(l)){var b=s.getSelectOption(l);s.removeSelectOption(l);s.massAddSelectOption(a,b);}}return s;},override:{onInit:function(){this._oAppComponent=this.base.getAppComponent();this._oMetaModel=this._oAppComponent.getModel().getMetaModel();this._oNavigationService=this._oAppComponent.getNavigationService();this._oView=this.base.getView();}}});});
