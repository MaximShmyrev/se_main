sap.ui.define(["sap/fe/core/helpers/BindingExpression", "sap/fe/core/templating/PropertyHelper"], function (BindingExpression, PropertyHelper) {
  "use strict";

  var _exports = {};
  var isPathExpression = PropertyHelper.isPathExpression;
  var equal = BindingExpression.equal;
  var constant = BindingExpression.constant;
  var annotationExpression = BindingExpression.annotationExpression;

  var getPathRelativeLocation = function (contextPath) {
    var visitedNavProps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];

    if (!contextPath) {
      return visitedNavProps.map(function (navProp) {
        return navProp.name;
      });
    } else {
      if (visitedNavProps.length >= contextPath.navigationProperties.length) {
        var remainingNavProps = [];
        contextPath.navigationProperties.forEach(function (navProp, navIndex) {
          if (visitedNavProps[navIndex] !== navProp) {
            remainingNavProps.push(visitedNavProps[navIndex]);
          }
        });
        remainingNavProps = remainingNavProps.concat(visitedNavProps.slice(contextPath.navigationProperties.length));
        return remainingNavProps.map(function (navProp) {
          return navProp.name;
        });
      } else {
        var extraNavProp = [];
        visitedNavProps.forEach(function (navProp, navIndex) {
          if (contextPath.navigationProperties[navIndex] !== navProp) {
            extraNavProp.push(visitedNavProps[navIndex]);
          }
        });
        extraNavProp = extraNavProp.concat(contextPath.navigationProperties.slice(visitedNavProps.length));
        return extraNavProp.map(function (navProp) {
          return navProp.partner;
        });
      }
    }
  };

  _exports.getPathRelativeLocation = getPathRelativeLocation;

  var enhanceDataModelPath = function (dataModelObjectPath, propertyPath) {
    var sPropertyPath = "";

    if (isPathExpression(propertyPath) && propertyPath.path) {
      sPropertyPath = propertyPath.path;
    } else if (typeof propertyPath === "string") {
      sPropertyPath = propertyPath;
    }

    var oTarget;

    if (isPathExpression(propertyPath)) {
      oTarget = propertyPath.$target;
    } else if (dataModelObjectPath.targetEntityType) {
      oTarget = dataModelObjectPath.targetEntityType.resolvePath(sPropertyPath);
    } else {
      oTarget = dataModelObjectPath.targetObject;
    }

    var aPathSplit = sPropertyPath.split("/");
    var currentEntitySet = dataModelObjectPath.targetEntitySet;
    var currentEntityType = dataModelObjectPath.targetEntityType;
    var navigationProperties = dataModelObjectPath.navigationProperties.concat(); // Process only if we have to go through navigation properties

    aPathSplit.reduce(function (reducedEntityType, pathPart) {
      if (!reducedEntityType) {
        return undefined;
      }

      var potentialNavProp = reducedEntityType.navigationProperties.find(function (navProp) {
        return navProp.name === pathPart;
      });

      if (potentialNavProp) {
        navigationProperties.push(potentialNavProp);
        currentEntityType = potentialNavProp.targetType;

        if (currentEntitySet && currentEntitySet.navigationPropertyBinding.hasOwnProperty(pathPart)) {
          currentEntitySet = currentEntitySet.navigationPropertyBinding[pathPart];
        }

        return currentEntityType;
      }

      return undefined;
    }, dataModelObjectPath.targetEntityType);
    return {
      startingEntitySet: dataModelObjectPath.startingEntitySet,
      navigationProperties: navigationProperties,
      contextLocation: dataModelObjectPath.contextLocation,
      targetEntitySet: currentEntitySet,
      targetEntityType: currentEntityType,
      targetObject: oTarget
    };
  };

  _exports.enhanceDataModelPath = enhanceDataModelPath;

  var getTargetObjectPath = function (dataModelObjectPath) {
    var bRelative = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
    var path = "";

    if (!bRelative) {
      path += "/".concat(dataModelObjectPath.startingEntitySet.name);
    }

    if (dataModelObjectPath.navigationProperties.length > 0) {
      if (path.length > 0) {
        path += "/";
      }

      path += dataModelObjectPath.navigationProperties.map(function (navProp) {
        return navProp.name;
      }).join("/");
    }

    if (dataModelObjectPath.targetObject && dataModelObjectPath.targetObject.name && dataModelObjectPath.targetObject._type !== "NavigationProperty" && dataModelObjectPath.targetObject !== dataModelObjectPath.startingEntitySet) {
      if (!path.endsWith("/")) {
        path += "/";
      }

      path += "".concat(dataModelObjectPath.targetObject.name);
    } else if (dataModelObjectPath.targetObject && dataModelObjectPath.targetObject.hasOwnProperty("term")) {
      if (path.length > 0 && !path.endsWith("/")) {
        path += "/";
      }

      path += "@".concat(dataModelObjectPath.targetObject.term);
    }

    return path;
  };

  _exports.getTargetObjectPath = getTargetObjectPath;

  var getContextRelativeTargetObjectPath = function (dataModelObjectPath) {
    var path = getPathRelativeLocation(dataModelObjectPath.contextLocation, dataModelObjectPath.navigationProperties).join("/");

    if (dataModelObjectPath.targetObject && dataModelObjectPath.targetObject.name && dataModelObjectPath.targetObject._type !== "NavigationProperty" && dataModelObjectPath.targetObject !== dataModelObjectPath.startingEntitySet) {
      if (!path.endsWith("/")) {
        path += "/";
      }

      path += "".concat(dataModelObjectPath.targetObject.name);
    } else if (dataModelObjectPath.targetObject && dataModelObjectPath.targetObject.hasOwnProperty("term")) {
      if (path.length > 0 && !path.endsWith("/")) {
        path += "/";
      }

      path += "@".concat(dataModelObjectPath.targetObject.term);
    }

    return path;
  };

  _exports.getContextRelativeTargetObjectPath = getContextRelativeTargetObjectPath;

  var isPathUpdatable = function (dataModelObjectPath, propertyPath) {
    return checkOnPath(dataModelObjectPath, function (annotationObject) {
      var _annotationObject$Upd;

      return annotationObject === null || annotationObject === void 0 ? void 0 : (_annotationObject$Upd = annotationObject.UpdateRestrictions) === null || _annotationObject$Upd === void 0 ? void 0 : _annotationObject$Upd.Updatable;
    }, propertyPath);
  };

  _exports.isPathUpdatable = isPathUpdatable;

  var isPathDeletable = function (dataModelObjectPath, propertyPath, bTableCase) {
    return checkOnPath(dataModelObjectPath, function (annotationObject) {
      var _annotationObject$Del;

      return annotationObject === null || annotationObject === void 0 ? void 0 : (_annotationObject$Del = annotationObject.DeleteRestrictions) === null || _annotationObject$Del === void 0 ? void 0 : _annotationObject$Del.Deletable;
    }, propertyPath, bTableCase);
  };

  _exports.isPathDeletable = isPathDeletable;

  var isPathInsertable = function (dataModelObjectPath, propertyPath) {
    return checkOnPath(dataModelObjectPath, function (annotationObject) {
      var _annotationObject$Ins;

      return annotationObject === null || annotationObject === void 0 ? void 0 : (_annotationObject$Ins = annotationObject.InsertRestrictions) === null || _annotationObject$Ins === void 0 ? void 0 : _annotationObject$Ins.Insertable;
    }, propertyPath);
  };

  _exports.isPathInsertable = isPathInsertable;

  var checkFilterExpressionRestrictions = function (dataModelObjectPath, allowedExpression) {
    return checkOnPath(dataModelObjectPath, function (annotationObject) {
      var _annotationObject$Fil;

      var filterExpressionRestrictions = (annotationObject === null || annotationObject === void 0 ? void 0 : (_annotationObject$Fil = annotationObject.FilterRestrictions) === null || _annotationObject$Fil === void 0 ? void 0 : _annotationObject$Fil.FilterExpressionRestrictions) || [];
      var currentObjectRestriction = filterExpressionRestrictions.find(function (restriction) {
        return restriction.Property.$target === dataModelObjectPath.targetObject;
      });

      if (currentObjectRestriction) {
        return allowedExpression.indexOf(currentObjectRestriction === null || currentObjectRestriction === void 0 ? void 0 : currentObjectRestriction.AllowedExpressions) !== -1;
      } else {
        return false;
      }
    });
  };

  _exports.checkFilterExpressionRestrictions = checkFilterExpressionRestrictions;

  var checkOnPath = function (dataModelObjectPath, checkFunction, propertyPath, bTableCase) {
    var _targetEntitySet, _targetEntitySet$anno;

    if (!dataModelObjectPath || !dataModelObjectPath.startingEntitySet) {
      return constant(true);
    }

    dataModelObjectPath = enhanceDataModelPath(dataModelObjectPath, propertyPath);
    var currentEntitySet = dataModelObjectPath.startingEntitySet;
    var parentEntitySet = null;
    var visitedNavigationPropsName = [];
    var allVisitedNavigationProps = [];
    var targetEntitySet = currentEntitySet;
    var resetVisitedNavProps = false;
    dataModelObjectPath.navigationProperties.forEach(function (navigationProperty) {
      if (resetVisitedNavProps) {
        visitedNavigationPropsName = [];
      }

      visitedNavigationPropsName.push(navigationProperty.name);
      allVisitedNavigationProps.push(navigationProperty);

      if (!navigationProperty.containsTarget) {
        // We should have a navigationPropertyBinding associated with the path so far which can consist of ([ContainmentNavProp]/)*[NavProp]
        var _fullNavigationPath = visitedNavigationPropsName.join("/");

        if (currentEntitySet && currentEntitySet.navigationPropertyBinding.hasOwnProperty(_fullNavigationPath)) {
          parentEntitySet = currentEntitySet;
          currentEntitySet = currentEntitySet.navigationPropertyBinding[_fullNavigationPath];
          targetEntitySet = currentEntitySet; // If we reached a navigation property with a navigationpropertybinding, we need to reset the visited path on the next iteration (if there is one)

          resetVisitedNavProps = true;
        } else {
          // We really should not end up here but at least let's try to avoid incorrect behavior
          parentEntitySet = currentEntitySet;
          currentEntitySet = null;
          resetVisitedNavProps = true;
        }
      } else {
        parentEntitySet = currentEntitySet;
        targetEntitySet = null;
      }
    }); // At this point we have navigated down all the nav prop and we should have
    // The target entityset pointing to either null (in case of containment navprop a last part), or the actual target (non containment as target)
    // The parent entitySet pointing to the previous entityset used in the path
    // VisitedNavigationPath should contain the path up to this property
    // Restrictions should then be evaluated as ParentEntitySet.NavRestrictions[NavpropertyPath] || TargetEntitySet.Restrictions

    var fullNavigationPath = visitedNavigationPropsName.join("/");
    var restrictions;

    if (parentEntitySet !== null) {
      var _parentEntitySet$anno, _parentEntitySet$anno2, _parentEntitySet$anno3;

      var _parentEntitySet = parentEntitySet;
      (_parentEntitySet$anno = _parentEntitySet.annotations) === null || _parentEntitySet$anno === void 0 ? void 0 : (_parentEntitySet$anno2 = _parentEntitySet$anno.Capabilities) === null || _parentEntitySet$anno2 === void 0 ? void 0 : (_parentEntitySet$anno3 = _parentEntitySet$anno2.NavigationRestrictions) === null || _parentEntitySet$anno3 === void 0 ? void 0 : _parentEntitySet$anno3.RestrictedProperties.forEach(function (restrictedNavProp) {
        var _restrictedNavProp$Na;

        if (((_restrictedNavProp$Na = restrictedNavProp.NavigationProperty) === null || _restrictedNavProp$Na === void 0 ? void 0 : _restrictedNavProp$Na.type) === "NavigationPropertyPath") {
          var _restrictionDefinition = checkFunction(restrictedNavProp);

          if (fullNavigationPath === restrictedNavProp.NavigationProperty.value && _restrictionDefinition !== undefined) {
            var _dataModelObjectPath;

            restrictions = equal(annotationExpression(_restrictionDefinition, getPathRelativeLocation((_dataModelObjectPath = dataModelObjectPath) === null || _dataModelObjectPath === void 0 ? void 0 : _dataModelObjectPath.contextLocation, allVisitedNavigationProps.slice(0, -1))), true);
          }
        }
      });
    }

    var targetRestrictions;
    var restrictionDefinition = checkFunction((_targetEntitySet = targetEntitySet) === null || _targetEntitySet === void 0 ? void 0 : (_targetEntitySet$anno = _targetEntitySet.annotations) === null || _targetEntitySet$anno === void 0 ? void 0 : _targetEntitySet$anno.Capabilities);

    if (restrictionDefinition !== undefined) {
      targetRestrictions = equal(annotationExpression(restrictionDefinition, getPathRelativeLocation(dataModelObjectPath.contextLocation, allVisitedNavigationProps)), true);
    } //object page table case in path based scenario's fallback to exisiting approach


    if (bTableCase && !restrictions && (restrictionDefinition === null || restrictionDefinition === void 0 ? void 0 : restrictionDefinition.path)) {
      var oResult = {
        "currentEntityRestriction": targetRestrictions
      };
      return oResult;
    }

    return restrictions || targetRestrictions || constant(true);
  };

  _exports.checkOnPath = checkOnPath;
  return _exports;
}, false);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRhdGFNb2RlbFBhdGhIZWxwZXIudHMiXSwibmFtZXMiOlsiZ2V0UGF0aFJlbGF0aXZlTG9jYXRpb24iLCJjb250ZXh0UGF0aCIsInZpc2l0ZWROYXZQcm9wcyIsIm1hcCIsIm5hdlByb3AiLCJuYW1lIiwibGVuZ3RoIiwibmF2aWdhdGlvblByb3BlcnRpZXMiLCJyZW1haW5pbmdOYXZQcm9wcyIsImZvckVhY2giLCJuYXZJbmRleCIsInB1c2giLCJjb25jYXQiLCJzbGljZSIsImV4dHJhTmF2UHJvcCIsInBhcnRuZXIiLCJlbmhhbmNlRGF0YU1vZGVsUGF0aCIsImRhdGFNb2RlbE9iamVjdFBhdGgiLCJwcm9wZXJ0eVBhdGgiLCJzUHJvcGVydHlQYXRoIiwiaXNQYXRoRXhwcmVzc2lvbiIsInBhdGgiLCJvVGFyZ2V0IiwiJHRhcmdldCIsInRhcmdldEVudGl0eVR5cGUiLCJyZXNvbHZlUGF0aCIsInRhcmdldE9iamVjdCIsImFQYXRoU3BsaXQiLCJzcGxpdCIsImN1cnJlbnRFbnRpdHlTZXQiLCJ0YXJnZXRFbnRpdHlTZXQiLCJjdXJyZW50RW50aXR5VHlwZSIsInJlZHVjZSIsInJlZHVjZWRFbnRpdHlUeXBlIiwicGF0aFBhcnQiLCJ1bmRlZmluZWQiLCJwb3RlbnRpYWxOYXZQcm9wIiwiZmluZCIsInRhcmdldFR5cGUiLCJuYXZpZ2F0aW9uUHJvcGVydHlCaW5kaW5nIiwiaGFzT3duUHJvcGVydHkiLCJzdGFydGluZ0VudGl0eVNldCIsImNvbnRleHRMb2NhdGlvbiIsImdldFRhcmdldE9iamVjdFBhdGgiLCJiUmVsYXRpdmUiLCJqb2luIiwiX3R5cGUiLCJlbmRzV2l0aCIsInRlcm0iLCJnZXRDb250ZXh0UmVsYXRpdmVUYXJnZXRPYmplY3RQYXRoIiwiaXNQYXRoVXBkYXRhYmxlIiwiY2hlY2tPblBhdGgiLCJhbm5vdGF0aW9uT2JqZWN0IiwiVXBkYXRlUmVzdHJpY3Rpb25zIiwiVXBkYXRhYmxlIiwiaXNQYXRoRGVsZXRhYmxlIiwiYlRhYmxlQ2FzZSIsIkRlbGV0ZVJlc3RyaWN0aW9ucyIsIkRlbGV0YWJsZSIsImlzUGF0aEluc2VydGFibGUiLCJJbnNlcnRSZXN0cmljdGlvbnMiLCJJbnNlcnRhYmxlIiwiY2hlY2tGaWx0ZXJFeHByZXNzaW9uUmVzdHJpY3Rpb25zIiwiYWxsb3dlZEV4cHJlc3Npb24iLCJmaWx0ZXJFeHByZXNzaW9uUmVzdHJpY3Rpb25zIiwiRmlsdGVyUmVzdHJpY3Rpb25zIiwiRmlsdGVyRXhwcmVzc2lvblJlc3RyaWN0aW9ucyIsImN1cnJlbnRPYmplY3RSZXN0cmljdGlvbiIsInJlc3RyaWN0aW9uIiwiUHJvcGVydHkiLCJpbmRleE9mIiwiQWxsb3dlZEV4cHJlc3Npb25zIiwiY2hlY2tGdW5jdGlvbiIsImNvbnN0YW50IiwicGFyZW50RW50aXR5U2V0IiwidmlzaXRlZE5hdmlnYXRpb25Qcm9wc05hbWUiLCJhbGxWaXNpdGVkTmF2aWdhdGlvblByb3BzIiwicmVzZXRWaXNpdGVkTmF2UHJvcHMiLCJuYXZpZ2F0aW9uUHJvcGVydHkiLCJjb250YWluc1RhcmdldCIsImZ1bGxOYXZpZ2F0aW9uUGF0aCIsInJlc3RyaWN0aW9ucyIsIl9wYXJlbnRFbnRpdHlTZXQiLCJhbm5vdGF0aW9ucyIsIkNhcGFiaWxpdGllcyIsIk5hdmlnYXRpb25SZXN0cmljdGlvbnMiLCJSZXN0cmljdGVkUHJvcGVydGllcyIsInJlc3RyaWN0ZWROYXZQcm9wIiwiTmF2aWdhdGlvblByb3BlcnR5IiwidHlwZSIsInJlc3RyaWN0aW9uRGVmaW5pdGlvbiIsInZhbHVlIiwiZXF1YWwiLCJhbm5vdGF0aW9uRXhwcmVzc2lvbiIsInRhcmdldFJlc3RyaWN0aW9ucyIsIm9SZXN1bHQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQXFCTyxNQUFNQSx1QkFBdUIsR0FBRyxVQUFTQyxXQUFULEVBQWtHO0FBQUEsUUFBdERDLGVBQXNELHVFQUFkLEVBQWM7O0FBQ3hJLFFBQUksQ0FBQ0QsV0FBTCxFQUFrQjtBQUNqQixhQUFPQyxlQUFlLENBQUNDLEdBQWhCLENB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LFFBQUlNLHFCQUFxQixLQUFLdkQsU0FBOUIsRUFBeUM7QUFDeEMyRCxNQUFBQSxrQkFBa0IsR0FBR0YsS0FBSyxDQUN6QkMsb0JBQW9CLENBQ25CSCxxQkFEbUIsRUFFbkIxRix1QkFBdUIsQ0FBQ2lCLG1CQUFtQixDQUFDeUIsZUFBckIsRUFBc0NrQyx5QkFBdEMsQ0FGSixDQURLLEVBS3pCLElBTHlCLENBQTFCO0FBT0EsS0E3RXFCLENBOEV0Qjs7O0FBQ0EsUUFBSXBCLFVBQVUsSUFBSSxDQUFDeUIsWUFBZixLQUErQlMscUJBQS9CLGFBQStCQSxxQkFBL0IsdUJBQStCQSxxQkFBcUIsQ0FBRXJFLElBQXRELENBQUosRUFBZ0U7QUFDL0QsVUFBTTBFLE9BQVksR0FBRztBQUNwQixvQ0FBNEJEO0FBRFIsT0FBckI7QUFHQSxhQUFPQyxPQUFQO0FBQ0E7O0FBQ0QsV0FBT2QsWUFBWSxJQUFJYSxrQkFBaEIsSUFBc0NyQixRQUFRLENBQUMsSUFBRCxDQUFyRDtBQUNBLEdBM0ZNIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbnRpdHlTZXQsIEVudGl0eVR5cGUsIE5hdmlnYXRpb25Qcm9wZXJ0eSwgUHJvcGVydHkgfSBmcm9tIFwiQHNhcC11eC9hbm5vdGF0aW9uLWNvbnZlcnRlclwiO1xuaW1wb3J0IHsgYW5ub3RhdGlvbkV4cHJlc3Npb24sIGNvbnN0YW50LCBlcXVhbCwgRXhwcmVzc2lvbiB9IGZyb20gXCJzYXAvZmUvY29yZS9oZWxwZXJzL0JpbmRpbmdFeHByZXNzaW9uXCI7XG5pbXBvcnQgeyBOYXZpZ2F0aW9uUHJvcGVydHlSZXN0cmljdGlvblR5cGVzIH0gZnJvbSBcIkBzYXAtdXgvdm9jYWJ1bGFyaWVzLXR5cGVzL2Rpc3QvZ2VuZXJhdGVkL0NhcGFiaWxpdGllc1wiO1xuaW1wb3J0IHsgUHJvcGVydHlPclBhdGggfSBmcm9tIFwic2FwL2ZlL2NvcmUvdGVtcGxhdGluZy9VSUZvcm1hdHRlcnNcIjtcbmltcG9ydCB7IGlzUGF0aEV4cHJlc3Npb24gfSBmcm9tIFwic2FwL2ZlL2NvcmUvdGVtcGxhdGluZy9Qcm9wZXJ0eUhlbHBlclwiO1xuaW1wb3J0IHtcblx0RmlsdGVyRXhwcmVzc2lvblJlc3RyaWN0aW9uVHlwZVR5cGVzLFxuXHROYXZpZ2F0aW9uUHJvcGVydHlSZXN0cmljdGlvblxufSBmcm9tIFwiQHNhcC11eC92b2NhYnVsYXJpZXMtdHlwZXMvdHlwZXMvZ2VuZXJhdGVkL0NhcGFiaWxpdGllc1wiO1xuaW1wb3J0IHsgRW50aXR5U2V0QW5ub3RhdGlvbnNfQ2FwYWJpbGl0aWVzIH0gZnJvbSBcIkBzYXAtdXgvdm9jYWJ1bGFyaWVzLXR5cGVzL2Rpc3QvZ2VuZXJhdGVkL0NhcGFiaWxpdGllc19FZG1cIjtcbmltcG9ydCB7IFByb3BlcnR5UGF0aCB9IGZyb20gXCJAc2FwLXV4L3ZvY2FidWxhcmllcy10eXBlc1wiO1xuXG5leHBvcnQgdHlwZSBEYXRhTW9kZWxPYmplY3RQYXRoID0ge1xuXHRzdGFydGluZ0VudGl0eVNldDogRW50aXR5U2V0O1xuXHRjb250ZXh0TG9jYXRpb24/OiBEYXRhTW9kZWxPYmplY3RQYXRoO1xuXHRuYXZpZ2F0aW9uUHJvcGVydGllczogTmF2aWdhdGlvblByb3BlcnR5W107XG5cdHRhcmdldEVudGl0eVNldDogRW50aXR5U2V0IHwgdW5kZWZpbmVkO1xuXHR0YXJnZXRFbnRpdHlUeXBlOiBFbnRpdHlUeXBlO1xuXHR0YXJnZXRPYmplY3Q6IGFueTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRQYXRoUmVsYXRpdmVMb2NhdGlvbiA9IGZ1bmN0aW9uKGNvbnRleHRQYXRoPzogRGF0YU1vZGVsT2JqZWN0UGF0aCwgdmlzaXRlZE5hdlByb3BzOiBOYXZpZ2F0aW9uUHJvcGVydHlbXSA9IFtdKTogc3RyaW5nW10ge1xuXHRpZiAoIWNvbnRleHRQYXRoKSB7XG5cdFx0cmV0dXJuIHZpc2l0ZWROYXZQcm9wcy5tYXAobmF2UHJvcCA9PiBuYXZQcm9wLm5hbWUpO1xuXHR9IGVsc2Uge1xuXHRcdGlmICh2aXNpdGVkTmF2UHJvcHMubGVuZ3RoID49IGNvbnRleHRQYXRoLm5hdmlnYXRpb25Qcm9wZXJ0aWVzLmxlbmd0aCkge1xuXHRcdFx0bGV0IHJlbWFpbmluZ05hdlByb3BzOiBOYXZpZ2F0aW9uUHJvcGVydHlbXSA9IFtdO1xuXHRcdFx0Y29udGV4dFBhdGgubmF2aWdhdGlvblByb3BlcnRpZXMuZm9yRWFjaCgobmF2UHJvcCwgbmF2SW5kZXgpID0+IHtcblx0XHRcdFx0aWYgKHZpc2l0ZWROYXZQcm9wc1tuYXZJbmRleF0gIT09IG5hdlByb3ApIHtcblx0XHRcdFx0XHRyZW1haW5pbmdOYXZQcm9wcy5wdXNoKHZpc2l0ZWROYXZQcm9wc1tuYXZJbmRleF0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdHJlbWFpbmluZ05hdlByb3BzID0gcmVtYWluaW5nTmF2UHJvcHMuY29uY2F0KHZpc2l0ZWROYXZQcm9wcy5zbGljZShjb250ZXh0UGF0aC5uYXZpZ2F0aW9uUHJvcGVydGllcy5sZW5ndGgpKTtcblx0XHRcdHJldHVybiByZW1haW5pbmdOYXZQcm9wcy5tYXAobmF2UHJvcCA9PiBuYXZQcm9wLm5hbWUpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsZXQgZXh0cmFOYXZQcm9wOiBOYXZpZ2F0aW9uUHJvcGVydHlbXSA9IFtdO1xuXHRcdFx0dmlzaXRlZE5hdlByb3BzLmZvckVhY2goKG5hdlByb3AsIG5hdkluZGV4KSA9PiB7XG5cdFx0XHRcdGlmIChjb250ZXh0UGF0aC5uYXZpZ2F0aW9uUHJvcGVydGllc1tuYXZJbmRleF0gIT09IG5hdlByb3ApIHtcblx0XHRcdFx0XHRleHRyYU5hdlByb3AucHVzaCh2aXNpdGVkTmF2UHJvcHNbbmF2SW5kZXhdKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRleHRyYU5hdlByb3AgPSBleHRyYU5hdlByb3AuY29uY2F0KGNvbnRleHRQYXRoLm5hdmlnYXRpb25Qcm9wZXJ0aWVzLnNsaWNlKHZpc2l0ZWROYXZQcm9wcy5sZW5ndGgpKTtcblx0XHRcdHJldHVybiBleHRyYU5hdlByb3AubWFwKG5hdlByb3AgPT4gbmF2UHJvcC5wYXJ0bmVyKTtcblx0XHR9XG5cdH1cbn07XG5cbmV4cG9ydCBjb25zdCBlbmhhbmNlRGF0YU1vZGVsUGF0aCA9IGZ1bmN0aW9uKFxuXHRkYXRhTW9kZWxPYmplY3RQYXRoOiBEYXRhTW9kZWxPYmplY3RQYXRoLFxuXHRwcm9wZXJ0eVBhdGg/OiBQcm9wZXJ0eU9yUGF0aDxQcm9wZXJ0eT5cbik6IERhdGFNb2RlbE9iamVjdFBhdGgge1xuXHRsZXQgc1Byb3BlcnR5UGF0aDogc3RyaW5nID0gXCJcIjtcblx0aWYgKGlzUGF0aEV4cHJlc3Npb24ocHJvcGVydHlQYXRoKSAmJiBwcm9wZXJ0eVBhdGgucGF0aCkge1xuXHRcdHNQcm9wZXJ0eVBhdGggPSBwcm9wZXJ0eVBhdGgucGF0aDtcblx0fSBlbHNlIGlmICh0eXBlb2YgcHJvcGVydHlQYXRoID09PSBcInN0cmluZ1wiKSB7XG5cdFx0c1Byb3BlcnR5UGF0aCA9IHByb3BlcnR5UGF0aCBhcyBzdHJpbmc7XG5cdH1cblx0bGV0IG9UYXJnZXQ7XG5cdGlmIChpc1BhdGhFeHByZXNzaW9uKHByb3BlcnR5UGF0aCkpIHtcblx0XHRvVGFyZ2V0ID0gcHJvcGVydHlQYXRoLiR0YXJnZXQ7XG5cdH0gZWxzZSBpZiAoZGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRFbnRpdHlUeXBlKSB7XG5cdFx0b1RhcmdldCA9IGRhdGFNb2RlbE9iamVjdFBhdGgudGFyZ2V0RW50aXR5VHlwZS5yZXNvbHZlUGF0aChzUHJvcGVydHlQYXRoKTtcblx0fSBlbHNlIHtcblx0XHRvVGFyZ2V0ID0gZGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3Q7XG5cdH1cblx0Y29uc3QgYVBhdGhTcGxpdCA9IHNQcm9wZXJ0eVBhdGguc3BsaXQoXCIvXCIpO1xuXHRsZXQgY3VycmVudEVudGl0eVNldCA9IGRhdGFNb2RlbE9iamVjdFBhdGgudGFyZ2V0RW50aXR5U2V0O1xuXHRsZXQgY3VycmVudEVudGl0eVR5cGUgPSBkYXRhTW9kZWxPYmplY3RQYXRoLnRhcmdldEVudGl0eVR5cGU7XG5cdGNvbnN0IG5hdmlnYXRpb25Qcm9wZXJ0aWVzID0gZGF0YU1vZGVsT2JqZWN0UGF0aC5uYXZpZ2F0aW9uUHJvcGVydGllcy5jb25jYXQoKTtcblx0Ly8gUHJvY2VzcyBvbmx5IGlmIHdlIGhhdmUgdG8gZ28gdGhyb3VnaCBuYXZpZ2F0aW9uIHByb3BlcnRpZXNcblxuXHRhUGF0aFNwbGl0LnJlZHVjZSgocmVkdWNlZEVudGl0eVR5cGU6IEVudGl0eVR5cGUgfCB1bmRlZmluZWQsIHBhdGhQYXJ0OiBzdHJpbmcpID0+IHtcblx0XHRpZiAoIXJlZHVjZWRFbnRpdHlUeXBlKSB7XG5cdFx0XHRyZXR1cm4gdW5kZWZpbmVkO1xuXHRcdH1cblx0XHRjb25zdCBwb3RlbnRpYWxOYXZQcm9wID0gcmVkdWNlZEVudGl0eVR5cGUubmF2aWdhdGlvblByb3BlcnRpZXMuZmluZChuYXZQcm9wID0+IG5hdlByb3AubmFtZSA9PT0gcGF0aFBhcnQpO1xuXHRcdGlmIChwb3RlbnRpYWxOYXZQcm9wKSB7XG5cdFx0XHRuYXZpZ2F0aW9uUHJvcGVydGllcy5wdXNoKHBvdGVudGlhbE5hdlByb3ApO1xuXHRcdFx0Y3VycmVudEVudGl0eVR5cGUgPSBwb3RlbnRpYWxOYXZQcm9wLnRhcmdldFR5cGU7XG5cdFx0XHRpZiAoY3VycmVudEVudGl0eVNldCAmJiBjdXJyZW50RW50aXR5U2V0Lm5hdmlnYXRpb25Qcm9wZXJ0eUJpbmRpbmcuaGFzT3duUHJvcGVydHkocGF0aFBhcnQpKSB7XG5cdFx0XHRcdGN1cnJlbnRFbnRpdHlTZXQgPSBjdXJyZW50RW50aXR5U2V0Lm5hdmlnYXRpb25Qcm9wZXJ0eUJpbmRpbmdbcGF0aFBhcnRdO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIGN1cnJlbnRFbnRpdHlUeXBlO1xuXHRcdH1cblx0XHRyZXR1cm4gdW5kZWZpbmVkO1xuXHR9LCBkYXRhTW9kZWxPYmplY3RQYXRoLnRhcmdldEVudGl0eVR5cGUpO1xuXG5cdHJldHVybiB7XG5cdFx0c3RhcnRpbmdFbnRpdHlTZXQ6IGRhdGFNb2RlbE9iamVjdFBhdGguc3RhcnRpbmdFbnRpdHlTZXQsXG5cdFx0bmF2aWdhdGlvblByb3BlcnRpZXM6IG5hdmlnYXRpb25Qcm9wZXJ0aWVzLFxuXHRcdGNvbnRleHRMb2NhdGlvbjogZGF0YU1vZGVsT2JqZWN0UGF0aC5jb250ZXh0TG9jYXRpb24sXG5cdFx0dGFyZ2V0RW50aXR5U2V0OiBjdXJyZW50RW50aXR5U2V0LFxuXHRcdHRhcmdldEVudGl0eVR5cGU6IGN1cnJlbnRFbnRpdHlUeXBlLFxuXHRcdHRhcmdldE9iamVjdDogb1RhcmdldFxuXHR9O1xufTtcblxuZXhwb3J0IGNvbnN0IGdldFRhcmdldE9iamVjdFBhdGggPSBmdW5jdGlvbihkYXRhTW9kZWxPYmplY3RQYXRoOiBEYXRhTW9kZWxPYmplY3RQYXRoLCBiUmVsYXRpdmU6IGJvb2xlYW4gPSBmYWxzZSk6IHN0cmluZyB7XG5cdGxldCBwYXRoID0gXCJcIjtcblx0aWYgKCFiUmVsYXRpdmUpIHtcblx0XHRwYXRoICs9IGAvJHtkYXRhTW9kZWxPYmplY3RQYXRoLnN0YXJ0aW5nRW50aXR5U2V0Lm5hbWV9YDtcblx0fVxuXHRpZiAoZGF0YU1vZGVsT2JqZWN0UGF0aC5uYXZpZ2F0aW9uUHJvcGVydGllcy5sZW5ndGggPiAwKSB7XG5cdFx0aWYgKHBhdGgubGVuZ3RoID4gMCkge1xuXHRcdFx0cGF0aCArPSBcIi9cIjtcblx0XHR9XG5cdFx0cGF0aCArPSBkYXRhTW9kZWxPYmplY3RQYXRoLm5hdmlnYXRpb25Qcm9wZXJ0aWVzLm1hcChuYXZQcm9wID0+IG5hdlByb3AubmFtZSkuam9pbihcIi9cIik7XG5cdH1cblxuXHRpZiAoXG5cdFx0ZGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3QgJiZcblx0XHRkYXRhTW9kZWxPYmplY3RQYXRoLnRhcmdldE9iamVjdC5uYW1lICYmXG5cdFx0ZGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3QuX3R5cGUgIT09IFwiTmF2aWdhdGlvblByb3BlcnR5XCIgJiZcblx0XHRkYXRhTW9kZWxPYmplY3RQYXRoLnRhcmdldE9iamVjdCAhPT0gZGF0YU1vZGVsT2JqZWN0UGF0aC5zdGFydGluZ0VudGl0eVNldFxuXHQpIHtcblx0XHRpZiAoIXBhdGguZW5kc1dpdGgoXCIvXCIpKSB7XG5cdFx0XHRwYXRoICs9IFwiL1wiO1xuXHRcdH1cblx0XHRwYXRoICs9IGAke2RhdGFNb2RlbE9iamVjdFBhdGgudGFyZ2V0T2JqZWN0Lm5hbWV9YDtcblx0fSBlbHNlIGlmIChkYXRhTW9kZWxPYmplY3RQYXRoLnRhcmdldE9iamVjdCAmJiBkYXRhTW9kZWxPYmplY3RQYXRoLnRhcmdldE9iamVjdC5oYXNPd25Qcm9wZXJ0eShcInRlcm1cIikpIHtcblx0XHRpZiAocGF0aC5sZW5ndGggPiAwICYmICFwYXRoLmVuZHNXaXRoKFwiL1wiKSkge1xuXHRcdFx0cGF0aCArPSBcIi9cIjtcblx0XHR9XG5cdFx0cGF0aCArPSBgQCR7ZGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3QudGVybX1gO1xuXHR9XG5cdHJldHVybiBwYXRoO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldENvbnRleHRSZWxhdGl2ZVRhcmdldE9iamVjdFBhdGggPSBmdW5jdGlvbihkYXRhTW9kZWxPYmplY3RQYXRoOiBEYXRhTW9kZWxPYmplY3RQYXRoKTogc3RyaW5nIHtcblx0bGV0IHBhdGggPSBnZXRQYXRoUmVsYXRpdmVMb2NhdGlvbihkYXRhTW9kZWxPYmplY3RQYXRoLmNvbnRleHRMb2NhdGlvbiwgZGF0YU1vZGVsT2JqZWN0UGF0aC5uYXZpZ2F0aW9uUHJvcGVydGllcykuam9pbihcIi9cIik7XG5cdGlmIChcblx0XHRkYXRhTW9kZWxPYmplY3RQYXRoLnRhcmdldE9iamVjdCAmJlxuXHRcdGRhdGFNb2RlbE9iamVjdFBhdGgudGFyZ2V0T2JqZWN0Lm5hbWUgJiZcblx0XHRkYXRhTW9kZWxPYmplY3RQYXRoLnRhcmdldE9iamVjdC5fdHlwZSAhPT0gXCJOYXZpZ2F0aW9uUHJvcGVydHlcIiAmJlxuXHRcdGRhdGFNb2RlbE9iamVjdFBhdGgudGFyZ2V0T2JqZWN0ICE9PSBkYXRhTW9kZWxPYmplY3RQYXRoLnN0YXJ0aW5nRW50aXR5U2V0XG5cdCkge1xuXHRcdGlmICghcGF0aC5lbmRzV2l0aChcIi9cIikpIHtcblx0XHRcdHBhdGggKz0gXCIvXCI7XG5cdFx0fVxuXHRcdHBhdGggKz0gYCR7ZGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3QubmFtZX1gO1xuXHR9IGVsc2UgaWYgKGRhdGFNb2RlbE9iamVjdFBhdGgudGFyZ2V0T2JqZWN0ICYmIGRhdGFNb2RlbE9iamVjdFBhdGgudGFyZ2V0T2JqZWN0Lmhhc093blByb3BlcnR5KFwidGVybVwiKSkge1xuXHRcdGlmIChwYXRoLmxlbmd0aCA+IDAgJiYgIXBhdGguZW5kc1dpdGgoXCIvXCIpKSB7XG5cdFx0XHRwYXRoICs9IFwiL1wiO1xuXHRcdH1cblx0XHRwYXRoICs9IGBAJHtkYXRhTW9kZWxPYmplY3RQYXRoLnRhcmdldE9iamVjdC50ZXJtfWA7XG5cdH1cblx0cmV0dXJuIHBhdGg7XG59O1xuXG5leHBvcnQgY29uc3QgaXNQYXRoVXBkYXRhYmxlID0gZnVuY3Rpb24oXG5cdGRhdGFNb2RlbE9iamVjdFBhdGg6IERhdGFNb2RlbE9iamVjdFBhdGggfCB1bmRlZmluZWQsXG5cdHByb3BlcnR5UGF0aD86IFByb3BlcnR5T3JQYXRoPFByb3BlcnR5PlxuKTogRXhwcmVzc2lvbjxib29sZWFuPiB7XG5cdHJldHVybiBjaGVja09uUGF0aChcblx0XHRkYXRhTW9kZWxPYmplY3RQYXRoLFxuXHRcdChhbm5vdGF0aW9uT2JqZWN0OiBOYXZpZ2F0aW9uUHJvcGVydHlSZXN0cmljdGlvbiB8IEVudGl0eVNldEFubm90YXRpb25zX0NhcGFiaWxpdGllcykgPT4ge1xuXHRcdFx0cmV0dXJuIGFubm90YXRpb25PYmplY3Q/LlVwZGF0ZVJlc3RyaWN0aW9ucz8uVXBkYXRhYmxlO1xuXHRcdH0sXG5cdFx0cHJvcGVydHlQYXRoXG5cdCk7XG59O1xuZXhwb3J0IGNvbnN0IGlzUGF0aERlbGV0YWJsZSA9IGZ1bmN0aW9uKFxuXHRkYXRhTW9kZWxPYmplY3RQYXRoOiBEYXRhTW9kZWxPYmplY3RQYXRoIHwgdW5kZWZpbmVkLFxuXHRwcm9wZXJ0eVBhdGg/OiBQcm9wZXJ0eU9yUGF0aDxQcm9wZXJ0eT4sXG5cdGJUYWJsZUNhc2U/OiBib29sZWFuXG4pOiBFeHByZXNzaW9uPGJvb2xlYW4+IHtcblx0cmV0dXJuIGNoZWNrT25QYXRoKFxuXHRcdGRhdGFNb2RlbE9iamVjdFBhdGgsXG5cdFx0KGFubm90YXRpb25PYmplY3Q6IE5hdmlnYXRpb25Qcm9wZXJ0eVJlc3RyaWN0aW9uIHwgRW50aXR5U2V0QW5ub3RhdGlvbnNfQ2FwYWJpbGl0aWVzKSA9PiB7XG5cdFx0XHRyZXR1cm4gYW5ub3RhdGlvbk9iamVjdD8uRGVsZXRlUmVzdHJpY3Rpb25zPy5EZWxldGFibGU7XG5cdFx0fSxcblx0XHRwcm9wZXJ0eVBhdGgsXG5cdFx0YlRhYmxlQ2FzZVxuXHQpO1xufTtcblxuZXhwb3J0IGNvbnN0IGlzUGF0aEluc2VydGFibGUgPSBmdW5jdGlvbihcblx0ZGF0YU1vZGVsT2JqZWN0UGF0aDogRGF0YU1vZGVsT2JqZWN0UGF0aCB8IHVuZGVmaW5lZCxcblx0cHJvcGVydHlQYXRoPzogUHJvcGVydHlPclBhdGg8UHJvcGVydHk+XG4pOiBFeHByZXNzaW9uPGJvb2xlYW4+IHtcblx0cmV0dXJuIGNoZWNrT25QYXRoKFxuXHRcdGRhdGFNb2RlbE9iamVjdFBhdGgsXG5cdFx0KGFubm90YXRpb25PYmplY3Q6IE5hdmlnYXRpb25Qcm9wZXJ0eVJlc3RyaWN0aW9uIHwgRW50aXR5U2V0QW5ub3RhdGlvbnNfQ2FwYWJpbGl0aWVzKSA9PiB7XG5cdFx0XHRyZXR1cm4gYW5ub3RhdGlvbk9iamVjdD8uSW5zZXJ0UmVzdHJpY3Rpb25zPy5JbnNlcnRhYmxlO1xuXHRcdH0sXG5cdFx0cHJvcGVydHlQYXRoXG5cdCk7XG59O1xuXG5leHBvcnQgY29uc3QgY2hlY2tGaWx0ZXJFeHByZXNzaW9uUmVzdHJpY3Rpb25zID0gZnVuY3Rpb24oXG5cdGRhdGFNb2RlbE9iamVjdFBhdGg6IERhdGFNb2RlbE9iamVjdFBhdGgsXG5cdGFsbG93ZWRFeHByZXNzaW9uOiAoc3RyaW5nIHwgdW5kZWZpbmVkKVtdXG4pOiBFeHByZXNzaW9uPGJvb2xlYW4+IHtcblx0cmV0dXJuIGNoZWNrT25QYXRoKGRhdGFNb2RlbE9iamVjdFBhdGgsIChhbm5vdGF0aW9uT2JqZWN0OiBOYXZpZ2F0aW9uUHJvcGVydHlSZXN0cmljdGlvbiB8IEVudGl0eVNldEFubm90YXRpb25zX0NhcGFiaWxpdGllcykgPT4ge1xuXHRcdGNvbnN0IGZpbHRlckV4cHJlc3Npb25SZXN0cmljdGlvbnM6IEZpbHRlckV4cHJlc3Npb25SZXN0cmljdGlvblR5cGVUeXBlc1tdID1cblx0XHRcdChhbm5vdGF0aW9uT2JqZWN0Py5GaWx0ZXJSZXN0cmljdGlvbnM/LkZpbHRlckV4cHJlc3Npb25SZXN0cmljdGlvbnMgYXMgRmlsdGVyRXhwcmVzc2lvblJlc3RyaWN0aW9uVHlwZVR5cGVzW10pIHx8IFtdO1xuXHRcdGNvbnN0IGN1cnJlbnRPYmplY3RSZXN0cmljdGlvbiA9IGZpbHRlckV4cHJlc3Npb25SZXN0cmljdGlvbnMuZmluZChyZXN0cmljdGlvbiA9PiB7XG5cdFx0XHRyZXR1cm4gKHJlc3RyaWN0aW9uLlByb3BlcnR5IGFzIFByb3BlcnR5UGF0aCkuJHRhcmdldCA9PT0gZGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3Q7XG5cdFx0fSk7XG5cdFx0aWYgKGN1cnJlbnRPYmplY3RSZXN0cmljdGlvbikge1xuXHRcdFx0cmV0dXJuIGFsbG93ZWRFeHByZXNzaW9uLmluZGV4T2YoY3VycmVudE9iamVjdFJlc3RyaWN0aW9uPy5BbGxvd2VkRXhwcmVzc2lvbnMpICE9PSAtMTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fSk7XG59O1xuXG5leHBvcnQgY29uc3QgY2hlY2tPblBhdGggPSBmdW5jdGlvbihcblx0ZGF0YU1vZGVsT2JqZWN0UGF0aDogRGF0YU1vZGVsT2JqZWN0UGF0aCB8IHVuZGVmaW5lZCxcblx0Y2hlY2tGdW5jdGlvbjogRnVuY3Rpb24sXG5cdHByb3BlcnR5UGF0aD86IFByb3BlcnR5T3JQYXRoPFByb3BlcnR5Pixcblx0YlRhYmxlQ2FzZT86IGJvb2xlYW5cbik6IEV4cHJlc3Npb248Ym9vbGVhbj4ge1xuXHRpZiAoIWRhdGFNb2RlbE9iamVjdFBhdGggfHwgIWRhdGFNb2RlbE9iamVjdFBhdGguc3RhcnRpbmdFbnRpdHlTZXQpIHtcblx0XHRyZXR1cm4gY29uc3RhbnQodHJ1ZSk7XG5cdH1cblx0ZGF0YU1vZGVsT2JqZWN0UGF0aCA9IGVuaGFuY2VEYXRhTW9kZWxQYXRoKGRhdGFNb2RlbE9iamVjdFBhdGgsIHByb3BlcnR5UGF0aCk7XG5cblx0bGV0IGN1cnJlbnRFbnRpdHlTZXQ6IEVudGl0eVNldCB8IG51bGwgPSBkYXRhTW9kZWxPYmplY3RQYXRoLnN0YXJ0aW5nRW50aXR5U2V0O1xuXHRsZXQgcGFyZW50RW50aXR5U2V0OiBFbnRpdHlTZXQgfCBudWxsID0gbnVsbDtcblx0bGV0IHZpc2l0ZWROYXZpZ2F0aW9uUHJvcHNOYW1lOiBzdHJpbmdbXSA9IFtdO1xuXHRjb25zdCBhbGxWaXNpdGVkTmF2aWdhdGlvblByb3BzOiBOYXZpZ2F0aW9uUHJvcGVydHlbXSA9IFtdO1xuXHRsZXQgdGFyZ2V0RW50aXR5U2V0OiBFbnRpdHlTZXQgfCBudWxsID0gY3VycmVudEVudGl0eVNldDtcblx0bGV0IHJlc2V0VmlzaXRlZE5hdlByb3BzID0gZmFsc2U7XG5cblx0ZGF0YU1vZGVsT2JqZWN0UGF0aC5uYXZpZ2F0aW9uUHJvcGVydGllcy5mb3JFYWNoKChuYXZpZ2F0aW9uUHJvcGVydHk6IE5hdmlnYXRpb25Qcm9wZXJ0eSkgPT4ge1xuXHRcdGlmIChyZXNldFZpc2l0ZWROYXZQcm9wcykge1xuXHRcdFx0dmlzaXRlZE5hdmlnYXRpb25Qcm9wc05hbWUgPSBbXTtcblx0XHR9XG5cdFx0dmlzaXRlZE5hdmlnYXRpb25Qcm9wc05hbWUucHVzaChuYXZpZ2F0aW9uUHJvcGVydHkubmFtZSk7XG5cdFx0YWxsVmlzaXRlZE5hdmlnYXRpb25Qcm9wcy5wdXNoKG5hdmlnYXRpb25Qcm9wZXJ0eSk7XG5cdFx0aWYgKCFuYXZpZ2F0aW9uUHJvcGVydHkuY29udGFpbnNUYXJnZXQpIHtcblx0XHRcdC8vIFdlIHNob3VsZCBoYXZlIGEgbmF2aWdhdGlvblByb3BlcnR5QmluZGluZyBhc3NvY2lhdGVkIHdpdGggdGhlIHBhdGggc28gZmFyIHdoaWNoIGNhbiBjb25zaXN0IG9mIChbQ29udGFpbm1lbnROYXZQcm9wXS8pKltOYXZQcm9wXVxuXHRcdFx0Y29uc3QgZnVsbE5hdmlnYXRpb25QYXRoID0gdmlzaXRlZE5hdmlnYXRpb25Qcm9wc05hbWUuam9pbihcIi9cIik7XG5cdFx0XHRpZiAoY3VycmVudEVudGl0eVNldCAmJiBjdXJyZW50RW50aXR5U2V0Lm5hdmlnYXRpb25Qcm9wZXJ0eUJpbmRpbmcuaGFzT3duUHJvcGVydHkoZnVsbE5hdmlnYXRpb25QYXRoKSkge1xuXHRcdFx0XHRwYXJlbnRFbnRpdHlTZXQgPSBjdXJyZW50RW50aXR5U2V0O1xuXHRcdFx0XHRjdXJyZW50RW50aXR5U2V0ID0gY3VycmVudEVudGl0eVNldC5uYXZpZ2F0aW9uUHJvcGVydHlCaW5kaW5nW2Z1bGxOYXZpZ2F0aW9uUGF0aF07XG5cdFx0XHRcdHRhcmdldEVudGl0eVNldCA9IGN1cnJlbnRFbnRpdHlTZXQ7XG5cdFx0XHRcdC8vIElmIHdlIHJlYWNoZWQgYSBuYXZpZ2F0aW9uIHByb3BlcnR5IHdpdGggYSBuYXZpZ2F0aW9ucHJvcGVydHliaW5kaW5nLCB3ZSBuZWVkIHRvIHJlc2V0IHRoZSB2aXNpdGVkIHBhdGggb24gdGhlIG5leHQgaXRlcmF0aW9uIChpZiB0aGVyZSBpcyBvbmUpXG5cdFx0XHRcdHJlc2V0VmlzaXRlZE5hdlByb3BzID0gdHJ1ZTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIFdlIHJlYWxseSBzaG91bGQgbm90IGVuZCB1cCBoZXJlIGJ1dCBhdCBsZWFzdCBsZXQncyB0cnkgdG8gYXZvaWQgaW5jb3JyZWN0IGJlaGF2aW9yXG5cdFx0XHRcdHBhcmVudEVudGl0eVNldCA9IGN1cnJlbnRFbnRpdHlTZXQ7XG5cdFx0XHRcdGN1cnJlbnRFbnRpdHlTZXQgPSBudWxsO1xuXHRcdFx0XHRyZXNldFZpc2l0ZWROYXZQcm9wcyA9IHRydWU7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHBhcmVudEVudGl0eVNldCA9IGN1cnJlbnRFbnRpdHlTZXQ7XG5cdFx0XHR0YXJnZXRFbnRpdHlTZXQgPSBudWxsO1xuXHRcdH1cblx0fSk7XG5cblx0Ly8gQXQgdGhpcyBwb2ludCB3ZSBoYXZlIG5hdmlnYXRlZCBkb3duIGFsbCB0aGUgbmF2IHByb3AgYW5kIHdlIHNob3VsZCBoYXZlXG5cdC8vIFRoZSB0YXJnZXQgZW50aXR5c2V0IHBvaW50aW5nIHRvIGVpdGhlciBudWxsIChpbiBjYXNlIG9mIGNvbnRhaW5tZW50IG5hdnByb3AgYSBsYXN0IHBhcnQpLCBvciB0aGUgYWN0dWFsIHRhcmdldCAobm9uIGNvbnRhaW5tZW50IGFzIHRhcmdldClcblx0Ly8gVGhlIHBhcmVudCBlbnRpdHlTZXQgcG9pbnRpbmcgdG8gdGhlIHByZXZpb3VzIGVudGl0eXNldCB1c2VkIGluIHRoZSBwYXRoXG5cdC8vIFZpc2l0ZWROYXZpZ2F0aW9uUGF0aCBzaG91bGQgY29udGFpbiB0aGUgcGF0aCB1cCB0byB0aGlzIHByb3BlcnR5XG5cblx0Ly8gUmVzdHJpY3Rpb25zIHNob3VsZCB0aGVuIGJlIGV2YWx1YXRlZCBhcyBQYXJlbnRFbnRpdHlTZXQuTmF2UmVzdHJpY3Rpb25zW05hdnByb3BlcnR5UGF0aF0gfHwgVGFyZ2V0RW50aXR5U2V0LlJlc3RyaWN0aW9uc1xuXHRjb25zdCBmdWxsTmF2aWdhdGlvblBhdGggPSB2aXNpdGVkTmF2aWdhdGlvblByb3BzTmFtZS5qb2luKFwiL1wiKTtcblx0bGV0IHJlc3RyaWN0aW9ucztcblx0aWYgKHBhcmVudEVudGl0eVNldCAhPT0gbnVsbCkge1xuXHRcdGNvbnN0IF9wYXJlbnRFbnRpdHlTZXQ6IEVudGl0eVNldCA9IHBhcmVudEVudGl0eVNldDtcblx0XHRfcGFyZW50RW50aXR5U2V0LmFubm90YXRpb25zPy5DYXBhYmlsaXRpZXM/Lk5hdmlnYXRpb25SZXN0cmljdGlvbnM/LlJlc3RyaWN0ZWRQcm9wZXJ0aWVzLmZvckVhY2goXG5cdFx0XHQocmVzdHJpY3RlZE5hdlByb3A6IE5hdmlnYXRpb25Qcm9wZXJ0eVJlc3RyaWN0aW9uVHlwZXMpID0+IHtcblx0XHRcdFx0aWYgKHJlc3RyaWN0ZWROYXZQcm9wLk5hdmlnYXRpb25Qcm9wZXJ0eT8udHlwZSA9PT0gXCJOYXZpZ2F0aW9uUHJvcGVydHlQYXRoXCIpIHtcblx0XHRcdFx0XHRjb25zdCByZXN0cmljdGlvbkRlZmluaXRpb24gPSBjaGVja0Z1bmN0aW9uKHJlc3RyaWN0ZWROYXZQcm9wKTtcblx0XHRcdFx0XHRpZiAoZnVsbE5hdmlnYXRpb25QYXRoID09PSByZXN0cmljdGVkTmF2UHJvcC5OYXZpZ2F0aW9uUHJvcGVydHkudmFsdWUgJiYgcmVzdHJpY3Rpb25EZWZpbml0aW9uICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRcdHJlc3RyaWN0aW9ucyA9IGVxdWFsKFxuXHRcdFx0XHRcdFx0XHRhbm5vdGF0aW9uRXhwcmVzc2lvbihcblx0XHRcdFx0XHRcdFx0XHRyZXN0cmljdGlvbkRlZmluaXRpb24sXG5cdFx0XHRcdFx0XHRcdFx0Z2V0UGF0aFJlbGF0aXZlTG9jYXRpb24oZGF0YU1vZGVsT2JqZWN0UGF0aD8uY29udGV4dExvY2F0aW9uLCBhbGxWaXNpdGVkTmF2aWdhdGlvblByb3BzLnNsaWNlKDAsIC0xKSlcblx0XHRcdFx0XHRcdFx0KSxcblx0XHRcdFx0XHRcdFx0dHJ1ZVxuXHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpO1xuXHR9XG5cdGxldCB0YXJnZXRSZXN0cmljdGlvbnM7XG5cdGNvbnN0IHJlc3RyaWN0aW9uRGVmaW5pdGlvbiA9IGNoZWNrRnVuY3Rpb24odGFyZ2V0RW50aXR5U2V0Py5hbm5vdGF0aW9ucz8uQ2FwYWJpbGl0aWVzKTtcblx0aWYgKHJlc3RyaWN0aW9uRGVmaW5pdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0dGFyZ2V0UmVzdHJpY3Rpb25zID0gZXF1YWwoXG5cdFx0XHRhbm5vdGF0aW9uRXhwcmVzc2lvbihcblx0XHRcdFx0cmVzdHJpY3Rpb25EZWZpbml0aW9uLFxuXHRcdFx0XHRnZXRQYXRoUmVsYXRpdmVMb2NhdGlvbihkYXRhTW9kZWxPYmplY3RQYXRoLmNvbnRleHRMb2NhdGlvbiwgYWxsVmlzaXRlZE5hdmlnYXRpb25Qcm9wcylcblx0XHRcdCksXG5cdFx0XHR0cnVlXG5cdFx0KTtcblx0fVxuXHQvL29iamVjdCBwYWdlIHRhYmxlIGNhc2UgaW4gcGF0aCBiYXNlZCBzY2VuYXJpbydzIGZhbGxiYWNrIHRvIGV4aXNpdGluZyBhcHByb2FjaFxuXHRpZiAoYlRhYmxlQ2FzZSAmJiAhcmVzdHJpY3Rpb25zICYmIHJlc3RyaWN0aW9uRGVmaW5pdGlvbj8ucGF0aCkge1xuXHRcdGNvbnN0IG9SZXN1bHQ6IGFueSA9IHtcblx0XHRcdFwiY3VycmVudEVudGl0eVJlc3RyaWN0aW9uXCI6IHRhcmdldFJlc3RyaWN0aW9uc1xuXHRcdH07XG5cdFx0cmV0dXJuIG9SZXN1bHQ7XG5cdH1cblx0cmV0dXJuIHJlc3RyaWN0aW9ucyB8fCB0YXJnZXRSZXN0cmljdGlvbnMgfHwgY29uc3RhbnQodHJ1ZSk7XG59O1xuIl19