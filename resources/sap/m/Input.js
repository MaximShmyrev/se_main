/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['./InputBase','./Popover','sap/ui/core/Item','./ColumnListItem','./GroupHeaderListItem','./StandardListItem','sap/ui/core/SeparatorItem','./List','./Table','./library','sap/ui/core/IconPool','sap/ui/Device','./SuggestionsPopover','./Toolbar','./ToolbarSpacer','./Button',"sap/ui/core/ResizeHandler","sap/ui/dom/containsOrEquals","sap/base/assert","sap/base/util/deepEqual","sap/m/inputUtils/wordStartsWithValue","sap/m/inputUtils/inputsDefaultFilter","sap/m/inputUtils/highlightDOMElements","sap/m/inputUtils/typeAhead","sap/ui/events/KeyCodes","sap/m/inputUtils/filterItems","sap/m/inputUtils/ListHelpers","./InputRenderer","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/selectText"],function(I,P,a,C,G,S,b,L,T,l,c,D,d,e,f,B,R,g,h,j,w,k,m,t,K,n,o,p,q){"use strict";var r=l.ListType;var s=l.InputTextFormatMode;var u=l.InputType;var v=l.ListMode;var x=l.ListSeparators;var y=I.extend("sap.m.Input",{metadata:{library:"sap.m",properties:{type:{type:"sap.m.InputType",group:"Data",defaultValue:u.Text},maxLength:{type:"int",group:"Behavior",defaultValue:0},dateFormat:{type:"string",group:"Misc",defaultValue:'YYYY-MM-dd',deprecated:true},showValueHelp:{type:"boolean",group:"Behavior",defaultValue:false},valueHelpIconSrc:{type:"sap.ui.core.URI",group:"Behavior",defaultValue:"sap-icon://value-help"},showSuggestion:{type:"boolean",group:"Behavior",defaultValue:false},valueHelpOnly:{type:"boolean",group:"Behavior",defaultValue:false},filterSuggests:{type:"boolean",group:"Behavior",defaultValue:true},maxSuggestionWidth:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:null},startSuggestion:{type:"int",group:"Behavior",defaultValue:1},showTableSuggestionValueHelp:{type:"boolean",group:"Behavior",defaultValue:true},description:{type:"string",group:"Misc",defaultValue:null},fieldWidth:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:'50%'},valueLiveUpdate:{type:"boolean",group:"Behavior",defaultValue:false},selectedKey:{type:"string",group:"Data",defaultValue:""},textFormatMode:{type:"sap.m.InputTextFormatMode",group:"Misc",defaultValue:s.Value},textFormatter:{type:"any",group:"Misc",defaultValue:""},suggestionRowValidator:{type:"any",group:"Misc",defaultValue:""},enableSuggestionsHighlighting:{type:"boolean",group:"Behavior",defaultValue:true},autocomplete:{type:"boolean",group:"Behavior",defaultValue:true}},defaultAggregation:"suggestionItems",aggregations:{suggestionItems:{type:"sap.ui.core.Item",multiple:true,singularName:"suggestionItem"},suggestionColumns:{type:"sap.m.Column",multiple:true,singularName:"suggestionColumn",bindable:"bindable",forwarding:{getter:"_getSuggestionsTable",aggregation:"columns"}},suggestionRows:{type:"sap.m.ColumnListItem",altTypes:["sap.m.GroupHeaderListItem"],multiple:true,singularName:"suggestionRow",bindable:"bindable",forwarding:{getter:"_getSuggestionsTable",aggregation:"items"}},_suggestionPopup:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_valueHelpIcon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"}},associations:{selectedItem:{type:"sap.ui.core.Item",multiple:false},selectedRow:{type:"sap.m.ColumnListItem",multiple:false}},events:{liveChange:{parameters:{value:{type:"string"},escPressed:{type:"boolean"},previousValue:{type:"string"}}},valueHelpRequest:{parameters:{fromSuggestions:{type:"boolean"}}},suggest:{parameters:{suggestValue:{type:"string"},suggestionColumns:{type:"sap.m.ListBase"}}},suggestionItemSelected:{parameters:{selectedItem:{type:"sap.ui.core.Item"},selectedRow:{type:"sap.m.ColumnListItem"}}},submit:{parameters:{value:{type:"string"}}}},designtime:"sap/m/designtime/Input.designtime"}});c.insertFontFaceStyle();y._DEFAULTFILTER_TABULAR=function(V,z){var A=z.getCells(),i=0;for(;i<A.length;i++){if(A[i].getText){if(w(A[i].getText(),V)){return true;}}}return false;};y._DEFAULTRESULT_TABULAR=function(z){var A=z.getCells(),i=0;for(;i<A.length;i++){if(A[i].getText){return A[i].getText();}}return"";};y.prototype.init=function(){I.prototype.init.call(this);this._fnFilter=k;this._bFullScreen=D.system.phone;this._iSetCount=0;this._sProposedItemText=null;this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.m");};y.prototype.exit=function(){I.prototype.exit.call(this);this._deregisterEvents();this.cancelPendingSuggest();if(this._iRefreshListTimeout){clearTimeout(this._iRefreshListTimeout);this._iRefreshListTimeout=null;}if(this._oSuggestionTable){this._oSuggestionTable.destroy();this._oSuggestionTable=null;}if(this._oSuggPopover){this._oSuggPopover.destroy();this._oSuggPopover=null;}if(this._oShowMoreButton){this._oShowMoreButton.destroy();this._oShowMoreButton=null;}if(this._oButtonToolbar){this._oButtonToolbar.destroy();this._oButtonToolbar=null;}this.$().off("click");};y.prototype.onBeforeRendering=function(){var i=this.getSelectedKey(),z=this.getShowValueHelp()&&this.getEnabled()&&this.getEditable(),E=this.getAggregation("_endIcon")||[],A=E[0],F,H=this._isSuggestionsPopoverOpen(),V=H?this._oSuggPopover._getValueStateHeader().getText():null,J=H?this._oSuggPopover._getValueStateHeader().getValueState():"";I.prototype.onBeforeRendering.call(this);this._deregisterEvents();if(i){this.setSelectedKey(i);}if(this.getShowSuggestion()){if(this.getShowTableSuggestionValueHelp()){this._addShowMoreButton();}else{this._removeShowMoreButton();}F=this._oSuggPopover._oPopupInput;if(F){F.setType(this.getType());}}if(z){A=this._getValueHelpIcon();A.setProperty("visible",true,true);}else if(A){A.setProperty("visible",false,true);}if(!this.getWidth()){this.setProperty("width","100%",true);}this._resetTypeAhead();if(H&&((this.getValueStateText()&&V!==this.getValueStateText())||(this.getValueState()!==J)||(this.getFormattedValueStateText()))){this._updateSuggestionsPopoverValueState();}};y.prototype._getDisplayText=function(i){var z=this.getTextFormatter();if(z){return z(i);}var A=i.getText(),E=i.getKey(),F=this.getTextFormatMode();switch(F){case s.Key:return E;case s.ValueKey:return A+' ('+E+')';case s.KeyValue:return'('+E+') '+A;default:return A;}};y.prototype._onValueUpdated=function(i){if(this._bSelectingItem||i===this._sSelectedValue){return;}var z=this.getSelectedKey(),H,A=this._oSuggPopover&&this._oSuggPopover.getItemsContainer();if(z===''){return;}if(this._hasTabularSuggestions()){H=this._oSuggestionTable&&!!this._oSuggestionTable.getSelectedItem();}else{H=A&&!!A.getSelectedItem();}if(H){return;}this.setProperty("selectedKey",'',true);this.setAssociation("selectedRow",null,true);this.setAssociation("selectedItem",null,true);this.fireSuggestionItemSelected({selectedItem:null,selectedRow:null});};y.prototype._updateSelectionFromList=function(){if(this._oSuggPopover._iPopupListSelectedIndex<0){return false;}var i=this._oSuggPopover.getItemsContainer(),z=i&&i.getSelectedItem();if(z){if(this._hasTabularSuggestions()){this.setSelectionRow(z,true);}else{this.setSelectionItem(o.getItemByListItem(this.getSuggestionItems(),z),true);}}return true;};y.prototype.setSelectionItem=function(i,z){this._bSelectingItem=true;if(!i){this.setAssociation("selectedItem",null,true);this.setValue('');return;}this._oSuggPopover._iPopupListSelectedIndex=-1;var A=this._iSetCount,N;this.setAssociation("selectedItem",i,true);this.setProperty("selectedKey",i.getKey(),true);if(z){this.fireSuggestionItemSelected({selectedItem:i});}if(A!==this._iSetCount){N=this.getValue();}else{N=this._getDisplayText(i);}this._sSelectedValue=N;this.updateInputField(N);if(this.bIsDestroyed){return;}if(!(this.isMobileDevice()&&this instanceof sap.m.MultiInput)){this._closeSuggestionPopup();}this._bSelectingItem=false;};y.prototype.addSuggestionRowGroup=function(i,H,z){H=H||new G({title:i.text||i.key});this.addAggregation("suggestionRows",H,z);return H;};y.prototype.addSuggestionItemGroup=function(i,H,z){H=H||new b({text:i.text||i.key});this.addAggregation("suggestionItems",H,z);return H;};y.prototype.setSelectedItem=function(i){if(typeof i==="string"){i=sap.ui.getCore().byId(i);}if(i!==null&&!(i instanceof a)){return this;}this.setSelectionItem(i);return this;};y.prototype.setSelectedKey=function(i){i=this.validateProperty("selectedKey",i);this.setProperty("selectedKey",i,true);if(this._hasTabularSuggestions()){return this;}if(!i){this.setSelectionItem();return this;}var z=this.getSuggestionItemByKey(i);this.setSelectionItem(z);return this;};y.prototype.getSuggestionItemByKey=function(z){var A=this.getSuggestionItems()||[],E,i;for(i=0;i<A.length;i++){E=A[i];if(E.getKey()===z){return E;}}};y.prototype._getFormattedValueStateText=function(){var i=this._isSuggestionsPopoverOpen(),V=i?this._oSuggPopover._getValueStateHeader().getFormattedText():null;if(i&&V){return V;}else{return I.prototype.getFormattedValueStateText.call(this);}};y.prototype.setSelectionRow=function(i,z){if(!i){this.setAssociation("selectedRow",null,true);return;}this._oSuggPopover._iPopupListSelectedIndex=-1;this._bSelectingItem=true;var A,E=this.getSuggestionRowValidator();if(E){A=E(i);if(!(A instanceof a)){A=null;}}var F=this._iSetCount,H="",N;this.setAssociation("selectedRow",i,true);if(A){H=A.getKey();}this.setProperty("selectedKey",H,true);if(z){this.fireSuggestionItemSelected({selectedRow:i});}if(F!==this._iSetCount){N=this.getValue();}else{if(A){N=this._getDisplayText(A);}else{N=this._fnRowResultFilter?this._fnRowResultFilter(i):y._DEFAULTRESULT_TABULAR(i);}}this._sSelectedValue=N;this.updateInputField(N);if(this.bIsDestroyed){return;}if(!(this.isMobileDevice()&&this instanceof sap.m.MultiInput&&this._isMultiLineMode)){this._closeSuggestionPopup();}this._bSelectingItem=false;};y.prototype.setSelectedRow=function(i){if(typeof i==="string"){i=sap.ui.getCore().byId(i);}if(i!==null&&!(i instanceof C)){return this;}this.setSelectionRow(i);return this;};y.prototype._getValueHelpIcon=function(){var i=this,E=this.getAggregation("_endIcon")||[],z=this.getValueHelpIconSrc(),V=E[0];if(!V){V=this.addEndIcon({id:this.getId()+"-vhi",src:z,useIconTooltip:false,alt:this._oRb.getText("INPUT_VALUEHELP_BUTTON"),decorative:false,noTabStop:true,press:function(A){if(!i.getValueHelpOnly()){var F=this.getParent(),$;if(D.support.touch){$=F.$('inner');$.attr('readonly','readonly');F.focus();$.removeAttr('readonly');}else{F.focus();}i.bValueHelpRequested=true;i._fireValueHelpRequest(false);}}});}else if(V.getSrc()!==z){V.setSrc(z);}return V;};y.prototype._fireValueHelpRequest=function(F){var i="";if(this.getShowSuggestion()&&this._oSuggPopover){i=this._sTypedInValue||"";}else{i=this.getDOMValue();}this.fireValueHelpRequest({fromSuggestions:F,_userInputValue:i});};y.prototype._fireValueHelpRequestForValueHelpOnly=function(){if(this.getEnabled()&&this.getEditable()&&this.getShowValueHelp()&&this.getValueHelpOnly()){if(D.system.phone){this.focus();}this._fireValueHelpRequest(false);}};y.prototype.ontap=function(E){I.prototype.ontap.call(this,E);if(this.isValueHelpOnlyOpener(E.target)){this._fireValueHelpRequestForValueHelpOnly();}if(this.isMobileDevice()&&this.getEditable()&&this.getEnabled()&&this.getShowSuggestion()&&this._oSuggPopover&&E.target.id!=this.getId()+"-vhi"){this._openSuggestionsPopover();}};y.prototype.setFilterFunction=function(F){if(F===null||F===undefined){this._fnFilter=k;return this;}h(typeof(F)==="function","Input.setFilterFunction: first argument fnFilter must be a function on "+this);this._fnFilter=F;return this;};y.prototype.setRowResultFunction=function(F){var i;if(F===null||F===undefined){this._fnRowResultFilter=y._DEFAULTRESULT_TABULAR;return this;}h(typeof(F)==="function","Input.setRowResultFunction: first argument fnFilter must be a function on "+this);this._fnRowResultFilter=F;i=this.getSelectedRow();if(i){this.setSelectedRow(i);}return this;};y.prototype.closeSuggestions=function(){this._closeSuggestionPopup();};y.prototype._doSelect=function(i,E){if(D.support.touch){return;}var z=this._$input[0];if(z){var $=this._$input;z.focus();$.selectText(i?i:0,E?E:$.val().length);}return this;};y.prototype._isIncrementalType=function(){var i=this.getType();if(i==="Number"||i==="Date"||i==="Datetime"||i==="Month"||i==="Time"||i==="Week"){return true;}return false;};y.prototype.onsapescape=function(E){var i;if(this._isSuggestionsPopoverOpen()){E.originalEvent._sapui_handledByControl=true;this._oSuggPopover._iPopupListSelectedIndex=-1;this._closeSuggestionPopup();if(this._sBeforeSuggest!==undefined){if(this._sBeforeSuggest!==this.getValue()){i=this.getLastValue();this.setValue(this._sBeforeSuggest);this.setLastValue(i);}this._sBeforeSuggest=undefined;}return;}if(this.getValueLiveUpdate()){this.setProperty("value",this.getLastValue(),true);}if(I.prototype.onsapescape){I.prototype.onsapescape.apply(this,arguments);}};y.prototype.onsapenter=function(E){var V;this.cancelPendingSuggest();if(this._isSuggestionsPopoverOpen()){if(!this._updateSelectionFromList()&&!this.isComposingCharacter()){this._closeSuggestionPopup();V=this.getDOMValue().length;this.selectText(V,V);}}if(I.prototype.onsapenter){I.prototype.onsapenter.apply(this,arguments);}if(this.getEnabled()&&this.getEditable()&&!(this.getValueHelpOnly()&&this.getShowValueHelp())){this.fireSubmit({value:this.getValue()});}};y.prototype.onsapfocusleave=function(E){var i=this._oSuggPopover,z=i&&i.getPopover(),F=E.relatedControlId&&sap.ui.getCore().byId(E.relatedControlId),A=F&&F.getFocusDomRef(),H=z&&A&&g(z.getDomRef(),A);if(z instanceof P){if(H&&!i.bMessageValueStateActive){this._bPopupHasFocus=true;if(D.system.desktop&&j(z.getFocusDomRef(),A)||F.isA("sap.m.GroupHeaderListItem")){this.focus();}}else{if(this.getDOMValue()===this._sSelectedSuggViaKeyboard){this._sSelectedSuggViaKeyboard=null;}}}if(!H){I.prototype.onsapfocusleave.apply(this,arguments);}this.bValueHelpRequested=false;};y.prototype.onmousedown=function(E){if(this._isSuggestionsPopoverOpen()){E.stopPropagation();}};y.prototype._deregisterEvents=function(){this._deregisterPopupResize();if(this.isMobileDevice()&&this._oSuggPopover&&this._oSuggPopover.getPopover()){this.$().off("click");}};y.prototype.updateSuggestionItems=function(){this._bSuspendInvalidate=true;this.updateAggregation("suggestionItems");this._synchronizeSuggestions();this._bSuspendInvalidate=false;return this;};y.prototype.invalidate=function(){if(!this._bSuspendInvalidate){I.prototype.invalidate.apply(this,arguments);}};y.prototype.cancelPendingSuggest=function(){if(this._iSuggestDelay){clearTimeout(this._iSuggestDelay);this._iSuggestDelay=null;}};y.prototype._triggerSuggest=function(V){var i=this._oSuggPopover.getItemsContainer();this.cancelPendingSuggest();this._bShouldRefreshListItems=true;if(!V){V="";}if(V.length>=this.getStartSuggestion()){this._iSuggestDelay=setTimeout(function(){if(this._sPrevSuggValue!==V){this._bBindingUpdated=false;this.fireSuggest({suggestValue:V});if(!this._bBindingUpdated){this._refreshItemsDelayed();}this._sPrevSuggValue=V;}}.bind(this),300);}else if(this.isMobileDevice()){if(i instanceof T){i.addStyleClass("sapMInputSuggestionTableHidden");}else if(i&&i.destroyItems){i.destroyItems();}}else if(this._isSuggestionsPopoverOpen()){setTimeout(function(){var N=this.getDOMValue()||'';if(N<this.getStartSuggestion()){this._oSuggPopover._iPopupListSelectedIndex=-1;this._closeSuggestionPopup();}}.bind(this),0);}};(function(){y.prototype.setShowSuggestion=function(V){this.setProperty("showSuggestion",V,true);if(V){this._oSuggPopover=this._getSuggestionsPopover();this._oSuggPopover._iPopupListSelectedIndex=-1;if(!this._oSuggPopover.getPopover()){this._createSuggestionsPopoverPopup();this._synchronizeSuggestions();this._createSuggestionPopupContent();}}else{if(this._oSuggPopover){this._oSuggPopover._destroySuggestionPopup();this._oSuggPopover._iPopupListSelectedIndex=-1;this._oButtonToolbar=null;this._oShowMoreButton=null;}}return this;};y.prototype._shouldTriggerSuggest=function(){return!this._bPopupHasFocus&&!this.getStartSuggestion()&&!this.getValue()&&this.getShowSuggestion();};y.prototype.setShowTableSuggestionValueHelp=function(V){this.setProperty("showTableSuggestionValueHelp",V,true);if(!(this._oSuggPopover&&this._oSuggPopover.getPopover())){return this;}if(V){this._addShowMoreButton();}else{this._removeShowMoreButton();}return this;};y.prototype.onchange=function(E){if(this.getShowValueHelp()||this.getShowSuggestion()){return;}this.onChange(E);};y.prototype.oninput=function(E){I.prototype.oninput.call(this,E);if(E.isMarked("invalid")){return;}var V=this.getDOMValue(),i,z,A;if(this.getValueLiveUpdate()){this.setProperty("value",V,true);this._onValueUpdated(V);}this.fireLiveChange({value:V,newValue:V});this.addStyleClass("sapMFocus");if(this.getShowSuggestion()&&!this.isMobileDevice()){i=this._getSuggestionsPopover();z=i.getItemsContainer();this._triggerSuggest(V);if(z&&!i.bMessageValueStateActive){A=z&&z.getSelectedItem();z.removeStyleClass("sapMListFocus");A&&A.removeStyleClass("sapMLIBFocused");}else if(i.bMessageValueStateActive&&document.activeElement.tagName!=="A"){i._getValueStateHeader().removeStyleClass("sapMPseudoFocus");}}this._handleTypeAhead(this);};y.prototype.onkeydown=function(E){this._bDoTypeAhead=!D.os.android&&this.getAutocomplete()&&(E.which!==K.BACKSPACE)&&(E.which!==K.DELETE);};y.prototype.getValue=function(){return this.getDomRef("inner")&&this._$input?this.getDOMValue():this.getProperty("value");};y.prototype._refreshItemsDelayed=function(){clearTimeout(this._iRefreshListTimeout);this._iRefreshListTimeout=setTimeout(function(){if(this._oSuggPopover){this._refreshListItems();}}.bind(this),0);};y.prototype._clearSuggestionPopupItems=function(){var i=this._oSuggPopover.getItemsContainer();if(!i){return;}if(i instanceof T){i.removeSelections(true);}else{i.destroyItems();}};y.prototype._hideSuggestionPopup=function(){var i=this._oSuggPopover.getPopover(),z=this._oSuggPopover.getItemsContainer();function _(V){var F=this.getFocusInfo();this.setDOMValue(V);if(D.browser.internet_explorer){this.applyFocusInfo(F);}}if(!this.isMobileDevice()){if(this._isSuggestionsPopoverOpen()){this._sCloseTimer=setTimeout(function(){if(this._oSuggPopover){this._oSuggPopover._iPopupListSelectedIndex=-1;}this.cancelPendingSuggest();if(this._sTypedInValue){_.call(this,this._sTypedInValue);}i.close();}.bind(this),0);}}else if(this._hasTabularSuggestions()&&z){z.addStyleClass("sapMInputSuggestionTableHidden");}this.$("SuggDescr").text("");this.$("inner").removeAttr("aria-activedescendant");};y.prototype._openSuggestionPopup=function(O){if(!this.isMobileDevice()){if(this._sCloseTimer){clearTimeout(this._sCloseTimer);this._sCloseTimer=null;}if(!this._isSuggestionsPopoverOpen()&&!this._sOpenTimer&&O!==false){this._sOpenTimer=setTimeout(function(){this._sOpenTimer=null;this._oSuggPopover&&this._openSuggestionsPopover();}.bind(this),0);}}};y.prototype.getSuggestionsCount=function(F){var H=F.items,i=F.groups,z=H.length+i.length,A=z;if(!this._hasTabularSuggestions()){A-=i.length;}return A;};y.prototype._applySuggestionAcc=function(N){var A="",i=this._oRb;if(N===1){A=i.getText("INPUT_SUGGESTIONS_ONE_HIT");}else if(N>1){A=i.getText("INPUT_SUGGESTIONS_MORE_HITS",N);}else{A=i.getText("INPUT_SUGGESTIONS_NO_HIT");}this.$("SuggDescr").text(A);};y.prototype._refreshListItems=function(){var i=this.getShowSuggestion(),z=this._bDoTypeAhead?this._sTypedInValue:(this.getDOMValue()||""),F,A;this._oSuggPopover._iPopupListSelectedIndex=-1;if(!i||!this._bShouldRefreshListItems||!this.getDomRef()||(!this.isMobileDevice()&&!this.$().hasClass("sapMInputFocused"))){return null;}this._clearSuggestionPopupItems();if(z.length<this.getStartSuggestion()){this._hideSuggestionPopup();return false;}F=this._getFilteredSuggestionItems(z);A=this.getSuggestionsCount(F);if(A>0){this._openSuggestionPopup(this.getValue().length>=this.getStartSuggestion());}else{this._hideSuggestionPopup();}this._applySuggestionAcc(A);};y.prototype.addSuggestionItem=function(i){this.addAggregation("suggestionItems",i,true);if(!this._oSuggPopover){this._getSuggestionsPopover();}this._synchronizeSuggestions();this._createSuggestionPopupContent();return this;};y.prototype.insertSuggestionItem=function(i,z){this.insertAggregation("suggestionItems",z,i,true);if(!this._oSuggPopover){this._getSuggestionsPopover();}this._synchronizeSuggestions();this._createSuggestionPopupContent();return this;};y.prototype.removeSuggestionItem=function(i){var z=this.removeAggregation("suggestionItems",i,true);this._synchronizeSuggestions();return z;};y.prototype.removeAllSuggestionItems=function(){var i=this.removeAllAggregation("suggestionItems",true);this._synchronizeSuggestions();return i;};y.prototype.destroySuggestionItems=function(){this.destroyAggregation("suggestionItems",true);this._synchronizeSuggestions();return this;};y.prototype.addSuggestionRow=function(i){i.setType(r.Active);this.addAggregation("suggestionRows",i);this._synchronizeSuggestions();this._createSuggestionPopupContent(true);return this;};y.prototype.insertSuggestionRow=function(i,z){i.setType(r.Active);this.insertAggregation("suggestionRows",i,z);this._synchronizeSuggestions();this._createSuggestionPopupContent(true);return this;};y.prototype.removeSuggestionRow=function(i){var z=this.removeAggregation("suggestionRows",i);this._synchronizeSuggestions();return z;};y.prototype.removeAllSuggestionRows=function(){var i=this.removeAllAggregation("suggestionRows");this._synchronizeSuggestions();return i;};y.prototype.destroySuggestionRows=function(){this.destroyAggregation("suggestionRows");this._synchronizeSuggestions();return this;};y.prototype.bindAggregation=function(){if(arguments[0]==="suggestionRows"||arguments[0]==="suggestionColumns"||arguments[0]==="suggestionItems"){this._createSuggestionPopupContent(arguments[0]==="suggestionRows"||arguments[0]==="suggestionColumns");this._bBindingUpdated=true;}return I.prototype.bindAggregation.apply(this,arguments);};y.prototype._closeSuggestionPopup=function(){if(this._oSuggPopover){this._bShouldRefreshListItems=false;this.cancelPendingSuggest();this._isSuggestionsPopoverOpen()&&this._oSuggPopover.getPopover().close();if(!this.isMobileDevice()&&this.$().hasClass("sapMInputFocused")){this.openValueStateMessage();}this.$("SuggDescr").text("");this.$("inner").removeAttr("aria-activedescendant");this._sPrevSuggValue=null;}};y.prototype._synchronizeSuggestions=function(){var i=this.isMobileDevice()&&this._oSuggPopover&&this._oSuggPopover._oPopupInput.getFocusDomRef();if(document.activeElement===this.getFocusDomRef()||document.activeElement===i){this._bShouldRefreshListItems=true;this._refreshItemsDelayed();}if(!this.getDomRef()||this._isSuggestionsPopoverOpen()){return;}this._synchronizeSelection();};y.prototype._synchronizeSelection=function(){var i=this.getSelectedKey();if(!i){return;}if(this.getValue()&&!this.getSelectedItem()&&!this.getSelectedRow()){return;}this.setSelectedKey(i);};})();y.prototype.onfocusin=function(E){I.prototype.onfocusin.apply(this,arguments);this.addStyleClass("sapMInputFocused");if(!this.isMobileDevice()&&this._isSuggestionsPopoverOpen()){this.closeValueStateMessage();}if(this._shouldTriggerSuggest()){this._triggerSuggest(this.getValue());}this._bPopupHasFocus=undefined;this._sPrevSuggValue=null;};y.prototype.oncompositionend=function(E){I.prototype.oncompositionend.apply(this,arguments);if(!D.browser.edge&&!D.browser.firefox){this._handleTypeAhead(this);}};y.prototype._handleTypeAhead=function(i){var V=this.getValue();this._sTypedInValue=V;i._sProposedItemText=null;if(!this._bDoTypeAhead||V===""||V.length<this.getStartSuggestion()||document.activeElement!==this.getFocusDomRef()){return;}var H=i._hasTabularSuggestions(),z=H?i.getSuggestionRows():i.getSuggestionItems(),E=function(F){if(!F){return"";}return H?this._fnRowResultFilter(F):F.getText();}.bind(this);var A=t(V,this,z,function(F){return this._formatTypedAheadValue(E(F));}.bind(this));i._sProposedItemText=E(A[0]);};y.prototype._resetTypeAhead=function(i){i=i||this;i._sProposedItemText=null;this._sTypedInValue='';};y.prototype.onsapright=function(){var V=this.getValue();if(!this.getAutocomplete()){return;}if(this._sTypedInValue!==V){this._sTypedInValue=V;this.fireLiveChange({value:V,newValue:V});}};y.prototype._formatTypedAheadValue=function(N){if(N.toLowerCase().indexOf(this._sTypedInValue.toLowerCase())===0){return this._sTypedInValue.concat(N.substring(this._sTypedInValue.length,N.length));}else{return N;}};y.prototype.onsapshow=function(E){if(!this.getEnabled()||!this.getEditable()||!this.getShowValueHelp()){return;}this.bValueHelpRequested=true;this._fireValueHelpRequest(false);E.preventDefault();E.stopPropagation();};y.prototype.onsaphide=y.prototype.onsapshow;y.prototype.onsapselect=function(E){this._fireValueHelpRequestForValueHelpOnly();};y.prototype.onfocusout=function(E){I.prototype.onfocusout.apply(this,arguments);this.removeStyleClass("sapMInputFocused");this.$("SuggDescr").text("");};y.prototype._hasTabularSuggestions=function(){return!!(this.getAggregation("suggestionColumns")&&this.getAggregation("suggestionColumns").length);};y.prototype._getSuggestionsTable=function(){if(this._bIsBeingDestroyed){return this._oSuggestionTable;}if(!this._oSuggestionTable){this._oSuggestionTable=new T(this.getId()+"-popup-table",{mode:v.SingleSelectMaster,showNoData:false,showSeparators:x.None,width:"100%",enableBusyIndicator:false,rememberSelections:false,itemPress:function(E){if(D.system.desktop){this.focus();}var i=E.getParameter("listItem");this.setSelectionRow(i,true);}.bind(this),sticky:[l.Sticky.ColumnHeaders]});this._oSuggestionTable.addEventDelegate({onAfterRendering:function(){var i;if(!this.getEnableSuggestionsHighlighting()){return;}i=this._oSuggestionTable.$().find('tbody .sapMLabel');m(i,this._sTypedInValue);}},this);if(this.isMobileDevice()){this._oSuggestionTable.addStyleClass("sapMInputSuggestionTableHidden");}this._oSuggestionTable.updateItems=function(){T.prototype.updateItems.apply(this,arguments);this._refreshItemsDelayed();return this;};}return this._oSuggestionTable;};y.prototype.clone=function(){var i=I.prototype.clone.apply(this,arguments);i.setRowResultFunction(this._fnRowResultFilter);i.setValue(this.getValue());return i;};y.prototype.setValue=function(V){this._iSetCount++;I.prototype.setValue.call(this,V);this._onValueUpdated(V);return this;};y.prototype.setDOMValue=function(i){this._$input.val(i);};y.prototype.getDOMValue=function(){return this._$input.val();};y.prototype.updateInputField=function(N){if(this._isSuggestionsPopoverOpen()&&this.isMobileDevice()){this._oSuggPopover._oPopupInput.setValue(N);this._oSuggPopover._oPopupInput._doSelect();}else{N=this._getInputValue(N);this.setDOMValue(N);this.onChange(null,null,N);}};y.prototype.getAccessibilityInfo=function(){var i=I.prototype.getAccessibilityInfo.apply(this,arguments);i.description=((i.description||"")+" "+this.getDescription()).trim();return i;};y.prototype.preventChangeOnFocusLeave=function(E){return this.bFocusoutDueRendering||this.bValueHelpRequested;};y.prototype._getShowMoreButton=function(){return this._oShowMoreButton||(this._oShowMoreButton=new B({text:this._oRb.getText("INPUT_SUGGESTIONS_SHOW_ALL"),press:this._getShowMoreButtonPress.bind(this)}));};y.prototype._getShowMoreButtonPress=function(){var i;if(this.getShowTableSuggestionValueHelp()){if(this._sTypedInValue){i=this._sTypedInValue;this.updateDomValue(i);this._resetTypeAhead();this._sTypedInValue=i;}this._fireValueHelpRequest(true);this._oSuggPopover._iPopupListSelectedIndex=-1;this._closeSuggestionPopup();}};y.prototype._addShowMoreButton=function(i){var z=this._oSuggPopover&&this._oSuggPopover.getPopover();if(!z||!i&&!this._hasTabularSuggestions()){return;}if(z.isA("sap.m.Dialog")){var A=this._getShowMoreButton();z.setEndButton(A);}else{var E=this._getButtonToolbar();z.setFooter(E);}};y.prototype._removeShowMoreButton=function(){var i=this._oSuggPopover&&this._oSuggPopover.getPopover();if(!i||!this._hasTabularSuggestions()){return;}if(i.isA("sap.m.Dialog")){i.setEndButton(null);}else{i.setFooter(null);}};y.prototype._getButtonToolbar=function(){var i=this._getShowMoreButton();return this._oButtonToolbar||(this._oButtonToolbar=new e({content:[new f(),i]}));};y.prototype._hasShowSelectedButton=function(){return false;};y.prototype._createSuggestionPopupContent=function(i){if(this._bIsBeingDestroyed||this._getSuggestionsPopover().getItemsContainer()){return;}this._oSuggPopover.initContent(i?this._getSuggestionsTable():null);if(!this._hasTabularSuggestions()&&!i){this._decorateSuggestionsPopoverList(this._getSuggestionsPopover().getItemsContainer());}else{this._decorateSuggestionsPopoverTable();}};y.prototype._decorateSuggestionsPopoverList=function(i){if(!i||!i.isA("sap.m.List")){return;}i.addEventDelegate({onAfterRendering:function(){var z,A;if(!this.getEnableSuggestionsHighlighting()){return;}z=i.$().find('.sapMSLIInfo, .sapMSLITitleOnly');A=this._bDoTypeAhead?this._sTypedInValue:this.getValue();A=(A||"").toLowerCase();m(z,A);}},this);i.attachItemPress(function(E){if(D.system.desktop){this.focus();}var z=E.getParameter("listItem");if(!z.isA("sap.m.GroupHeaderListItem")){this.setSelectionItem(o.getItemByListItem(this.getSuggestionItems(),z),true);}},this);};y.prototype._decorateSuggestionsPopoverTable=function(){if(this._fnFilter===k){this._fnFilter=y._DEFAULTFILTER_TABULAR;}if(!this._fnRowResultFilter){this._fnRowResultFilter=y._DEFAULTRESULT_TABULAR;}if(this.getShowTableSuggestionValueHelp()){this._addShowMoreButton(true);}};y.prototype._createPopupInput=function(){var i=new y(this.getId()+"-popup-input",{width:"100%",valueLiveUpdate:true,showValueStateMessage:false,valueState:this.getValueState(),showValueHelp:this.getShowValueHelp(),valueHelpRequest:function(E){this.fireValueHelpRequest({fromSuggestions:true});this._oSuggPopover._iPopupListSelectedIndex=-1;this._closeSuggestionPopup();}.bind(this),liveChange:function(E){var V=E.getParameter("newValue");this.setDOMValue(this._getInputValue(this._oSuggPopover._oPopupInput.getValue()));this._triggerSuggest(V);this.fireLiveChange({value:V,newValue:V});}.bind(this)});return this._modifyPopupInput(i);};y.prototype._modifyPopupInput=function(i){i._handleTypeAhead=function(){y.prototype._handleTypeAhead.call(i,this);}.bind(this);i._resetTypeAhead=function(){y.prototype._resetTypeAhead.call(i,this);}.bind(this);i.addEventDelegate({onsapenter:function(){this.setValue(this._sProposedItemText);}},this);return i;};y.prototype.forwardEventHandlersToSuggPopover=function(i){i.setOkPressHandler(this._closeSuggestionPopup.bind(this));i.setCancelPressHandler(this._closeSuggestionPopup.bind(this));};y.prototype._getSuggestionsPopover=function(){if(!this._oSuggPopover){var i=this._oSuggPopover=new d(this);if(this.isMobileDevice()){i._oPopupInput=this._createPopupInput();}this._oSuggPopover.setInputLabels(this.getLabels.bind(this));this._createSuggestionsPopoverPopup();this.forwardEventHandlersToSuggPopover(i);i.attachEvent(d.M_EVENTS.SELECTION_CHANGE,function(E){var N=E.getParameter("newValue");this.setDOMValue(N);this._sSelectedSuggViaKeyboard=N;this._doSelect();},this);if(this.getShowTableSuggestionValueHelp()){this._addShowMoreButton();}}return this._oSuggPopover;};y.prototype._createSuggestionsPopoverPopup=function(){if(!this._oSuggPopover){return;}var i=this._oSuggPopover;var z;i.createSuggestionPopup({showSelectedButton:this._hasShowSelectedButton()});z=i.getPopover();z.attachBeforeOpen(function(){this._updateSuggestionsPopoverValueState();},this);z.attachBeforeClose(function(){this._updateSuggestionsPopoverValueState();},this);if(this.isMobileDevice()){z.attachBeforeClose(function(){this.setDOMValue(this._getInputValue(i._oPopupInput.getValue()));this.onChange();},this).attachAfterClose(function(){var A=i.getItemsContainer();if(!A){return;}if(T&&!(A instanceof T)){A.destroyItems();}else{A.removeSelections(true);}}).attachAfterOpen(function(){this._triggerSuggest(this.getValue());this._refreshListItems();},this).attachBeforeOpen(function(){i._oPopupInput.setPlaceholder(this.getPlaceholder());i._oPopupInput.setMaxLength(this.getMaxLength());i._oPopupInput.setValue(this.getValue());},this);}else{z.attachAfterClose(function(){this._updateSelectionFromList();var A=i.getItemsContainer(),E=A.getSelectedItem();if(!A){return;}if(A instanceof T){E&&E.removeStyleClass("sapMLIBFocused");A.removeSelections(true);}else{A.destroyItems();}this._deregisterPopupResize();},this).attachBeforeOpen(function(){i._sPopoverContentWidth=this.getMaxSuggestionWidth();i._bIsInputIncrementalType=this._isIncrementalType();this._sBeforeSuggest=this.getValue();i.resizePopup(this);this._registerPopupResize();},this);}this.setAggregation("_suggestionPopup",z);this._oSuggestionPopup=z;};y.prototype._registerPopupResize=function(){if(this._oSuggPopover){this._sPopupResizeHandler=R.register(this,this._oSuggPopover.resizePopup.bind(this._oSuggPopover,this));}};y.prototype._deregisterPopupResize=function(){if(this._sPopupResizeHandler){this._sPopupResizeHandler=R.deregister(this._sPopupResizeHandler);}};y.prototype.showItems=function(F){var i,z,A=this._fnFilter;if(!this.getEnabled()||!this.getEditable()){return;}this.setFilterFunction(F||function(){return true;});this._clearSuggestionPopupItems();i=this._getFilteredSuggestionItems(this.getDOMValue());z=this.getSuggestionsCount(i);if(z>0){this._openSuggestionPopup();}else{this._hideSuggestionPopup();}this._applySuggestionAcc(z);this.setFilterFunction(A);};y.prototype.shouldValueStateMessageBeOpened=function(){var i=I.prototype.shouldValueStateMessageBeOpened.apply(this,arguments);if(!i||this._isSuggestionsPopoverOpen()){return false;}return true;};y.prototype._isSuggestionsPopoverOpen=function(){return this._oSuggPopover&&this._oSuggPopover.isOpen();};y.prototype.isMobileDevice=function(){return D.system.phone;};y.prototype._openSuggestionsPopover=function(){this.closeValueStateMessage();this._updateSuggestionsPopoverValueState();this._oSuggPopover.getPopover().open();};y.prototype._updateSuggestionsPopoverValueState=function(){var i=this._oSuggPopover,V=this.getValueState(),N=this.getValueState()!==i._getValueStateHeader().getValueState(),z=this.getFormattedValueStateText(),A=this.getValueStateText();if(!i){return;}if(this._isSuggestionsPopoverOpen()&&!z&&!N){this.setFormattedValueStateText(this._oSuggPopover._getValueStateHeader().getFormattedText());}i.updateValueState(V,(z||A),this.getShowValueStateMessage());if(this.isMobileDevice()){i._oPopupInput.setValueState(V);}};y.prototype.setShowValueHelp=function(i){this.setProperty("showValueHelp",i);if(this._oSuggPopover&&this._oSuggPopover._oPopupInput){this._oSuggPopover._oPopupInput.setShowValueHelp(i);}return this;};y.prototype.isValueHelpOnlyOpener=function(i){return true;};y.prototype._getFilteredSuggestionItems=function(V){var F,i=this.getSuggestionItems(),z=this.getSuggestionRows(),A=this._oSuggPopover.getItemsContainer();if(this._hasTabularSuggestions()){if(this.isMobileDevice()&&A){A.removeStyleClass("sapMInputSuggestionTableHidden");}F=this.filterTabularItems(z,V);}else{F=n(this,i,V,this.getFilterSuggests(),true,this._fnFilter);this._mapItems(F);}return F;};y.prototype.filterTabularItems=function(i,V){var z,F=this.getFilterSuggests(),A=[],E=[],H=false;i.forEach(function(J){if(J.isA("sap.m.GroupHeaderListItem")){E.push({header:J,visible:false});}else{z=!F||this._fnFilter(V,J);J.setVisible(z);z&&A.push(J);if(!H&&z&&this._sProposedItemText===this._fnRowResultFilter(J)){J.setSelected(true);H=true;}if(E.length&&z){E[E.length-1].visible=true;}}},this);E.forEach(function(J){J.header.setVisible(J.visible);});this._getSuggestionsTable().invalidate();return{items:A,groups:E};};y.prototype._mapItems=function(F){var i=this.getSuggestionItems(),z=F.items,A=F.groups,M=A.map(function(Q){return Q.header;}),E=false,H=this._oSuggPopover,J=H&&H.getItemsContainer(),N,O;i.filter(function(Q){return(z.indexOf(Q)>-1)||(M.indexOf(Q)>-1);}).map(function(Q){N=o.createListItemFromCoreItem(Q,true);J.addItem(N);if(!E&&this._sProposedItemText===Q.getText()){N.setSelected(true);E=true;}return Q;},this).filter(function(Q){return M.indexOf(Q)>-1;}).forEach(function(Q){O=M.indexOf(Q);if(O>-1){N=o.getListItem(Q);N&&N.setVisible(A[O].visible);}});};return y;});
