/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['./ComboBoxTextField','./ComboBoxBase','./List','./library','sap/ui/Device','sap/ui/core/Item','./StandardListItem','./ComboBoxRenderer','sap/ui/base/ManagedObjectObserver',"sap/ui/dom/containsOrEquals","sap/m/inputUtils/scrollToItem","sap/m/inputUtils/inputsDefaultFilter","sap/m/inputUtils/typeAhead","sap/m/inputUtils/filterItems","sap/m/inputUtils/ListHelpers","sap/m/inputUtils/itemsVisibilityHandler","sap/ui/events/KeyCodes","./Toolbar","sap/base/assert","sap/base/security/encodeXML","sap/ui/core/Core","sap/base/Log","sap/ui/dom/jquery/control"],function(C,a,L,l,D,I,S,b,M,c,s,i,t,f,d,g,K,T,h,j,k,m,q){"use strict";var n=l.ListMode;var o=a.extend("sap.m.ComboBox",{metadata:{library:"sap.m",designtime:"sap/m/designtime/ComboBox.designtime",properties:{selectedKey:{type:"string",group:"Data",defaultValue:""},selectedItemId:{type:"string",group:"Misc",defaultValue:""},filterSecondaryValues:{type:"boolean",group:"Misc",defaultValue:false}},associations:{selectedItem:{type:"sap.ui.core.Item",multiple:false}},events:{change:{parameters:{value:{type:"string"},itemPressed:{type:"boolean"}}},selectionChange:{parameters:{selectedItem:{type:"sap.ui.core.Item"}}}},dnd:{draggable:false,droppable:true}}});function H(e,r){if(!r){return;}var u=e.getFocusDomRef(),v=e._getSelectionRange().start,w=u.value.substring(0,u.selectionStart),x=e._shouldResetSelectionStart(r),y=e.getSelectedItem(),G=r.isA("sap.ui.core.SeparatorItem"),z=d.getListItem(r);e.handleListItemsVisualFocus(z);e.setSelection(r);if(r!==y&&!G){e.updateDomValue(r.getText());e.fireSelectionChange({selectedItem:r});r=e.getSelectedItem();z=d.getListItem(r);if(x){v=0;}e.selectText(v,u.value.length);e._bIsLastFocusedItemHeader=false;}if(G){e.setSelectedItem(null);e.fireSelectionChange({selectedItem:null});e.updateDomValue(w);e._bIsLastFocusedItemHeader=true;e._getGroupHeaderInvisibleText().setText(e._oRb.getText("LIST_ITEM_GROUP_HEADER")+" "+r.getText());}if(e.isOpen()){e.removeStyleClass("sapMFocus");e._getList().addStyleClass("sapMListFocus");}else{e.addStyleClass("sapMFocus");}s(z,e.getPicker());}function p(e){var r=this.getSelectedItem(),u=d.getListItem(r),v=r&&u&&u.getDomRef(),w=v&&v.offsetTop,x=v&&v.offsetHeight,P=this.getPicker(),y=P.getDomRef("cont"),z=y.clientHeight;if(r&&((w+x)>(z))){if(!e){this._getList().$().css("visibility","hidden");}else{y.scrollTop=w-x/2;this._getList().$().css("visibility","visible");}}}o.prototype._getSelectedItemText=function(v){v=v||this.getSelectedItem();if(!v){v=this.getDefaultSelectedItem();}if(v){return v.getText();}return"";};o.prototype.setSelectedIndex=function(e,_){var r;_=_||this.getItems();e=(e>_.length-1)?_.length-1:Math.max(0,e);r=_[e];if(r){this.setSelection(r);}};o.prototype.revertSelection=function(){var P,e=this.getPickerTextField();this.setSelectedItem(this._oSelectedItemBeforeOpen);this.setValue(this._sValueBeforeOpen);if(this.getSelectedItem()===null){P=this._sValueBeforeOpen;}else{P=this._oSelectedItemBeforeOpen.getText();}e&&e.setValue(P);};o.prototype._filterStartsWithItems=function(e,r){var u=e.toLowerCase();var v=this.getItems(),F=v.filter(function(w){return w[r]&&w[r]().toLowerCase().startsWith(u);});return F;};o.prototype.getNextFocusableItem=function(e){var A=this.getSelectableItems(),r=this.getNonSeparatorSelectableItems(A),F=this.hasStyleClass("sapMFocus"),u=this.getSelectedItem()||d.getItemByListItem(this.getItems(),this._oLastFocusedListItem),v=this.getFormattedTextFocused(),N;if((F&&this.isOpen())||v){N=A[0];}else if(F&&!this.getValueStateLinks().length){N=r[r.indexOf(u)+(e?1:-1)];}else{N=A[A.indexOf(u)+(e?1:-1)];}if(v||(!v&&u===A[0]&&!e&&this.getValueStateLinks().length)){this.setProperty("formattedTextFocused",!v);}return N;};o.prototype.getNonSeparatorSelectableItems=function(e){return e.filter(function(r){return!r.isA("sap.ui.core.SeparatorItem");});};o.prototype._itemsTextStartsWithTypedValue=function(e,r){if(!e||typeof r!="string"||r==""){return false;}return e.getText().toLowerCase().startsWith(r.toLowerCase());};o.prototype._shouldResetSelectionStart=function(e){var r=this.getFocusDomRef(),u=this._getSelectionRange(),v=u.start!==u.end,w=r.value.substring(0,u.start),x=this._itemsTextStartsWithTypedValue(e,w);return!(x&&(v||this._bIsLastFocusedItemHeader));};o.prototype._getSelectionRange=function(){var e=this.getFocusDomRef(),v=this.getValue(),r=e.selectionStart,u=e.selectionEnd,R={start:r,end:u};if(!(D.browser.msie||D.browser.edge)){return R;}if(this._bIsLastFocusedItemHeader){R.start=v.length;R.end=v.length;}return R;};o.prototype.handleListItemsVisualFocus=function(e){if(this._oLastFocusedListItem){this._oLastFocusedListItem.removeStyleClass("sapMLIBFocused");this._oLastFocusedListItem=null;}else if(this.isOpen()&&this.getFocusDomRef()){this.getFocusDomRef().setAttribute("aria-activedescendant",e.getId());}if(e){this._oLastFocusedListItem=e;e.addStyleClass("sapMLIBFocused");}};o.prototype.setSelection=function(v){var e=this._getList(),r=this._getSuggestionsPopover(),u,w;this.setAssociation("selectedItem",v);this._setPropertyProtected("selectedItemId",(v instanceof I)?v.getId():v,true);if(typeof v==="string"){v=k.byId(v);}if(e){u=d.getListItem(v);if(u){e.setSelectedItem(u,true);}else{e.removeSelections(true);}}w=v?v.getKey():"";this._setPropertyProtected("selectedKey",w);if(r){r._iPopupListSelectedIndex=this.getItems().indexOf(v);}};o.prototype.isSelectionSynchronized=function(){var v=this.getSelectedItem();return this.getSelectedKey()===(v&&v.getKey());};o.prototype._forwardItemProperties=function(P){var e=P.object,r=e.data(d.CSS_CLASS+"ListItem"),u={text:"title",enabled:"visible",tooltip:"tooltip"},A,v,w;if(Object.keys(u).indexOf(P.name)>-1){v=u[P.name];w="set"+v.charAt(0).toUpperCase()+v.slice(1);r[w](P.current);}if(P.name==="additionalText"){A=this.getShowSecondaryValues()?P.current:"";r.setInfo(A);}};o.prototype.isItemSelected=function(v){return v&&(v.getId()===this.getAssociation("selectedItem"));};o.prototype.setAssociation=function(A,e,r){var u=this._getList();if(u&&(A==="selectedItem")){if(!(e instanceof I)){e=this.findItem("id",e);}u.setSelectedItem(d.getListItem(e),true);}return a.prototype.setAssociation.apply(this,arguments);};o.prototype.removeAllAssociation=function(A,e){var r=this._getList();if(r&&(A==="selectedItem")){L.prototype.removeAllAssociation.apply(r,arguments);}return a.prototype.removeAllAssociation.apply(this,arguments);};o.prototype.init=function(){this._oRb=k.getLibraryResourceBundle("sap.m");a.prototype.init.apply(this,arguments);this.bOpenValueStateMessage=true;this._sValueBeforeOpen="";this._sInputValueBeforeOpen="";this._oSelectedItemBeforeOpen=null;this.bIsFocused=false;if(D.system.phone){this.attachEvent("_change",this.onPropertyChange,this);}this._oLastFocusedListItem=null;this._bIsLastFocusedItemHeader=null;this._oItemObserver=new M(this._forwardItemProperties.bind(this));};o.prototype.onBeforeRendering=function(){a.prototype.onBeforeRendering.apply(this,arguments);var e=this.getSelectedItem(),r=this._getList(),u=e&&d.getListItem(e),F=this.getProperty("formattedTextFocused"),v=this.getPicker()&&this.getPicker().getCustomHeader(),P=(D.browser.msie&&v&&v.getFormattedText)?v.getFormattedText():v;this.synchronizeSelection();if(!this.getOpen()&&document.activeElement===this.getFocusDomRef()&&this.getEnabled()){this.addStyleClass("sapMFocus");}if(F){P.addStyleClass("sapMPseudoFocus");r.removeStyleClass("sapMListFocus");u.removeStyleClass("sapMLIBFocused");this.removeStyleClass("sapMFocus");}else if(P){P.removeStyleClass("sapMPseudoFocus");}};o.prototype.exit=function(){a.prototype.exit.apply(this,arguments);this._oRb=null;this._oSelectedItemBeforeOpen=null;this._oLastFocusedListItem=null;if(this._oItemObserver){this._oItemObserver.disconnect();this._oItemObserver=null;}};o.prototype.onBeforeRenderingPicker=function(){var O=this["onBeforeRendering"+this.getPickerType()];O&&O.call(this);};o.prototype.onBeforeRenderingDropdown=function(){var P=this.getPicker(),w=(this.$().outerWidth()/parseFloat(l.BaseFontSize))+"rem";if(P){P.setContentMinWidth(w);}};o.prototype.onBeforeRenderingList=function(){if(this.bProcessingLoadItemsEvent){var e=this._getList(),F=this.getFocusDomRef();if(e){e.setBusy(true);}if(F){F.setAttribute("aria-busy","true");}}};o.prototype.onAfterRenderingPicker=function(){var O=this["onAfterRendering"+this.getPickerType()];O&&O.call(this);p.call(this,false);};o.prototype.onAfterRenderingList=function(){var e=this.getSelectedItem(),r=d.getListItem(e);if(this.bProcessingLoadItemsEvent&&(this.getItems().length===0)){return;}var u=this._getList(),F=this.getFocusDomRef();this.highlightList(this._sInputValueBeforeOpen);if(e){u.setSelectedItem(r);this.handleListItemsVisualFocus(r);}if(u){u.setBusy(false);}if(F){F.removeAttribute("aria-busy");}};o.prototype._fillList=function(){var F,e,r,u=this._getList(),E=d.getEnabledItems(this.getItems());if(!u){return;}if(this._oLastFocusedListItem){e=d.getItemByListItem(E,this._oLastFocusedListItem);}u.destroyItems();if(this._sInputValueBeforeOpen){F=this.filterItems(this._sInputValueBeforeOpen);E=F.items;}E.forEach(function(v){r=this._mapItemToListItem(v).setVisible(true);u.addItem(r);}.bind(this));if(this._sInputValueBeforeOpen){g(E,F);}if(e){this._oLastFocusedListItem=d.getListItem(e);}};o.prototype.filterItems=function(v){return f(this,this.getItems(),v,true,this.getFilterSecondaryValues(),this.fnFilter||i);};o.prototype._mapItemToListItem=function(e){var r=d.createListItemFromCoreItem(e,this.getShowSecondaryValues());if(e.isA("sap.ui.core.Item")){this.setSelectable(e,e.getEnabled());}r.addAriaLabelledBy(this._getGroupHeaderInvisibleText().getId());r.addStyleClass(this.getRenderer().CSS_CLASS_COMBOBOXBASE+"NonInteractiveItem");this._oItemObserver.observe(e,{properties:["text","additionalText","enabled","tooltip"]});return r;};o.prototype.oninput=function(e){a.prototype.oninput.apply(this,arguments);this.syncPickerContent();if(e.isMarked("invalid")){return;}this.loadItems(function(){this.handleInputValidation(e);},{name:"input",busyIndicator:false});if(this.bProcessingLoadItemsEvent&&(this.getPickerType()==="Dropdown")){this.open();}if(this._oLastFocusedListItem){this._oLastFocusedListItem.removeStyleClass("sapMLIBFocused");this._oLastFocusedListItem=null;}this.setFormattedTextFocused(false);this.addStyleClass("sapMFocus");this._getList().removeStyleClass("sapMListFocus");if(this._getItemsShownWithFilter()){this.toggleIconPressedStyle(true);}};o.prototype.handleInputValidation=function(e){var v,r,F,u,w,x=this.getSelectedItem(),V=e.target.value,E=V==="",y=e.srcControl,z=(this.getPickerType()==="Dropdown"),A=d.getListItem(x),B=this.filterItems(V);if(E&&!this.bOpenedByKeyboardOrButton&&!this.isPickerDialog()){v=this.getItems();}else{v=this.getNonSeparatorSelectableItems(B.items);g(this.getItems(),B);}F=v[0];u=v.some(function(G){return G.getKey()===this.getSelectedKey();},this);r=this.intersectItems(this._filterStartsWithItems(V,'getText'),v);w=!E&&F&&F.getEnabled();if(F&&this.getSelectedKey()&&!u){this.setSelection(null);}if(w&&y&&y._bDoTypeAhead){this.handleTypeAhead(y,v,V);}else if(w&&r[0]&&V===r[0].getText()){this.setSelection(r[0]);}else{this.setSelection(null);}if(x!==this.getSelectedItem()){this.fireSelectionChange({selectedItem:this.getSelectedItem()});A=d.getListItem(this.getSelectedItem());}this._sInputValueBeforeOpen=V;if(this.isOpen()){setTimeout(function(){this.highlightList(V);}.bind(this));}if(F){if(E&&!this.bOpenedByKeyboardOrButton){this.close();}else if(z){this.open();s(A,this.getPicker());}}else if(this.isOpen()){if(z&&!this.bOpenedByKeyboardOrButton){this.close();}}else{this.clearFilter();}};o.prototype.handleTypeAhead=function(e,r,v){var u,w=this.getFilterSecondaryValues(),x=t(v,e,r,function(y){u=[y.getText()];if(w){u.push(y.getAdditionalText());}return u;});this.setSelection(x[0]);this.addStyleClass("sapMFocus");this._getList().removeStyleClass("sapMListFocus");};o.prototype.onSelectionChange=function(e){var r=d.getItemByListItem(this.getItems(),e.getParameter("listItem")),P=this.getChangeEventParams(),u=(r!==this.getSelectedItem());this.updateDomValue(r.getText());this.setSelection(r);this.fireSelectionChange({selectedItem:this.getSelectedItem()});if(u){P.itemPressed=true;this.onChange(null,P);}};o.prototype.onItemPress=function(e){var r=e.getParameter("listItem"),u=r.getTitle(),P=this.getChangeEventParams(),v=(r!==d.getListItem(this.getSelectedItem()));if(r.isA("sap.m.GroupHeaderListItem")){return;}this.handleListItemsVisualFocus(r);this.updateDomValue(u);if(!v){P.itemPressed=true;this.onChange(null,P);}this._setPropertyProtected("value",u,true);if(this.getPickerType()==="Dropdown"&&!this.isPlatformTablet()){this.selectText.bind(this,this.getValue().length,this.getValue().length);}this.close();};o.prototype.onBeforeOpen=function(){a.prototype.onBeforeOpen.apply(this,arguments);var P=this["onBeforeOpen"+this.getPickerType()],e=this.getFocusDomRef();this.setProperty("open",true);if(this.hasLoadItemsEventListeners()&&!this.bProcessingLoadItemsEvent){this.loadItems();}if(e){e.setAttribute("aria-controls",this.getPicker().getId());}this.addContent();P&&P.call(this);};o.prototype.onBeforeOpenDialog=function(){var P=this.getPickerTextField();this._oSelectedItemBeforeOpen=this.getSelectedItem();this._sValueBeforeOpen=this.getValue();this.getSelectedItem()&&g(this.getItems(),this.filterItems(""));P.setValue(this._sValueBeforeOpen);};o.prototype.onAfterOpen=function(){var e=this.getSelectedItem(),r=this._getSelectionRange(),u=this.isPlatformTablet();this.closeValueStateMessage();p.call(this,true);if(!u&&e&&r.start===r.end&&r.start>1){setTimeout(function(){this.selectText(0,r.end);}.bind(this),0);}};o.prototype.onBeforeClose=function(){a.prototype.onBeforeClose.apply(this,arguments);var e=this.getFocusDomRef();this.setProperty("open",false);this.setProperty("formattedTextFocused",false);if(e){e.removeAttribute("aria-controls");}this.toggleIconPressedStyle(false);};o.prototype.onAfterClose=function(){this.clearFilter();this._sInputValueBeforeOpen="";if(this.isPickerDialog()){a.prototype.closeValueStateMessage.apply(this,arguments);}};o.prototype.onItemChange=function(e){var r=this.getAssociation("selectedItem"),N=e.getParameter("newValue"),P=e.getParameter("name");if(r===e.getParameter("id")){switch(P){case"text":if(!this.isBound("value")){this.setValue(N);}break;case"key":if(!this.isBound("selectedKey")){this.setSelectedKey(N);}break;}}};o.prototype.onkeydown=function(e){var r=e.srcControl;a.prototype.onkeydown.apply(r,arguments);if(!r.getEnabled()||!r.getEditable()){return;}var u=K;r._bDoTypeAhead=!D.os.android&&(e.which!==u.BACKSPACE)&&(e.which!==u.DELETE);};o.prototype.oncut=function(e){var r=e.srcControl;a.prototype.oncut.apply(r,arguments);r._bDoTypeAhead=false;};o.prototype.onsapenter=function(e){var r=e.srcControl,u=r.getSelectedItem();if(u&&this.getFilterSecondaryValues()){r.updateDomValue(u.getText());}a.prototype.onsapenter.apply(r,arguments);if(!r.getEnabled()||!r.getEditable()){return;}if(r.isOpen()&&!this.isComposingCharacter()){r.close();}};o.prototype.onsapdown=function(e){var r=e.srcControl;if(!r.getEnabled()||!r.getEditable()){return;}this.syncPickerContent();e.setMarked();e.preventDefault();this.loadItems(function u(){H.call(this,r,this.getNextFocusableItem(true));});};o.prototype.onsapup=function(e){var r=e.srcControl;if(!r.getEnabled()||!r.getEditable()){return;}this.syncPickerContent();e.setMarked();e.preventDefault();this.loadItems(function u(){H.call(this,r,this.getNextFocusableItem(false));});};o.prototype.onsaphome=function(e){var r=e.srcControl;if(!r.getEnabled()||!r.getEditable()){return;}this.syncPickerContent();e.setMarked();if(this.getValueStateLinks().length){this.setProperty("formattedTextFocused",true);}e.preventDefault();this.loadItems(function u(){var F=this.getSelectableItems()[0];H.call(this,r,F);});};o.prototype.onsapend=function(e){var r=e.srcControl;if(!r.getEnabled()||!r.getEditable()){return;}this.syncPickerContent();e.setMarked();e.preventDefault();if(this.getValueStateLinks().length&&this.getFormattedTextFocused()){this.setProperty("formattedTextFocused",false);}this.loadItems(function v(){var u=this.findLastEnabledItem(this.getSelectableItems());H.call(this,r,u);});};o.prototype.onsappagedown=function(e){var r=e.srcControl;if(!r.getEnabled()||!r.getEditable()){return;}this.syncPickerContent();e.setMarked();e.preventDefault();if(this.getValueStateLinks().length&&this.getFormattedTextFocused()){this.setProperty("formattedTextFocused",false);}this.loadItems(function(){var u=this.getNonSeparatorSelectableItems(this.getSelectableItems()),v=u.indexOf(this.getSelectedItem())+10,w;v=(v>u.length-1)?u.length-1:Math.max(0,v);w=u[v];H.call(this,r,w);});};o.prototype.onsappageup=function(e){var r=e.srcControl;if(!r.getEnabled()||!r.getEditable()){return;}this.syncPickerContent();e.setMarked();e.preventDefault();this.loadItems(function(){var u=this.getNonSeparatorSelectableItems(this.getSelectableItems()),v=u.indexOf(this.getSelectedItem())-10,w;v=(v>u.length-1)?u.length-1:Math.max(0,v);w=u[v];H.call(this,r,w);});};o.prototype.onsapshow=function(e){var r,u,E=this.getEditable(),v;a.prototype.onsapshow.apply(this,arguments);this.syncPickerContent();if(!this.getValue()&&E){r=this.getSelectableItems();u=this.getNonSeparatorSelectableItems(r)[0];if(u){v=d.getListItem(u);if(this.isOpen()){this.removeStyleClass("sapMFocus");this._getList().addStyleClass("sapMListFocus");this.handleListItemsVisualFocus(v);}else{this.addStyleClass("sapMFocus");}this.setSelection(u);this.updateDomValue(u.getText());this.fireSelectionChange({selectedItem:u});setTimeout(function(){this.selectText(0,u.getText().length);}.bind(this),0);}}};o.prototype.onsaphide=o.prototype.onsapshow;o.prototype.ontap=function(e){if(!this.getEnabled()){return;}var r=this.getFocusDomRef(),A="aria-activedescendant";this.addStyleClass("sapMFocus");if(this.getFormattedTextFocused()){this.setFormattedTextFocused(false);}else if((this.getOpen()&&this._getList().hasStyleClass("sapMListFocus"))||this._oLastFocusedListItem){this._getList().removeStyleClass("sapMListFocus");this._oLastFocusedListItem.removeStyleClass("sapMLIBFocused");this._oLastFocusedListItem=null;r.removeAttribute(A);}};o.prototype.onfocusin=function(e){var r=this.getPickerType()==="Dropdown";if(this._bIsBeingDestroyed){return;}if(e.target===this.getOpenArea()){this.bOpenValueStateMessage=false;if(r&&!this.isPlatformTablet()){this.focus();}}else{if(r){setTimeout(function(){if(document.activeElement===this.getFocusDomRef()&&!this.bIsFocused&&!this.bFocusoutDueRendering&&!this.getSelectedText()){this.selectText(0,this.getValue().length);}this.bIsFocused=true;}.bind(this),0);}if(!this.isOpen()&&this.bOpenValueStateMessage&&this.shouldValueStateMessageBeOpened()){this.openValueStateMessage();}this.bOpenValueStateMessage=true;}if(this.getEnabled()&&(!this.isOpen()||!this.getSelectedItem()||!this._getList().hasStyleClass("sapMListFocus"))){this.addStyleClass("sapMFocus");}};o.prototype.onsapfocusleave=function(e){this.bIsFocused=false;var r,P,R,F,u=this.getSelectedItem();if(u&&this.getFilterSecondaryValues()){this.updateDomValue(u.getText());}a.prototype.onsapfocusleave.apply(this,arguments);if(this.isPickerDialog()){return;}P=this.getPicker();if(!e.relatedControlId||!P){return;}r=this.isPlatformTablet();R=k.byId(e.relatedControlId);F=R&&R.getFocusDomRef();if(c(P.getFocusDomRef(),F)&&!r&&!this.getFormattedTextFocused()){this.focus();}};o.prototype.synchronizeSelection=function(){if(this.isSelectionSynchronized()){return;}var e=this.getSelectedKey(),v=this.getItemByKey(""+e);if(v&&(e!=="")){this.setAssociation("selectedItem",v,true);this._setPropertyProtected("selectedItemId",v.getId(),true);this.setValue(v.getText());this._sValue=this.getValue();}};o.prototype.configPicker=function(P){var r=this.getRenderer(),e=r.CSS_CLASS_COMBOBOXBASE;P.setHorizontalScrolling(false).addStyleClass(e+"Picker").addStyleClass(e+"Picker-CTX").attachBeforeOpen(this.onBeforeOpen,this).attachAfterOpen(this.onAfterOpen,this).attachBeforeClose(this.onBeforeClose,this).attachAfterClose(this.onAfterClose,this).addEventDelegate({onBeforeRendering:this.onBeforeRenderingPicker,onAfterRendering:this.onAfterRenderingPicker},this);};o.prototype._configureList=function(e){var r=this.getRenderer();if(!e){return;}e.setMode(n.SingleSelectMaster).addStyleClass(r.CSS_CLASS_COMBOBOXBASE+"List").addStyleClass(r.CSS_CLASS_COMBOBOX+"List");e.attachSelectionChange(this.onSelectionChange,this).attachItemPress(this.onItemPress,this);e.addEventDelegate({onBeforeRendering:this.onBeforeRenderingList,onAfterRendering:this.onAfterRenderingList},this);};o.prototype.destroyItems=function(){this.destroyAggregation("items");if(this._getList()){this._getList().destroyItems();}return this;};o.prototype.getDefaultSelectedItem=function(){return null;};o.prototype.getChangeEventParams=function(){return{itemPressed:false};};o.prototype.clearSelection=function(){this.setSelection(null);};o.prototype.selectText=function(e,r){a.prototype.selectText.apply(this,arguments);this.textSelectionStart=e;this.textSelectionEnd=r;return this;};o.prototype.removeAllItems=function(){var e=a.prototype.removeAllItems.apply(this,arguments);this._fillList();return e;};o.prototype.clone=function(e){var r=a.prototype.clone.apply(this,arguments),u=this._getList();if(!this.isBound("items")&&u){r.syncPickerContent();r.setSelectedIndex(this.indexOfItem(this.getSelectedItem()));}return r;};o.prototype.open=function(){this.syncPickerContent();var e=this._getList();a.prototype.open.call(this);if(this.getSelectedItem()){e.addStyleClass("sapMListFocus");this.removeStyleClass("sapMFocus");}return this;};o.prototype.syncPickerContent=function(){var P,e=this.getPicker(),r=this.getInputForwardableProperties();if(!e){var u,G;e=this.createPicker(this.getPickerType());P=this.getPickerTextField();this._fillList();if(P){r.forEach(function(v){v=v.charAt(0).toUpperCase()+v.slice(1);u="set"+v;G="get"+v;if(P[u]){P[u](this[G]());}},this);}this._getSuggestionsPopover().updateValueState(this.getValueState(),this.getValueStateText(),this.getShowValueStateMessage());}this.synchronizeSelection();return e;};o.prototype.findAggregatedObjects=function(){var e=this._getList();if(e){return L.prototype.findAggregatedObjects.apply(e,arguments);}return[];};o.prototype.setSelectedItem=function(v){if(typeof v==="string"){this.setAssociation("selectedItem",v,true);v=k.byId(v);}if(!(v instanceof I)&&v!==null){return this;}if(!v){v=this.getDefaultSelectedItem();}this.setSelection(v);this.setValue(this._getSelectedItemText(v));return this;};o.prototype.setSelectedItemId=function(v){v=this.validateProperty("selectedItemId",v);if(!v){v=this.getDefaultSelectedItem();}this.setSelection(v);v=this.getSelectedItem();this.setValue(this._getSelectedItemText(v));return this;};o.prototype.setSelectedKey=function(e){e=this.validateProperty("selectedKey",e);var r=(e===""),u=this.isBound("selectedKey")&&this.isBound("value")&&this.getBindingInfo("selectedKey").skipModelUpdate;if(r){this.setSelection(null);if(!u){this.setValue("");}return this;}var v=this.getItemByKey(e);if(v){this.setSelection(v);if(!u){this.setValue(this._getSelectedItemText(v));}return this;}this._sValue=this.getValue();return this._setPropertyProtected("selectedKey",e);};o.prototype._setPropertyProtected=function(P,v,r){try{return this.setProperty(P,v,r);}catch(e){m.warning("setSelectedKey update failed due to exception. Loggable in support mode log",null,null,function(){return{exception:e};});}};o.prototype.getSelectedItem=function(){var v=this.getAssociation("selectedItem");return(v===null)?null:k.byId(v)||null;};o.prototype.removeItem=function(v){v=a.prototype.removeItem.apply(this,arguments);var e;if(this._getList()){this._getList().removeItem(v&&d.getListItem(v));}if(this.isBound("items")&&!this.bItemsUpdated){return v;}var V=this.getValue();if(this.getItems().length===0){this.clearSelection();}else if(this.isItemSelected(v)){e=this.getDefaultSelectedItem();this.setSelection(e);this.setValue(V);}return v;};o.prototype._modifyPopupInput=function(e){a.prototype._modifyPopupInput.apply(this,arguments);e.addEventDelegate({onsapenter:function(){var r=e.getValue();this.updateDomValue(r);this.onChange();if(r){this.updateDomValue(r);this.onChange();this.close();}}},this);return e;};o.prototype.applyShowItemsFilters=function(){var P,e;this.syncPickerContent();P=this.getPicker();e=function(){P.detachBeforeOpen(e,this);P=null;g(this.getItems(),this.filterItems(this.getValue()||"_"));};P.attachBeforeOpen(e,this);};o.prototype.showItems=function(F){var e,r,u=Array.prototype.slice.call(arguments),v=this.fnFilter,w=function(){this.setFilterFunction(F||function(){return true;});r=this.filterItems(this.getValue()||"_");g(this.getItems(),r);this.setFilterFunction(v);e=r.items;if(e&&e.length){a.prototype.showItems.apply(this,u);}}.bind(this);this.attachLoadItems(w);this.loadItems(w);};o.prototype._getFormattedValueStateText=function(){if(this.isOpen()){return this._getSuggestionsPopover()._getValueStateHeader().getFormattedText();}else{return C.prototype.getFormattedValueStateText.call(this);}};return o;});
