/*!
 * SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Component","sap/ui/thirdparty/jquery","sap/base/Log","./utils/Constants","./data/Config","./controller/PluginController"],function(C,$,L,a,b,P){"use strict";return C.extend("sap.feedback.ui.flpplugin.Component",{metadata:{manifest:"json"},_oPluginController:null,init:function(){this._getShellUIService().then(function(s){return this._setup(s);}.bind(this));},_setup:function(s){return new Promise(function(r,c){var o=this._loadPluginConfig();if(o){var q=o.getQualtricsUri();if(q&&q.length>0){var t=o.getTenantId();if(t&&t.length>0){if(this._isDeviceDisplayFormatCombinationValid(o.getDisplayFormat())){var R=this.getModel("i18n").getResourceBundle();this._oPluginController=new P(o,this._getRenderer(),R,s);this._oPluginController.init().then(function(){r();});}}else{L.error("Feedback config insufficient - tenant id missing.",o,a.S_PLUGIN_COMPONENT_NAME);c();}}else{L.error("Feedback config insufficient - url missing.",o,a.S_PLUGIN_COMPONENT_NAME);c();}}else{L.error("Feedback config could not be read.",o,a.S_PLUGIN_COMPONENT_NAME);c();}}.bind(this));},_loadPluginConfig:function(){if(this.getComponentData()){var p=this.getComponentData().config;var c=new b(p.qualtricsInternalUri,p.tenantId,a.E_DATA_FORMAT.version1);c.setTenantRole(p.tenantRole);if(p.isPushEnabled){c.setIsPushEnabled(p.isPushEnabled);if(c.getIsPushEnabled()&&p.pushChannelPath&&p.pushChannelPath.length>0){c.setPushChannelPath(p.pushChannelPath);}}if(p.productName){c.setProductName(p.productName);}if(p.platformType){c.setPlatformType(p.platformType);}return c;}return null;},_isDeviceDisplayFormatCombinationValid:function(d){if(sap.ui.Device.system.phone&&d===a.E_DISPLAY_FORMAT.popover){return false;}return true;},_getShellUIService:function(){return this.getService("ShellUIService").then(function(s){return s;},function(e){L.error("Cannot get ShellUIService",e,a.S_PLUGIN_COMPONENT_NAME);});},_getRenderer:function(){var d=new $.Deferred(),r;this._oShellContainer=$.sap.getObject("sap.ushell.Container");if(!this._oShellContainer){d.reject("Illegal state: shell container not available; this component must be executed in a unified shell runtime context.");}else{r=this._oShellContainer.getRenderer();if(r){d.resolve(r);}else{this._onRendererCreated=function(e){r=e.getParameter("renderer");if(r){d.resolve(r);}else{d.reject("Illegal state: shell renderer not available after recieving 'rendererLoaded' event.");}};this._oShellContainer.attachRendererCreatedEvent(this._onRendererCreated);}}return d.promise();}});});
