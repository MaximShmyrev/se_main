/*!
 * SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/base/Object","sap/base/Log","sap/ui/core/ws/WebSocket","sap/ui/core/ws/ReadyState","../utils/Constants"],function(O,L,W,R,C){"use strict";return O.extend("sap.feedback.ui.flpplugin.controller.PushClient",{_oConfig:null,_fnPushCallback:null,_connection:null,constructor:function(c){this._oConfig=c;},init:function(p){this._fnPushCallback=p;this._initClient();},_initClient:function(){var w=this._constructUri();if(w&&w.length>0){try{this._connection=new W(w);this._connection.attachOpen(this._onOpen,this);this._connection.attachMessage(this._onMessage,this);this._connection.attachError(this._onError,this);this._connection.attachClose(this._onClose,this);}catch(e){L.error("Push survey connection could not be initalized.",e,C.S_PLUGIN_PUSHCLNT_NAME);}}},_constructUri:function(){var c=window.location;var s="";if(c.protocol==="https:"){s="wss:";}else{s="ws:";}s+="//"+c.host;s+=this._oConfig.getPushChannelPath();return s;},_close:function(){this._connection.close();},send:function(){if(this._connection.getReadyState()===R.OPEN){}},_onOpen:function(e){L.info("Opened push survey channel:",e,C.S_PLUGIN_PUSHCLNT_NAME);},_onMessage:function(E){var d=E.getParameter("data");if(d){try{var j=JSON.parse(d);this.showSurvey(j);}catch(e){L.error("Push survey data could not be parsed.",e,C.S_PLUGIN_PUSHCLNT_NAME);}}},_onError:function(e){L.info("Error on push survey channel:",e,C.S_PLUGIN_PUSHCLNT_NAME);},_onClose:function(e){L.info("Closing push survey channel:",e,C.S_PLUGIN_PUSHCLNT_NAME);},showSurvey:function(d){if(d&&d.showSurvey){if(d.showSurvey===true){if(d.appTitle){sap.qtxAppContext.appTitle=d.appTitle;}if(this._fnPushCallback){this._fnPushCallback(d);}}}}});});
