sap.ui.define(["sap/ui/base/Object","sap/ui/base/Event","sap/ui/core/mvc/ControllerExtension","sap/ui/model/Context","sap/ui/model/Filter","sap/m/Table","sap/m/ListBase","sap/m/MessageBox","sap/ui/generic/app/navigation/service/SelectionVariant","sap/ui/generic/app/navigation/service/NavError","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/metadataAnalyser","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/ui/model/analytics/odata4analytics","sap/base/util/extend","sap/base/util/deepExtend","sap/suite/ui/generic/template/genericUtilities/FeError","sap/suite/ui/generic/template/js/StableIdHelper"],function(B,E,C,a,F,R,L,M,S,N,c,m,t,b,o,d,f,g,h){"use strict";var s="lib.CommonUtils";var l=sap.ui.getCore();var n=new b(s).getLogger();function p(q,r,u){var v;var w=Object.create(null);var O=Object.create(null);function P(e){var i;if(c.isSmartTable(e)){i=e.getCustomToolbar();}else if(c.isSmartChart(e)){i=e.getToolbar();}if(i){var j=V(i);if(j&&j.annotatedActionIds){O[e.getId()]=JSON.parse(atob(j.annotatedActionIds));}if(j&&j.deleteButtonId){O[e.getId()].push({ID:j.deleteButtonId,RecordType:"CRUDActionDelete"});}}}function G(e){if(!O[e.getId()]){P(e);}return O[e.getId()];}function x(e){var i,j,k,J1;i=e.getEntitySet();j=q.getOwnerComponent().getModel().getMetaModel();k=j.getODataEntitySet(i);J1=j.getODataEntityType(k.entityType);return J1;}function y(e,i,j){var k=e instanceof E?e.getSource():e;var J1=k.getId();var K1=w[J1];if(!K1){if(j){return null;}K1={control:k,infoObject:Object.create(null),categories:[]};(i||Function.prototype)(K1.infoObject,K1.categories,k);w[J1]=K1;}return K1.infoObject;}function z(e,i){for(var j in w){var k=w[j];if(k.categories.indexOf(e)>=0){i(k.infoObject,k.control);}}}function A(e){r.oApplication.attachControlToParent(e,q.getView());}function D(e,j){var k="";var J1=q.getView();for(var i=0;i<e.length;i++){var K1=e[i];if(c.isElementVisibleOnView(K1,J1)){if(j){var L1=l.byId(K1);if(c.isSmartTable(L1)||c.isMTable(L1)||c.isUiTable(L1)){k=k||K1;continue;}}return K1;}}return k;}function H(e,i,j,k){return r.oApplication.getDialogFragmentForView(q.getView(),e,i,j,k);}function I(e,i,j,k,J1){return r.oApplication.getDialogFragmentForViewAsync(q.getView(),e,i,j,k,J1);}var J;function K(){var e=q.getOwnerComponent();J=J||e.getModel("i18n").getResourceBundle();return J.getText.apply(J,arguments);}function Q(k,e,i,j){var J1,K1,L1,M1;var N1=q.getOwnerComponent();var O1=e.indexOf("::"+N1.getEntitySet()+"--")+2;J1=e.substring(O1,e.lastIndexOf("::"));J1=J1.replace(/--/g,"|").replace(/::/g,"|");L1=i||k;K1=J1&&J1!='|'?k+"|"+J1:L1;M1=K(K1,j);if(M1===K1&&K1!=L1){M1=K(L1,j);}return M1;}function T(e,i){var i=i||e.getSelectionBehavior();if(i==="DATAPOINT"){return{"dataPoints":e.getSelectedDataPoints().dataPoints,"count":e.getSelectedDataPoints().count};}else if(i==="CATEGORY"){return{"dataPoints":e.getSelectedCategories().categories,"count":e.getSelectedCategories().count};}else if(i==="SERIES"){return{"dataPoints":e.getSelectedSeries().series,"count":e.getSelectedSeries().count};}}function U(e,j,k){var J1=[];if(c.isSmartTable(e)){e=e.getTable();}else if(c.isSmartChart(e)){e.getChartAsync().then(function(N1){e=N1;if(e&&e.getMetadata().getName()==="sap.chart.Chart"){var O1=false;j=j||e.getSelectionBehavior();k=k||T(e,j);if(k&&k.count>0){if(j==="DATAPOINT"){O1=true;}var P1=k.dataPoints;var Q1=[];for(var i=0;i<P1.length;i++){if(O1){if(P1[i].context){J1.push(P1[i].context);}}else{Q1.push(P1[i].dimensions);}}if(!O1){J1[0]=Q1;}}}});}if(e instanceof L){J1=e.getSelectedContexts();}else if(c.isUiTable(e)){var K1=e.getPlugins().filter(function(N1){return N1.isA("sap.ui.table.plugins.SelectionPlugin");})[0];var L1=K1?K1.getSelectedIndices():e.getSelectedIndices();if(L1){var M1;for(var i=0;i<L1.length;i++){M1=e.getContextByIndex(L1[i]);if(M1){J1.push(M1);}}}}return J1;}function V(e){var i={};if(e instanceof sap.ui.core.Element){e.getCustomData().forEach(function(j){i[j.getKey()]=j.getValue();});}return i;}function W(e){var j,k,J1;var K1=h1(e);if(!c.isSmartTable(K1)&&!c.isSmartChart(K1)){K1=K1.getParent();}var L1=U(K1);var M1=K1.getModel();k=e1(K1);c1(k,L1,M1,K1);j=G(K1);for(var i=0;i<j.length;i++){J1=j[i];X(J1,M1,L1,K1);}if(u.getParameterModelForTemplating().getData().templateSpecific.multiEdit){var N1=b1(L1,K1);var O1=h.getStableId({type:"ListReportAction",subType:"MultiEdit"});Z(O1,"enabled",N1.length>0);}}function X(e,i,j,k){var J1;if(e.RecordType==="CRUDActionDelete"){var K1=_(i,j,k);u.getTemplatePrivateModel().setProperty("/listReport/deleteEnabled",K1);J1=Promise.resolve(K1);}else if(e.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||e.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){var L1=i.getMetaModel();J1=$(i,L1,j,e.RecordType,e.Action,k);}var M1=q.getView().byId(e.ID);if(M1&&/generic\/controlProperties/.test(M1.getBindingPath("enabled"))){J1.then(Z.bind(null,e.ID,"enabled"));}}function Y(e){var i;var j=h1(e);var k=U(j);var J1=e.getModel();i=f1();c1(i,k,J1,j);}function Z(i,e,j){var k=u.getTemplatePrivateModel();var J1=k.getProperty("/generic/controlProperties/"+i);if(!J1){J1={};J1[e]=j;k.setProperty("/generic/controlProperties/"+i,J1);}else{k.setProperty("/generic/controlProperties/"+i+"/"+e,j);}}function $(e,i,k,J1,K1,L1){var M1,N1,O1,P1;var Q1=false;if(J1==="com.sap.vocabularies.UI.v1.DataFieldForAction"){M1=i.getODataFunctionImport(K1);O1=M1&&M1["sap:action-for"];if(O1&&O1!==""&&O1!==" "){if(k.length>0){P1=M1["sap:applicable-path"];if(P1&&P1!==""&&P1!==" "){for(var j=0;j<k.length;j++){if(!k[j]){continue;}N1=e.getObject(k[j].getPath());if(N1&&N1[P1]){Q1=true;break;}}}else{Q1=true;}}}else{Q1=true;}}else if(J1==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(k.length>0){Q1=true;}else if(c.isSmartChart(L1)){return L1.getChartAsync().then(function(){return L1.getDrillStackFilters().length>0;});}}return Promise.resolve(Q1);}function _(e,i,j){if(i.length===0){return false;}var k=a1(j);var J1=k&&k.Deletable&&k.Deletable.Path;return i.some(function(K1){var L1=e.getObject(K1.getPath()+"/DraftAdministrativeData");var M1=!(L1&&L1.InProcessByUser&&!L1.DraftIsProcessedByMe);return M1&&!(J1&&!e.getProperty(J1,K1));});}function a1(e){var i=e.getModel()&&e.getModel().getMetaModel();var j=i&&i.getODataEntitySet(e.getEntitySet());var k=j&&j["Org.OData.Capabilities.V1.DeleteRestrictions"];return k;}function b1(e,i){if(e.length===0){return[];}var j=[];var k=i.getModel();var J1=k.getMetaModel();var K1=J1.getODataEntitySet(i.getEntitySet());var L1=K1["Org.OData.Capabilities.V1.UpdateRestrictions"]&&K1["Org.OData.Capabilities.V1.UpdateRestrictions"].Updatable;if(L1){if(L1.Path){j=e.filter(function(M1){return!!k.getProperty(L1.Path,M1);});}else if(L1.Bool!=="false"){j=e;}}return j;}function c1(e,i,j,k){var J1=g1(k);var K1=u.getTemplatePrivateModel();var L1=K1.getProperty("/generic/listCommons/breakoutActionsEnabled");if(J1){var M1=q.byId("template::IconTabBar");var N1="";if(M1){N1=M1.getSelectedKey();}d1(L1,J1,e,i,j,N1,k);}K1.setProperty("/generic/listCommons/breakoutActionsEnabled",L1);}function d1(e,i,j,k,J1,K1,L1){var M1;for(var N1 in i){M1=true;var O1=i[N1].id+((K1&&!i[N1].determining)?"-"+K1:"");if(L1&&L1.getId().indexOf("AnalyticalListPage")>-1){M1=!!e[O1].enabled;}if(i[N1].requiresSelection){if(k.length>0){if(L1&&c.isSmartChart(L1)){if(i[N1].filter==="chart"){M1=true;}}else if(L1&&c.isSmartTable(L1)){if(i[N1].filter!=="chart"){M1=true;}}if(i[N1].applicablePath!==undefined&&i[N1].applicablePath!==""){M1=false;for(var P1=0;P1<k.length;P1++){var Q1="";var R1=i[N1].applicablePath.split("/");if(R1.length>1){for(var S1=0;S1<R1.length-1;S1++){Q1+="/"+R1[S1];}}var T1=J1.getObject(k[P1].getPath()+Q1);var U1=R1[R1.length-1];if(T1[U1]===true){M1=true;break;}}}}else if(c.isSmartChart(L1)){if((L1.getId().indexOf("AnalyticalListPage")>-1?i[N1].filter==="chart":true)){if(L1.getDrillStackFilters().length>0){M1=true;}else{M1=false;}}}else{if(i[N1].filter!=="chart"){M1=false;}}}e[O1]={enabled:M1};}}function e1(e){var i=[];var j=g1(e);for(var k in j){i.push(j[k].id);}return i;}function f1(){var e=[];var i=g1();for(var j in i){if(i[j].determining){e.push(j);}}return e;}function g1(e){var i=u.getControllerExtensions();var j=V(e).sectionId;if(!j){return i&&i["Actions"];}else{return i&&i.Sections&&i.Sections[j]&&i.Sections[j].Actions;}}function h1(e){var i=e;while(i){if(i instanceof R||c.isUiTable(i)||c.isSmartTable(i)||c.isSmartChart(i)){return i;}i=i.getParent&&i.getParent();}return null;}function i1(e){if(c.isSmartTable(e)){e=e.getTable();}if(c.isUiTable(e)){return e.getBindingInfo("rows");}else if(e instanceof R){return e.getBindingInfo("items");}return null;}function j1(e,i,j){var k=i1(e);if(k&&k.binding){if(i){k.binding.refresh(i);}else{k.binding.refresh();}if(!j&&q.getView().getModel("ui").getProperty("/editable")){u.messagesRefresh();}}else if(e&&e.rebindTable){e.rebindTable();}}function k1(e){var i=q.getOwnerComponent();var j=i.getModel();var k,J1;var K1=!r.oApplication.checkEtags();if(K1){J1=i1(e);if(J1){k=J1.path;var L1=e.getEntitySet();var M1=j.getMetaModel();var N1=M1.getODataEntitySet(L1);if(q.getMetadata().getName()==='sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage'&&l1(j,N1)){j.invalidateEntityType(N1.entityType);}else{j.invalidate(m1.bind(null,k));}var O1=i.getId();var P1=Object.create(null);P1[O1]=true;r.oApplication.refreshAllComponents(P1);}}}function l1(e,i){var j=new o.Model(o.Model.ReferenceByModel(e));var k=j.findQueryResultByName(i.name);var J1=k&&k.getParameterization();return!!J1;}function m1(e,k,i){var j=e[0]==="/"?e.substr(1):e;if(k.split("(")[0]===j){return true;}else{return false;}}function n1(e,i){var j;if(u.isDraftEnabled()){j=r.oDraftController.isActiveEntity(e)?1:6;}else{var k=q.getOwnerComponent();j=k.getModel("ui").getProperty("/editable")?6:1;}u.navigateAccordingToContext(e,j,i);}function o1(e){if(e instanceof N){if(e.getErrorCode()==="NavigationHandler.isIntentSupported.notSupported"){M.show(K("ST_NAV_ERROR_NOT_AUTHORIZED_DESC"),{title:K("ST_GENERIC_ERROR_TITLE")});}else{M.show(e.getErrorCode(),{title:K("ST_GENERIC_ERROR_TITLE")});}}}function p1(e,i){A1(function(){v=r.oApplication.getNavigationHandler();var j={semanticObject:e.semanticObject,action:e.action};var k=v.mixAttributesAndSelectionVariant(e.parameters);if(typeof q.adaptNavigationParameterExtension==="function"){q.adaptNavigationParameterExtension(k,j);}v.navigate(e.semanticObject,e.action,k.toJSONString(),null,o1);},Function.prototype,i,"LeavePage");}function q1(e){var J1=[],K1,L1,M1;var N1=q.getOwnerComponent();var O1=N1.getModel().getMetaModel();if(!e){return{};}var P1=N1.getAppComponent().getConfig().pages[0];if(!P1){return{};}var Q1=function(i){M1=O1.getODataEntitySet(i.entitySet).entityType;L1=O1.getODataEntityType(M1);K1={};K1={entitySet:i.entitySet,aKeys:O1.getODataEntityType(M1).key.propertyRef,navigationProperty:i.navigationProperty};for(var j=0,S1=K1.aKeys.length;j<S1;j++){var k=0,T1=L1.property.length;for(k;k<T1;k++){if(K1.aKeys[j].name===L1.property[k].name){K1.aKeys[j].type=L1.property[k].type;break;}}}};var R1=function(e,P1){if(!P1.pages){return J1;}for(var i=0,j=P1.pages.length;i<j;i++){if(!P1.pages[i]){break;}if(e===P1.pages[i].entitySet){Q1(P1.pages[i]);J1.splice(0,0,K1);break;}J1=R1(e,P1.pages[i]);if(J1.length>0){Q1(P1.pages[i]);J1.splice(0,0,K1);}}return J1;};return R1(e,P1);}function r1(k,e){var J1,K1,i,L1;for(i=0,L1=k.length;i<L1;i++){if(k[i].navigationProperty){K1+="/"+k[i].navigationProperty;}else{K1="/"+k[i].entitySet;}for(var j=0,M1=k[i].aKeys.length;j<M1;j++){if(j===0){K1+="(";J1="";}else{J1=",";}switch(k[i].aKeys[j].type){case"Edm.Guid":if(e.DraftAdministrativeData&&e.DraftAdministrativeData.DraftIsCreatedByMe){K1+=J1+k[i].aKeys[j].name+"="+"guid'"+e.DraftAdministrativeData.DraftUUID+"'";}else{K1+=J1+k[i].aKeys[j].name+"="+"guid'"+e[k[i].aKeys[j].name]+"'";}break;case"Edm.Boolean":if(e.DraftAdministrativeData&&e.DraftAdministrativeData.DraftIsCreatedByMe){K1+=J1+k[i].aKeys[j].name+"="+false;}else{K1+=J1+k[i].aKeys[j].name+"="+e[k[i].aKeys[j].name];}break;default:if(typeof e[k[i].aKeys[j].name]==="string"){K1+=J1+k[i].aKeys[j].name+"="+"'"+e[k[i].aKeys[j].name]+"'";}else{K1+=J1+k[i].aKeys[j].name+"="+e[k[i].aKeys[j].name];}break;}if(j===(M1-1)){K1+=")";}}}return K1;}function s1(e,k,q){var J1,K1,L1,M1,N1,O1,P1;var Q1={semanticObject:"",action:""};v=r.oApplication.getNavigationHandler();J1=v.mixAttributesAndSelectionVariant({},k);for(M1 in e.semanticAttributesOfSemanticObjects){for(L1 in e.semanticAttributesOfSemanticObjects[M1]){if(!J1.getSelectOption(L1)){J1.addParameter(L1,"");}}N1=J1.getPropertyNames();Q1.semanticObject=M1;q.adaptNavigationParameterExtension(J1,Q1);O1=J1.getSelectOptionsPropertyNames();P1=J1.getParameterNames();for(var i=0,R1=N1.length;i<R1;i++){if(O1.indexOf(N1[i])<0&&P1.indexOf(N1[i])<0){delete e.semanticAttributesOfSemanticObjects[M1][N1[i]];J1.removeSelectOption(N1[i]);}}if(M1===e.semanticObject){var S1=e.semanticAttributesOfSemanticObjects[""];for(var j=0,R1=P1.length;j<R1;j++){J1.removeParameter(P1[j]);if(!(P1[j]in S1)){var T1=e.semanticAttributesOfSemanticObjects[e.semanticObject][P1[j]];T1=(typeof T1==="undefined"||T1===null)?"":String(T1);J1.addParameter(P1[j],T1);}}J1=v.mixAttributesAndSelectionVariant(e.semanticAttributesOfSemanticObjects[M1],J1.toJSONString());K1=J1.toJSONString();}}delete e.semanticAttributes;v.processBeforeSmartLinkPopoverOpens(e,K1);}function t1(e,j){var k=function(N1){for(var i=0;i<N1.length;i++){j(N1[i].name);}};var J1=q.getView().getModel().getMetaModel();var K1=J1.getODataEntitySet(e,false);var L1=J1.getODataEntityType(K1.entityType,false);k(L1.key.propertyRef);var M1=r.oDraftController.getDraftContext();if(M1.isDraftEnabled(e)){k(M1.getSemanticKey(e));j("IsActiveEntity");j("HasDraftEntity");j("HasActiveEntity");}}function u1(i,j,k,J1){if(J1&&k&&k.getAnalyticBindingPath&&k.getConsiderAnalyticalParameters()){try{var K1=k.getAnalyticBindingPath();var L1=i.getEntitySet();var M1=i.getModel();var N1=M1.getMetaModel();var O1=N1.getODataEntitySet(L1);var P1=q.getOwnerComponent();var Q1=P1.getAppComponent();var R1=m.getParametersByEntitySet(Q1.getModel(),L1);if(j){K1=j(O1,R1);}if(K1){J1(K1);}}catch(e){n.warning("Mandatory parameters have no values");}}}function v1(e,j,k){for(var i=0;i<j.length;i++){var J1=j[i];var K1=J1.lastIndexOf("/");var L1;if(K1<0){if(r.oApplication.getNavigationProperty(e,J1)){L1=J1;}else{continue;}}else{L1=J1.substring(0,K1);}if(k.indexOf(L1)===-1){k.push(L1);}}}function w1(e,i,j){var k=e.getParameter("bindingParams"),J1=e.getSource().getId();k.parameters=k.parameters||{};k.parameters.transitionMessagesOnly=u.getNoStateMessagesForTables();var K1=function(R1,S1,J1){if(i&&i[R1]){var T1=true;var U1=function(){var V1=arguments[0];if(!(V1 instanceof C)){throw new g(s,"Please provide a valid ControllerExtension in order to execute extension "+R1);}if(!T1){throw new g(s,"Extension "+R1+" must be executed synchronously");}var W1=Array.prototype.slice.call(arguments,1);S1.apply(null,W1);};i[R1](U1,J1);T1=false;}};var L1=function(R1){if(!J1||q.byId(J1)===e.getSource()){k.filters.push(R1);}};if(i.addTemplateSpecificFilters){i.addTemplateSpecificFilters(k.filters);}K1("addExtensionFilters",L1,J1);var M1=e.getSource();if(q.getMetadata().getName()!=='sap.suite.ui.generic.template.ObjectPage.view.Details'){u1(M1,i.resolveParamaterizedEntitySet,j,i.setBindingPath);}var N1=M1.getEntitySet();var O1=k.parameters.select&&k.parameters.select.split(",")||[];var P1=k.parameters.expand&&k.parameters.expand.split(",")||[];var Q1=function(R1,J1){if(R1&&(!J1||q.byId(J1)===e.getSource())){var S1=R1.split(',');S1.forEach(function(T1){if(T1&&O1.indexOf(T1)===-1){O1.push(T1);}});}};if(i.isMandatoryFiltersRequired){t1(N1,Q1);}K1("ensureExtensionFields",Q1,J1);(i.addNecessaryFields||Function.prototype)(O1,Q1,N1);v1(N1,O1,P1);if(P1.length>0){k.parameters.expand=P1.join(",");}if(O1.length>0){k.parameters.select=O1.join(",");}}function x1(e,i,j){if(!e){return K("DRAFT_OBJECT");}else if(i){return K(j?"LOCKED_OBJECT":"UNSAVED_CHANGES");}else{return"";}}function y1(){return new Promise(function(e){var i;I("sap.suite.ui.generic.template.fragments.DraftAdminDataPopover",{formatText:function(){var j=Array.prototype.slice.call(arguments,1);var k=arguments[0];if(!k){return"";}if(j.length>0&&(j[0]===null||j[0]===undefined||j[0]==="")){if(j.length>3&&(j[3]===null||j[3]===undefined||j[3]==="")){return(j.length>2&&(j[1]===null||j[1]===undefined||j[1]===""))?"":j[2];}else{return K(k,j[3]);}}else{return K(k,j[0]);}},closeDraftAdminPopover:function(){i.close();},formatDraftLockText:x1},"admin").then(function(j){i=j;e(i);});});}function z1(e,i,j,k){return r.oDataLossHandler.performIfNoDataLoss(e,i,k,true,true);}function A1(e,i,j,k,J1){return r.oDataLossHandler.performIfNoDataLoss(e,i,k,J1,false);}function B1(e,i){i=f({busy:{set:true,check:true},dataloss:{popup:true,navigation:false}},i);var j,k;var J1=new Promise(function(N1,O1){j=N1;k=O1;});var K1=i.busy.set?function(){r.oApplication.getBusyHelper().setBusy(J1,false,{actionLabel:i.sActionLabel});return e();}:e;var L1=i.mConsiderObjectsAsDeleted?function(N1){r.oApplication.prepareDeletion(i.mConsiderObjectsAsDeleted);return K1();}:K1;var M1=function(){var N1=(i.dataloss.popup?A1(L1,k,null,(i.dataloss.navigation?"LeavePage":"Proceed"),true):L1());if(N1 instanceof Promise){N1.then(j,k);}else{j(N1);}};r.oApplication.performAfterSideEffectExecution(M1,i.busy.check&&k);return J1;}function C1(e){var i=e.getId()+"-variant";var j=sap.ui.getCore().byId(i);var k=j.getDefaultVariantKey();return k===j.STANDARDVARIANTKEY?"":k;}function D1(e){var i=e.getId()+"-variant";var j=sap.ui.getCore().byId(i);var k=j.getDefaultVariantKey();return k===j.STANDARDVARIANTKEY?"":k;}function E1(e){var j;var k=u.getTemplatePrivateModel();var J1=q.getOwnerComponent();var K1,L1,M1,N1,O1,P1=[],Q1=[],i,R1,S1,T1,U1,V1,W1;var X1,Y1;K1=J1.getAppComponent();L1=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");M1=k.getProperty("/generic/supportedIntents/");if(c.isSmartChart(e)){j=e.getToolbar();}else if(c.isSmartTable(e)){j=e.getCustomToolbar();}N1=j.getContent();O1=N1.length;for(i=0;i<O1;i++){R1=V(N1[i]);if(R1.hasOwnProperty("SemanticObject")&&R1.hasOwnProperty("Action")){S1=R1.SemanticObject;T1=R1.Action;U1={semanticObject:S1,action:T1,ui5Component:K1};P1.push([U1]);V1=d({},U1);V1.bLinkIsSupported=false;Q1.push(V1);}}if(P1.length>0&&L1){W1=L1.getLinks(P1);W1.done(function(Z1){M1=k.getProperty("/generic/supportedIntents/");X1=Z1.length;for(i=0;i<X1;i++){if(Z1[i][0].length>0){Q1[i].bLinkIsSupported=true;}S1=Q1[i].semanticObject;T1=Q1[i].action;Y1=k.getProperty("/generic/supportedIntents/"+S1);if(!Y1){M1[S1]={};M1[S1][T1]={"visible":Q1[i].bLinkIsSupported};}else if(!Y1[T1]){Y1[T1]={"visible":Q1[i].bLinkIsSupported};}else{Y1[T1]["visible"]=Q1[i].bLinkIsSupported;}}k.updateBindings();});}}function F1(e,i){var j=i&&q.byId(i);var k=(i&&!j)?Promise.reject():new Promise(function(J1,K1){r.oApplication.performAfterSideEffectExecution(function(){var L1=r.oApplication.getBusyHelper();if(L1.isBusy()){K1();return;}if(j&&(!j.getVisible()||(j.getEnabled&&!j.getEnabled()))){K1();return;}var k=j?e(j):e();if(k instanceof Promise){k.then(J1,K1);L1.setBusy(k);}else{J1(k);}});});k.catch(Function.prototype);return k;}function G1(e,i){var j=typeof i==="string"?JSON.parse(i):i;var k=j&&j.SortOrder;if(e.oSmartTable){H1(e.oSmartTable,k);}if(e.oSmartChart){H1(e.oSmartChart,k);}}function H1(e,i){var j=e.getUiState();var k=j.getPresentationVariant();if(!k.SortOrder&&e.isA("sap.ui.comp.smarttable.SmartTable")){var J1=e.getCustomData().find(function(P1){return P1.getKey()==="TemplateSortOrder";});var K1=J1&&J1&&J1.getValue();if(K1){k.SortOrder=[];var L1=K1.split(", ");L1.forEach(function(P1){var Q1=P1.split(" ");if(Q1.length>1){k.SortOrder.push({Property:Q1[0],Descending:Q1[1]==="true"});}});}}var M1=function(P1){var Q1=e.getModel().getMetaModel();var R1=Q1.getODataEntitySet(e&&e.getEntitySet());var S1=Q1.getODataEntityType(R1.entityType);var T1=S1.property;return T1.some(function(U1){return U1.name===P1.Property;});};var N1=i.filter(function(P1){return M1(P1);});var O1=N1.concat(k.SortOrder);O1=O1.filter(function(P1){return P1!==undefined;});k.SortOrder=O1;j.setPresentationVariant(k);e.setUiState(j);}function I1(e,i,j,k,J1){var K1,L1={};if(!i){K1=[];}else if(Array.isArray(i)){K1=i;}else{K1=[i];}if(j){L1.urlParameters=j;}if(k&&k.bInvocationGroupingChangeSet){L1.operationGrouping="com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet";}L1.triggerChanges=u.isDraftEnabled();u.executeBeforeInvokeActionFromExtensionAPI(J1);var M1=r.oApplicationController.invokeActions(e,K1,L1);if(k&&k.bSetBusy){u.getBusyHelper().setBusy(M1);}M1.then(u.executeAfterInvokeActionFromExtensionAPI.bind(null,J1));return M1;}var c1=t.testable(c1,"fillEnabledMapForBreakoutActions");var e1=t.testable(e1,"getBreakoutActionIds");var h1=t.testable(h1,"getOwnerControl");var U=t.testable(U,"getSelectedContexts");var G=t.testable(G,"fnGetToolbarCutomData");return{getPositionableControlId:D,getMetaModelEntityType:x,getText:K,getContextText:Q,getNavigationKeyProperties:q1,mergeNavigationKeyPropertiesWithValues:r1,executeGlobalSideEffect:function(){if(u.isDraftEnabled()){var e=q.getView();var i=q.getOwnerComponent();var j=i.getAppComponent();var k=j.getForceGlobalRefresh();var J1=i.getModel("ui");e.attachBrowserEvent("keydown",function(K1){var L1=K1.target.type==="search";var M1=K1.target.type==="textarea";var N1=K1.target.id.indexOf("rowAction")>-1;var O1=K1.target.id.indexOf("ColumnListItem")>-1;if(K1.keyCode===13&&K1.ctrlKey!==true&&J1.getProperty("/editable")&&!L1&&!M1&&!N1&&!O1){r.oApplication.addSideEffectPromise(new Promise(function(P1,Q1){setTimeout(function(){var R1=r.oApplicationController.executeSideEffects(e.getBindingContext(),null,null,k);R1.then(function(){P1();setTimeout(function(){var S1=document.getElementById(K1.target.id);if(S1){S1.focus();}});},Q1);});}));}});}},setEnabledToolbarButtons:W,setEnabledFooterButtons:Y,fillEnabledMapForBreakoutActions:c1,getBreakoutActions:g1,getSelectedContexts:U,getSelectionPoints:T,getDeleteRestrictions:a1,getSmartTableDefaultVariant:C1,getSmartChartDefaultVariant:D1,setPrivateModelControlProperty:Z,navigateFromListItem:n1,navigateExternal:p1,semanticObjectLinkNavigation:s1,getCustomData:function(e){var j=e.getSource().getCustomData();var k={};for(var i=0;i<j.length;i++){k[j[i].getKey()]=j[i].getValue();}return k;},getCustomDataText:function(e){return new Promise(function(j,k){e.getCustomData().forEach(function(J1){var K1=J1.getKey();if(K1==="text"){var L1=J1.getBinding("value");var M1=!L1&&J1.getBindingInfo("value");if(!L1&&!M1){j(J1.getValue());return;}var N1=function(O1){j(O1.getSource().getExternalValue());return;};if(L1){L1.attachChangeOnce(N1);}else{M1.events={change:N1};for(var i=0;i<M1.parts.length;i++){M1.parts[i].targetType="string";}}}});});},onBeforeRebindTableOrChart:w1,formatDraftLockText:x1,showDraftPopover:function(e,i){y1().then(function(j){var k=j.getModel("admin");k.setProperty("/IsActiveEntity",e.getProperty("IsActiveEntity"));k.setProperty("/HasDraftEntity",e.getProperty("HasDraftEntity"));j.bindElement({path:e.getPath()+"/DraftAdministrativeData"});if(j.getBindingContext()){j.openBy(i);}else{j.getObjectBinding().attachDataReceived(function(){j.openBy(i);});}});},getContentDensityClass:function(){return r.oApplication.getContentDensityClass();},attachControlToView:A,getDialogFragment:H,getDialogFragmentAsync:I,processDataLossConfirmationIfNonDraft:A1,processDataLossTechnicalErrorConfirmation:z1,securedExecution:B1,getOwnerControl:h1,getTableBindingInfo:i1,refreshSmartTable:j1,refreshModel:k1,getElementCustomData:V,triggerAction:function(e,i,j,k,J1){A1(function(){r.oCRUDManager.callAction({functionImportPath:j.Action,contexts:e,sourceControl:k,label:j.Label,operationGrouping:""}).then(function(K1){if(K1&&K1.length>0){var L1=K1[0];if(L1.response&&L1.response.context&&(!L1.actionContext||L1.actionContext&&L1.response.context.getPath()!==L1.actionContext.getPath())){r.oApplication.getBusyHelper().getUnbusy().then(r.oViewDependencyHelper.setMeToDirty.bind(null,q.getOwnerComponent(),i));}}});},Function.prototype,J1,"Proceed");},checkToolbarIntentsSupported:E1,executeIfControlReady:F1,getControlInformation:y,executeForAllInformationObjects:z,setControlSortOrder:G1,invokeActionsForExtensionAPI:I1,filterUpdatableContexts:b1};}return B.extend("sap.suite.ui.generic.template.lib.CommonUtils",{constructor:function(e,i,j){d(this,p(e,i,j));}});});
