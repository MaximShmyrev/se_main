sap.ui.define(["sap/ui/base/Object","sap/ui/model/base/ManagedObjectModel","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/js/AnnotationHelper","sap/suite/ui/generic/template/lib/CRUDActionHandler","sap/base/util/extend","sap/base/util/isEmptyObject","sap/suite/ui/generic/template/genericUtilities/FeError"],function(B,M,c,F,A,C,e,a,b){"use strict";var s="lib.ComponentUtils";var l=new F(s).getLogger();var d={isPreliminary:function(){return false;}};function g(o,f){var t=f.oTemplateContract.mRoutingTree[f.route];var h;var H;var j;var k;var m;var I=false;var L;var n=[];var N=false;var E=[];function p(){return o.getModel("_templPriv");}function q(i){f.oTemplateContract.oNavigationControllerProxy.preloadComponent(i);}function r(){var i=o.getAppComponent();return i.getModel("_templPrivGlobal");}function u(){return t.level;}function v(){var i=f.oTemplateContract.oApplicationProxy.getAncestralNode(t,1);if(i){var P1={};var Q1=i.getPath(2,r1());P1.bindingContext=o.getModel().createBindingContext(Q1)||o.getModel().getContext(Q1);P1.entitySet=i.entitySet;P1.view=i.componentId&&f.oTemplateContract.componentRegistry[i.componentId].oController.getView();return P1;}return null;}function w(){return f.preprocessorsData;}function x(){var i=w();if(i&&i.rootContextExpand){return i.rootContextExpand.join(',');}}function y(){return f.oParameterModel;}function z(i,P1,Q1){if(typeof Q1!=="function"){throw new b(s,"Event handler must be a function");}E.push({template:i,event:P1,handler:Q1});}function D(P1,Q1,R1){for(var i=E.length;i--;){if(E[i].handler===R1&&E[i].event===Q1&&E[i].template===P1){E.splice(i,1);}}}function G(P1,Q1,R1){for(var i=0;i<E.length;i++){if(E[i].event===Q1&&E[i].template===P1){E[i].handler(R1);}}}function J(i){return i.getMetadata().getName();}function K(){return f.oApplication.isComponentActive(o);}function O(){return f.oNavigationObserver.getProcessFinished(true);}function P(i,P1){var Q1=O();Q1.then(function(){if(K()){if(P1){b1(true);}G(J(f.oController),"PageDataLoaded",{context:i});if(i&&x1()){var R1=i.getObject();if(!R1.IsActiveEntity){f.oApplication.getDraftSiblingPromise(i);}}}});}function Q(){h.then(function(i){if(i){P(i);}});}function S(){f.oHeaderLoadingObserver.startProcess();if(!m){var i=new Promise(function(P1){m=P1;});f.oApplication.getBusyHelper().setBusy(i);}}function R(){if(!H){h=new Promise(function(i){H=i;});}}if(t.getPath(3)){R();}else{h=Promise.resolve();}function T(i){l.info("Request header data",i.getSource().getPath(),"Class sap.suite.ui.generic.template.lib.ComponentUtils");I=true;R();if(!o.getComponentContainer().getElementBinding().isSuspended()){S();}}function U(){if(m){m();m=null;}f.oHeaderLoadingObserver.stopProcess();}function V(i){var P1=i.getSource().getBoundContext();if(P1){return P1;}if(o.getComponentContainer().getElementBinding().isSuspended()){P1=null;}else{P1=d;}_();return P1;}function W(){f.oTemplateContract.oNavigationControllerProxy.navigationContextNotFound();}function X(){I=false;if(!k){return;}if(k===d){W();_();}else if(!o.getComponentContainer().getElementBinding().isSuspended()){var i=o.getBindingContext();var P1=n1(i);var Q1=P1.bIsDraft||N;var R1;if(Q1){N=false;R1=P1.bIsCreate?4:2;}else{R1=1;}var S1=p();S1.setProperty("/objectPage/displayMode",R1);var T1=o.getModel("ui");T1.setProperty("/enabled",true);T1.setProperty("/createMode",P1.bIsCreate);T1.setProperty("/editable",Q1);(f.methods.updateBindingContext||Function.prototype)(i);if(H){H(k);}}else{return;}H=null;k=null;}function Y(i){l.info("Received header data",i.getSource().getPath(),"Class sap.suite.ui.generic.template.lib.ComponentUtils");j();U();if(I){k=V(i);}X();}function Z(i){j();var P1=V(i);if(P1&&P1.isPreliminary()){return;}k=P1;X();f.oHeaderLoadingObserver.stopProcess();}function $(i){f.oHeaderLoadingObserver.startProcess();var P1=new Promise(function(Q1){j=Q1;});R();if(f.methods.beforeRebind){f.methods.beforeRebind(P1);}k=null;t.bindElement(o.getComponentContainer(),i,false,{dataRequested:T,dataReceived:Y,change:Z});L=i;if(f.methods.afterRebind){f.methods.afterRebind();}}function _(){R();var i=o.getComponentContainer();i.unbindElement();i.setBindingContext();L=null;k=null;I=false;U();}function a1(){var P1=r1();var Q1=(P1.length===n.length);for(var i=0;i<P1.length&&Q1;i++){Q1=P1[i]===n[i];}n=P1;return!Q1;}function b1(i){f.reuseComponentsReady.then(function(P1){for(var Q1 in P1){P1[Q1].pathUnchangedCallBack(i);}});}function c1(i,P1){var Q1=Object.create(null);for(var R1 in i){var S1=i[R1];Q1[R1]=P1(S1,R1);}return Q1;}function d1(){var i=p();for(var P1 in t.embeddedComponents){var Q1=!!t.embeddedComponents[P1].definition.hiddenByDefault;i.setProperty("/generic/embeddedComponents/"+P1+"/hidden",Q1);}}function e1(i,P1){var Q1=a1();if(Q1&&!P1){d1();}if(!i){if(f.routingSpec&&f.routingSpec.noOData){P(null,Q1);}return;}var R1=o.getComponentContainer();if(!R1){return;}var S1=o.getModel("ui");var T1=!!f.nonDraftCreateContext;if(T1){var U1=R1.getBindingContext();if(U1===f.nonDraftCreateContext){return;}S1.setProperty("/enabled",true);S1.setProperty("/editable",true);S1.setProperty("/createMode",true);_();if(H){H(f.nonDraftCreateContext);H=null;}else{h=Promise.resolve(f.nonDraftCreateContext);}Q();if(f.methods.beforeRebind){f.methods.beforeRebind(h);}R1.setBindingContext(f.nonDraftCreateContext);Promise.all([f.oViewRenderedPromise,f.viewRegistered]).then(b1.bind(null,true));if(f.methods.afterRebind){f.methods.afterRebind();}}else{var V1=R1.getElementBinding();if(V1){if(L===i){if(V1.isSuspended()){V1.resume();X();}if(I){S();}f.oApplication.getBusyHelper().getUnbusy().then(b1.bind(null,Q1&&f.routingSpec.noOData));if(!P1){Q();}if(!P1&&!x1()){S1.setProperty("/editable",false);}S1.setProperty("/enabled",true);return;}else if(!P1){_();}}S1.setProperty("/enabled",false);S1.setProperty("/editable",false);S1.setProperty("/createMode",false);$(i);Q();}}function f1(i,P1){var Q1={};if(i){Q1.discardPromise=i;}var R1=o.getModel();if(R1.hasPendingChanges()){var S1=f.oController.getView();S1.setBindingContext(null);R1.resetChanges();S1.setBindingContext();}var T1=o.getModel("ui");if(P1||T1.getProperty("/editable")){delete f.nonDraftCreateContext;T1.setProperty("/editable",false);if(i){i.catch(function(){T1.setProperty("/editable",true);});}else{var U1=p();U1.setProperty("/objectPage/displayMode",1);}G(J(f.oController),"AfterCancel",Q1);}}function g1(i,P1){return x1()?null:f.oTemplateContract.oNavigationControllerProxy.navigateForNonDraftCreate(i,P1);}function h1(i,P1){N=P1;f.oTemplateContract.oNavigationControllerProxy.adaptUrlAfterNonDraftCreateSaved(i);}function i1(){var i=o.getComponentContainer().getElementBinding();if(i){o.getModel().invalidateEntry(i.getBoundContext());if(i.isSuspended()){_();}else{i.refresh(true);}}}function j1(i){i=i||o.getIsRefreshRequired();if(i||!a(f.mRefreshInfos)){(f.methods.refreshBinding||Function.prototype)(i,f.mRefreshInfos);o.setIsRefreshRequired(false);f.mRefreshInfos=Object.create(null);}b1(i);}function k1(){var i=o.getModel();var P1={canonicalRequest:!f.oTemplateContract.bCreateRequestsCanonical,batchGroupId:"facets",updateAggregatedMessages:true};i.read(L,P1);}function l1(i){if(x1()){var P1=o.getComponentContainer();var Q1=P1.getElementBinding();if(Q1&&!Q1.isSuspended()){Q1.suspend();i.catch(function(){Q1.resume();});}}}function m1(){var i=o.getComponentContainer();if(f.nonDraftCreateContext){i.setBindingContext();delete f.nonDraftCreateContext;return;}var P1=i.getElementBinding();if(P1&&!P1.isSuspended()){if(f.oTemplateContract.oValidationMessageBinding.getLength()){_();}else{P1.suspend();}U();}}function n1(i){var P1=u();return f.oApplication.registerContext(i,P1,o.getEntitySet(),r1());}function o1(i){if(i.level<2){return[i.entitySet];}var P1=f.oTemplateContract.mRoutingTree[i.parentRoute];var Q1=o1(P1);if(i!==t){Q1.push(i.navigationProperty?Q1[P1.level-1]+"/"+i.navigationProperty:i.entitySet);}return Q1;}function p1(){return t.level<2?[]:o1(t);}function q1(i,P1,Q1){var R1;for(R1=t;R1.level>Q1;){R1=f.oTemplateContract.mRoutingTree[R1.parentRoute];}var S1=new M(i);S1.bindProperty("/"+P1).attachChange(function(T1){var U1=T1.getSource().getValue();f.oTemplateContract.oNavigationControllerProxy.setTextForTreeNode(R1,U1);});R1.contextTargets=R1.contextTargets||[];R1.contextTargets.push(i);}function r1(){return f.oApplication.getCurrentKeys(u());}function s1(i){return f.oApplication.getCommunicationObject(o,i);}function t1(i,P1,Q1,R1){f.oTemplateContract.oNavigationControllerProxy.navigateToChild(t,i,Q1,P1,R1);}function u1(i,P1,Q1){f.oTemplateContract.oNavigationControllerProxy.navigateFromNodeAccordingToContext(t,i,P1,Q1);}function v1(){return t.headerTitle;}function w1(i){f.oTemplateContract.oNavigationControllerProxy.setTextForTreeNode(t,i);}function x1(){return t.isDraft;}function y1(){return!(f.routingSpec&&f.routingSpec.noOData);}function z1(){return!f.oTemplateContract.bCreateRequestsCanonical;}function A1(){return h;}function B1(){return f.oTemplateContract.oPaginatorInfo[u()-1];}function C1(i,P1){var Q1=u();if(!P1){Q1--;}f.oTemplateContract.oPaginatorInfo[Q1]=i;}function D1(i,P1){f.reuseComponentsReady.then(function(Q1){var R1=P1.getComponentInstance();for(var S1 in Q1){if(R1===Q1[S1].component){var T1=p();T1.setProperty("/generic/embeddedComponents/"+S1+"/isInVisibleArea",i);return;}}});}function E1(){f.oStatePreserverPromise.then(function(i){i.stateChanged();});}f.oStatePreserverPromise=f.reuseComponentsReady.then(function(i){var P1=f.methods.getStatePreserverSettings&&f.methods.getStatePreserverSettings();if(!P1){return{getUrlParameterInfo:function(){return Promise.resolve({});},applyAppState:Function.prototype,stateChanged:Function.prototype};}var Q1="sap-iapp-state"+(t.level===0?"":"-"+t.entitySet);var R1=e({appStateName:encodeURI(Q1),getCurrentState:function(){var T1=f.methods.getCurrentState?f.methods.getCurrentState():Object.create(null);var U1=function(V1,W1){if(V1.component.stGetCurrentState){var X1=V1.component.stGetCurrentState();for(var Y1 in X1){T1["$embeddedComponent$"+W1.length+"$"+W1+"$"+Y1]=X1[Y1];}}};c1(i,U1);return T1;},applyState:function(T1,U1){var V1=Object.create(null);var W1=Object.create(null);for(var X1 in T1){if(X1.indexOf("$embeddedComponent$")===0){var Y1=X1.substring(19);var Z1=Y1.indexOf("$");var $1=Number(Y1.substring(0,Z1));var _1=Y1.substring(Z1+1,Z1+$1+1);var a2=W1[_1];if(!a2){a2=Object.create(null);W1[_1]=a2;}var b2=Y1.substring(Z1+$1+2);a2[b2]=T1[X1];}else{V1[X1]=T1[X1];}}(f.methods.applyState||Function.prototype)(V1,U1);var c2=function(d2,e2){if(d2.component.stApplyState){d2.component.stApplyState(W1[e2]||Object.create(null),U1);}};Promise.all([f.oViewRenderedPromise,h]).then(c1.bind(null,i,c2));},oComponent:o},P1);var S1=f.oApplication.getStatePreserver(R1);f.oApplication.registerStateChanger(S1.getAsStateChanger());return S1;});f.oTemplateContract.oStatePreserversAvailablePromise=Promise.all([f.oTemplateContract.oStatePreserversAvailablePromise,f.oStatePreserverPromise]);function F1(){var i=f.oTemplateContract.oFlexibleColumnLayoutHandler;return i?i.getFclProxy(t):{handleDataReceived:t.level?null:Function.prototype,isListAndFirstEntryLoadedOnStartup:t.level?null:Function.prototype,isNextObjectLoadedAfterDelete:Function.prototype};}function G1(){return t.page.component.settings||{};}function H1(){var i=o.getAppComponent().getManifestEntry("sap.ui5");var P1=i.extends&&i.extends.extensions&&i.extends.extensions["sap.ui.controllerExtensions"];P1=P1&&P1[o.getTemplateName()];P1=P1&&P1["sap.ui.generic.app"];return P1&&P1[o.getEntitySet()];}function I1(){var i=o.getAppComponent().getManifestEntry("sap.ui5");var P1=i.extends&&i.extends.extensions&&i.extends.extensions["sap.ui.viewExtensions"];return P1&&P1[o.getTemplateName()];}function J1(i){f.aUnsavedDataCheckFunctions=f.aUnsavedDataCheckFunctions||[];f.aUnsavedDataCheckFunctions.push(i);}function K1(P1,Q1){if(f.methods.getTableForChildContext){var R1=p();var S1=R1.getProperty("/generic/currentActiveChildContext");var T1=S1&&f.methods.getTableForChildContext(S1);if(T1){var U1=T1.getTable();if(c.isMTable(U1)){var V1=U1.getItems();for(var i=0;i<V1.length;i++){var W1=V1[i];if(W1.getBindingContextPath()===S1){U1.scrollToIndex(i);break;}}}}}}var L1;function M1(){L1=L1||new C(f.oTemplateContract,f.oController,f.oControllerUtils.oCommonUtils);return L1;}function N1(i){if(f.methods.executeAfterInvokeActionFromExtensionAPI){f.methods.executeAfterInvokeActionFromExtensionAPI(i,f.oControllerUtils.oCommonUtils);}}function O1(i){if(f.methods.executeBeforeInvokeActionFromExtensionAPI){f.methods.executeBeforeInvokeActionFromExtensionAPI(i,f.oControllerUtils.oCommonUtils);}}return{getBusyHelper:function(){return f.oApplication.getBusyHelper();},attach:function(i,P1,Q1){z(J(i),P1,Q1);},detach:function(i,P1,Q1){D(J(i),P1,Q1);},fire:function(i,P1,Q1){G(J(i),P1,Q1);},isListReportTemplate:function(){return A.isListReportTemplate(f.routeConfig);},getPreprocessorsData:w,getRootExpand:x,getParameterModelForTemplating:y,bindComponent:e1,cancelEdit:f1,getNonDraftCreatePromise:g1,adaptUrlAfterNonDraftCreateSaved:h1,refreshBinding:j1,refreshBindingUnconditional:i1,suspendBinding:m1,messagesRefresh:k1,getTemplatePrivateModel:p,getTemplatePrivateGlobalModel:r,registerContext:n1,getViewLevel:u,getRootAncestorDetails:v,getBreadCrumbInfo:p1,registerAncestorTitleUpdater:q1,getCurrentKeys:r1,getCommunicationObject:s1,navigateRoute:t1,navigateAccordingToContext:u1,getTitle:v1,setText:w1,onBeforeDraftTransfer:l1,isDraftEnabled:x1,isODataBased:y1,getNoStateMessagesForTables:z1,isComponentActive:K,navigateToDataLoadedFailedPage:W,getHeaderDataAvailablePromise:A1,getPaginatorInfo:B1,setPaginatorInfo:C1,onVisibilityChangeOfReuseComponent:D1,getNavigationFinishedPromise:O,stateChanged:E1,unbind:_,getFclProxy:F1,getSettings:G1,getControllerExtensions:H1,getViewExtensions:I1,registerUnsavedDataCheckFunction:J1,layoutChanged:K1,getCRUDActionHandler:M1,executeAfterInvokeActionFromExtensionAPI:N1,executeBeforeInvokeActionFromExtensionAPI:O1,preloadComponent:q};}return B.extend("sap.suite.ui.generic.template.lib.ComponentUtils",{constructor:function(o,f){e(this,g(o,f));}});});
