sap.ui.define(["sap/base/util/extend","sap/base/util/deepExtend","sap/ui/model/odata/AnnotationHelper","sap/suite/ui/generic/template/js/StableIdHelper","sap/suite/ui/generic/template/js/staticChecksHelper","sap/suite/ui/generic/template/js/preparationHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger"],function(e,d,A,S,s,p,F){"use strict";var l=new F("ObjectPage.Component").getLogger();function g(c,m,o,D,L){function G(i,y){var R=e({},y);switch(i){case"com.sap.vocabularies.UI.v1.ReferenceFacet":if(!R["com.sap.vocabularies.UI.v1.PartOfPreview"]||R["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool!=="false"){R["com.sap.vocabularies.UI.v1.PartOfPreview"]={Bool:"true"};}break;default:break;}return R;}function f(R){if(!R.getObject().Target){return undefined;}var i=A.resolvePath(m.getContext(R.sPath+"/Target"));return i&&m.getContext(i).getObject();}function E(i){i.subSections=i.subSections||[];if(i.subSections.find(function(y){return i.additionalData.facetId===y.additionalData.facetId;})){return;}var y=e({},i);delete y.subSections;y.blocks=[];i.subSections.push(y);}var M=0;function a(P,H,y,z){var R=[];var B=["sections","subSections","blocks"];y=y||0;var C=m.getObject(P);if(!Array.isArray(C)){return[];}C.forEach(function(J,i){var K={additionalData:{facetId:S.getStableId({type:"ObjectPage",subType:"Facet",sRecordType:J.RecordType,bIsHeaderFacet:H,sAnnotationPath:J.Target&&J.Target.AnnotationPath,sAnnotationId:J.ID&&J.ID.String})},annotations:{Facet:{annotation:d({},J)}},metaModelPath:P+"/"+i};K.facetIdAsObject={id:K.additionalData.facetId};K.fallbackIdByEnumerationForRuntime=K.additionalData.facetId||"missingStableId#"+M++;if(J.RecordType==="com.sap.vocabularies.UI.v1.CollectionFacet"){var O=a(P+"/"+i+"/Facets",H,y+1,K);if(y===0&&!K.subSections&&O.length===0){E(K);}else{var Q=B[y+1]||"unsupportedNestingLevel";K[Q]=K[Q]||[];K[Q]=K[Q].concat(O);}}else if(J.RecordType==="com.sap.vocabularies.UI.v1.ReferenceFacet"){K.fallbackIdByAnnotationPathForManifest=S.getStableId({type:"ObjectPage",subType:"Facet",sRecordType:J.RecordType,bIsHeaderFacet:H,sAnnotationPath:J.Target&&J.Target.AnnotationPath});K.annotations.Facet.annotation=G("com.sap.vocabularies.UI.v1.ReferenceFacet",J);var T=e({},K);T.targetAnnotation=f(m.getContext(P+"/"+i));var U;switch(y){case 0:if(J.Target&&!J.Target.AnnotationPath){return;}U=e({},K);U.blocks=[T];K.subSections=[U];break;case 1:E(z);U=z.subSections.find(function(U){return U.additionalData.facetId===z.additionalData.facetId;});U.blocks.push(T);U.dummyFormId=S.getStableId({type:'ObjectPageSection',subType:'SmartForm',sFacet:z.additionalData.facetId,sIsPartOfPreview:'true'});return;case 2:K.targetAnnotation=T.targetAnnotation;z.dummyFormId=S.getStableId({type:'ObjectPageSection',subType:'SmartForm',sFacet:z.additionalData.facetId,sIsPartOfPreview:'true'});break;default:l.warning("UnSupported Nesting of Collectionfacets");break;}}R.push(K);});return R;}function b(i){i.multiSelect=i.multiSelect||i.allTableMultiSelect;var T=A.gotoEntitySet(m.getContext(i.metaModelPath+"/Target"));var y=T&&m.getObject(T).name||L;var z=c.getControllerExtensions();var B=z&&z.Sections&&z.Sections[i.additionalData.facetId]&&z.Sections[i.additionalData.facetId].Actions;var R=p.getNormalizedTableSettings(m,i,D,y,B,i.targetAnnotation);R.variantManagement=!!(i.tableSettings&&i.tableSettings.variantManagement);if(R.onlyForDelete){R.mode=c.isDraftEnabled()?"{= ${ui>/editable} ? '"+R.mode+"' : 'None'}":"{= ${ui>/editable} ? 'None' : '"+R.mode+"'}";}var C=m.getODataEntitySet(y);if(R&&R.createWithParameterDialog&&R.createWithParameterDialog.fields){s.checkErrorforCreateWithDialog(m.getODataEntityType(C.entityType),R);R.createWithParameterDialog.id=S.getStableId({type:'ObjectPageAction',subType:'CreateWithDialog',sFacet:i.additionalData.facetId});}return R;}function h(i){return{variantManagement:!!(i.chartSettings&&i.chartSettings.variantManagement),chartTitle:i.targetAnnotation&&i.targetAnnotation.Title};}function n(i){var y=o.sections&&e({},o.sections[i.additionalData.facetId],o.sections[i.fallbackIdByAnnotationPathForManifest]);e(i,y,i);if(i.targetAnnotation){var z=d({},o,i);var B=i.annotations.Facet.annotation.Target.AnnotationPath.split("@").pop().split("#")[0];switch(B){case"com.sap.vocabularies.UI.v1.LineItem":i.tableSettings=b(z);break;case"com.sap.vocabularies.UI.v1.Chart":i.chartSettings=h(z);break;default:break;}}}function j(i){i.bShowTitle=true;var y=new RegExp("'",'g');var z=new RegExp('"','g');if(i.blocks.length===1){var B=i.blocks[0];if(B.targetAnnotation){var C=i.annotations.Facet.annotation.Label&&i.annotations.Facet.annotation.Label.String;var H=C&&C.replace(y,"\\'").replace(z,'\\"');var J=B.annotations.Facet.annotation.Target.AnnotationPath.split("@").pop().split("#")[0];if((J==="com.sap.vocabularies.UI.v1.LineItem")&&B.tableSettings&&B.tableSettings.headerInfo){var T=B.tableSettings.headerInfo.TypeNamePlural&&B.tableSettings.headerInfo.TypeNamePlural.String&&B.tableSettings.headerInfo.TypeNamePlural.String.replace(y,"\\'");T=T&&T.replace(z,'\\"');if(T&&T.indexOf(">")>-1){T="@i18n>"+T.split(">")[1].split("}")[0];}else{T="@i18n>"+T;}if(H&&H.indexOf(">")>-1){H="@i18n>"+H.split(">")[1].split("}")[0];}else{H="@i18n>"+H;}i.bShowTitle="{parts: [{path: '"+H+"'}, {path: '"+T+"'}], formatter: 'sap.suite.ui.generic.template.js.AnnotationHelper.formatSubSectionHeader'}";}else if((J==="com.sap.vocabularies.UI.v1.Chart")&&B.chartSettings&&B.chartSettings.chartTitle){var K=B.chartSettings.chartTitle.String&&B.chartSettings.chartTitle.String.replace(y,"\\'");K=K&&K.replace(z,'\\"');if(K&&K.indexOf(">")>-1){K="@i18n>"+K.split(">")[1].split("}")[0];}else{K="@i18n>"+K;}if(H&&H.indexOf(">")>-1){H="@i18n>"+H.split(">")[1].split("}")[0];}else{H="@i18n>"+H;}i.bShowTitle="{parts: [{path: '"+H+"'}, {path: '"+K+"'}], formatter: 'sap.suite.ui.generic.template.js.AnnotationHelper.formatSubSectionHeader'}";}}}}function k(i,y){var z={BeforeFacet:{withKey:{section:{type:"ObjectPageSection",subType:"BeforeFacetExtensionSectionWithKey"},subSection:{type:"ObjectPageSection",subType:"BeforeFacetExtensionSubSectionWithKey"}},withoutKey:{section:{type:"ObjectPageSection",subType:"BeforeFacetExtensionSection"},subSection:{type:"ObjectPageSection",subType:"BeforeFacetExtensionSubSection"}}},AfterFacet:{withKey:{section:{type:"ObjectPageSection",subType:"AfterFacetExtensionSectionWithKey"},subSection:{type:"ObjectPageSection",subType:"AfterFacetExtensionSubSectionWithKey"}},withoutKey:{section:{type:"ObjectPageSection",subType:"AfterFacetExtensionSection"},subSection:{type:"ObjectPageSection",subType:"AfterFacetExtensionSubSection"}}}};var B=z[i][y.sKey?"withKey":"withoutKey"];var C=e({},B.section);C.sEntitySet=y.sEntitySet;C.sFacet=y.sFacetId;C.sFacetExtensionKey=y.oExtensionDefinition.key||y.sKey;var H=S.getStableId(C);C.type=B.subSection.type;C.subType=B.subSection.subType;var J=S.getStableId(C);return{id:H,additionalData:{facetId:y.sFacetId},extensionPointName:y.sExtensionPointName,extensionPointNamePrefix:y.sExtensionPointNamePrefix,subSections:[{id:J,additionalData:{facetId:y.sFacetId},extensionPointName:y.sExtensionPointName,extensionPointNamePrefix:y.sExtensionPointNamePrefix,blocks:[]}]};}function q(){var V=c.getViewExtensions()||{};return Object.keys(V).map(function(i){var K=i.split("|");return{sExtensionPointNamePrefix:K[0],sEntitySet:K[1],sFacetId:K[2],sKey:K[3],oExtensionDefinition:V[i],sExtensionPointName:i};}).filter(function(i){return i.sEntitySet===L;});}function r(i){var V=q();var R=[];i.forEach(function(y){var B=V.filter(function(C){return C.sFacetId===y.additionalData.facetId&&C.sExtensionPointNamePrefix==="BeforeFacet";});var z=V.filter(function(C){return C.sFacetId===y.additionalData.facetId&&C.sExtensionPointNamePrefix==="AfterFacet";});R=R.concat(B.map(k.bind(null,"BeforeFacet")));R.push(y);R=R.concat(z.map(k.bind(null,"AfterFacet")));});return R;}function N(B){n(B);}function I(B){return B.annotations.Facet.annotation.RecordType==="com.sap.vocabularies.UI.v1.ReferenceFacet";}function t(i){n(i);i.blocks.forEach(N);i.blocks=i.blocks.filter(I);j(i);i.moreBlocks=i.blocks.filter(function(B){return B.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="false";});if(i.moreBlocks.length>0){i.dummyFormIdMoreBlocks=S.getStableId({type:'ObjectPageSection',subType:'SmartForm',sFacet:i.additionalData.facetId,sIsPartOfPreview:'false'});}i.blocks=i.blocks.filter(function(B){return B.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="true";});}function u(){return true;}function v(i){n(i);i.subSections.forEach(t);i.subSections=i.subSections.filter(u);}function w(){return true;}function x(){var i=m.getMetaContext("/"+L).getPath();var y=a(i+"/com.sap.vocabularies.UI.v1.Facets",false);var z=r(y);z.forEach(v);return z.filter(w);}return{sections:x(),breadCrumb:c.getBreadCrumbInfo(),isSelflinkRequired:true,isIndicatorRequired:true,isSemanticallyConnected:false};}return{getTemplateSpecificParameters:g};});
