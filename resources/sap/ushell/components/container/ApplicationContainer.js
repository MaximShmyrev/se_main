// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/Device","sap/ushell/utils","sap/ushell/ApplicationType","sap/m/MessagePopover","sap/ui/core/Component","sap/ui/core/ComponentContainer","sap/ui/core/Control","sap/ui/thirdparty/URI","sap/ushell/EventHub","sap/ui/core/Icon","sap/ushell/System","sap/ushell/User","sap/m/Text","sap/base/util/UriParameters","sap/base/util/deepEqual","sap/base/util/uid","sap/base/security/encodeXML","sap/ushell/utils/testableHelper","sap/ushell/Config","sap/ushell/resources","sap/base/Log"],function(D,u,A,M,C,a,b,U,E,I,S,c,T,d,f,g,h,t,j,r,L){"use strict";var P="sap.ushell.components.container.",s=P+"ApplicationContainer",k="sap.ushell.Container.dirtyState.",l="autoplay;battery;camera;display-capture;geolocation;gyroscope;magnetometer;microphone;midi;clipboard-write;clipboard-read;fullscreen",m,o,H,R,n=false,K=false,q=[],v=0;var w=["sap-ach","sap-fiori-id","sap-hide-intent-link","sap-priority","sap-tag","sap-ui-app-id-hint","sap-ui-debug","sap-ui-fl-control-variant-id","sap-ui-fl-max-layer","sap-ui-tech-hint","sap-ui2-tcode","sap-ui2-wd-app-id","sap-ui2-wd-conf-id","sap-ushell-cdm-site-url","sap-ushell-defaultedParameterNames","sap-ushell-navmode","sap-ushell-next-navmode","sap-ushell-url","sap-app-origin-hint"];function x(e){var i=sap.ushell.Container.getService("CrossApplicationNavigation");i.isUrlSupported(e.url).done(function(){e.promise.resolve({"allowed":true,"id":e.id});}).fail(function(){e.promise.resolve({"allowed":false,"id":e.id});});}function y(e){var i={"asyncURLHandler":q1.prototype._adaptIsUrlSupportedResultForMessagePopover};if(M&&M.setDefaultHandlers){M.setDefaultHandlers(i);}E.emit("StepDone",e.stepName);}E.once("initMessagePopover").do(y);m=new u.Map();function z(e){return m.get(e.getId());}function B(){return o;}function F(e){var p=new d(e).mParams,i=p["sap-xapp-state"],r1;delete p["sap-xapp-state"];r1={startupParameters:p};if(i){r1["sap-xapp-state"]=i;}return r1;}function G(e,i){if(!R){R=jQuery.sap.resources({url:jQuery.sap.getModulePath(P)+"/resources/resources.properties",language:sap.ui.getCore().getConfiguration().getLanguage()});}return R.getText(e,i);}function J(){return new I({size:"2rem",src:"sap-icon://error",tooltip:q1.prototype._getTranslatedText("an_error_has_occured")});}function N(e){var i=e.getAggregation("child"),p;if(i instanceof a){p=i.getComponentInstance().getMetadata().getName().replace(/\.Component$/,"");L.debug("unloading component "+p,null,s);}e.destroyAggregation("child");}function O(e,i,p){return new Promise(function(r1){var s1,t1,u1,v1,w1,x1={},y1,z1;function A1(C1){C1.setWidth(e.getWidth());C1.setHeight(e.getHeight());C1.addStyleClass("sapUShellApplicationContainer");e.setAggregation("child",C1,true);}s1=i.indexOf("?");if(s1>=0){v1=q1.prototype._getParameterMap(i);x1=v1.startupParameters;i=i.slice(0,s1);}if(i.slice(-1)!=="/"){i+="/";}if(/\.view\.(\w+)$/i.test(p)){u1=/^SAPUI5=(?:([^/]+)\/)?([^/]+)\.view\.(\w+)$/i.exec(p);if(!u1){L.error("Invalid SAPUI5 URL",p,s);r1(q1.prototype._createErrorControl());return;}w1=u1[1];y1=u1[2];z1=u1[3].toUpperCase();if(w1){y1=w1+"."+y1;}else{t1=y1.lastIndexOf(".");if(t1<1){L.error("Missing namespace",p,s);return q1.prototype._createErrorControl();}w1=y1.slice(0,t1);}}else{w1=p.replace(/^SAPUI5=/,"");}jQuery.sap.registerModulePath(w1,i+w1.replace(/\./g,"/"));q1.prototype._destroyChild(e);if(y1){if(e.getApplicationConfiguration()){x1.config=e.getApplicationConfiguration();}sap.ui.view({id:e.getId()+"-content",type:z1,viewData:x1||{},viewName:y1,async:true}).loaded().then(function(C1){e.fireEvent("applicationConfiguration");A1(C1);r1(C1);});}else{L.debug("loading component "+w1,null,s);var B1=v1?{startupParameters:v1.startupParameters}:{startupParameters:{}};if(v1&&v1["sap-xapp-state"]){B1["sap-xapp-state"]=v1["sap-xapp-state"];}if(e.getApplicationConfiguration()){B1.config=e.getApplicationConfiguration();}sap.ui.core.Component.create({id:e.getId()+"-component",componentData:B1,name:w1}).then(function(C1){e.fireEvent("applicationConfiguration",{"configuration":C1.getMetadata().getConfig()});var D1=new a({id:e.getId()+"-content",component:C1});A1(D1);r1(D1);});}});}function Q(e,i){setTimeout(function(){sap.ui.getCore().getEventBus().publish("sap.ushell",e,i);},0);}function V(e,i,p){var r1=this,s1,t1={oControl:undefined,oPromise:undefined},u1,v1,w1,x1={startupParameters:{}},y1,z1=e.getComponentHandle(),A1=sap.ushell.Container.getService("PluginManager"),B1,C1;function D1(E1){e.fireEvent("applicationConfiguration",{"configuration":E1.getMetadata().getConfig()});v1=new a({id:e.getId()+"-content",component:E1});v1.setHeight(e.getHeight());v1.setWidth(e.getWidth());v1.addStyleClass("sapUShellApplicationContainer");e._disableRouterEventHandler=q1.prototype._disableRouter.bind(r1,E1);sap.ui.getCore().getEventBus().subscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",e._disableRouterEventHandler);e.setAggregation("child",v1,true);if(A1){B1=A1.getPluginLoadingPromise("RendererExtensions");C1=B1&&B1.state();if(C1==="pending"){B1.done(function(){q1.prototype._publishExternalEvent("appComponentLoaded",{component:E1});}).fail(function(){q1.prototype._publishExternalEvent("appComponentLoaded",{component:E1});});}if(C1==="resolved"||C1==="rejected"){q1.prototype._publishExternalEvent("appComponentLoaded",{component:E1});}}else{q1.prototype._publishExternalEvent("appComponentLoaded",{component:E1});}return v1;}u.addTime("createUi5Component");u1=i.indexOf("?");if(u1>=0){w1=q1.prototype._getParameterMap(i);x1={startupParameters:w1.startupParameters};if(w1["sap-xapp-state"]){x1["sap-xapp-state"]=w1["sap-xapp-state"];}i=i.slice(0,u1);}if(e.getApplicationConfiguration()){x1.config=e.getApplicationConfiguration();}if(i.slice(-1)!=="/"){i+="/";}q1.prototype._destroyChild(e);y1={id:e.getId()+"-component",name:p,componentData:x1};L.debug("Creating component instance for "+p,JSON.stringify(y1),s);sap.ui.getCore().getEventBus().publish("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",{name:p});if(z1){var E1=z1.getInstance(y1);t1.oControl=D1(E1);}else{s1=new jQuery.Deferred();jQuery.sap.registerModulePath(p,i);L.error("No component handle available for '"+p+"'; fallback to component.load()",null,s);sap.ui.component({id:e.getId()+"-component",name:p,componentData:x1,async:true}).then(function(E1){s1.resolve(D1(E1));});t1.oPromise=s1.promise();}return t1;}function W(e){var i;if((e instanceof C)&&(typeof e.getRouter==="function")){i=e.getRouter();if(i&&(typeof i.stop==="function")){L.info("router stopped for instance "+e.getId());i.stop();}}}function X(e){var i=document.createElement("a"),p=new d(e).get("sap-client"),r1;i.href=e;r1=i.protocol+"//"+i.host;return new S({alias:p?r1+"?sap-client="+p:r1,baseUrl:r1,client:p||undefined,platform:"abap"});}function Y(e,i){var p=false,r1=e.getDomRef(),s1,t1;if(e.getIframeWithPost()===true&&r1&&r1.getAttribute&&r1.getAttribute("sap-iframe-app")=="true"){r1=jQuery("#"+r1.getAttribute("id")+"-iframe")[0];}if(r1){s1=U(e._getIFrameUrl(r1)||window.location&&window.location.href||"");t1=s1.protocol()+"://"+s1.host();p=(i.source===r1.contentWindow)||(i.origin===t1);}return p;}function Z(e,i,p){var r1=JSON.stringify({type:"request",service:i,request_id:g(),body:{}});L.debug("Sending post message request to origin ' "+p+"': "+r1,null,"sap.ushell.components.container.ApplicationContainer");e.postMessage(r1,p);}function $(){var i=this.getDomRef();if(!i||i.tagName!=="IFRAME"){if(this.getIframeWithPost()===true&&i&&i.getAttribute&&i.getAttribute("sap-iframe-app")=="true"){return jQuery("#"+i.getAttribute("id")+"-iframe")[0];}return null;}return i;}function _(i){var e;if(i===undefined){i=this._getIFrame();}if(this.getIframeWithPost()===true){e=jQuery("#"+i.getAttribute("id").replace("-iframe","-form"))[0].action;if(e===undefined&&(new U()).query(true).hasOwnProperty("sap-isolation-enabled")){e=i.src;}}else{e=i.src;}return e;}function a1(e,i){if(e&&!e.getActive()){L.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(r1)+"' on inactive container '"+e.getId()+"'","Only active containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}var p=e.getUi5ComponentName&&e.getUi5ComponentName(),r1=i.data;if(typeof p==="string"){L.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(r1)+"' on container of UI5 application '"+p+"'","Only non UI5 application containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}var s1={bApiRegistered:true};H(e,i,s1);b1(e,i,s1);}var a1=t.testableStatic(a1,"ApplicationContainer_handleMessageEvent");function b1(e,p,r1){var s1,t1,u1;if(r1.bApiRegistered!==false){return;}if(n===false){n=true;s1=sap.ushell.Container.getService("PluginManager");if(s1){t1=s1.getPluginLoadingPromise("RendererExtensions");u1=t1&&t1.state();if(u1==="pending"){K=true;t1.done(function(){var v1;K=false;L.debug("Processing post messages queue after 'RendererExtensions' plugins loaded, queue size is: "+q.length,null,"sap.ushell.components.container.ApplicationContainer");for(var i=0;i<q.length;i++){v1=q[i];try{a1.call(v1.that,v1.oContainer,v1.oMessage);}catch(ex){L.error(ex.message||ex,null,"sap.ushell.components.container.ApplicationContainer");}}q=[];});}}}if(K===true){q.push({index:v++,that:this,oContainer:e,oMessage:p});}}var b1=t.testableStatic(b1,"ApplicationContainer_handlePostMessagesForPluginsPostLoading");function c1(){n=false;K=false;q=[];v=0;}var c1=t.testableStatic(c1,"ApplicationContainer_resetPluginsLoadIndications");function d1(e,i){var p=e._getIFrame(),r1=e.getApplicationType();if(u.isApplicationTypeEmbeddedInIframe(e.getApplicationType(r1))&&p){var s1=new U(e._getIFrameUrl(p));var t1=s1.protocol()+"://"+s1.host();p.contentWindow.postMessage(JSON.stringify({action:"pro54_disableDirtyHandler"}),t1);i.preventDefault();}}function e1(e,i,p){e.write("<div").writeControlData(i).writeAccessibilityState(i).addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles().write(">");if(p){e.renderControl(p);}e.write("</div>");}function f1(e,i,p){if(u.isApplicationTypeEmbeddedInIframe(i)){var r1=e.getTargetNavigationMode();p=q1.prototype._adjustNwbcUrl(p,i,r1,e.getIsStateful());u.localStorageSetItem(e.globalDirtyStorageKey,sap.ushell.Container.DirtyState.INITIAL);}return p;}function g1(e,i,p,r1){var s1,t1=function(){var B1=u.getParameterValueBoolean("sap-accessibility");if(B1!==undefined){return B1;}return sap.ushell.Container.getUser().getAccessibilityMode();},u1=function(){var B1=new d(e)||{mParams:{}};if(B1.mParams["sap-theme"]===undefined){return sap.ushell.Container.getUser().getTheme(c.prototype.constants.themeFormat.NWBC);}return undefined;},v1=function(){var B1=false,C1=new d(e)||{mParams:{}};B1=sap.ui.getCore().getConfiguration().getStatistics()&&C1.mParams["sap-statistics"]===undefined;return B1;},w1=function(){var B1=window.hasher&&window.hasher.getHash(),y1="",C1;if(B1&&B1.length>0&&B1.indexOf("sap-iapp-state=")>0){C1=/(?:sap-iapp-state=)([^&/]+)/.exec(B1);if(C1&&C1.length===2){y1=C1[1];}}return y1;},x1=function(){var B1="";var C1=(!!jQuery("body.sapUiSizeCompact").length);var D1=(!!jQuery("body.sapUiSizeCozy").length);if(C1===true){B1="0";}else if(D1){B1="1";}return B1;};e+=e.indexOf("?")>=0?"&":"?";e+="sap-ie=edge";s1=u1();if(s1){e+=e.indexOf("?")>=0?"&":"?";e+="sap-theme="+encodeURIComponent(s1);}if(p){e+=e.indexOf("?")>=0?"&":"?";e+="sap-target-navmode="+encodeURIComponent(p);}if(t1()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-accessibility=X";}if(v1()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-statistics=true";}if(r1){e+=e.indexOf("?")>=0?"&":"?";e+="sap-keepclientsession=1";}var y1=w1();if(y1&&y1.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-iapp-state="+y1;}var z1=x1();if(z1&&z1.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-touch="+z1;}var A1=0;if(j.last("/core/shell/sessionTimeoutIntervalInMinutes")>0){A1=j.last("/core/shell/sessionTimeoutIntervalInMinutes");}e+=e.indexOf("?")>=0?"&":"?";e+="sap-ushell-timeout="+A1;return u.appendSapShellParam(e,i);}function h1(e,i,p,r1){var s1=i.getAggregation("child"),t1,u1;if(!s1||i._bRecreateChild){u1=q1.prototype._createUi5Component(i,p,r1);if(u1.oControl!==undefined){i._bRecreateChild=false;q1.prototype._renderControlInDiv(e,i,u1.oControl);}else{i.oDeferredControlCreation=new jQuery.Deferred();q1.prototype._renderControlInDiv(e,i);u1.oPromise.then(function(v1){i._bRecreateChild=false;t1=sap.ui.getCore().createRenderManager();t1.renderControl(v1);t1.flush(jQuery("#"+i.getId())[0]);t1.destroy();i.oDeferredControlCreation.resolve();});}}else{q1.prototype._renderControlInDiv(e,i,s1);}}function i1(e,i,p){var r1=e.getProperty(i);if(f(r1,p)){return;}e.setProperty(i,p);e._bRecreateChild=true;}function j1(e,i,p,r1,s1){var t1,u1=true;localStorage.removeItem(i.globalDirtyStorageKey);i.oDeferredControlCreation=undefined;if(s1&&s1.indexOf("SAPUI5.Component=")===0&&p===A.URL.type){h1(e,i,r1,s1.replace(/^SAPUI5\.Component=/,""));return;}if(s1&&s1.indexOf("SAPUI5=")===0&&p===A.URL.type){q1.prototype._renderControlInDiv(e,i,undefined,"open");i.oDeferredControlCreation=new jQuery.Deferred();q1.prototype._createUi5View(i,r1,s1).then(function(v1){var A1,B1=jQuery("#"+i.getId());if(B1&&B1.length>0){A1=sap.ui.getCore().createRenderManager();A1.renderControl(v1);A1.flush(jQuery("#"+i.getId())[0]);A1.destroy();}else{e.renderControl(v1);}i.oDeferredControlCreation.resolve();});q1.prototype._renderControlInDiv(e,i,undefined,"close");return;}L.debug("Not resolved as \"SAPUI5.Component=\" or \"SAPUI5=\" , "+"will attempt to load into iframe "+s1);if(!i.getActive()){L.debug("Skipping rendering container iframe","Container '"+i.getId()+"' is inactive");return;}try{r1=i.getFrameSource(p,r1,s1);}catch(ex){L.error(ex.message||ex,null,s);i.fireEvent("applicationConfiguration");e.renderControl(q1.prototype._createErrorControl());return;}if(sap.ushell.Container){t1=q1.prototype._getLogoutHandler(i);if(!t1){if(u.isApplicationTypeEmbeddedInIframe(p)){t1=q1.prototype._logout.bind(null,i);m.put(i.getId(),t1);sap.ushell.Container.attachLogoutEvent(t1);sap.ushell.Container.addRemoteSystem(q1.prototype._createSystemForUrl(r1));}}else if(!u.isApplicationTypeEmbeddedInIframe(p)){sap.ushell.Container.detachLogoutEvent(t1);m.remove(i.getId());}}r1=q1.prototype._checkNwbcUrlAdjustment(i,p,r1);var w1=new d(document.URL);r1=i._adjustURLForIsolationOpeningWithoutURLTemplate(r1);if(p==="TR"||i.getIsPostCapability()&&new d(r1).get("sap-iframe-hint")==="GUI"){if(w1.get("sap-post-params")==="true"){i.setIframePostAllParams(true);}}u1=false;if(new d(window.location.href).get("sap-post")==="true"){u1=true;}else if(window.QUnit!==undefined){u1=i.getIframeWithPost();}if(u1===true&&((p==="NWBC"||p==="TR")||i.getIsPostCapability()===true)){i.setProperty("iframeWithPost",true,true);i.oDeferredRenderer=new jQuery.Deferred();r1=q1.prototype._filterURLParams(r1);var x1=[];var y1=q1.prototype._getParamKeys(r1,x1);q1.prototype._generateRootElementForIFrame(e,i,true);if(y1.length>0){var z1=sap.ushell.Container.getService("CrossApplicationNavigation");z1.getAppStateData(y1).then(function(v1){var A1;var B1=jQuery("#"+i.getId());if(B1.length>0){A1=sap.ui.getCore().createRenderManager();q1.prototype._buildHTMLElements(A1,i,v1,x1,r1,true,w1);A1.flush(B1[0]);A1.destroy();}else{q1.prototype._buildHTMLElements(e,i,v1,x1,r1,true,w1);}setTimeout(i.oDeferredRenderer.resolve,0);},function(v1){q1.prototype._buildHTMLElements(e,i,undefined,x1,r1,true,w1);setTimeout(i.oDeferredRenderer.resolve,0);});}else{q1.prototype._buildHTMLElements(e,i,undefined,x1,r1,false,w1);setTimeout(i.oDeferredRenderer.resolve,0);}q1.prototype._generateRootElementForIFrame(e,i,false);return;}i.fireEvent("applicationConfiguration");e.write("<iframe").writeControlData(i).writeAccessibilityState(i).writeAttributeEscaped("src",r1).writeAttributeEscaped("title",r.i18n.getText("AppilcationContainer.IframeTitle")).addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles();if(j.last("/core/shell/enableFeaturePolicyInIframes")===true){e.writeAttribute("allow",l);}e.write("></iframe>");}function k1(e){var i=new d(document.URL);if(i.get("sap-isolation-enabled")==="true"){var p=sap.ushell.Container.getService("URLParsing"),r1=p.getHash(document.URL),s1="",t1="&sap-plugins="+encodeURIComponent(sap.ushell.Container.getService("PluginManager")._getNamesOfPluginsWithAgents());if(e.indexOf("&/")>0){s1=e.substr(e.indexOf("&/"));}if(t1==="&sap-plugins="){t1="";}if(r1){var u1=p.parseShellHash("#"+r1),v1=p.paramsToString(u1.params);if(v1&&v1.length>=0){var w1=sap.ushell.Container.getService("AppState").createEmptyAppState(),x1=sap.ushell.Container.getService("AppState").createEmptyAppState(),y1="";if(v1.indexOf("sap-intent-param")>=0){y1=encodeURIComponent(v1);}else{w1.setData(v1);w1.save();y1=encodeURIComponent("sap-intent-param="+w1.getKey());}x1.setData("sap-startup-params="+y1);x1.save();e=e.split("#")[0]+"&sap-intent-param="+x1.getKey()+t1+"#"+window.hasher.getHash();}else{e=e.split("#")[0]+t1+"#"+window.hasher.getHash();}}else{e+="#"+window.hasher.getHash();}if(e.indexOf("&/")<0){e+=s1;}}if(i.has("sap-iframe-params")){var z1=i.get("sap-iframe-params")||"",A1=z1.split(",");A1.forEach(function(B1){if(B1&&B1.length>0){if(i.has(B1)){e=e.split("#")[0]+"&"+B1+"="+i.get(B1)+"#"+e.split("#")[1];}}});}return e;}function l1(e){var i=new U(e);i=i.removeSearch(w);return i.toString();}function m1(e,i){var p=[],r1;if(e.indexOf("sap-intent-param=")>0){r1=/(?:sap-intent-param=)([^&/]+)/.exec(e);if(r1&&r1.length===2){p.push([r1[1]]);i.push("sap-intent-param-data");}}if(e.indexOf("sap-xapp-state=")>0){r1=/(?:sap-xapp-state=)([^&/]+)/.exec(e);if(r1&&r1.length===2){p.push([r1[1]]);i.push("sap-xapp-state-data");}}if(e.indexOf("sap-iapp-state=")>0){r1=/(?:sap-iapp-state=)([^&/]+)/.exec(e);if(r1&&r1.length===2){p.push([r1[1]]);i.push("sap-iapp-state-data");}}return p;}function n1(e,i,p,r1,s1,t1,u1){var v1=i.getId()+"-form",w1="",x1="",y1=false;if(p===undefined){p=[];}p.push([sap.ushell.Container.getFLPUrl(true)]);r1.push("sap-flp-url");var z1="";var A1={};r1.forEach(function(D1,E1){if(p[E1][0]){A1[D1]=p[E1][0];}});z1=JSON.stringify(A1);w1="<input name=\"sap-flp-params\" value=\""+h(z1)+"\">";if(i.getIframePostAllParams()===true){i.setIframePostAllParams(false);var B1=new d(s1);x1=o1(i,B1);}i.fireEvent("applicationConfiguration");e.write("<form").writeAttributeEscaped("method","post").writeAttributeEscaped("id",v1).writeAttributeEscaped("name",v1).writeAttributeEscaped("target",i.getId()+"-iframe").writeAttributeEscaped("action",s1).addStyle("display","none").writeStyles().write(">").writeAttributeEscaped(w1+x1).write("</form>");var C1=i.sId;if(!t1&&i.hasStyleClass("hidden")){y1=true;i.toggleStyleClass("hidden",false);}i.sId+="-iframe";e.write("<iframe").writeAttributeEscaped("name",i.getId()).writeControlData(i).writeAccessibilityState(i).writeAttributeEscaped("sap-orig-src",s1).writeAttributeEscaped("title",r.i18n.getText("AppilcationContainer.IframeTitle")).addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles();if(j.last("/core/shell/enableFeaturePolicyInIframes")===true){e.writeAttribute("allow",l);}e.write("></iframe>");i.sId=C1;if(y1){i.toggleStyleClass("hidden",true);}}function o1(e,i){var r1="";var s1="",t1="";if(i.has("sap-iframe-hint")){r1=i.get("sap-iframe-hint");}var u1=i.mParams;if(e.getApplicationType()==="TR"||(r1==="GUI")){var p,v1;for(p in u1){if(p==="sap-iframe-hint"){continue;}v1=u1[p][0];s1="<input name=\""+p+"\" value=\""+h(v1)+"\">";t1+=s1;}}return t1;}function p1(e,i,p){if(p){e.write("<div").writeControlData(i).writeAttributeEscaped("sap-iframe-app","true").addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles().write(">");}else{e.write("</div>");}}var q1=b.extend(s,{metadata:{properties:{additionalInformation:{defaultValue:"",type:"string"},application:{type:"object"},applicationConfiguration:{type:"object"},applicationType:{defaultValue:"URL",type:P+"ApplicationType"},height:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},navigationMode:{defaultValue:"",type:"string"},targetNavigationMode:{defaultValue:"",type:"string"},text:{defaultValue:"",type:"string"},url:{defaultValue:"",type:"string"},visible:{defaultValue:true,type:"boolean"},active:{defaultValue:true,type:"boolean"},"sap-system":{type:"string"},applicationDependencies:{type:"object"},componentHandle:{type:"object"},ui5ComponentName:{type:"string"},width:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},shellUIService:{type:"object"},appIsolationService:{type:"object"},reservedParameters:{type:"object"},coreResourcesFullyLoaded:{type:"boolean"},isStateful:{defaultValue:false,type:"boolean"},iframeHandlers:{defaultValue:"",type:"string"},iframeWithPost:{defaultValue:false,type:"boolean"},beforeAppCloseEvent:{type:"object"},isPostCapability:{defaultValue:false,type:"boolean"},extendedInfo:{type:"object"},systemAlias:{defaultValue:"",type:"string"},iframePostAllParams:{defaultValue:false,type:"boolean"}},events:{"applicationConfiguration":{}},aggregations:{child:{multiple:false,type:"sap.ui.core.Control",visibility:"hidden"}},library:"sap.ushell",designtime:"sap/ushell/designtime/ApplicationContainer.designtime"},exit:function(){var e,i=this;if(sap.ushell.Container){e=q1.prototype._getLogoutHandler(i);if(e){sap.ushell.Container.detachLogoutEvent(e);m.remove(i.getId());}}localStorage.removeItem(i.globalDirtyStorageKey);if(i._unloadEventListener){removeEventListener("unload",i._unloadEventListener);}if(i._disableRouterEventHandler){sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",i._disableRouterEventHandler);}if(i._storageEventListener){removeEventListener("storage",i._storageEventListener);}if(i._messageEventListener){removeEventListener("message",i._messageEventListener);}q1.prototype._destroyChild(i);if(b.exit){b.exit.apply(i);}},setHandleMessageEvent:function(i){H=i;},init:function(){var e=this;e.globalDirtyStorageKey=k+g();e._unloadEventListener=e.exit.bind(e);addEventListener("unload",e._unloadEventListener);e._storageEventListener=function(i){var p=e.getApplicationType();if(i.key===e.globalDirtyStorageKey&&i.newValue===sap.ushell.Container.DirtyState.PENDING&&u.isApplicationTypeEmbeddedInIframe(p)){var r1=e._getIFrame();if(r1){L.debug("getGlobalDirty() send pro54_getGlobalDirty ",null,"sap.ushell.components.container.ApplicationContainer");var s1=new U(e._getIFrameUrl(r1));var t1=s1.protocol()+"://"+s1.host();r1.contentWindow.postMessage(JSON.stringify({action:"pro54_getGlobalDirty"}),t1);}}};addEventListener("storage",e._storageEventListener);e._messageEventListener=q1.prototype._handleMessageEvent.bind(null,e);addEventListener("message",e._messageEventListener);},onAfterRendering:function(){var e=this;this.rerender=function(){};if(D.os.ios&&this.$().prop("tagName")==="IFRAME"){this.$().parent().css("overflow","auto");}if(this.oDeferredRenderer){this.oDeferredRenderer.done(function(){var i=document.getElementById(e.getId()+"-form");if(i){i.submit();}});}},renderer:function(e,i){var p=i.getApplication(),r1=i.launchpadData,s1;if(!i.getVisible()){q1.prototype._renderControlInDiv(e,i);return;}if(i.error){delete i.error;q1.prototype._renderControlInDiv(e,i,q1.prototype._createErrorControl());}else if(!p){q1.prototype._render(e,i,i.getApplicationType(),i.getUrl(),i.getAdditionalInformation());}else if(!p.isResolvable()){q1.prototype._render(e,i,p.getType(),p.getUrl(),"");}else if(r1){q1.prototype._render(e,i,r1.applicationType,r1.Absolute.url.replace(/\?$/,""),r1.applicationData);}else{L.debug("Resolving "+p.getUrl(),null,s);p.resolve(function(t1){L.debug("Resolved "+p.getUrl(),JSON.stringify(t1),s);i.launchpadData=t1;q1.prototype._destroyChild(i);},function(t1){var u1=p.getMenu().getDefaultErrorHandler();if(u1){u1(t1);}q1.prototype._destroyChild(i);i.error=t1;});s1=new T({text:q1.prototype._getTranslatedText("loading",[p.getText()])});q1.prototype._destroyChild(i);i.setAggregation("child",s1);q1.prototype._renderControlInDiv(e,i,s1);}}});q1.prototype.getFrameSource=function(e,i){if(!Object.prototype.hasOwnProperty.call(A.enum,e)){throw new Error("Illegal application type: "+e);}return i;};q1.prototype.setUrl=function(e){i1(this,"url",e);};q1.prototype.setAdditionalInformation=function(e){i1(this,"additionalInformation",e);};q1.prototype.setApplicationType=function(e){i1(this,"applicationType",e);};q1.prototype.createPostMessageRequest=function(e,i){var p=Date.now().toString();return{"type":"request","request_id":p,"service":e,"body":i};};q1.prototype.setNewTRApplicationContext=function(e){var i=new jQuery.Deferred(),p=this._getIFrame(),r1,s1,t1=this;if(!p){return i.promise().reject({message:"Expected an exisiting TR application application frame but found none."});}function u1(){if(s1){s1["sap-flp-url"]=sap.ushell.Container.getFLPUrl(true);r1["sap-flp-params"]=h(JSON.stringify(s1));}var y1=t1.createPostMessageRequest("sap.its.startService",r1);t1.postMessageToIframe(y1,p,true).then(function(){i.resolve();},function(z1){i.reject({eventData:z1,message:"Failed to change application context."});});}e=u.appendSapShellParam(e);r1={"url":e};if(this.getIframeWithPost&&this.getIframeWithPost()===true){var v1=[];var w1=q1.prototype._getParamKeys(e,v1);if(w1.length>0){var x1=sap.ushell.Container.getService("CrossApplicationNavigation");x1.getAppStateData(w1).then(function(y1){s1={};v1.forEach(function(z1,A1){if(y1[A1][0]){s1[z1]=y1[A1][0];}});u1();},function(y1){u1();});}else{s1={};u1();}}else{u1();}return i.promise();};q1.prototype.postMessageToIframe=function(i,p,r1){var s1=this;var t1=i.request_id;return new Promise(function(u1,v1){function w1(A1){var B1;try{B1=JSON.parse(A1.data,s1);if(t1!==B1.request_id){return;}if(B1.status==="success"){u1(B1);}else{v1(B1);}window.removeEventListener("message",w1);}catch(e){u1();L.warning("Obtained bad response from framework in response to message "+i.request_id);L.debug("Underlying framework returned invalid response data: '"+A1.data+"'");}}var x1=JSON.stringify(i);L.debug("Sending postMessage "+x1+" to application container '"+s1.getId()+"'");var y1=new U(s1._getIFrameUrl(p));var z1=y1.protocol()+"://"+y1.host();if(r1){window.addEventListener("message",w1,false);p.contentWindow.postMessage(x1,z1);}else{p.contentWindow.postMessage(x1,z1);u1();}});};q1.prototype.postMessageToCurrentIframe=function(e,i){if(i===undefined){i=false;}var p=this._getIFrame();if(!p){if(i){return Promise.reject({message:"Expected opened iframe not found."});}return;}return this.postMessageToIframe(e,p,i);};q1.prototype.setNewApplicationContext=function(e,i){var p=this;var r1=this["setNew"+e+"ApplicationContext"];if(!r1){return Promise.reject({message:"Unsupported application type"});}var s1=this._getIFrame();if(!s1){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var t1=this.createPostMessageRequest("sap.gui.triggerCloseSessionImmediately",{});return this.postMessageToIframe(t1,s1,true).then(function(){return r1.call(p,i);},function(u1){return Promise.reject({eventData:u1,message:"Failed to change application context."});});};q1.prototype.onApplicationOpened=function(e){var i=this.getIsStateful();if(!i){return Promise.resolve();}var p=this.getApplicationType();if(p==="TR"&&e!=="TR"){var r1=this._getIFrame();if(!r1){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var s1=this.createPostMessageRequest("sap.gui.triggerCloseSession",{});return this.postMessageToIframe(s1,r1,false).catch(function(t1){return Promise.reject({eventData:t1,message:"Failed to change application context."});});}return Promise.resolve();};q1.prototype.postMessageRequest=function(e,i){var p=this._getIFrame();if(!p){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var r1=this.createPostMessageRequest(e,i||{});return this.postMessageToIframe(r1,p,false).catch(function(s1){return Promise.reject({eventData:s1,message:"Failed to post message."});});};q1.prototype.sendBeforeAppCloseEvent=function(){var e=this.getBeforeAppCloseEvent&&this.getBeforeAppCloseEvent(),i;if(e&&e.enabled&&e.enabled===true){i=this.createPostMessageRequest("sap.ushell.services.CrossApplicationNavigation.beforeAppCloseEvent",e.params);return this.postMessageToIframe(i,this._getIFrame(),true);}else{return undefined;}};q1.prototype.getDeffedControlCreation=function(e){if(this.oDeferredControlCreation){return this.oDeferredControlCreation.promise();}else{return new jQuery.Deferred().resolve().promise();}};q1.prototype._getCommunicationHandlers=B;q1.prototype._adaptIsUrlSupportedResultForMessagePopover=x;q1.prototype._getLogoutHandler=z;q1.prototype._getParameterMap=F;q1.prototype._getTranslatedText=G;q1.prototype._createErrorControl=J;q1.prototype._destroyChild=N;q1.prototype._createUi5View=O;q1.prototype._publishExternalEvent=Q;q1.prototype._createUi5Component=V;q1.prototype._disableRouter=W;q1.prototype._createSystemForUrl=X;q1.prototype._isTrustedPostMessageSource=Y;q1.prototype._handleMessageEvent=a1;q1.prototype._logout=d1;q1.prototype._renderControlInDiv=e1;q1.prototype._checkNwbcUrlAdjustment=f1;q1.prototype._adjustNwbcUrl=g1;q1.prototype._render=j1;q1.prototype._getParamKeys=m1;q1.prototype._buildHTMLElements=n1;q1.prototype._buildHTMLForAllPostParams=o1;q1.prototype._generateRootElementForIFrame=p1;q1.prototype._backButtonPressedCallback=Z;q1.prototype._getIFrame=$;q1.prototype._getIFrameUrl=_;q1.prototype._filterURLParams=l1;q1.prototype._adjustURLForIsolationOpeningWithoutURLTemplate=k1;return q1;},true);
