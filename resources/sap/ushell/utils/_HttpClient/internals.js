// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/thirdparty/jquery"],function(L,q){"use strict";var e=b.bind(null,XMLHttpRequest),c=m.bind(null,e,o);return Object.create(null,{_executeRequest:{value:b},executeRequest:{value:e},executeRequestWithCsrfToken:{value:a},isSafeHttpMethod:{value:i},isValidHttpMethod:{value:f},summariseResponse:{value:s},processResponse:{value:p},getHttpRequestWrapper:{value:g},containsCSRFTokenHeaderEntry:{value:d},csrfTokenReadFromCache:{value:h},csrfTokenWriteToCache:{value:j},csrfTokenIsCached:{value:k},_csrfTokenFetch:{value:m},csrfTokenFetch:{value:c},_csrfTokenGet:{value:l},csrfTokenGet:{value:l.bind(null,k,h,j,c)},csrfTokenAddToRequestHeader:{value:n},csrfTokenExtractFromResponseHeader:{value:o}});function a(E,C,r,t,u,v,I,R,U,w,x){function y(A){return(A&&(A.status===403)&&(v(A,x).toLowerCase()==="required"));}var z;if(!/Function/.test(Object.prototype.toString.call(E))||!/Function/.test(Object.prototype.toString.call(C))||!/Function/.test(Object.prototype.toString.call(t))||!/Function/.test(Object.prototype.toString.call(r))||!/Function/.test(Object.prototype.toString.call(u))||!/Function/.test(Object.prototype.toString.call(v))||!/Function/.test(Object.prototype.toString.call(I))){throw new Error("DependencyInjectionError: one or more of the injected dependencies is invalid");}if(!/String/.test(Object.prototype.toString.call(R))||!/String/.test(Object.prototype.toString.call(U))){throw new Error("IllegalArgumentError: one or more of the arguments is invalid");}if(!w){w={};}return new Promise(function(A,B){function D(F){L.error(F,null,"sap.ushell.util.HttpClient");B(F);}if(!I(R)){r(U,x).then(function(F){z=u(F,w);return E(R,U,z);}).then(function(F){A(F);}).catch(function(F){if(y(F)){t(U,x).then(function(G){z=u(G,w);return E(R,U,z);}).then(function(G){A(G);}).catch(D);}else{D(F);}});}else{z=u("fetch",w);E(R,U,z).then(function(F){var G=v(F);if(G){C(G,x);}A(F);}).catch(D);}});}function b(F,r,u,C){var H,R,x;if(!/Function/.test(Object.prototype.toString.call(F))){throw new Error("DependencyInjectionError: one or more of the injected dependencies is invalid");}if(!/String/.test(Object.prototype.toString.call(r))||!/String/.test(Object.prototype.toString.call(u))){throw new Error("IllegalArgumentException: one or more of the arguments is invalid");}x=new F();if(/[a-z]/.test(r)){r=r.toUpperCase();}if(C){H=!C.headers?[]:Object.keys(C.headers).map(function(t){return{name:t,value:this[t]};},C.headers);R=C.data;}else{H=[];}return new Promise(function(t,v){["load","error"].forEach(function(E){x.addEventListener(E,p.bind(null,x,t,v));});x.open(r,u);H.forEach(function(w){x.setRequestHeader(w.name,w.value);});x.send(JSON.stringify(R));});}function g(M,H,B,C,r){if(!/String/.test(Object.prototype.toString.call(M))||!/Function/.test(Object.prototype.toString.call(H))||!/String/.test(Object.prototype.toString.call(B))){throw new Error("IllegalArgumentError: one or more of the arguments is invalid");}return function(P,S){return H(M,B.replace(/\/$/,"")+"/"+P.replace(/^\//,""),q.extend({},C,S),r);};}function p(x,O,E){var r;if(!x||!/Number/.test(Object.prototype.toString.call(x.status))||!/Function/.test(Object.prototype.toString.call(x.getAllResponseHeaders))){throw new Error("IllegalArgumentError: invalid XMLHttpRequest instance");}r=s(x);if(x.status<200||x.status>299){E(r);}else{O(r);}}function s(x){return{status:x.status,statusText:x.statusText,responseText:x.responseText,responseHeaders:x.getAllResponseHeaders().split(/\r\n/g).filter(function(I){return I.length>0;}).map(function(H){var P=H.split(":");return{name:P[0].trim(),value:P[1].trim()};})};}function d(H){var r=H["x-csrf-token"]||H["X-CSRF-TOKEN"];return!!r&&/String/.test(Object.prototype.toString.call(r));}function i(H){switch(H){case"HEAD":case"GET":case"OPTIONS":return true;case"POST":case"PUT":case"DELETE":return false;default:throw new Error("IllegalArgumentError: '"+H+"' is not a supported request method");}}function f(H){switch(H){case"HEAD":case"GET":case"OPTIONS":case"POST":case"PUT":case"DELETE":return true;default:throw new Error("IllegalArgumentError: '"+H+"' is not a supported request method");}}function h(C){return C.token;}function j(N,C){C.token=N;}function k(C){return!!C.token;}function l(C,r,t,u,U,v){if(!/Function/.test(Object.prototype.toString.call(C))||!/Function/.test(Object.prototype.toString.call(r))||!/Function/.test(Object.prototype.toString.call(t))||!/Function/.test(Object.prototype.toString.call(u))){throw new Error("DependencyInjectionError: one or more of the injected dependencies is invalid");}if(!/String/.test(Object.prototype.toString.call(U))){throw new Error("IllegalArgumentError: one or more of the arguments is invalid");}return new Promise(function(w,x){if(C(v)){w(r(v));}else{u(U).then(function(y){t(y,v);w(y);}).catch(function(E){x(E);});}});}function m(E,C,u){if(!/Function/.test(Object.prototype.toString.call(E))||!/Function/.test(Object.prototype.toString.call(C))){throw new Error("DependencyInjectionError: one or more of the injected dependencies is invalid");}if(!/String/.test(Object.prototype.toString.call(u))){throw new Error("IllegalArgumentError: one or more of the arguments is invalid");}return E("OPTIONS",u,{headers:{"x-csrf-token":"fetch"}}).then(function(r){return C(r);});}function n(H,C){var E,O={"x-csrf-token":H};if(!/String/.test(Object.prototype.toString.call(H))||!/object Object/.test(Object.prototype.toString.call(C))){throw new Error("IllegalArgumentError: one or more of the arguments is invalid");}E=q.extend(true,{},C);if(!E.headers){E.headers=O;}else{q.extend(E.headers,O);}return E;}function o(r){var C;if(!/Array/.test(Object.prototype.toString.call(r.responseHeaders))){return undefined;}C=r.responseHeaders.filter(function(H){return H.name==="x-csrf-token";})[0];return C&&C.value?C.value:undefined;}});
