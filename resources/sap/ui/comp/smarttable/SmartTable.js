/*
 * ! SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/thirdparty/jquery','sap/m/library','sap/ui/core/library','sap/ui/core/Core','sap/ui/core/ShortcutHintsMixin','sap/ui/core/format/ListFormat','sap/ui/events/KeyCodes','sap/ui/comp/util/DateTimeUtil','sap/ui/comp/util/FilterUtil','sap/m/Column','sap/m/ColumnListItem','sap/m/Label','sap/m/MessageBox','sap/m/Table','sap/m/Text','sap/m/Title','sap/m/OverflowToolbar','sap/m/ToolbarSpacer','sap/m/OverflowToolbarButton','sap/m/ToolbarSeparator','sap/m/VBox','sap/m/FlexItemData','sap/ui/comp/library','sap/ui/comp/providers/TableProvider','sap/ui/comp/smartfilterbar/FilterProvider','sap/ui/comp/smartvariants/SmartVariantManagement','sap/ui/model/Sorter','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/ui/model/json/JSONModel','sap/ui/table/AnalyticalColumn','sap/ui/table/AnalyticalTable','sap/ui/table/Column','sap/ui/table/Table','sap/ui/table/TreeTable','sap/ui/comp/personalization/Controller','sap/ui/comp/personalization/Util','sap/ui/comp/util/FormatUtil','sap/ui/comp/util/FullScreenUtil','sap/ui/comp/odata/ODataModelUtil','sap/ui/comp/odata/ODataType','sap/ui/comp/state/UIState','sap/ui/comp/smartvariants/PersonalizableInfo','sap/ui/core/format/NumberFormat','sap/ui/Device','sap/base/Log','sap/base/util/deepEqual','sap/base/util/merge',"sap/m/ColumnHeaderPopover",'sap/m/ColumnPopoverActionItem','sap/m/ColumnPopoverSortItem','sap/m/Menu','sap/m/MenuButton','sap/m/MenuItem','sap/m/Button','sap/m/Link','sap/m/MessageStrip','sap/ui/core/InvisibleMessage','sap/ui/util/openWindow','sap/ui/core/theming/Parameters'],function(q,M,c,C,S,L,K,D,F,a,b,d,f,R,T,g,O,h,j,k,V,l,m,n,o,p,r,s,t,J,A,u,v,w,x,y,P,z,B,E,G,U,H,N,I,Q,W,X,Y,Z,$,_,a1,b1,c1,d1,e1,f1,g1,h1){"use strict";var i1=M.ButtonType;var j1=M.MenuButtonMode;var k1=M.ToolbarDesign;var l1=M.ToolbarStyle;var m1=c.SortOrder;var n1=m.smarttable.InfoToolbarBehavior;var o1=V.extend("sap.ui.comp.smarttable.SmartTable",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smarttable/SmartTable.designtime",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},enableDataStateFiltering:{type:"boolean",group:"Behavior",defaultValue:false,visibility:"hidden"},smartFilterId:{type:"string",group:"Misc",defaultValue:null},ignoredFields:{type:"string",group:"Misc",defaultValue:null},initiallyVisibleFields:{type:"string",group:"Misc",defaultValue:null},requestAtLeastFields:{type:"string",group:"Misc",defaultValue:null},ignoreFromPersonalisation:{type:"string",group:"Misc",defaultValue:null},tableType:{type:"sap.ui.comp.smarttable.TableType",group:"Misc",defaultValue:null},useVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},showVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},useExportToExcel:{type:"boolean",group:"Misc",defaultValue:true},exportType:{type:"sap.ui.comp.smarttable.ExportType",group:"Misc",defaultValue:"UI5Client"},useTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},showTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},showRowCount:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},headerLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:sap.ui.core.TitleLevel.Auto},toolbarStyleClass:{type:"string",group:"Misc",defaultValue:null},enableCustomFilter:{type:"boolean",group:"Misc",defaultValue:true},persistencyKey:{type:"string",group:"Misc",defaultValue:null},useOnlyOneSolidToolbar:{type:"boolean",group:"Misc",defaultValue:false},placeToolbarInTable:{type:"boolean",group:"Misc",defaultValue:false},currentVariantId:{type:"string",group:"Misc",defaultValue:null},editable:{type:"boolean",group:"Misc",defaultValue:false},enableAutoBinding:{type:"boolean",group:"Misc",defaultValue:false},tableBindingPath:{type:"string",group:"Misc",defaultValue:null},editTogglable:{type:"boolean",group:"Misc",defaultValue:false},demandPopin:{type:"boolean",group:"Misc",defaultValue:false},showFullScreenButton:{type:"boolean",group:"Misc",defaultValue:false},initialNoDataText:{type:"string",group:"Misc",defaultValue:null},useInfoToolbar:{type:"sap.ui.comp.smarttable.InfoToolbarBehavior",group:"Behavior",defaultValue:n1.Auto},showDetailsButton:{type:"boolean",group:"Misc",defaultValue:false},detailsButtonSetting:{type:"sap.ui.core.Priority[]",group:"Behavior"},enableAutoColumnWidth:{type:"boolean",group:"Misc",defaultValue:false}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}},aggregations:{customToolbar:{type:"sap.m.Toolbar",multiple:false},semanticObjectController:{type:"sap.ui.comp.navpopover.SemanticObjectController",multiple:false},noData:{type:"sap.ui.core.Control",altTypes:["string"],multiple:false},semanticKeyAdditionalControl:{type:"sap.ui.core.Control",multiple:false}},events:{initialise:{},beforeRebindTable:{},editToggled:{},dataRequested:{},dataReceived:{},afterVariantInitialise:{},afterVariantSave:{parameters:{currentVariantId:{type:"string"}}},afterVariantApply:{parameters:{currentVariantId:{type:"string"}}},showOverlay:{},fieldChange:{},fullScreenToggled:{parameters:{fullScreen:{type:"boolean"}}},beforeExport:{parameters:{exportSettings:{type:"object"},userExportSettings:{type:"object"}}},beforePaste:{allowPreventDefault:true,parameters:{columnInfos:{type:"object[]"}}},paste:{parameters:{result:{type:"object"}}}}},renderer:{apiVersion:2},constructor:function(){V.apply(this,arguments);this._aExistingColumns=[];this._aAlwaysSelect=[];this._oTemplate=null;this._mFieldMetadataByKey={};this._createToolbar();this._oP13nDialogSettings=this.data("p13nDialogSettings");if(typeof this._oP13nDialogSettings==="string"){try{this._oP13nDialogSettings=JSON.parse(this._oP13nDialogSettings);}catch(e){this._oP13nDialogSettings=null;}}this._bIsFilterPanelEnabled=(this._oP13nDialogSettings&&this._oP13nDialogSettings.filter)?this._oP13nDialogSettings.filter.visible!==false:true;this._bIsSortPanelEnabled=(this._oP13nDialogSettings&&this._oP13nDialogSettings.sort)?this._oP13nDialogSettings.sort.visible!==false:true;this._createTable();this.attachModelContextChange(this._initialiseMetadata,this);}});o1.prototype.getEnableDataStateFiltering=function(){return this.getProperty("enableDataStateFiltering");};o1.prototype.setEnableDataStateFiltering=function(e){if(this.getEnableDataStateFiltering()===e){return this;}this.setProperty("enableDataStateFiltering",e,true);if(!e){this._onApplyMessageFilter(e);if(this._oDataStateIndicator){this._oDataStateIndicator.detachEvent("dataStateChange",this._onDataStateChange,this);this._oDataStateIndicator.detachEvent("messageLinkPressed",this._onMessageLinkPressed,this);this._oDataStateIndicator=null;}}this._bApplyFilter=false;this._handleDataStateIndicator();return this;};o1.prototype._handleDataStateIndicator=function(){if(!this._oTable||!this.getEnableDataStateFiltering()){return;}var i=this._oTable.getDependents();if(!i.length){return;}var e=i.find(function(r1){return r1.isA("sap.m.plugins.DataStateIndicator");});if(!e){return;}this._oDataStateIndicator=e;this._oDataStateIndicator.attachEvent("dataStateChange",this._onDataStateChange,this);var q1=C.getLibraryResourceBundle("sap.ui.comp");this._oDataStateIndicator.setMessageLinkText(q1.getText("SMARTTABLE_MESSAGESTRIP_FILTER_ITEMS"));this._oDataStateIndicator.setMessageLinkVisible(true);this._oDataStateIndicator.attachEvent("messageLinkPressed",this._onMessageLinkPressed,this);this._oDataStateIndicator.refresh();};o1.prototype.setHeaderLevel=function(e){if(this.getHeaderLevel()===e){return this;}this.setProperty("headerLevel",e,true);this._headerText&&this._headerText.setLevel(e);return this;};o1.prototype._onMessageLinkPressed=function(){this._bApplyFilter=!this._bApplyFilter;this._onApplyMessageFilter(this._bApplyFilter);};o1.prototype._getP13nFilterMessageStrip=function(){var e,i;if(this.getEnableDataStateFiltering()){i=C.getLibraryResourceBundle("sap.ui.comp");e=new e1({text:i.getText("SMARTTABLE_P13N_FILTER_MESSAGESTRIP"),type:"Information",visible:this._bApplyFilter,link:new d1({text:i.getText("SMARTTABLE_MESSAGESTRIP_CLEAR_FILTER"),press:[function(){e.setVisible(false);this._onApplyMessageFilter(false);this._bApplyFilter=!this._bApplyFilter;},this]})});}return e;};o1.prototype._onDataStateChange=function(e){var i=e.getParameter("filteredMessages")||[];this._sDataStateType=e.getSource()._getCombinedType(i).toUpperCase();if(!i.length){this._onApplyMessageFilter(false);}};o1.prototype._onApplyMessageFilter=function(e){this._filterByDataStateError(e);var i=C.getLibraryResourceBundle("sap.ui.comp");if(this._oDataStateIndicator&&!e){this._oDataStateIndicator.setMessageLinkText(i.getText("SMARTTABLE_MESSAGESTRIP_FILTER_ITEMS"));this._getRowBinding().checkDataState();}else if(this._oDataStateIndicator){this._oDataStateIndicator.setMessageLinkText(i.getText("SMARTTABLE_MESSAGESTRIP_CLEAR_FILTER"));}};o1.prototype.init=function(){V.prototype.init.call(this);this.addStyleClass("sapUiCompSmartTable");this.setFitContainer(true);this._aColumnKeys=[];this._aDeactivatedColumns=[];this._mLazyColumnMap={};};o1.prototype._getVariantManagementControl=function(e){var i=null;if(e){if(typeof e==='string'){i=C.byId(e);}else{i=e;}if(i){if(!(i instanceof p)){Q.error("Control with the id="+e.getId?e.getId():e+" not of expected type");return null;}}}return i;};o1.prototype._createVariantManagementControl=function(){if(this._oVariantManagement||(!this.getUseVariantManagement()&&!this.getUseTablePersonalisation())||!this.getPersistencyKey()){return;}var e=new H({type:"table",keyName:"persistencyKey",dataSource:"TODO"});e.setControl(this);var i=this.getSmartVariant();if(i){this._oVariantManagement=this._getVariantManagementControl(i);}else if(this._oSmartFilter&&this._oSmartFilter.data("pageVariantPersistencyKey")){i=this._oSmartFilter.getSmartVariant();if(i){this._oVariantManagement=this._getVariantManagementControl(i);}}else{this._oVariantManagement=new p(this.getId()+"-variant",{showShare:true});}if(this._oVariantManagement){this._oVariantManagement.addPersonalizableControl(e);this._oVariantManagement.attachSave(this._variantSaved,this);this._oVariantManagement.attachAfterSave(this._variantAfterSave,this);this._oVariantManagement.initialise(this._variantInitialised,this);}};o1.prototype._variantInitialised=function(){if(!this._oCurrentVariant){this._oCurrentVariant="STANDARD";}this.fireAfterVariantInitialise();if(this._oVariantManagement&&!this._oVariantManagement.getEnabled()){this._checkAndTriggerBinding();}};o1.prototype._variantSaved=function(){if(this._oPersController){this._oPersController.setPersonalizationData(this._oCurrentVariant,true);}};o1.prototype._variantAfterSave=function(){this.fireAfterVariantSave({currentVariantId:this.getCurrentVariantId()});};o1.prototype.setTableBindingPath=function(e){this.setProperty("tableBindingPath",e,true);return this;};o1.prototype.setShowTablePersonalisation=function(e){this.setProperty("showTablePersonalisation",e,true);if(this._oTablePersonalisationButton){this._oTablePersonalisationButton.setVisible(e);}return this;};o1.prototype.setUseVariantManagement=function(e){this.setProperty("useVariantManagement",e,true);if(this._oPersController){this._oPersController.setResetToInitialTableState(!e);}return this;};o1.prototype.setShowVariantManagement=function(e){this.setProperty("showVariantManagement",e,true);if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(e);if(this._oSeparator){this._oSeparator.setVisible(e);}}return this;};o1.prototype.setToolbarStyleClass=function(e){this.setProperty("toolbarStyleClass",e,true);return this;};o1.prototype.setCustomToolbar=function(e){this._oCustomToolbar=e;return this;};o1.prototype.getCustomToolbar=function(){return this._oCustomToolbar;};o1.prototype.setHeader=function(e){var i=this.getProperty("header"),q1;this.setProperty("header",e,true);if(this.bIsInitialised&&this._oToolbar){q1=(!i===!e);if(!q1){this._createToolbarContent();}else{this._refreshHeaderText();}}return this;};o1.prototype.setShowRowCount=function(e){this.setProperty("showRowCount",e,true);this._refreshHeaderText();return this;};o1.prototype.setEditable=function(e){this.setProperty("editable",e,true);if(this._oEditModel){this._oEditModel.setProperty("/editable",e);}if(this._oEditButton){this._oEditButton.setIcon(e?"sap-icon://display":"sap-icon://edit");}if(this._isMobileTable&&this._oTable.setKeyboardMode){this._oTable.setKeyboardMode(e?"Edit":"Navigation");}return this;};o1.prototype.setDemandPopin=function(e){var i=this.getDemandPopin();if(i===e){return this;}this.setProperty("demandPopin",e,true);if(this.bIsInitialised){if(e){this._updateColumnsPopinFeature();}else{this._deactivateColumnsPopinFeature();}}return this;};o1.prototype._refreshHeaderText=function(){if(!this._headerText){return;}if(!this._oNumberFormatInstance){this._oNumberFormatInstance=N.getFloatInstance();}var i;var e=this.getHeader();this._headerText.setVisible(!!e);if(this.getShowRowCount()){i=this._getRowCount(true);var q1=this._oNumberFormatInstance.format(i);e+=" ("+q1+")";}this._headerText.setText(e);this._updateAriaLabelledByInfo();if(this._bUpdateTableAnnouncement){this._bUpdateTableAnnouncement=false;this._updateTableAnnouncement(i);}};o1.prototype._updateAriaLabelledByInfo=function(){var e=this._headerText.getId();if(this._oTable&&this._oTable.addAriaLabelledBy){if(this._headerText.getVisible()){if(this._oTable.getAriaLabelledBy().indexOf(e)===-1){this._oTable.addAriaLabelledBy(e);}}else{this._oTable.removeAriaLabelledBy(e);}}};o1.prototype._updateTableAnnouncement=function(i){var e=f1.getInstance();if(e){var q1=C.getLibraryResourceBundle("sap.ui.comp");var r1=this.getHeader();if(i===undefined&&this._getRowCount(false)>0){e.announce(q1.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED",[r1]));}else if(i>1){e.announce(q1.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED_MULT",[r1,i]));}else if(i===1){e.announce(q1.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED_SING",[r1,i]));}else{e.announce(q1.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED_NOITEMS",[r1]));}}};o1.prototype._addFullScreenButton=function(){if(this._oFullScreenButton){this._oToolbar.removeContent(this._oFullScreenButton);}if(this.getShowFullScreenButton()){if(!this._oFullScreenButton){this._oFullScreenButton=new j(this.getId()+"-btnFullScreen",{press:[function(){this._toggleFullScreen(!this.bFullScreen);},this]});this._oFullScreenButton.addStyleClass("sapUiCompSmartTableToolbarContent");}this._renderFullScreenButton();this._oToolbar.addContent(this._oFullScreenButton);}};o1.prototype._createToolbar=function(){var e=null;if(!this._oToolbar){e=this.getCustomToolbar();if(e){this._oToolbar=e;}else{this._oToolbar=new O({design:k1.Transparent,style:this.getTableType()==="ResponsiveTable"?l1.Standard:l1.Clear});this._oToolbar.addStyleClass("sapUiCompSmartTableToolbar");if(this.getToolbarStyleClass()){this._oToolbar.addStyleClass(this.getToolbarStyleClass());}}this._oToolbar.setLayoutData(new l({shrinkFactor:0}));}};o1.prototype._toggleShowHideDetails=function(e){if(!this._oShowHideDetailsButton||(e===this.bHideDetails)){return;}this.bHideDetails=e;if(this.bHideDetails){this._oTable.setHiddenInPopin(this._getImportanceToHide());}else{this._oTable.setHiddenInPopin([]);}this._renderShowHideDetailsButton();};o1.prototype._getImportanceToHide=function(){var e=this.getDetailsButtonSetting()||[];var i=[];if(e.length){i=e;}else{i=I.system.phone?["Low","Medium"]:["Low"];}return i;};o1.prototype._renderShowHideDetailsButton=function(){var e=C.getLibraryResourceBundle("sap.ui.comp"),i;i=this.bHideDetails?e.getText("TABLE_SHOWDETAILS_TEXT"):e.getText("TABLE_HIDEDETAILS_TEXT");this._oShowHideDetailsButton.setTooltip(i);this._oShowHideDetailsButton.setText(i);};o1.prototype._toggleFullScreen=function(e,i){if(!this._oFullScreenButton||(e===this.bFullScreen&&!i)){return;}this.bFullScreen=e;B.toggleFullScreen(this,this.bFullScreen,this._oFullScreenButton,this._toggleFullScreen);this._renderFullScreenButton();this.fireFullScreenToggled({fullScreen:e});};o1.prototype._renderFullScreenButton=function(){var e=C.getLibraryResourceBundle("sap.ui.comp"),i;i=this.bFullScreen?e.getText("CHART_MINIMIZEBTN_TOOLTIP"):e.getText("CHART_MAXIMIZEBTN_TOOLTIP");this._oFullScreenButton.setTooltip(i);this._oFullScreenButton.setText(i);this._oFullScreenButton.setIcon(this.bFullScreen?"sap-icon://exit-full-screen":"sap-icon://full-screen");};o1.prototype._createToolbarContent=function(){if(!this._oToolbar){this._createToolbar();}this._addVariantManagementToToolbar();this._addSeparatorToToolbar();this._addHeaderToToolbar();this._addSpacerToToolbar();this._addEditTogglableToToolbar();this._addShowHideDetailsButton();this._addTablePersonalisationToToolbar();this._addExportToExcelToToolbar();this._addFullScreenButton();this._bToolbarInsertedIntoItems=true;this._placeToolbar();};o1.prototype._placeToolbar=function(){if(!this.getPlaceToolbarInTable()){this.insertItem(this._oToolbar,0);}else if(this._isMobileTable){this._oTable.setHeaderToolbar(this._oToolbar);}else{this._oTable.addExtension(this._oToolbar);}};o1.prototype.getToolbar=function(){return this._oToolbar;};o1.prototype._addEditTogglableToToolbar=function(){var e;if(this._oEditButton){this._oToolbar.removeContent(this._oEditButton);}if(this.getEditTogglable()){if(!this._oEditButton){e=C.getLibraryResourceBundle("sap.ui.comp").getText("TABLE_EDITTOGGLE_TOOLTIP");this._oEditButton=new j(this.getId()+"-btnEditToggle",{icon:this.getEditable()?"sap-icon://display":"sap-icon://edit",text:e,tooltip:e,press:[function(){var i=this.getEditable();i=!i;this.setEditable(i,true);this.fireEditToggled({editable:i});},this]});this._oEditButton.addStyleClass("sapUiCompSmartTableToolbarContent");}this._oToolbar.addContent(this._oEditButton);}};o1.prototype._addHeaderToToolbar=function(){if(this._headerText){this._oToolbar.removeContent(this._headerText);}if(!this._headerText){this._headerText=new g(this.getId()+"-header");this._headerText.addStyleClass("sapMH4Style");this._headerText.addStyleClass("sapUiCompSmartTableHeader");this._headerText.addStyleClass("sapUiCompSmartTableToolbarContent");this._headerText.setLevel(this.getHeaderLevel());}this._refreshHeaderText();this._oToolbar.insertContent(this._headerText,0);};o1.prototype._addSeparatorToToolbar=function(){if(this._oSeparator){this._oToolbar.removeContent(this._oSeparator);}if(this.getHeader()&&this.getUseVariantManagement()&&this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){if(!this._oSeparator){this._oSeparator=new k(this.getId()+"-toolbarSeperator");if(!this.getShowVariantManagement()){this._oSeparator.setVisible(false);}}this._oToolbar.insertContent(this._oSeparator,0);}if(this._oToolbar){this._oToolbar.addStyleClass("sapMTBHeader-CTX");}};o1.prototype._addVariantManagementToToolbar=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oToolbar.removeContent(this._oVariantManagement);if(this.getUseVariantManagement()){this._oToolbar.insertContent(this._oVariantManagement,0);this._oVariantManagement.addStyleClass("sapUiCompSmartTableToolbarContent");if(!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(this.getShowVariantManagement());}}}};o1.prototype._addSpacerToToolbar=function(){var e=false,q1=this._oToolbar.getContent(),i,r1;if(q1){r1=q1.length;i=0;for(i;i<r1;i++){if(q1[i]instanceof h){e=true;break;}}}if(!e){this._oToolbar.addContent(new h(this.getId()+"-toolbarSpacer"));}};o1.prototype._createShowHideDetailsButton=function(){this._oShowHideDetailsButton=new c1(this.getId()+"-btnShowHideDetails",{visible:false,press:[function(){this._toggleShowHideDetails(!this.bHideDetails);},this]});this._oShowHideDetailsButton.addStyleClass("sapUiCompSmartTableToolbarContent");};o1.prototype._addShowHideDetailsButton=function(){if(this._oShowHideDetailsButton){this._oToolbar.removeContent(this._oShowHideDetailsButton);}if(this.getShowDetailsButton()&&this._isMobileTable){this.bHideDetails=true;if(!this._oShowHideDetailsButton){this._createShowHideDetailsButton();}this._renderShowHideDetailsButton();this._oToolbar.addContent(this._oShowHideDetailsButton);}};o1.prototype._addTablePersonalisationToToolbar=function(){var e;if(this._oTablePersonalisationButton){this._oToolbar.removeContent(this._oTablePersonalisationButton);}if(this.getUseTablePersonalisation()){if(!this._oTablePersonalisationButton){e=C.getLibraryResourceBundle("sap.ui.comp").getText("TABLE_PERSOBTN_TOOLTIP");this._oTablePersonalisationButton=new j(this.getId()+"-btnPersonalisation",{icon:"sap-icon://action-settings",text:e,tooltip:e,press:[function(i){this._oPersController.openDialog();},this]});S.addConfig(this._oTablePersonalisationButton,{messageBundleKey:I.os.macintosh?"SMARTTABLE_SHORTCUT_SHOW_SETTINGS_MAC":"SMARTTABLE_SHORTCUT_SHOW_SETTINGS"},this);this._oTablePersonalisationButton.addStyleClass("sapUiCompSmartTableToolbarContent");this._oTablePersonalisationButton.setVisible(this.getShowTablePersonalisation());}this._oToolbar.addContent(this._oTablePersonalisationButton);}};o1.prototype._triggerGWExport=function(){var e=C.getLibraryResourceBundle("sap.ui.comp");var i=function(){var r1=this._getRowBinding();var s1=r1.getDownloadUrl("xlsx");s1=this._removeExpandParameter(s1);if(s1&&s1.length>2048&&I.browser.msie){f.error(e.getText("DOWNLOAD_TOO_COMPLEX_TEXT"));return;}var t1={url:s1};this.fireBeforeExport({exportSettings:t1});g1(t1.url);}.bind(this);var q1=this._getRowCount(true);if(q1>10000){f.confirm(e.getText("DOWNLOAD_CONFIRMATION_TEXT",q1),{actions:[f.Action.YES,f.Action.NO],onClose:function(r1){if(r1===f.Action.YES){i();}}});}else{i();}};o1.prototype._addExportToExcelToToolbar=function(){if(this._oUseExportToExcel){this._oToolbar.removeContent(this._oUseExportToExcel);}if(!this.getUseExportToExcel()){return;}if(!this._oUseExportToExcel){var e=this.getId()+"-btnExcelExport";var i="sap-icon://excel-attachment";var q1=C.getLibraryResourceBundle("sap.ui.comp");if(this.getExportType()==="UI5Client"){this._oUseExportToExcel=this._createClientExportButton(e,i);}if(this._bTableSupportsExcelExport&&this.getExportType()==="GW"){var r1;r1=q1.getText("TABLE_EXPORT_TEXT");this._oUseExportToExcel=new j(e,{icon:i,text:r1,tooltip:r1,press:[this._triggerGWExport,this]});}this._setExcelExportEnableState();if(this._oUseExportToExcel){this._oUseExportToExcel.addStyleClass("sapUiCompSmartTableToolbarContent");}}this._oToolbar.addContent(this._oUseExportToExcel);};o1.prototype._openExportSettings=function(){var e=this;this._loadExportLibrary().then(function(){sap.ui.require(['sap/ui/export/ExportUtils'],function(i){i.getExportSettingsViaDialog(e._cachedExcelSettings,e).then(function(q1){e._cachedExcelSettings=q1;e._triggerUI5ClientExport(q1);});});});};o1.prototype._createClientExportButton=function(e,i){var q1=C.getLibraryResourceBundle("sap.ui.comp");var r1={fileName:this.getHeader()};if(!this._cachedExcelSettings){this._cachedExcelSettings=r1;}var s1=new a1(e,{icon:i,tooltip:q1.getText("TABLE_EXPORT_TEXT"),type:i1.Ghost,buttonMode:j1.Split,useDefaultActionOnly:true,defaultAction:[function(){this._triggerUI5ClientExport(r1);},this],menu:[new _({items:[new b1({text:q1.getText("QUICK_EXPORT"),press:[function(){this._triggerUI5ClientExport(r1);},this]}),new b1({text:q1.getText("EXPORT_WITH_SETTINGS"),press:[this._openExportSettings,this]})]})]});S.addConfig(s1._getButtonControl(),{addAccessibilityLabel:true,messageBundleKey:I.os.macintosh?"SMARTTABLE_SHORTCUT_EXPORT_TO_EXCEL_MAC":"SMARTTABLE_SHORTCUT_EXPORT_TO_EXCEL"},this);return s1;};o1.prototype.onkeydown=function(e){if(e.isMarked()){return;}if((e.metaKey||e.ctrlKey)&&e.shiftKey&&e.which===K.E){if(this.getUseExportToExcel()&&this.getExportType()==="UI5Client"&&this._oUseExportToExcel&&this._oUseExportToExcel.getEnabled()){this._openExportSettings();e.setMarked();e.preventDefault();}}else if((e.metaKey||e.ctrlKey)&&e.which===K.COMMA){if(this.getUseTablePersonalisation()&&this._oTablePersonalisationButton&&this._oTablePersonalisationButton.getVisible()){this._oPersController.openDialog();e.setMarked();e.preventDefault();}}};o1.prototype._loadExportLibrary=function(){if(!this._oExportLibLoadPromise){this._oExportLibLoadPromise=C.loadLibrary("sap.ui.export",true);}return this._oExportLibLoadPromise;};o1.prototype._getColumnLabel=function(e){var i;if(typeof e==='string'){e=this._getColumnByKey(e);}if(!e){return null;}if(e.getLabel){i=e.getLabel();}if(e.getHeader){i=e.getHeader();}return(i&&i.getText)?i.getText():null;};o1.prototype._getColumnWidthNumber=function(e){if(e.indexOf("em")>0){return Math.round(parseFloat(e));}if(e.indexOf("px")>0){return Math.round(parseInt(e)/16);}return"";};o1.prototype._triggerUI5ClientExport=function(e){var i=this._createExportColumnConfiguration(e);if(!i||!i.length){f.error(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS_EXPORT"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});return;}var q1=this._getRowBinding();var r1=this._getColumnLabel.bind(this);var s1={workbook:{columns:i,hierarchyLevel:(this._isTreeTable&&q1.getTreeAnnotation)?q1.getTreeAnnotation("hierarchy-level-for"):undefined},dataSource:q1,fileName:e?e.fileName:this.getHeader()};this._loadExportLibrary().then(function(){sap.ui.require(['sap/ui/export/ExportUtils','sap/ui/export/Spreadsheet'],function(t1,u1){var v1=Promise.resolve();if(e.includeFilterSettings){v1=t1.parseFilterConfiguration(q1,r1).then(function(w1){if(e.includeFilterSettings&&w1){s1.workbook.context={metaSheetName:w1.name,metainfo:[w1]};}});}v1.then(function(){var w1={splitCells:false,includeFilterSettings:false};if(e){w1.splitCells=e.splitCells;w1.includeFilterSettings=e.includeFilterSettings;}var x1=new u1(s1);x1.attachBeforeExport(function(z1){this.fireBeforeExport({exportSettings:z1.getParameter('exportSettings'),userExportSettings:w1});},this);var y1=function(){x1.destroy();};x1.build().then(y1,y1);}.bind(this));}.bind(this));}.bind(this));};o1.prototype._createExportColumnConfiguration=function(e){var q1,i,r1,s1,t1,u1,v1,w1,x1,y1,z1,A1,B1,C1,D1,E1,F1,G1,H1=[];var I1=e&&e.splitCells;var J1=function(L1,M1){return'{'+(parseInt(M1)-1)+'}';};q1=this._isMobileTable?this._oTable.getColumns(true):this._oTable.getColumns();r1=q1.length;for(i=0;i<r1;i++){v1=null;w1=null;x1=null;s1=q1[i];if(s1.getVisible()){t1=s1.data("p13nData");if(s1.getLeadingProperty){v1=s1.getLeadingProperty();}if(!v1&&t1){v1=t1["leadingProperty"];}if(Array.isArray(v1)){v1=v1[0];}if(v1){u1=this._getColumnLabel(s1);C1=s1.getWidth().toLowerCase()||t1.width||"";C1=this._getColumnWidthNumber(C1);D1=t1.type==="numeric"?"Number":t1.type;G1=t1.typeInstance;F1=null;E1=null;if(t1.unit){D1=t1.isCurrency?"Currency":"Number";if(I1){x1=t1.unit;}}else if(G1&&G1.isA("sap.ui.comp.odata.type.FiscalDate")){var K1=G1.getFormatter();w1=K1.getTemplate().replace(/\$(\d)/g,J1);E1=K1.getRegExPattern().toString().slice(1,-1);D1="String";}else if(D1!="date"&&G.isDateOrTime(t1.edmType)){D1=G.getTypeName(t1.edmType);if(D1==="DateTimeOffset"){D1="DateTime";}}else if(D1==="stringdate"){D1="Date";E1="YYYYMMDD";}else if(D1==="boolean"){D1="Boolean";F1=G.getType(t1.edmType);}else if(t1.description){D1="String";if(!I1){w1=z.getFormattedExpressionFromDisplayBehaviour(t1.displayBehaviour,"{0}","{1}");}else if(t1.displayBehaviour==="descriptionOnly"){v1=t1.description;}else if(t1.displayBehaviour!=="idOnly"){x1=t1.description;}}else if(t1.isDigitSequence){D1="Number";}else if(D1==="string"){D1="String";}else if(D1==="date"){D1="Date";}else if(D1==="time"){D1="Time";}H1.push({columnId:s1.getId(),property:t1.description&&!I1?[v1,t1.description]:v1,type:D1,inputFormat:E1,label:u1?u1:v1,width:C1,textAlign:s1.getHAlign(),template:w1,trueValue:(D1==="Boolean"&&F1)?F1.formatValue(true,"string"):undefined,falseValue:(D1==="Boolean"&&F1)?F1.formatValue(false,"string"):undefined,unitProperty:(D1==="Currency"||(D1==="Number"&&!I1))?t1.unit:undefined,displayUnit:D1==="Currency"&&!I1,precision:t1.precision,scale:t1.scale});if(x1){y1=this._getColumnByKey(x1);z1=u1;u1=null;if(y1){u1=this._getColumnLabel(y1);C1=y1.getWidth().toLowerCase()||"";C1=this._getColumnWidthNumber(C1);B1=y1.getHAlign();}else{A1=this._mFieldMetadataByKey[x1];if(A1){u1=A1.label;C1=A1.width;}}H1.push({columnId:s1.getId()+"-additionalProperty",property:x1,type:"String",label:u1||(z1?z1+" (2)":x1),width:C1,textAlign:B1});}}}}return H1;};o1.prototype._removeExpandParameter=function(e){var i=e.replace(new RegExp("([\\?&]\\$expand=[^&]+)(&?)"),function(q1,r1,s1){return s1?r1.substring(0,1):"";});return i;};o1.prototype._getRowCount=function(e){var i=this._getRowBinding();if(!i){return 0;}var q1=0;if(e&&i.getTotalSize){q1=i.getTotalSize();}else{q1=i.getLength();}if(q1<0||q1==="0"){q1=0;}return q1;};o1.prototype._setExcelExportEnableState=function(){if(this._oUseExportToExcel){var i=this._getRowCount();this._oUseExportToExcel.setEnabled(i>0);}};o1.prototype._createPersonalizationController=function(){if(this._oPersController||!this.getUseTablePersonalisation()){return;}var e=this._oP13nDialogSettings;e=this._setIgnoreFromPersonalisationToSettings(e);e=e||{};if(this._isTreeTable){e.stableColumnKeys=[];e.stableColumnKeys.push(this._aColumnKeys[0]);}if(this._bIsFilterPanelEnabled){e.filter=e.filter?e.filter:{};e.filter.createMessageStrip=this._getP13nFilterMessageStrip.bind(this);}this._oPersController=new y(this.getId()+"-persoController",{table:this._oTable,columnKeys:this._aColumnKeys,setting:e,resetToInitialTableState:!this.getUseVariantManagement(),beforePotentialTableChange:[this._beforePersonalisationModelDataChange,this],afterPotentialTableChange:[this._afterPersonalisationModelDataChange,this],afterP13nModelDataChange:[this._personalisationModelDataChange,this],requestColumns:[this._personalisationRequestColumns,this]});};o1.prototype._setIgnoreFromPersonalisationToSettings=function(e){var i=P.createArrayFromString(this.getIgnoreFromPersonalisation());if(i.length){if(!e){e={};}var q1=function(r1){if(!e[r1]){e[r1]={};}e[r1].ignoreColumnKeys=i;};q1("filter");q1("sort");q1("group");q1("columns");}return e;};o1.prototype._getRowBinding=function(){if(this._oTable){return this._oTable.getBinding(this._sAggregation);}};o1.prototype.setEntitySet=function(e){this.setProperty("entitySet",e,true);this._initialiseMetadata();return this;};o1.prototype._initialiseMetadata=function(e){var i=this,q1=i;if(e){q1=e.getSource();}if(!q1.bIsInitialised){E.handleModelInit(q1,q1._onMetadataInitialised);}};o1.prototype._onMetadataInitialised=function(){this._bMetaModelLoadAttached=false;if(!this.bIsInitialised){this._createTableProvider();if(this._oTableProvider){this._aTableViewMetadata=this._oTableProvider.getTableViewMetadata();if(this._aTableViewMetadata){if(!this._isMobileTable&&this.getDemandPopin()){this.setDemandPopin(false);Q.error("use SmartTable property 'demandPopin' only  with responsive table, property has been set to false");}this.detachModelContextChange(this._initialiseMetadata,this);this.bIsInitialised=true;this._bTableSupportsExcelExport=this._oTableProvider.getSupportsExcelExport();this._bMultiUnitBehaviorEnabled=this._oTableProvider.getMultiUnitBehaviorEnabled();this._listenToSmartFilter();this._createVariantManagementControl();this._createToolbarContent();this._aAlwaysSelect=this._oTableProvider.getRequestAtLeastFields();this._createContent();this._createPersonalizationController();this._oEditModel=new J({editable:this.getEditable()});this.setModel(this._oEditModel,"sm4rtM0d3l");this.attachEvent("_change",this._onPropertyChange,this);this.fireInitialise();if(!this._oVariantManagement||(this._oVariantManagement&&this._bVariantInitialised)){this._checkAndTriggerBinding();}}}}};o1.prototype._checkAndTriggerBinding=function(){if(!this._bAutoBindingTriggered){this._bAutoBindingTriggered=true;if(this.getEnableAutoBinding()){if(this._oSmartFilter){if(this._oSmartFilter.isInitialised()){this._oSmartFilter.search();}else{this._oSmartFilter.attachEventOnce("initialise",function(){this._oSmartFilter.search();},this);}}else{this._reBindTable();}}}};o1.prototype._aStaticProperties=["entitySet","ignoredFields","initiallyVisibleFields","ignoreFromPersonalisation","tableType","useTablePersonalisation","enableAutoBinding","persistencyKey","smartFilterId","showDetailsButton","enableAutoColumnWidth"];o1.prototype._aToolbarRelatedProperties=["useExportToExcel","exportType","showFullScreenButton","editTogglable","placeToolbarInTable"];o1.prototype._onPropertyChange=function(e){var i=e.getParameter("name");if(this._aStaticProperties.indexOf(i)>-1){Q.error("Property "+i+" cannot be changed after the SmartTable with id "+this.getId()+" is initialised");}if(this._oToolbar&&this._aToolbarRelatedProperties.indexOf(i)>-1){if(i==="exportType"&&this._oUseExportToExcel){this._oUseExportToExcel.destroy();this._oUseExportToExcel=null;}this._createToolbarContent();}};o1.prototype._createTableProvider=function(){var e,i,q1;i=this.getEntitySet();q1=this.getIgnoredFields();e=this.getModel();if(e&&i){if(this._aExistingColumns.length){if(q1){q1+=","+this._aExistingColumns.toString();}else{q1=this._aExistingColumns.toString();}}this._oTableProvider=new n({entitySet:i,ignoredFields:q1,initiallyVisibleFields:this.getInitiallyVisibleFields(),isEditableTable:this.getEditable(),smartTableId:this.getId(),isAnalyticalTable:!!this._isAnalyticalTable,isMobileTable:!!this._isMobileTable,dateFormatSettings:this.data("dateFormatSettings"),useUTCDateTime:this.data("useUTCDateTime"),currencyFormatSettings:this.data("currencyFormatSettings"),defaultDropDownDisplayBehaviour:this.data("defaultDropDownDisplayBehaviour"),useSmartField:this.data("useSmartField"),useSmartToggle:this.data("useSmartToggle"),skipAnnotationParse:this.data("skipAnnotationParse"),lineItemQualifier:this.data("lineItemQualifier"),presentationVariantQualifier:this.data("presentationVariantQualifier"),enableInResultForLineItem:this.data("enableInResultForLineItem"),_semanticKeyAdditionalControl:this.getAggregation("semanticKeyAdditionalControl"),model:e,semanticObjectController:this.getSemanticObjectController(),showDetailsButton:this.getShowDetailsButton(),enableAutoColumnWidth:this.getEnableAutoColumnWidth()});}};o1.prototype._listenToSmartFilter=function(){var e,i,q1=false;e=this.getSmartFilterId();this._oSmartFilter=this._findControl(e,"sap.ui.comp.filterbar.FilterBar");if(this._oSmartFilter){this._oSmartFilter.attachSearch(this._reBindTable,this);this._oSmartFilter.attachFilterChange(this._filterChangeEvent,this);q1=true;}i=this.getInitialNoDataText();if(i){q1=i==="$FILTERBAR";if(!q1&&i!=="$NO_FILTERBAR"){this._setNoDataText(i);return;}}if(q1){this._setNoDataText(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_DATA"));}else{this._setNoDataText(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_DATA_WITHOUT_FILTERBAR"));}};o1.prototype._filterChangeEvent=function(){if(this._isTableBound()&&this._oSmartFilter&&!this._oSmartFilter.getLiveMode()&&!this._oSmartFilter.isDialogOpen()){this._showOverlay(true);}};o1.prototype._showOverlay=function(e){if(e){var i={show:true};this.fireShowOverlay({overlay:i});e=i.show;}this._oTable.setShowOverlay(e);};o1.prototype._findControl=function(i,e){var q1,r1;if(i){q1=C.byId(i);if(!q1||!q1.isA(e)){r1=this._getView();if(r1){q1=r1.byId(i);}}if(q1&&!q1.isA(e)){q1=undefined;}}return q1;};o1.prototype._getView=function(){if(!this._oView){var e=this.getParent();while(e){if(e.isA("sap.ui.core.mvc.View")){this._oView=e;break;}e=e.getParent();}}return this._oView;};o1.prototype.rebindTable=function(e){this._reBindTable(null,e);};o1.prototype._reBindTable=function(e,q1){var r1,s1,t1,i,u1,v1,w1=[],x1,y1,z1,A1,B1,C1,D1,E1={},F1={preventTableBind:false};this._bUpdateTableAnnouncement=e&&e.getId&&e.getId()==="search";t1=this._getTablePersonalisationData()||{};if(this._oMessageFilter){x1=this._oMessageFilter;}else{x1=t1.filters;y1=t1.excludeFilters;}D1=t1.sorters;if(this._oSmartFilter){v1=this._oSmartFilter.getFilters();E1=this._oSmartFilter.getParameters()||{};}if(v1&&v1.length){if(y1){w1=[new s([v1[0],y1],true)];}else{w1=v1;}}else if(y1){w1=[y1];}if(x1){x1=w1.concat(x1);}else{x1=w1;}z1=this._getRequestAtLeastFields();B1=this._getRelevantColumnPaths();A1=B1["select"];if(!A1||!A1.length){A1=z1;}else{u1=z1.length;for(i=0;i<u1;i++){if(A1.indexOf(z1[i])<0){A1.push(z1[i]);}}}if(this._mSelectExpandForGroup&&this._mSelectExpandForGroup.select){this._mSelectExpandForGroup.select.forEach(function(I1){if(A1.indexOf(I1)<0){A1.push(I1);}});}if(A1.length){E1["select"]=A1.toString();C1=B1["expand"]||[];if(this._mSelectExpandForGroup&&this._mSelectExpandForGroup.expand){this._mSelectExpandForGroup.expand.forEach(function(I1){if(C1.indexOf(I1)<0){C1.push(I1);}});}if(C1.length){E1["expand"]=C1.join(",");}}E1["useBatchRequests"]=true;if(!D1){D1=[];}F1.filters=x1;F1.sorter=D1;F1.parameters=E1;F1.length=undefined;F1.startIndex=undefined;F1.events={};this.fireBeforeRebindTable({bindingParams:F1,messageFilterActive:!!this._bApplyFilter});if(!F1.preventTableBind){D1=F1.sorter;x1=F1.filters;E1=F1.parameters;A1=F1.parameters["select"];if(!A1||!A1.length){f.error(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});return;}s1=this.getTableBindingPath()||("/"+this.getEntitySet());if(this._oTable.resumeUpdateAnalyticalInfo){this._oTable.resumeUpdateAnalyticalInfo(true,false);}this._bDataLoadPending=true;this._bIgnoreChange=false;if(this._bForceTableUpdate){q1=true;this._bForceTableUpdate=false;}if(!q1){r1=this._oTable.getBinding(this._sAggregation);if(r1&&r1.mParameters){q1=!(W(E1,r1.mParameters,true)&&W(E1.custom,r1.mParameters.custom)&&!F1.length&&!F1.startIndex&&s1===r1.getPath());}}if(!this._bNoDataUpdated){this._bNoDataUpdated=true;this._setNoDataText();}if(!r1||!this._bIsTableBound||q1){o1._addBindingListener(F1,"change",this._onBindingChange,this);o1._addBindingListener(F1,"dataRequested",this._onDataRequested,this);o1._addBindingListener(F1,"dataReceived",this._onDataReceived,this);if(this._isMobileTable){var G1=this._oTable?this._oTable.getColumns():[];var H1=this._oTemplate?this._oTemplate.getCells():[];if(G1.length===H1.length){G1.forEach(function(I1,J1){H1[J1].setBindingContext(I1.getVisible()?undefined:null);});}}this._oTable.bindRows({path:s1,filters:x1,sorter:D1,parameters:E1,length:F1.length,startIndex:F1.startIndex,template:this._oTemplate,events:F1.events});this._bIsTableBound=true;}else{r1.sort(D1);r1.filter(x1,"Application");}this._showOverlay(false);}};o1.prototype._onDataRequested=function(e){if(e&&e.getParameter&&e.getParameter("__simulateAsyncAnalyticalBinding")){return;}this._bIgnoreChange=true;this.fireDataRequested(e.getParameters());};o1.prototype._onDataReceived=function(e){if(e&&e.getParameter&&e.getParameter("__simulateAsyncAnalyticalBinding")){return;}this._bIgnoreChange=false;this._onDataLoadComplete(e,true);this.fireDataReceived(e);};o1.prototype._onBindingChange=function(e){if(this._bIgnoreChange){return;}var i,q1=false;i=(e&&e.getParameter)?e.getParameter("reason"):undefined;if(!i||i==="filter"||i==="context"||(!this._bDataLoadPending&&i==="change")){q1=true;}if(i==="change"||q1){this._onDataLoadComplete(e,q1);}};o1._addBindingListener=function(e,i,q1,r1){if(!e.events){e.events={};}if(!e.events[i]){e.events[i]=q1.bind(r1);}else{var s1=e.events[i];e.events[i]=function(){q1.apply(r1,arguments);s1.apply(r1,arguments);};}};o1.prototype._onDataLoadComplete=function(e,i){if(this._bDataLoadPending||i){this._bDataLoadPending=false;this.updateTableHeaderState();}};o1.prototype._isTableBound=function(){if(this._bIsTableBound){return true;}if(this._oTable){return this._oTable.isBound(this._sAggregation);}return false;};o1.prototype.setNoData=function(e){this._oNoData=e;if(this._bNoDataUpdated||this._isTableBound()){this._setNoDataText();}return this;};o1.prototype.getNoData=function(){return this._oNoData;};o1.prototype._setNoDataText=function(e){var i=this._oTable.setNoData;if(!i){i=this._oTable.setNoDataText;}if(!i){return;}var q1=e;if(!q1){q1=this.getNoData();}if(!q1){q1=C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_RESULTS");}i.call(this._oTable,q1,true);};o1.prototype.updateTableHeaderState=function(){this._refreshHeaderText();this._setExcelExportEnableState();};o1.prototype._createContent=function(){var i,e=0,q1,r1,s1,t1=[];if(this._aExistingColumns&&this._aExistingColumns.length){this._aColumnKeys=[].concat(this._aExistingColumns.reverse());}r1=this._parseIndexedColumns();e=this._aTableViewMetadata.length;for(i=0;i<e;i++){q1=this._aTableViewMetadata[i];if(q1.isInitiallyVisible){this._aColumnKeys.push(q1.name);}else{t1.push(q1.name);}if(!(q1.isInitiallyVisible||q1.inResult)){this._mLazyColumnMap[q1.name]=q1;}else{s1=this._createColumnForField(q1);this._oTable.addColumn(s1);}this._mFieldMetadataByKey[q1.name]=q1;}this._insertIndexedColumns(r1);this._aColumnKeys=this._aColumnKeys.concat(t1);if(this._isMobileTable&&this.getEnableAutoColumnWidth()){this.setDemandPopin(true);this._oTable.setFixedLayout("Strict");this._oTable.setContextualWidth("auto");}this._updateColumnsPopinFeature();if(this.getShowDetailsButton()){this._oTable.setHiddenInPopin(this._getImportanceToHide());}this._storeInitialColumnSettings();};o1.prototype._createColumnForField=function(e){var i,q1;q1=this.getId()+"-"+e.name.replace(/[^A-Za-z0-9_.:-]+/g,"_");i=this._createColumn(e,q1);e.isColumnCreated=true;i.data("p13nData",{columnKey:e.name,leadingProperty:e.name,additionalProperty:e.additionalProperty,navigationProperty:e.navigationProperty,sortProperty:e.sortable?e.name:undefined,filterProperty:e.filterable?e.name:undefined,isGroupable:e.sortable&&e.filterable&&e.aggregationRole==="dimension",fullName:e.hasValueListAnnotation?e.fullName:null,type:e.filterType,typeInstance:e.modelType,maxLength:e.maxLength,precision:e.precision,scale:e.scale,align:e.align,edmType:e.type,displayBehaviour:e.displayBehaviour,description:e.description,isDigitSequence:e.isDigitSequence,isCurrency:e.isCurrencyField,unit:e.unit,width:e.width,aggregationRole:e.aggregationRole,nullable:e.nullable!=="false"});if(e.filterable&&i.setFilterProperty){i.setFilterProperty(e.name);}if(e.sortable&&i.setSortProperty){i.setSortProperty(e.name);}this._registerContentTemplateEvents(e.template);return i;};o1.prototype._parseIndexedColumns=function(){var i,e,q1,r1,s1,t1,u1,v1,w1;var x1=this._oTable.getColumns();var y1=null;if(this._oTemplate&&this._oTemplate.getCells){y1=this._oTemplate.getCells();}if(!x1){return null;}r1=[];e=x1.length;for(i=0;i<e;i++){q1=x1[i];s1=q1.data("p13nData");t1=null;u1=null;if(s1){t1=s1.columnIndex;u1=s1.columnKey;}v1=-1;if(t1!==null&&t1!==undefined){v1=parseInt(t1);}if(!isNaN(v1)&&v1>-1){if(y1){w1=y1[i];this._oTemplate.removeCell(w1);}else{w1=null;}this._aColumnKeys.splice(i-r1.length,1);r1.push({index:v1,columnKey:u1,column:q1,template:w1});this._oTable.removeColumn(q1);}}r1.sort(function(z1,A1){return z1.index-A1.index;});return r1;};o1.prototype._insertIndexedColumns=function(e){var i,q1,r1;if(!e){return;}q1=e.length;for(i=0;i<q1;i++){r1=e[i];this._aColumnKeys.splice(r1.index,0,r1.columnKey);this._oTable.insertColumn(r1.column,r1.index);if(r1.template){this._oTemplate.insertCell(r1.template,r1.index);}}};o1.prototype._updateColumnsPopinFeature=function(){if(!this._isMobileTable||!this.getDemandPopin()){return;}if(!this._oTable.getAutoPopinMode()){this._oTable.setAutoPopinMode(true);}var e=this._oTable.getColumns(true);if(!e){return;}e=e.filter(function(i){return i.getVisible();});e.forEach(function(i){if(i.getPopinDisplay()!="WithoutHeader"){i.setPopinDisplay("Inline");}});};o1.prototype._storeInitialColumnSettings=function(){this._aInitialSorters=[];P.createSort2Json(this._oTable,this._aInitialSorters,P.createArrayFromString(this.getIgnoreFromPersonalisation()));};o1.prototype._deactivateColumnsPopinFeature=function(){if(!this._isMobileTable){return;}if(this._oTable.getAutoPopinMode()){this._oTable.setAutoPopinMode(false);}var e=this._oTable.getColumns();if(!e){return;}var q1,r1=e.length;for(var i=0;i<r1;i++){q1=e[i];q1.setDemandPopin(false);q1.setMinScreenWidth("1px");}};o1.prototype._registerContentTemplateEvents=function(e){if(e.isA("sap.ui.comp.SmartToggle")){e=e.getEdit();}if(e&&e.attachChange){e.attachChange(function(i){this.fireFieldChange({changeEvent:i});},this);}};o1.prototype._updateInitialColumns=function(){var i=this._oTable.getColumns(),q1=i?i.length:0,r1,s1,t1;while(q1--){t1=null;r1=i[q1];if(r1){s1=r1.data("p13nData");if(typeof s1==="string"){try{s1=JSON.parse(s1);}catch(e){}if(s1){r1.data("p13nData",s1);}}if(s1){t1=s1["columnKey"];}if(t1){this._aExistingColumns.push(t1);}}}};o1.prototype._getRelevantColumnPaths=function(){var e={},q1=[],r1=[],s1=this._oTable.getColumns(),i,t1=s1?s1.length:0,u1,v1,w1,x1,y1;var z1=function(w1,A1){var B1,C1;if(w1){C1=w1.split(",");B1=C1.length;while(B1--){w1=C1[B1];if(w1&&A1.indexOf(w1)<0){A1.push(w1);}}}};for(i=0;i<t1;i++){u1=s1[i];w1=null;if(u1.getVisible()||(u1.getInResult&&u1.getInResult())){if(u1.getLeadingProperty){w1=u1.getLeadingProperty();}v1=u1.data("p13nData");if(v1){if(!w1){w1=v1["leadingProperty"];}x1=v1["additionalProperty"];y1=v1["navigationProperty"];}if(w1&&q1.indexOf(w1)<0){q1.push(w1);}z1(x1,q1);z1(y1,r1);}}e["select"]=q1;e["expand"]=r1;return e;};o1.prototype._createTable=function(){var e=this.getItems(),i=e?e.length:0,q1,r1;this._sAggregation="rows";while(i--){q1=e[i];if(q1 instanceof w||q1 instanceof R){break;}q1=null;}if(q1){this._oTable=q1;if(q1 instanceof u){this._isAnalyticalTable=true;}else if(q1 instanceof R){this._isMobileTable=true;this._oTemplate=(q1.getItems()&&q1.getItems().length>0)?q1.getItems()[0]:new b();q1.removeAllItems();}else if(q1 instanceof x){this._isTreeTable=true;}this._updateInitialColumns();}else{r1=this.getId()+"-ui5table";if(this.getTableType()==="AnalyticalTable"){this._isAnalyticalTable=true;this._oTable=new u(r1,{enableCustomFilter:true});}else if(this.getTableType()==="ResponsiveTable"){this._isMobileTable=true;this._oTable=new R(r1,{growing:true,autoPopinMode:this.getDemandPopin()});this._oTemplate=new b();}else if(this.getTableType()==="TreeTable"){this._isTreeTable=true;this._oTable=new x(r1,{selectionMode:"MultiToggle"});}else{this._oTable=new w(r1,{selectionMode:"MultiToggle"});}if(this._oTable.setVisibleRowCountMode){this._oTable.setVisibleRowCountMode("Auto");}this.insertItem(this._oTable,2);}if(!this._oTable.getLayoutData()){if(this._oTable instanceof R||(this._oTable.getVisibleRowCountMode&&this._oTable.getVisibleRowCountMode()!=="Auto")){this._oTable.setLayoutData(new l({growFactor:1,baseSize:"auto"}));}else{this._oTable.setLayoutData(new l({growFactor:1,baseSize:"0%"}));}}this._oTable.addStyleClass("sapUiCompSmartTableInnerTable");this._oTable.setEnableBusyIndicator(true);this._oTable.setBusyIndicatorDelay(100);if(this._oTable.setEnableCustomFilter){this._oTable.setEnableCustomFilter(this.getEnableCustomFilter());}if(this._oTable.setShowColumnVisibilityMenu){this._oTable.setShowColumnVisibilityMenu(false);}if(this._oTable.getEnableCustomFilter&&this._oTable.getEnableCustomFilter()&&this._bIsFilterPanelEnabled){if(this._oTable.setEnableCellFilter){this._oTable.setEnableCellFilter(false);}if(this._oTable.attachCustomFilter){this._oTable.attachCustomFilter(this._onCustomFilter,this);}}if(this._isAnalyticalTable){this._createColumn=this._createAnalyticalColumn;}else if(this._isMobileTable){if(this.getUseTablePersonalisation()){this._oTable.bActiveHeaders=true;this._oTable.attachEvent("columnPress",this._onColumnPress,this);this._oTable.attachSort=function(){this.attachEvent("sort",arguments[0],arguments[1],arguments[2]);};this._oTable.detachSort=function(){this.detachEvent("sort",arguments[0],arguments[1]);};}this._sAggregation="items";this._createColumn=this._createMobileColumn;this._oTable.bindRows=this._oTable.bindItems;if(this.getShowDetailsButton()){this._oTable.attachEvent("popinChanged",this._onPopinChanged,this);}}if(!this._isMobileTable){this._oTable.attachRowsUpdated(function(){this._setExcelExportEnableState();},this);}if(this._oTable._setLargeDataScrolling){this._oTable._setLargeDataScrolling(true);}this._oTable.attachPaste(this._onInnerTablePaste,this);};o1.prototype._createResponsivePopover=function(){this._oFilterButton=new Z({text:C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_RP_FILTER"),icon:"sap-icon://filter",press:[function(e){this._onCustomFilter(e);},this]});this._oSortButton=new $({sort:[function(e){this._onCustomSort(e);},this]});this._oColumnHeaderPopover=new Y({items:[this._oSortButton,this._oFilterButton]});};o1.prototype._onColumnPress=function(e){this._oColumnClicked=e.getParameter("column");var i=this._oColumnClicked.data("p13nData");if(!i){return;}var q1=i.filterProperty;var r1=i.sortProperty;if(!this._oColumnHeaderPopover){this._createResponsivePopover();}this._oFilterButton.setVisible(!!q1&&this._bIsFilterPanelEnabled);this._oSortButton.setVisible(!!r1&&this._bIsSortPanelEnabled);if((q1&&this._bIsFilterPanelEnabled)||(r1&&this._bIsSortPanelEnabled)){this._oColumnHeaderPopover.removeAllAriaLabelledBy();this._oColumnHeaderPopover.addAriaLabelledBy(this._oColumnClicked.getHeader());this._oColumnHeaderPopover.openBy(this._oColumnClicked);}};o1.prototype._filterByDataStateError=function(e){if(!e){var i=!!this._oMessageFilter;this._oMessageFilter=null;this._createInfoToolbar();if(i){this.rebindTable();}}else{var q1=this._getRowBinding();if(q1&&this._oDataStateIndicator){var r1=this._oDataStateIndicator,s1=r1.getFilter(),t1=s1?function(u1){return s1(u1,r1.getControl());}:undefined;q1.requestFilterForMessages(t1).then(function(u1){if(!u1){return;}this._oMessageFilter=u1;this.rebindTable();this._createInfoToolbar(true);}.bind(this));}}};o1.prototype._onCustomSort=function(){var e=this._oColumnClicked.data("p13nData");if(e){if(!e.sorted){e.sorted={"ascending":true};this._oColumnClicked.data("p13nData",e);}else{e.sorted.ascending=!e.sorted.ascending;}}var i=e.sorted;var q1=i&&i.ascending;this._oTable.fireEvent("sort",{column:this._oColumnClicked,sortOrder:q1?m1.Ascending:m1.Descending,columnAdded:false});};o1.prototype._onCustomFilter=function(e){this._showTableFilterDialog(e.getParameter("column")||this._oColumnClicked);};o1.prototype._onPopinChanged=function(e){if(!this._oShowHideDetailsButton){this._createShowHideDetailsButton();}var i=e.getParameter("hasPopin");var q1=e.getParameter("hiddenInPopin");var r1=e.getSource().getVisibleItems();if(r1.length&&(q1.length||(i&&!this.bHideDetails))){this._oShowHideDetailsButton.setVisible(true);}else{this._oShowHideDetailsButton.setVisible(false);}};o1.prototype.getTable=function(){return this._oTable;};o1.prototype._showTableFilterDialog=function(e){if(this._oPersController){var i={filter:{visible:true}};if(e){i.filter["payload"]={column:e};}this._oPersController.openDialog(i);}};o1.prototype.getEnableAutoColumnWidth=function(){if(document.location.search.includes("sap-ui-xx-enableAutoColumnWidth")){return true;}return this.getProperty("enableAutoColumnWidth");};function p1(e,i){i=i||0;e=e||"";if(e.length<=i){return i;}if(!o1.oCanvasContext){var q1=function(){o1.oCanvasContext.font=h1.get("sapMFontMediumSize")+" "+h1.get("sapUiFontFamily");delete o1.fBooleanWidth;};o1.oCanvasContext=document.createElement("canvas").getContext("2d");C.attachThemeChanged(q1);q1();}return o1.oCanvasContext.measureText(e).width/parseFloat(M.BaseFontSize);}o1.prototype._calcColumnWidth=function(e,i,q1){q1=Object.assign({max:20,min:i?2:3,label:i?false:true,labelSplit:this._isMobileTable,defaultWidth:i?4:8,epsilon:i?0:0.05,padding:this._isMobileTable?1:1.25},q1);if(!e){return q1.defaultWidth;}var r1,s1=0,t1="w",u1=0,v1=q1.min,w1=q1.max,x1=q1.padding,y1=e.displayBehaviour,z1=e.type||"",A1={"Edm.Int16":6,"Edm.Int32":11,"Edm.Int64":13,"Edm.Float":7,"Edm.Single":7,"Edm.Double":14,"Edm.Decimal":17};if(i||y1!="descriptionOnly"){if(e.isImageURL||z1=="Edm.Byte"||z1=="Edm.SByte"){s1=v1;}else if(z1.startsWith("Edm.Date")||z1.startsWith("Edm.Time")){r1=new Date(2023,9,26,22,47,58);x1+=0.5;if(z1=="Edm.Time"){var B1=r1.getTimezoneOffset()*60*1000;r1=D.dateToEdmTime(r1);r1.ms-=B1;}}else if(z1 in A1){var C1=Math.min(e.precision||20,A1[z1]);r1=Math.pow(10,C1-(e.scale||0)-1);}else if(z1=="Edm.Boolean"){if(!o1.hasOwnProperty("fBooleanWidth")){var D1=p1(e.modelType.formatValue(true,"string"),v1);var E1=p1(e.modelType.formatValue(false,"string"),v1);o1.fBooleanWidth=Math.max(D1,E1);}s1=o1.fBooleanWidth;}else if(e.type=="Edm.String"){var F1=+e.maxLength||0;if(F1<=v1){s1=v1;}else if(F1<15){r1=t1.repeat(F1);}else{var G1=p1(t1.repeat(F1),v1);s1=Math.log10(G1)*(w1/2);}}else{s1=q1.defaultWidth;}if(r1){var H1=e.modelType.formatValue(r1,"string");s1=p1(H1,v1);}}if(!i&&y1!="idOnly"&&e.additionalProperty&&this._oTableProvider){e.additionalProperty.split(",").forEach(function(K1){var L1=this._oTableProvider.getFieldMetadata(K1);var M1=Object.assign({padding:1,max:w1-s1-1},e.vertical&&{padding:0,max:w1});var N1=this._calcColumnWidth(L1,true,M1);if(e.vertical){s1=Math.max(N1,s1);}else{s1+=N1;}},this);}if(q1.label){var I1=(e.label||e.fieldLabel||"").trim();var J1=I1.length;if(s1<w1&&s1<J1&&J1>v1){if(q1.labelSplit&&J1>w1){I1=I1.split(" ").reduce(function(K1,L1){return(K1.length>L1.length)?K1:L1;},"");if(I1.length<J1/2){I1+=t1;}}u1=p1(I1,v1);}}s1=Math.max(v1,s1,u1);s1=Math.min(s1+x1+q1.epsilon,w1);s1=Math.round(s1*100)/100;return s1;};o1.prototype._createColumn=function(e,i){var q1=new v(i,{autoResizable:true,hAlign:e.align,width:e.width||this._calcColumnWidth(e)+"rem",visible:e.isInitiallyVisible,label:new d(i+"-header",{textAlign:e.align,text:e.label}),sorted:e.sorted,sortOrder:e.sortOrder,tooltip:e.quickInfo,showSortMenuEntry:e.sortable&&this._bIsSortPanelEnabled,showFilterMenuEntry:e.filterable&&this._bIsFilterPanelEnabled,name:e.fieldName,template:e.template});return q1;};o1.prototype._createAnalyticalColumn=function(e,i){if(e.aggregationRole!=="measure"&&e.isMeasureField&&e.unit&&e.template.addStyleClass){e.template.addStyleClass("sapUiAnalyticalTableSumCellHidden sapUiAnalyticalTableGroupCellHidden");}else if(e.isCurrencyField&&e.template.addStyleClass){e.template.addStyleClass("sapUiCompCurrencyBold");}var q1=new A(i,{autoResizable:true,hAlign:e.align,width:e.width||this._calcColumnWidth(e)+"rem",visible:e.isInitiallyVisible,inResult:e.inResult,label:new d(i+"-header",{textAlign:e.align,text:e.label}),tooltip:e.quickInfo,sorted:e.sorted,sortOrder:e.sortOrder,grouped:e.grouped,showIfGrouped:e.grouped,showSortMenuEntry:e.sortable&&this._bIsSortPanelEnabled,showFilterMenuEntry:e.filterable&&this._bIsFilterPanelEnabled,summed:e.summed,leadingProperty:e.name,template:e.template,groupHeaderFormatter:z.getInlineGroupFormatterFunction(e,true)});return q1;};o1.prototype._createMobileColumn=function(e,i){var q1;q1=new a(i,{hAlign:e.align,visible:e.isInitiallyVisible,header:new d(i+"-header",{textAlign:e.align,text:e.label,tooltip:e.quickInfo,wrapping:true,wrappingType:M.WrappingType.Hyphenated}),tooltip:e.quickInfo});if(this.getShowDetailsButton()&&e.importance){q1.setImportance(e.importance);}if(this._oTemplate){this._oTemplate.addCell(e.template);}if(e.width){return q1.setWidth(e.width);}if(!this.getEnableAutoColumnWidth()){return q1.setWidth(e.isImageURL?"3em":"auto");}var r1=20,s1=this._calcColumnWidth(e);if(s1==r1){q1.setWidth("auto");q1.setAutoPopinWidth(r1);}else{q1.setWidth(s1+"rem");}return q1;};o1.prototype.fetchVariant=function(){if(this._oCurrentVariant==="STANDARD"||this._oCurrentVariant===null){return{};}return this._oCurrentVariant;};o1.prototype.applyVariant=function(e,i){this._oCurrentVariant=e;if(this._oCurrentVariant==="STANDARD"){this._oCurrentVariant=null;}this._bApplyingVariant=true;if(this._oTable._setSuppressRefresh){this._oTable._setSuppressRefresh(true);}if(this._oPersController){if(this._oCurrentVariant===null||q.isEmptyObject(this._oCurrentVariant)){this._oPersController.resetPersonalization("ResetFull");}else{this._oPersController.setPersonalizationData(this._oCurrentVariant,true);}}this._bApplyingVariant=false;this.fireAfterVariantApply({currentVariantId:this.getCurrentVariantId()});};o1.prototype.variantsInitialized=function(){this._bVariantInitialised=true;this._checkAndTriggerBinding();};o1.prototype.getUiState=function(){var e=this._oPersController?this._oPersController.getDataSuiteFormatSnapshot():null;return new U({presentationVariant:{SortOrder:e?e.SortOrder:[],GroupBy:e?e.GroupBy:[],Total:e?e.Total:[],RequestAtLeast:this._getRequestAtLeastFields(),Visualizations:e?e.Visualizations:[]},selectionVariant:{SelectOptions:e?e.SelectOptions:[]},variantName:this.getCurrentVariantId()});};o1.prototype.setUiState=function(e){this._setUiState(e,false);};o1.prototype.setUiStateAsVariant=function(e){this._setUiState(e,true);};o1.prototype._setUiState=function(e,i){var q1=e.getPresentationVariant()&&e.getPresentationVariant().RequestAtLeast?[].concat(e.getPresentationVariant().RequestAtLeast):[];if(!W(q1,this._getRequestAtLeastFields())){this._aAlwaysSelect=q1;}if(this._oPersController){if(i){this._oPersController.setPersonalizationDataAsDataSuiteFormat(X({},e.getPresentationVariant(),e.getSelectionVariant()),true);}else{var r1=(this._oVariantManagement&&e.getVariantName())?this._oVariantManagement.getVariantContent(this,e.getVariantName()):{};this._oPersController.setDataSuiteFormatSnapshot(X({},e.getPresentationVariant(),e.getSelectionVariant()),r1,true);}}};o1.prototype._getRequestAtLeastFields=function(){var e=this.getRequestAtLeastFields();var i=e?e.split(","):[];return i.concat(this._aAlwaysSelect);};o1.prototype._personalisationRequestColumns=function(e){var q1=e.getParameter("columnKeys"),r1,i,s1,t1,u1,v1={};s1=q1.length;for(i=0;i<s1;i++){r1=q1[i];t1=this._mLazyColumnMap[r1];if(t1){u1=this._createColumnForField(t1);if(this._isMobileTable){this._oTable.addColumn(u1);}v1[t1.name]=u1;}}this._oPersController.addColumns(v1);};o1.prototype._beforePersonalisationModelDataChange=function(e){if(this._oTable.suspendUpdateAnalyticalInfo){this._oTable.suspendUpdateAnalyticalInfo();}};o1.prototype._afterPersonalisationModelDataChange=function(e){this._updateColumnsPopinFeature();};o1.prototype._personalisationModelDataChange=function(e){this._oCurrentVariant=e.getParameter("persistentData");var i=e.getParameter("runtimeDeltaDataChangeType");var q1=this._getChangeStatus(i);if(q1==="Unchanged"){return;}if(!(this._bApplyingVariant||this._bDeactivatingColumns)){if(!this.getUseVariantManagement()){this._persistPersonalisation();}else if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(true);}}if(q1==="ModelChanged"&&this._isTableBound()){if(i&&i.columns==="ModelChanged"){this._bForceTableUpdate=true;}if(this._oSmartFilter){this._oSmartFilter.search();}else{this._reBindTable(null);}}if(this._isMobileTable){this._adaptCustomSort();}this._createInfoToolbar();};o1.prototype._adaptCustomSort=function(){if(this._oCurrentVariant){var e,i,q1,r1=[],s1;if(this._oCurrentVariant.sort&&this._oCurrentVariant.sort.sortItems){r1=this._oCurrentVariant.sort.sortItems;}this._oTable.getColumns().forEach(function(t1){e=t1.data("p13nData");i=e&&e.columnKey;if(i){q1=r1.filter(function(u1){return i===u1.columnKey;});s1=q1[0];if(s1){if(!e.sorted){e.sorted={"ascending":false};}if(s1.operation!==m1.Descending){e.sorted={"ascending":true};}t1.setSortIndicator(s1.operation);}else if(e&&e.sorted){e.sorted=null;t1.setSortIndicator(c.None);}}else if(t1.getSortIndicator()!==m1.None){t1.setSortIndicator(m1.None);}},this);}};o1.prototype.setUseInfoToolbar=function(e){this.setProperty("useInfoToolbar",e,true);if(this.getTable()){this._createInfoToolbar();}return this;};o1.prototype._updateInfoToolbar=function(i,e){if(!this._oInfoToolbar){this._oInfoToolbar=new O({active:true,visible:true,design:k1.Info,content:[new T({id:this.getId()+"-infoToolbarText",text:i,wrapping:false})],press:[e,this._handleInfoToolbarPress,this]});}else{this._oInfoToolbar.setVisible(true);this._oInfoToolbar.getContent()[0].setText(i);this._oInfoToolbar.detachPress(this._handleInfoToolbarPress,this);this._oInfoToolbar.attachPress(e,this._handleInfoToolbarPress,this);}};o1.prototype._handleInfoToolbarPress=function(e,i){this._showTableFilterDialog(i);};o1.prototype._createInfoToolbar=function(e){var i=this.getUseInfoToolbar(),q1=this.getTable(),r1=this.getId()+"-infoToolbarText",s1,t1=C.getLibraryResourceBundle("sap.ui.comp");if(i===n1.Off){if(this._oInfoToolbar&&this._oInfoToolbar.getVisible()){this._oInfoToolbar.setVisible(false);q1.removeAriaLabelledBy(r1);}return;}if(e){var u1=t1.getText("SMARTTABLE_INFOTOOLBAR_FILTERED_BY",[t1.getText("SMARTTABLE_INFOTOOLBAR_MESS_"+this._sDataStateType)]);this._updateInfoToolbar(u1);if(this._isMobileTable&&!q1.getInfoToolbar()){q1.setInfoToolbar(this._oInfoToolbar);}else if(!this._isMobileTable){var v1=q1.getExtension().some(function(B1){return B1.getId()===this._oInfoToolbar.getId();},this);if(!v1){q1.addExtension(this._oInfoToolbar);}}if(q1.getAriaLabelledBy().indexOf(r1)===-1){q1.addAriaLabelledBy(r1);}}else if(this._isMobileTable){if(q1.getInfoToolbar()&&!this._oInfoToolbar){Q.error("Custom infoToolbar is used, hence set useInfoToolbar property on the SmartTable with id='"+this.getId()+"' to Off");return;}var w1=this._oCurrentVariant&&this._oCurrentVariant.filter&&this._oCurrentVariant.filter.filterItems,x1=w1&&w1.length;if(x1){var y1=[],z1=L.getInstance();w1.forEach(function(B1){var C1=this._getColumnLabel(B1.columnKey);if(C1&&y1.indexOf(C1)===-1){y1.push(C1);}},this);var A1=t1.getText("SMARTTABLE_INFOTOOLBAR_FILTERED_BY",[z1.format(y1)]);s1=this._getColumnByKey(w1[0].columnKey);this._updateInfoToolbar(A1,s1);if(!q1.getInfoToolbar()){q1.setInfoToolbar(this._oInfoToolbar);}if(q1.getAriaLabelledBy().indexOf(r1)===-1){q1.addAriaLabelledBy(r1);}}else if(this._oInfoToolbar&&this._oInfoToolbar.getVisible()){this._oInfoToolbar.setVisible(false);q1.removeAriaLabelledBy(r1);}}else if(this._oInfoToolbar){this._oInfoToolbar.setVisible(false);}};o1.prototype._getChangeStatus=function(e){if(!e){return"ModelChanged";}if(e.sort==="ModelChanged"||e.filter==="ModelChanged"||e.columns==="ModelChanged"||e.group==="ModelChanged"){return"ModelChanged";}if(e.sort==="TableChanged"||e.filter==="TableChanged"||e.columns==="TableChanged"||e.group==="TableChanged"){return"TableChanged";}return"Unchanged";};o1.prototype._getTablePersonalisationData=function(){this._mSelectExpandForGroup=null;if(!this._oCurrentVariant){return null;}var e=[],i=[],q1=[],r1,s1,t1,u1,v1,w1,x1,y1,z1,A1,B1={},C1={},D1="",E1;if(this._isMobileTable&&this._oCurrentVariant.group&&this._oCurrentVariant.group.groupItems){s1=this._oCurrentVariant.group.groupItems[0];if(this._aDeactivatedColumns.indexOf(s1.columnKey)<0){v1=this._getColumnByKey(s1.columnKey);if(v1){D1=v1.getHeader().getText();}A1=this._getPathFromColumnKeyAndProperty(s1.columnKey,"sortProperty");}if(A1){x1=A1;y1=null;var F1=this._mFieldMetadataByKey[s1.columnKey],G1;if(F1){y1=F1.unit||F1.description;G1=z.getInlineGroupFormatterFunction(F1);}t1=new r(x1,s1.operation==="GroupDescending",function(J1){var K1=J1.getProperty(x1),L1;if(G1){if(y1){L1=J1.getProperty(y1);}K1=G1(K1,L1);}if(K1===undefined||K1===null){K1="";}return{key:K1,text:D1?D1+": "+K1:K1};});this._mSelectExpandForGroup={select:[x1]};if(F1){if(F1.additionalProperty){this._mSelectExpandForGroup.select.push(F1.additionalProperty);}if(F1.navigationProperty){this._mSelectExpandForGroup.expand=[F1.navigationProperty];}}e.push(t1);}}if(this._oCurrentVariant.sort){u1=this._oCurrentVariant.sort.sortItems;}else{u1=this._aInitialSorters;}if(u1){u1.forEach(function(J1,K1){var L1=J1.operation==="Descending";A1=null;z1=null;if(this._aDeactivatedColumns.indexOf(J1.columnKey)<0){A1=this._getPathFromColumnKeyAndProperty(J1.columnKey,"sortProperty");}if(A1){if(t1&&t1.sPath===A1){t1.bDescending=L1;}else{var F1=this._mFieldMetadataByKey[J1.columnKey];if(!F1){v1=this._getColumnByKey(J1.columnKey);w1=v1.data("p13nData");}if(this._bMultiUnitBehaviorEnabled&&((F1&&F1.isCurrencyField)||(w1&&w1.isCurrency))){z1=F1?F1.unit:w1.unit;if(z1&&!B1[z1]){B1[z1]={index:K1,descending:L1};}}C1[A1]={};if(C1[z1]){delete B1[z1];}else if(B1[A1]){delete B1[A1];}e.push(new r(A1,L1));}}},this);var H1=Object.keys(B1),I1;if(H1.length){H1.reverse().forEach(function(J1){I1=t1?B1[J1].index+1:B1[J1].index;e.splice(I1,0,new r(J1,B1[J1].descending));});}}if(this._oCurrentVariant.filter){this._oCurrentVariant.filter.filterItems.forEach(function(J1){var K1=J1.value1,L1=J1.value2,M1;A1=null;E1=false;v1=null;if(this._aDeactivatedColumns.indexOf(J1.columnKey)<0){v1=this._getColumnByKey(J1.columnKey);}if(v1){if(v1.getFilterProperty){A1=v1.getFilterProperty();}w1=v1.data("p13nData");if(w1){E1=w1.type==="time";if(!A1){A1=w1["filterProperty"];}}}if(A1){if(E1){if(K1 instanceof Date){K1=z.getEdmTimeFromDate(K1);}if(L1 instanceof Date){L1=z.getEdmTimeFromDate(L1);}}else{var N1=w1&&w1.typeInstance&&w1.typeInstance.getName()==="sap.ui.model.odata.type.DateTimeOffset";if(K1 instanceof Date&&!N1&&this._oTableProvider&&this._oTableProvider.getIsUTCDateHandlingEnabled()){K1=D.localToUtc(K1);L1=L1?D.localToUtc(L1):L1;}}var O1=(J1.exclude?q1:i);if(J1.operation==="Empty"){var P1=J1.exclude?t.NE:t.EQ;if(w1.edmType==="Edm.String"||w1.type==="string"){O1.push(new s(A1,P1,""));}if(w1.nullable){O1.push(new s(A1,P1,null));}}else{M1=J1.exclude?F.getTransformedExcludeOperation(J1.operation):J1.operation;O1.push(new s(A1,M1,K1,L1));}}},this);if(q1.length){r1=new s(q1,true);}}return{filters:i,excludeFilters:r1,sorters:e};};o1.prototype._getColumnByKey=function(e){var q1,r1,s1,i,t1;if(this._oTable){q1=this._oTable.getColumns();s1=q1.length;for(i=0;i<s1;i++){r1=q1[i];t1=r1.data("p13nData");if(t1&&t1.columnKey===e){return r1;}}}return null;};o1.prototype._getPathFromColumnKeyAndProperty=function(e,i){var q1=null,r1,s1;r1=this._getColumnByKey(e);if(r1){if(i=="sortProperty"&&r1.getSortProperty){q1=r1.getSortProperty();}else if(i=="filterProperty"&&r1.getFilterProperty){q1=r1.getFilterProperty();}else if(i=="leadingProperty"&&r1.getLeadingProperty){q1=r1.getLeadingProperty();}if(!q1){s1=r1.data("p13nData");if(s1){q1=s1[i];}}}return q1;};o1.prototype._persistPersonalisation=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){var e=this.getCurrentVariantId();if(!this._bSaving){this._bSaving=true;this._oVariantManagement.fireSave({name:"Personalisation",implicit:true,global:false,overwrite:!!e,key:e,def:true});delete this._bSaving;}}};o1.prototype.getCurrentVariantId=function(){return this._oVariantManagement?this._oVariantManagement.getCurrentVariantId():"";};o1.prototype.setCurrentVariantId=function(e){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setCurrentVariantId(e);}else{Q.error("sap.ui.comp.smarttable.SmartTable.prototype.setCurrentVariantId: VariantManagement does not exist, or is a page variant");}return this;};o1.prototype.setDetailsButtonSetting=function(e){this.setProperty("detailsButtonSetting",e,true);return this;};o1.prototype.isInitialised=function(){return!!this.bIsInitialised;};o1.prototype._aAvailablePanels=["Columns","Sort","Filter","Group"];o1.prototype.openPersonalisationDialog=function(e){if(!e||this._aAvailablePanels.indexOf(e)<0){Q.warning("sap.ui.comp.smarttable.SmartTable.prototype.openPersonalisationDialog: "+e+" is not a valid panel!");return;}if(this._oPersController){var i={};i[e.toLowerCase()]={visible:true};this._oPersController.openDialog(i);}};o1.prototype.deactivateColumns=function(e){this._aDeactivatedColumns=e||[];this._bDeactivatingColumns=true;if(this._oPersController){this._oPersController.addToSettingIgnoreColumnKeys(this._aDeactivatedColumns);}this._bDeactivatingColumns=false;};o1.prototype._onInnerTablePaste=function(e){if(!this.hasListeners("beforePaste")&&!this.hasListeners("paste")){return;}var i=e.getParameter("data");var q1=i.slice(0);var r1=this._getColumnInfoForPaste();if(this.fireBeforePaste({columnInfos:r1})){sap.ui.require(["sap/ui/core/util/PasteHelper"],function(s1){s1.parse(q1,r1).then(function(t1){this.firePaste({result:t1});}.bind(this));}.bind(this));}};o1.prototype._getColumnInfoForPaste=function(){var e=[],q1=this._oTable.getColumns(),i,r1=q1.length,s1,t1,u1,v1,w1,x1;if(this._isMobileTable&&q1.length){q1=q1.sort(function(y1,z1){return y1.getOrder()-z1.getOrder();});}for(i=0;i<r1;i++){s1=q1[i];u1=null;x1=null;if(s1.getVisible()){if(s1.getLeadingProperty){u1=s1.getLeadingProperty();}t1=s1.data("p13nData");if(!u1&&t1){u1=t1["leadingProperty"];}v1=t1.type==="numeric"?"number":t1.type;w1=t1["typeInstance"];if(t1.isCurrency||v1==="number"){x1=t1.unit;}else if(t1.description&&t1.displayBehaviour!=="idOnly"){x1=t1.description;}}e.push({columnId:s1.getId(),property:u1,ignore:!u1,type:w1});w1=G.getType("Edm.String");if(x1){e.push({columnId:s1.getId(),additionalProperty:true,property:x1,type:w1});}}return e;};o1.prototype.exit=function(){var i,e;this.detachEvent("_change",this._onPropertyChange,this);if(this._oSmartFilter){this._oSmartFilter.detachSearch(this._reBindTable,this);this._oSmartFilter.detachFilterChange(this._filterChangeEvent,this);this._oSmartFilter=null;}if(this._oTableProvider&&this._oTableProvider.destroy){this._oTableProvider.destroy();}this._oTableProvider=null;if(this._oPersController&&this._oPersController.destroy){this._oPersController.destroy();}this._oPersController=null;if(this._oVariantManagement){this._oVariantManagement.detachSave(this._variantSaved,this);this._oVariantManagement.detachAfterSave(this._variantAfterSave,this);if(!this._oVariantManagement.isPageVariant()&&this._oVariantManagement.destroy){this._oVariantManagement.destroy();}}this._oNumberFormatInstance=null;B.cleanUpFullScreen(this);if(this._oEditModel){this._oEditModel.destroy();}if(this._oNoData&&this._oNoData.destroy){this._oNoData.destroy();}this.oNoData=null;if(this._aTableViewMetadata){i=this._aTableViewMetadata.length;while(i--){e=this._aTableViewMetadata[i];if(e&&!e.isColumnCreated&&e.template){e.template.destroy();}}}this._aTableViewMetadata=null;this._mFieldMetadataByKey=null;this._mSelectExpandForGroup=null;this._oEditModel=null;this._oVariantManagement=null;this._oCurrentVariant=null;this._aExistingColumns=null;this._mLazyColumnMap=null;this._aColumnKeys=null;this._aDeactivatedColumns=null;this._aAlwaysSelect=null;this._oCustomToolbar=null;if(this._oToolbar&&!this._bToolbarInsertedIntoItems){this._oToolbar.destroy();}this._oToolbar=null;if(this._oUseExportToExcel&&!this.getUseExportToExcel()){this._oUseExportToExcel.destroy();}this._oUseExportToExcel=null;this._oTablePersonalisationButton=null;this._oP13nDialogSettings=null;if(this._oTemplate){this._oTemplate.destroy();}this._oTemplate=null;if(this._oColumnHeaderPopover){this._oColumnHeaderPopover.destroy();}this._oColumnHeaderPopover=null;this._oFilterButton=null;this._oSortButton=null;this._oInfoToolbar=null;this._oView=null;this._oTable=null;};return o1;});
