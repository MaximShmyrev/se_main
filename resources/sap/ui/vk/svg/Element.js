/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","../abgrToColor","../cssColorToColor","../NodeContentType"],function(q,d,e,N){"use strict";var E=function(p){p=p||{};this.type="Group";this.uid=q.sap.uid();this.sid=p.sid||undefined;this.name=p.name||undefined;this.vMask=p.subelement?undefined:(1|0);this.sMask=(0|0);this.matrix=new Float32Array(p.matrix||[1,0,0,1,0,0]);this.parent=null;this.children=[];this.domRef=null;this.nodeContentType=N.Regular;this.materialId=p.materialID;if(p.lineStyle){this.lineStyle=p.lineStyle;}if(p.fillStyle){this.fillStyle=p.fillStyle;}this.userData=p.subelement?{skipIt:true}:{};};function h(c,a){if(c){if(typeof c==="string"){c=e(c);return new Float32Array([c.red/255,c.green/255,c.blue/255,c.alpha]);}else if(c.length===4){return new Float32Array(c);}else{return new Float32Array([c[0],c[1],c[2],a]);}}return new Float32Array([0,0,0,a]);}E.prototype.isFillable=function(){return true;};E.prototype.defaultFillAlpha=0;E.prototype.setMaterial=function(m,a){m=m||{};if(this.materialId===m.materialId){var f=this.fillStyle;if(f){this.fill=h(f.color,1);}else{this.fill=new Float32Array([0,0,0,0]);}var b=this.lineStyle;if(b){this.stroke=h(b.color,1);this.strokeWidth=b.width||1;this.strokeDashArray=b.dashArray||b.dasharray||[];}else{this.stroke=h(m.lineColor,1);this.strokeWidth=m.lineWidth!==undefined?m.lineWidth:1;this.strokeDashArray=(m.lineStyle&&m.lineStyle.dashPattern)||[];}if(m.lineStyle&&m.lineStyle.widthCoordinateSpace!==undefined){this.widthCoordinateSpace=m.lineStyle.widthCoordinateSpace;}}for(var i=0,l=this.children.length;i<l;i++){this.children[i].setMaterial(m);}if(a){this.invalidate();}};E.prototype.add=function(a){if(a.parent!==null){a.parent.remove(a);}a.parent=this;this.children.push(a);a.sMask=this.sMask;if(this.highlightColor){a.highlightColor=this.highlightColor;}return this;};E.prototype.remove=function(a){var i=this.children.indexOf(a);if(i!==-1){a.parent=null;this.children.splice(i,1);}return this;};E.prototype.replace=function(a,b){var i=this.children.indexOf(a);if(i!==-1){a.parent=null;b.parent=this;this.children[i]=b;b.domRef=a.domRef;b.invalidate();}return this;};E.prototype._vkPersistentId=function(){var a=this;do{if(a.sid){return a.sid;}a=a.parent;}while(a);return null;};E.prototype._vkGetNodeContentType=function(){return this.nodeContentType;};E.prototype._vkSetNodeContentType=function(a){this.nodeContentType=a;};E.prototype.traverse=function(c){c(this);var a=this.children;for(var i=0,l=a.length;i<l;i++){a[i].traverse(c);}};E.prototype.traverseAncestors=function(c){var p=this.parent;if(p!==null){c(p);p.traverseAncestors(c);}};E.prototype.traverseVisible=function(c,m){if(this.isVisible(m)){c(this);var a=this.children;for(var i=0,l=a.length;i<l;i++){a[i].traverseVisible(c,m);}}};E.prototype.setVisible=function(m,v){if(this.vMask!==undefined){if(v){this.vMask|=m;}else{this.vMask&=~m;}if(this.domRef!==null){if(v){this.domRef.removeAttribute("display");}else{this.domRef.setAttribute("display","none");}}}};E.prototype.isVisible=function(m){return this.vMask!==undefined?(this.vMask&m)!==0:true;};E.prototype._updateColor=function(m){if(this.domRef!==null){if(this.fill!==undefined){this.domRef.setAttribute("fill",this._cssColor(this.fill,m));}if(this.stroke!==undefined&&this.stroke[3]>0&&this.strokeWidth>0){this.domRef.setAttribute("stroke",this._cssColor(this.stroke,m));}}};E.prototype.setSelected=function(m,a,b){if(a){this.sMask|=m;this.highlightColor=b;}else{this.sMask&=~m;delete this.highlightColor;}this._updateColor(m);};E.prototype.isSelected=function(m){return(this.sMask&m)!==0;};E.prototype.setTintColor=function(m,t){this.tintColor=t;this._updateColor(m);};E.prototype.setOpacity=function(m,a){this.opacity=a;if(this.domRef!==null){if(a!==undefined){this.domRef.setAttribute("opacity",a);}else{this.domRef.removeAttribute("opacity");}}};function j(m){return m[0]===1&&m[1]===0&&m[2]===0&&m[3]===1&&m[4]===0&&m[5]===0;}E.prototype.setMatrix=function(m){this.matrix=m;if(this.domRef!==null){if(!j(m)){this.domRef.setAttribute("transform","matrix("+this.matrix.join(",")+")");}else{this.domRef.removeAttribute("transform");}}};E._multiplyMatrices=function(a,b){var c=a[0],f=a[2],g=a[4];var i=a[1],l=a[3],m=a[5];var p=b[0],r=b[2],t=b[4];var u=b[1],v=b[3],w=b[5];return new Float32Array([c*p+f*u,i*p+l*u,c*r+f*v,i*r+l*v,c*t+f*w+g,i*t+l*w+m]);};E._invertMatrix=function(m){var a=m[0],b=m[1],c=m[2],f=m[3],g=m[4],i=m[5],l=a*f-b*c;if(l===0){return new Float32Array([0,0,0,0,0,0]);}var p=1/l;var t=new Float32Array(6);t[0]=f*p;t[1]=-b*p;t[2]=-c*p;t[3]=a*p;t[4]=(i*c-f*g)*p;t[5]=(b*g-i*a)*p;return t;};E._transformPoint=function(p,a,m){return{x:p*m[0]+a*m[2]+m[4],y:p*m[1]+a*m[3]+m[5]};};E.prototype._matrixWorld=function(m){if(m!==undefined){return E._multiplyMatrices(m,this.matrix);}else{var p=this.parent;var a=this.matrix;while(p!==null){a=E._multiplyMatrices(p.matrix,a);p=p.parent;}return a;}};function k(b,x,y,a,c){b.min.x=Math.min(b.min.x,x-a);b.min.y=Math.min(b.min.y,y-c);b.max.x=Math.max(b.max.x,x+a);b.max.y=Math.max(b.max.y,y+c);}function s(a){return a*a;}E.prototype._expandBoundingBoxCE=function(b,m,c,a,f,g){k(b,c*m[0]+a*m[2]+m[4],c*m[1]+a*m[3]+m[5],Math.abs(f*m[0])+Math.abs(g*m[2]),Math.abs(f*m[1])+Math.abs(g*m[3]));};E.prototype._expandBoundingBoxCR=function(b,m,c,a,r,f){k(b,c*m[0]+a*m[2]+m[4],c*m[1]+a*m[3]+m[5],Math.sqrt(s(r*m[0])+s(f*m[2])),Math.sqrt(s(r*m[1])+s(f*m[3])));};E.prototype._expandBoundingBox=function(b,m){};E.prototype._expandBoundingBoxRecursive=function(b,m,a){if(this.isVisible(m)){var c=this._matrixWorld(a);this._expandBoundingBox(b,c);var f=this.children;for(var i=0,l=f.length;i<l;i++){f[i]._expandBoundingBoxRecursive(b,m,c);}}};E.prototype._getSceneTreeElement=function(){var a=this;var p=a.parent;while(p){if(p.userData.closed){a=p;}p=p.parent;}while(a.userData.skipIt){a=a.parent;}return a;};E.prototype._findRectElementsRecursive=function(a,r,m,b){if(this.isVisible(m)){var c=this._matrixWorld(b);var f=this.children;var g={min:{x:Infinity,y:Infinity},max:{x:-Infinity,y:-Infinity}};this._expandBoundingBox(g,c);if(g.min.x<=r.x2&&g.max.x>=r.x1&&g.min.y<=r.y2&&g.max.y>=r.y1){a.add(this._getSceneTreeElement());}for(var i=0,l=f.length;i<l;i++){f[i]._findRectElementsRecursive(a,r,m,c);}}};E.prototype.tagName=function(){return"g";};E.prototype._setBaseAttributes=function(a,m){a("id",this.uid);if(this.opacity!==undefined){a("opacity",this.opacity);}if(!j(this.matrix)){a("transform","matrix("+this.matrix.join(",")+")");}if(this.vMask!==undefined&&!this.isVisible(m)){a("display","none");}if(this.fill!==undefined){a("fill",this._cssColor(this.fill,m));}if(this.stroke!==undefined&&this.stroke[3]>0&&this.strokeWidth){a("stroke",this._cssColor(this.stroke,m));a("stroke-width",this.strokeWidth);a("vector-effect","non-scaling-stroke");if(this.strokeDashArray.length>0){a("stroke-dasharray",this.strokeDashArray.join(" "));}}};E.prototype._setSpecificAttributes=function(a){};E.prototype.render=function(r,m){var t=this.tagName();r.write("<"+t);var a=r.writeAttribute.bind(r);this._setBaseAttributes(a,m);this._setSpecificAttributes(a);r.write(">");if(this._renderContent){this._renderContent(r);}this.children.forEach(function(b){b.render(r,m);});r.write("</"+t+">");};E.prototype._createDomElement=function(c){var a=document.createElementNS("http://www.w3.org/2000/svg",this.tagName());var b=a.setAttribute.bind(a);this._setBaseAttributes(b,1<<c);this._setSpecificAttributes(b);if(this._createContent){this._createContent(a);}return a;};E.prototype.invalidate=function(c){if(this.domRef!==null){var a=this.domRef;this.domRef=this._createDomElement(c);a.parentNode.replaceChild(this.domRef,a);for(var i=0,l=this.children.length;i<l;i++){var b=this.children[i].domRef;if(b){this.domRef.appendChild(b);}}}};E.prototype.rerender=function(c){var a=this.domRef;if(a!==null&&a.parentNode!==null){this.traverse(function(b){b.domRef=b._createDomElement(c);if(b===this){a.parentNode.replaceChild(b.domRef,a);}else{b.parent.domRef.appendChild(b.domRef);}}.bind(this));}};function n(a,b){var c=a.children;for(var i=0,l=c.length;i<l;i++){if(c[i].id===b){return c[i];}}return null;}E.prototype._setDomRef=function(a){this.domRef=a;var c=this.children;for(var i=0,l=c.length;i<l;i++){var b=c[i];b._setDomRef(a?n(a,b.uid):null);}};E.prototype.getElementByProperty=function(a,v){if(this[a]===v){return this;}var c=this.children;for(var i=0,l=c.length;i<l;i++){var b=c[i].getElementByProperty(a,v);if(b!==null){return b;}}return null;};E.prototype.getElementById=function(i){return this.getElementByProperty("uid",i);};function o(a,b,f){return a+(b-a)*f;}E.prototype._cssColor=function(c,m){var a=c[3];if(a===0){return"none";}var r=c[0]*255;var g=c[1]*255;var b=c[2]*255;var t=this.tintColor;if(t){t=d(t);var f=t.alpha;if(f>0){r=o(r,t.red,f);g=o(g,t.green,f);b=o(b,t.blue,f);}}var i=this.highlightColor;if(i){i=d(i);var l=i.alpha;if(l>0){r=o(r,i.red,l);g=o(g,i.green,l);b=o(b,i.blue,l);a=o(a,l,l);}}var p=((r<<24)|(g<<16)|(b<<8)|(a*255))>>>0;return"#"+("00000000"+p.toString(16)).slice(-8);};return E;});
