/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/ChangePersistenceFactory","sap/ui/fl/Change","sap/base/util/restricted/_omit","sap/base/Log"],function(C,a,_,L){"use strict";var E={};function i(o,p,d){if(d.getSelector().name!==p.extensionPointName){return false;}return o.changesHavingCorrectViewPrefix(p,d);}function b(o,e){if(e.fragmentId){var d=o.getExtensionPointInfo&&o.getExtensionPointInfo();if(d){return e.fragmentId!==d.fragmentId;}return true;}return false;}function c(o,e){var s=o.getSelector();s.id=e.targetControl.getId();s.idIsLocal=false;return s;}E.getChangesForExtensionPoint=function(o,p){if(!p.extensionPointName){L.error("Missing name from extension point info!");return Promise.resolve([]);}return o.getChangesForComponent().then(function(d){return d.filter(i.bind(this,o,p));});};E.enhanceExtensionPointChanges=function(p,e){p.extensionPointName=e.name;var o=C.getChangePersistenceForControl(e.targetControl);return E.getChangesForExtensionPoint(o,p).then(function(d){d.forEach(function(f){if(f.isInInitialState()&&!(f.getExtensionPointInfo&&f.getExtensionPointInfo())){f.setExtensionPointInfo(e);f.setSelector(c(f,e));if(o.isChangeMapCreated()){o.addChangeAndUpdateDependencies(p.appComponent,f);}}else if(b(f,e)){var g=f.getDefinition();var m=_(g,["fileName"]);m.support.sourceChangeFileName=g.fileName||"";var r=new a(a.createInitialFileContent(m));r.getDefinition().creation=g.creation;r.setSelector(c(r,e));r.setExtensionPointInfo(e);o.addChangeAndUpdateDependencies(p.appComponent,r,f);}});return d;});};return E;},true);
