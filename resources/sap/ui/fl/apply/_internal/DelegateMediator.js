/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/fl/Utils","sap/ui/core/util/reflection/JsControlTreeModifier"],function(L,f,J){"use strict";var D={};D._mDefaultDelegateItems={};function g(c,m){if(m){return m;}if(c.getModel){var M=c.getModel();if(!M){return undefined;}return M.getMetadata().getName();}}function a(c,m){m=g(c,m);var d=D._mDefaultDelegateItems[m];if(d){return{name:d.name,payload:{},modelType:m,requiredLibraries:d.requiredLibraries};}}function l(m,c,d){if(!d){return Promise.resolve();}return f.requireAsync(d.name).then(function(o){d.instance=o;return d;}).catch(function(e){L.error("Failed to load the delegate for the control "+m.getId(c)+"\n"+e.message);});}function v(c,m){return new Promise(function(r,b){if(!c){b(new Error("The control parameter is missing"));}if(!m){b(new Error("The modifier parameter is missing"));}if(!c){b(new Error("The input control should be available"));}if(m===J&&(!c.isA||!c.isA("sap.ui.base.ManagedObject"))){b(new Error("The input control should be a managed object"));}return r();});}D.getKnownDefaultDelegateLibraries=function(){return["sap.ui.comp"];};D.getRequiredLibrariesForDefaultDelegate=function(d,c,m){m=g(c,m);var b=D._mDefaultDelegateItems[m]||{};var i=d===b.name;return Object.keys((i&&b.requiredLibraries)||{});};D.isDelegateRegistered=function(m){return!!D._mDefaultDelegateItems[m];};D.registerDefaultDelegate=function(p){if(!(p.modelType&&p.delegate)){throw new Error("'modelType' and 'delegate' properties are required for registration!");}if(D.isDelegateRegistered(p.modelType)){throw new Error("modelType "+p.modelType+"is already defined!");}D._mDefaultDelegateItems[p.modelType]={name:p.delegate,requiredLibraries:p.requiredLibraries};};D.getDelegateForControl=function(c,m,M,s){return v(c,m).then(function(){return m.getFlexDelegate(c);}).then(function(i){if(i){return i;}return s&&a(c,M);}).then(l.bind(this,m,c));};D.clear=function(){D._mDefaultDelegateItems={};};return D;},false);
