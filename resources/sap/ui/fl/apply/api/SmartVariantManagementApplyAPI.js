/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/apply/_internal/flexState/compVariants/CompVariantMerger","sap/ui/fl/apply/_internal/ChangesController","sap/ui/fl/Change","sap/ui/fl/registry/Settings","sap/ui/fl/Utils","sap/ui/fl/LayerUtils"],function(F,M,C,a,b,S,U,L){"use strict";function g(o){return o&&o.getPersistencyKey&&o.getPersistencyKey();}function c(o,v){var r=M.getFlexReferenceForControl(o);var p=g(o);var m=F.getCompVariantsMap(r);return m._getOrCreate(p,v);}var d={getCompEntities:function(p){var r=M.getFlexReferenceForControl(p.control);return F.initialize({reference:r,componentData:{},manifest:U.getAppDescriptor(p.control),componentId:U.getAppComponentForControl(p.control).getId()}).then(c.bind(undefined,p.control));},loadChanges:function(p){return d.getCompEntities(p).then(function(o){return o.variants.concat(o.changes);});},loadVariants:function(p){return d.getCompEntities(p).then(function(m){var P=g(p.control);return C.merge(P,m,p.standardVariant,p.variants);});},getEntityById:function(p){var r=M.getFlexReferenceForControl(p.control);return F.getCompEntitiesByIdMap(r)[p.id];},isVariantSharingEnabled:function(){return S.getInstance().then(function(i){return i.isVariantSharingEnabled();});},isApplicationVariant:function(p){var o=p.control;if(U.isApplicationVariant(o)){return true;}var e=U.getComponentForControl(o);if(e&&e.getAppComponent){e=e.getAppComponent();if(e){return true;}}return false;},isVendorLayer:function(){return L.isVendorLayer();},isVariantDownport:function(){return d.isVendorLayer()&&U.isHotfixMode();},getDefaultVariantId:function(p){var o=c(p.control).defaultVariant;return o?o.getContent().defaultVariantName:"";},getExecuteOnSelect:function(p){var o=c(p.control).standardVariant;return o?o.getContent().executeOnSelect:null;},getChangeById:function(p){return d.getEntityById(p);},_getChangeMap:function(o){var r=M.getFlexReferenceForControl(o);var p=g(o);var m=F.getCompEntitiesByIdMap(r);var e={};Object.keys(m).forEach(function(i){if(m[i].getSelector&&m[i].getSelector().persistencyKey===p&&m[i].getFileType()==="change"){e[i]=m[i];}});return e;}};return d;},true);
