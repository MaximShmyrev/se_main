/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./BasePanel","sap/m/Label","sap/m/ColumnListItem","sap/m/HBox","sap/m/VBox","sap/ui/core/Icon","sap/m/Text","sap/m/Column","sap/m/Table","sap/m/library"],function(B,L,C,H,V,I,T,a,b,m){"use strict";var c=m.ListKeyboardMode;var d=B.extend("sap.ui.mdc.p13n.panels.ListView",{metadata:{library:"sap.ui.mdc",properties:{enableReorder:{type:"boolean",defaultValue:true}}},renderer:{}});d.prototype.applySettings=function(){B.prototype.applySettings.apply(this,arguments);this._aInitializedFields=[];var l=new C({selected:"{"+this.P13N_MODEL+">selected}",type:"Active",cells:[new V({items:[new L({wrapping:true,tooltip:"{"+this.P13N_MODEL+">tooltip}",text:"{"+this.P13N_MODEL+">label}"})]}),new H({justifyContent:"Center",items:[new I({src:"sap-icon://circle-task-2",size:"0.5rem",color:sap.ui.core.IconColor.Neutral,visible:{path:this.P13N_MODEL+">isFiltered",formatter:function(i){if(i){return true;}else{return false;}}}})]})]});this.setShowFactory(false);this.displayColumns();var t=this;if(this.getEnableReorder()){l.attachBrowserEvent("mouseenter",function(e){var i=this.getCells()[1].getItems()[0];i.setVisible(false);t._oSelectedItem=this;t._updateEnableOfMoveButtons(this,false);t._addMoveButtons(this);});l.attachBrowserEvent("mouseleave",function(e){var v=!!t.getP13nModel().getProperty(this.getBindingContextPath()).isFiltered;var i=this.getCells()[1].getItems()[0];if(t._oSelectedItem){t.removeMoveButtons();}i.setVisible(v);});this._setMoveButtonVisibility(true);}this.setTemplate(l);};d.prototype.removeMoveButtons=function(){if((!this._oSelectedItem)||(!this._oSelectedItem.getCells()[1])){return;}this._oSelectedItem.getCells()[1].removeItem(this._getMoveTopButton());this._oSelectedItem.getCells()[1].removeItem(this._getMoveUpButton());this._oSelectedItem.getCells()[1].removeItem(this._getMoveDownButton());this._oSelectedItem.getCells()[1].removeItem(this._getMoveBottomButton());};d.prototype.showFactory=function(s){this.displayColumns();if(s){this._addFactoryControl();}else{this._removeFactoryControl();}};d.prototype.setP13nModel=function(M){this.setModel(M,"$p13n");this.setPanelMode(true);this._getDragDropConfig().setEnabled(this.getEnableReorder());};d.prototype._removeFactoryControl=function(){this._oListControl.getItems().forEach(function(i){var f=i.getCells()[0];if(f.getItems().length>1){f.removeItem(f.getItems()[1]);}});this.removeStyleClass("sapUiMDCAFLabelMarkingList");return this._aInitializedFields;};d.prototype._onItemPressed=function(){B.prototype._onItemPressed.apply(this,arguments);this._addMoveButtons();};d.prototype._moveTableItem=function(){this.removeMoveButtons();B.prototype._moveTableItem.apply(this,arguments);};d.prototype.getShowFactory=function(){return this._bShowFactory;};d.prototype.setShowFactory=function(s){this._bShowFactory=s;};d.prototype.displayColumns=function(){var e=[this.getResourceText("p13nDialog.LIST_VIEW_COLUMN")];if(!this.getShowFactory()){e.push(new a({width:"25%",hAlign:"Center",vAlign:"Middle",header:new T({text:this.getResourceText("p13nDialog.LIST_VIEW_ACTIVE")})}));}this.setPanelColumns(e);};d.prototype._addFactoryControl=function(l){this._oListControl.getItems().forEach(function(i){var o=i.getBindingContext(this.P13N_MODEL);var f=this.getItemFactory().call(this,o);var e=i.getCells()[0];e.addItem(f);}.bind(this));this.addStyleClass("sapUiMDCAFLabelMarkingList");};d.prototype._createInnerListControl=function(){return new b(this.getId()+"-innerListViewTable",Object.assign({keyboardMode:c.Edit,growing:true,updateStarted:function(){this.removeMoveButtons();this._removeFactoryControl();}.bind(this),updateFinished:function(){if(this.getShowFactory()){this._addFactoryControl();}}.bind(this)},this._getListControlConfig()));};d.prototype.getSelectedFields=function(){var s=[];this._loopItems(this._oListControl,function(i,k){if(i.getSelected()){s.push(k);}});return s;};d.prototype._loopItems=function(l,i){l.getItems().forEach(function(o){var p=o.getBindingContextPath();var k=this.getP13nModel().getProperty(p).name;i.call(this,o,k);}.bind(this));};d.prototype.filterWithoutDestroy=function(f){this._oListControl.getBinding("items").filter(f,true);};d.prototype._addMoveButtons=function(){var t=this._oSelectedItem;if(!t){return;}var i=this.getP13nModel().getProperty(t.getBindingContextPath()).selected;if(i){t.getCells()[1].addItem(this._getMoveTopButton());t.getCells()[1].addItem(this._getMoveUpButton());t.getCells()[1].addItem(this._getMoveDownButton());t.getCells()[1].addItem(this._getMoveBottomButton());}};d.prototype.exit=function(){B.prototype.exit.apply(this,arguments);this._aInitializedFields=null;this._bShowFactory=null;};return d;});
