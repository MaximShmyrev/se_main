/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/m/library','sap/ui/mdc/field/FieldHelpBase','sap/ui/mdc/condition/Condition','sap/ui/base/ManagedObjectObserver'],function(m,F,C,M){"use strict";var B=m.ButtonType;var D;var T;var a;var b;var c;var d;var e=F.extend("sap.ui.mdc.field.ConditionFieldHelp",{metadata:{library:"sap.ui.mdc",properties:{title:{type:"string",group:"Appearance",defaultValue:""},label:{type:"string",group:"Appearance",defaultValue:""},_enableOK:{type:"boolean",group:"Appearance",defaultValue:true,visibility:"hidden"}}}});e.prototype.init=function(){F.prototype.init.apply(this,arguments);this._oObserver=new M(g.bind(this));this._oObserver.observe(this,{properties:["title","conditions"]});this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");};e._init=function(){F._init.apply(this,arguments);D=undefined;b=undefined;};e.prototype.exit=function(){F.prototype.exit.apply(this,arguments);this._oObserver.disconnect();this._oObserver=undefined;if(this._iConditionsTimer){clearTimeout(this._iConditionsTimer);this._iConditionsTimer=null;}};e.prototype.getIcon=function(){return"sap-icon://value-help";};e.prototype.isFocusInHelp=function(){return true;};e.prototype.openByTyping=function(){return false;};e.prototype._createPopover=function(){var p=F.prototype._createPopover.apply(this,arguments);if((!D||!T||!a||!b||!c||!d)&&!this._bModulesRequested){D=sap.ui.require("sap/ui/mdc/field/DefineConditionPanel");T=sap.ui.require("sap/m/Toolbar");a=sap.ui.require("sap/m/ToolbarSpacer");b=sap.ui.require("sap/m/Button");c=sap.ui.require("sap/ui/model/base/ManagedObjectModel");d=sap.ui.require("sap/ui/mdc/condition/FilterOperatorUtil");if(!D||!T||!a||!b||!c){sap.ui.require(["sap/ui/mdc/field/DefineConditionPanel","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/Button","sap/ui/model/base/ManagedObjectModel","sap/ui/mdc/condition/FilterOperatorUtil"],f.bind(this));this._bModulesRequested=true;}}if(p){p.setShowArrow(true);p.setTitle(this.getTitle());p.setShowHeader(true);p.setTitleAlignment("Center");p.setContentWidth("500px");p.setResizable(false);_.call(this);}return p;};function _(){if(!this._oDefineConditionPanel&&D&&T&&a&&b&&c&&d&&!this._bModulesRequested){this._oManagedObjectModel=new c(this);this._oDefineConditionPanel=new D(this.getId()+"-DCP",{conditions:{path:"$help>/conditions"},formatOptions:h.call(this),label:"{$help>/label}"}).setModel(this._oManagedObjectModel,"$help");this._setContent(this._oDefineConditionPanel);var o=new b(this.getId()+"-ok",{text:this._oResourceBundle.getText("valuehelp.OK"),enabled:"{$help>/_enableOK}",type:B.Emphasized,press:l.bind(this)});var i=new b(this.getId()+"-cancel",{text:this._oResourceBundle.getText("valuehelp.CANCEL"),press:n.bind(this)});var t=new T(this.getId()+"-TB",{content:[new a(this.getId()+"-Spacer"),o,i]}).setModel(this._oManagedObjectModel,"$help");var p=this.getAggregation("_popover");if(p){p.setFooter(t);}}}function f(i,t,o,p,q,r){D=i;T=t;a=o;b=p;c=q;d=r;this._bModulesRequested=false;if(!this._bIsBeingDestroyed){_.call(this);}}e.prototype.open=function(s){F.prototype.open.apply(this,arguments);var p=this.getAggregation("_popover");if(p&&this._oDefineConditionPanel){this._oDefineConditionPanel.setFormatOptions(h.call(this));this._oDefineConditionPanel.getBinding("conditions").resume();}return this;};e.prototype._handleAfterClose=function(E){this._oDefineConditionPanel.getBinding("conditions").suspend();this._oDefineConditionPanel.cleanUp();this.setProperty("_enableOK",true,true);if(this._iConditionsTimer){clearTimeout(this._iConditionsTimer);this._iConditionsTimer=null;}F.prototype._handleAfterClose.apply(this,arguments);};e.prototype._getControlForSuggestion=function(){var o=F.prototype._getControlForSuggestion.apply(this,arguments);var i=o.getAggregation("_endIcon",[]);if(i.length===1){o=i[0];}return o;};function g(o){if(o.name==="title"){var p=this.getAggregation("_popover");if(p){p.setTitle(this.getTitel());}}if(o.name==="conditions"){j.call(this,o.current);}}e.prototype.isValidationSupported=function(){return false;};e.prototype.getItemForValue=function(v,p,i,o,q,r,s,t){return{key:p,description:undefined};};function h(){if(this._oField&&this._oField._getFormatOptions){return this._oField._getFormatOptions();}else{return{};}}function j(i){if(this.isOpen()&&!this._iConditionsTimer){this._iConditionsTimer=setTimeout(function(){this._iConditionsTimer=null;k.call(this);}.bind(this),0);}}function k(){var I=false;var o=this.getConditions();for(var i=0;i<o.length;i++){var p=o[i];var O=d.getOperator(p.operator);try{O.validate(p.values,h.call(this).valueType);}catch(E){I=true;}}this.setProperty("_enableOK",!I,true);}function l(E){this.close();var i=this.getConditions();i=C._removeEmptyConditions(i);d.updateConditionsValues(i);this.setProperty("conditions",i,true);this.fireSelect({conditions:i,add:false,close:true});}function n(E){this.close();}return e;});
