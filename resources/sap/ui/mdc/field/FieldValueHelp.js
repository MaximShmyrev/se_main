/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/mdc/field/FieldHelpBase','sap/ui/mdc/condition/Condition','sap/ui/mdc/condition/FilterOperatorUtil','sap/ui/mdc/enum/OutParameterMode','sap/ui/mdc/enum/ConditionValidated','sap/ui/mdc/condition/FilterConverter','sap/ui/base/ManagedObjectObserver','sap/ui/base/SyncPromise','sap/base/util/ObjectPath','sap/base/util/deepEqual','sap/base/util/merge','sap/ui/model/resource/ResourceModel','sap/ui/model/Context','sap/ui/Device','sap/m/library','sap/ui/core/library'],function(F,C,a,O,b,c,M,S,d,e,m,R,f,D,g,h){"use strict";var k;var B;var V;var l;var n;var o;var p;var q=g.ButtonType;var r=h.OpenState;var s=F.extend("sap.ui.mdc.field.FieldValueHelp",{metadata:{library:"sap.ui.mdc",properties:{delegate:{type:"object",group:"Data",defaultValue:{name:"sap/ui/mdc/field/FieldValueHelpDelegate"}},filterFields:{type:"string",defaultValue:""},keyPath:{type:"string",defaultValue:""},descriptionPath:{type:"string",defaultValue:""},showConditionPanel:{type:"boolean",defaultValue:false},title:{type:"string",group:"Appearance",defaultValue:""},noDialog:{type:"boolean",group:"Appearance",defaultValue:false},_enableOK:{type:"boolean",group:"Appearance",defaultValue:true,visibility:"hidden"}},aggregations:{content:{type:"sap.ui.mdc.field.FieldValueHelpContentWrapperBase",multiple:false},filterBar:{type:"sap.ui.mdc.filterbar.FilterBarBase",multiple:false},inParameters:{type:"sap.ui.mdc.field.InParameter",group:"Data",multiple:true},outParameters:{type:"sap.ui.mdc.field.OutParameter",group:"Data",multiple:true},_dialog:{type:"sap.m.Dialog",multiple:false,visibility:"hidden"},_filterBar:{type:"sap.ui.mdc.filterbar.FilterBarBase",multiple:false,visibility:"hidden"}},defaultAggregation:"content",events:{dataRequested:{}}}});s._init=function(){F._init.apply(this,arguments);k=undefined;B=undefined;V=undefined;l=undefined;n=undefined;};s.prototype.init=function(){F.prototype.init.apply(this,arguments);this._oObserver=new M(t.bind(this));this._oObserver.observe(this,{properties:["filterValue","conditions","showConditionPanel","filterFields"],aggregations:["content","filterBar","_filterBar","inParameters"]});this.setBindingContext(null);this._oConditions={};};s.prototype.exit=function(){F.prototype.exit.apply(this,arguments);if(this._oManagedObjectModel){this._oManagedObjectModel.destroy();delete this._oManagedObjectModel;}this._oObserver.disconnect();this._oObserver=undefined;delete this._oConditions;if(this._iUpdateTimer){clearTimeout(this._iUpdateTimer);this._iUpdateTimer=null;}if(this._iFilterTimer){clearTimeout(this._iFilterTimer);this._iFilterTimer=null;}if(this._iSearchFieldTimer){clearTimeout(this._iSearchFieldTimer);this._iSearchFieldTimer=null;}if(this._iConditionsTimer){clearTimeout(this._iConditionsTimer);this._iConditionsTimer=null;}};s.prototype.invalidate=function(i){if(i){var j=this.getContent();var z1=this.getAggregation("_dialog");if(j&&i===j){var A1=this.getAggregation("_popover");if(z1&&z1.isOpen()){var B1=z1.getContent()[0];B1.invalidate(i);}else if(A1&&A1.isOpen()){A1.invalidate(i);}return;}var C1=s1.call(this);if((z1&&i===z1)||(C1&&i===C1)){if(i.bOutput&&!this._bIsBeingDestroyed){var D1=this.getParent();if(D1){D1.invalidate(this);}}return;}}F.prototype.invalidate.apply(this,arguments);};s.prototype.connect=function(i){F.prototype.connect.apply(this,arguments);y1.call(this);o1.call(this,this.getShowConditionPanel());return this;};s.prototype.getIcon=function(){if(this.getNoDialog()){return"sap-icon://slim-arrow-down";}else{return"sap-icon://value-help";}};s.prototype._createPopover=function(){var i=F.prototype._createPopover.apply(this,arguments);if(i){var j=this.getContent();if(j){j.initialize(true);}i._getAllContent=function(){var z1=this.getParent();var A1=[];if(z1){var B1=x1.call(z1);if(B1){A1.push(B1);}}return A1;};if(this._bNavigate){this.navigate(this._iStep);}}return i;};s.prototype._handleAfterOpen=function(i){F.prototype._handleAfterOpen.apply(this,arguments);var j=this.getContent();if(j){j.fieldHelpOpen(true);}};s.prototype.open=function(i){if(this.getNoDialog()&&!i){i=true;}y1.call(this);if(this._bOpenAfterPromise){this._bSuggestion=i;return;}var j=this.getContent();var z1=function(){if(this._bOpenAfterPromise){delete this._bOpenAfterPromise;this.open(this._bSuggestion);delete this._bSuggestion;}}.bind(this);var A1=this._bOpen?this._callContentRequest(!!i,z1):this._fireOpen(!!i,z1);delete this._bOpen;if(!A1){this._bSuggestion=i;if(i){this._getPopover();}else{j1.call(this);}this._bOpenAfterPromise=true;return;}this._bOpenHandled=true;j=this.getContent();if(j&&j.getFilterEnabled()&&!this._bNavigateRunning){if(!j.isSuspended()||i){this._bApplyFilter=true;}r1.call(this);}if(this._bUpdateFilterAfterClose){this._bUpdateFilterAfterClose=false;J.call(this,this.getFilterValue());}if(i){if(!j){this._bOpenIfContent=true;}else{j.fieldHelpOpen(i);if(!this.getFilterValue()&&!this._bNavigateRunning){a1.call(this,true);}F.prototype.open.apply(this,[i]);}}else{var B1=this.getAggregation("_popover");if(B1){if(B1.isOpen()){this.close();}B1.$().remove();}var C1=j1.call(this);if(C1){w1.call(this);q1.call(this);C1.setFieldGroupIds(this._oField.getFieldGroupIds());var D1=C1.getContent()[0];D1.setShowTokenizer(this.getMaxConditions()!==1&&!!j);D1.setFormatOptions(this._getFormatOptions());D1.bindProperty("conditions",{path:"$help>/conditions"});if(j){j.fieldHelpOpen(false);I.call(this);}this._aOldConditions=this.getConditions();C1.open();this._bDialogOpen=true;}else{this._bOpen=true;}}this._bOpenHandled=false;return;};s.prototype.toggleOpen=function(i){if(this.getNoDialog()&&!i){i=true;}if(i){F.prototype.toggleOpen.apply(this,[i]);}else if(this._bOpen||this._bOpenIfContent||this._bOpenAfterPromise){delete this._bOpen;delete this._bSuggestion;delete this._bOpenIfContent;delete this._bOpenAfterPromise;}else{var j=j1.call(this);if(j){if(j.isOpen()){var z1=j.oPopup.getOpenState();if(z1!=="CLOSED"&&z1!=="CLOSING"){this.close();}else{this._bReopen=true;}}else{this.open(i);}}else{this.open(i);}}};s.prototype.close=function(){if(!this._bDialogOpen){F.prototype.close.apply(this,arguments);}else{var i=this.getAggregation("_dialog");if(i){this._bClosing=true;i.close();var j=i.getContent()[0];j.unbindProperty("conditions",true);if(j._oDefineConditionPanel){j._oDefineConditionPanel.cleanUp();}}this._bReopen=false;delete this._bOpen;delete this._bOpenAfterPromise;}};s.prototype.isOpen=function(i){var j=F.prototype.isOpen.apply(this,arguments);if(!j&&(!i||!this._bClosing)){var z1=this.getAggregation("_dialog");if(z1){j=z1.isOpen();}}return j;};s.prototype.getDomRef=function(){if(!this._bDialogOpen){return F.prototype.getDomRef.apply(this,arguments);}else{var i=this.getAggregation("_dialog");if(i){return i.getDomRef();}}};function _(){var i=s1.call(this);var j;if(i){j=i.getInternalConditions();}else{j=this._oConditions;}var z1=false;for(var A1 in j){if(j[A1].length>0){v1.call(this,A1);z1=true;}}if(z1){a1.call(this,true);}}s.prototype._handleAfterClose=function(i){var j=this.getContent();if(j){if(!j.getAsyncKeyText()){_.call(this);}j.fieldHelpClose();}if(!this.isOpen()){this._bApplyFilter=false;}F.prototype._handleAfterClose.apply(this,arguments);};function t(i){if(i.object==this){var j;if(i.name==="content"){i1.call(this,i.mutation,i.child);}if(i.name==="filterBar"){if(i.mutation==="insert"&&this.getAggregation("_filterBar")){this.destroyAggregation("_filterBar");}p1.call(this,i.mutation,i.child,false);}if(i.name==="_filterBar"){p1.call(this,i.mutation,i.child,true);}if(i.name==="conditions"){G.call(this,i.current);}if(i.name==="filterValue"){if(this._bClosing){this._bUpdateFilterAfterClose=true;}else{J.call(this,i.current);}}if(i.name==="showConditionPanel"){o1.call(this,i.current);}if(i.name==="filterFields"){j=this.getAggregation("_dialog");if(j){if(j.isOpen()){if(i.current){w1.call(this);}else if(this.getAggregation("_filterBar")){this.destroyAggregation("_filterBar");}}}}if(i.name==="inParameters"){K.call(this,i.child,i.mutation);}}else if(i.object.isA("sap.ui.mdc.field.InParameter")){if(i.name==="value"){P.call(this,i.object.getHelpPath(),i.current,i.old,i.object.getUseConditions(),i.object.getInitialValueFilterEmpty());}if(i.name==="helpPath"){Q.call(this,i.current,i.old,i.object.getValue(),i.object.getUseConditions(),i.object.getInitialValueFilterEmpty());}}}s.prototype.openByTyping=function(){if(!this._bDetermineSearchSupportedCalled&&!this.isOpen()&&!this._bOpen&&!this._bOpenIfContent&&!this._bOpenAfterPromise){this.initControlDelegate();if(this.bDelegateInitialized){return u.call(this);}else{this._bDetermineSearchSupportedCalled=true;return this.awaitControlDelegate().then(function(){return u.call(this);}.bind(this));}}return!!this.getFilterFields();};function u(){this.fireOpen({suggestion:true});this._bDetermineSearchSupportedCalled=true;var i=this.getControlDelegate().determineSearchSupported(this.getPayload(),this);if(i instanceof Promise){return i.then(function(){return!!this.getFilterFields();}.bind(this));}else{return!!this.getFilterFields();}}s.prototype.isFocusInHelp=function(){if(!this.getNoDialog()){var i=this.getAggregation("_dialog");if((i&&i.isOpen())||(this._bDialogRequested&&this._bOpen)){return true;}}if(this._bFocusPopover){return true;}return false;};s.prototype.navigate=function(i){var j=this.getContent();var z1=this.getAggregation("_popover");y1.call(this);if(!z1||!z1.isOpen()){var A1=function(){this.navigate(i);}.bind(this);var B1=this._bNavigate?this._callContentRequest(true,A1):this._fireOpen(true,A1);if(!B1){j=this.getContent();this._bNavigate=false;this._iStep=null;if(j){this._getPopover();}return;}}this._bNavigate=false;this._iStep=null;j=this.getContent();if(j){z1=this._getPopover();this._bApplyFilter=true;this._bNavigateRunning=true;T.call(this);a1.call(this,true);}if(!z1){this._bNavigate=true;this._iStep=i;return;}if(j){j.navigate(i);}};function v(i){var j=this._getPopover();var z1=i.getParameter("key");var A1=i.getParameter("description");var B1=i.getParameter("inParameters");var C1=i.getParameter("outParameters");var D1=i.getParameter("leave");var E1=i.getParameter("itemId");var F1;if(D1){this._oField.focus();return;}if(z1===undefined){this._bFocusPopover=true;}if(!j.isOpen()){this._bOpenHandled=true;this.open(true);this._bOpenHandled=false;}this._bNavigateRunning=false;if(z1===undefined){this._bFocusPopover=false;return;}F1=C.createItemCondition(z1,A1);F1.validated=b.Validated;if(B1){F1.inParameters=U.call(this,B1);}if(C1){F1.outParameters=W.call(this,C1);}this.setProperty("conditions",[F1],true);this.fireNavigate({value:A1,key:z1,condition:F1,itemId:E1});}s.prototype._getTextOrKey=function(i,j,z1,A1,B1,C1){var D1="";var E1=this.getContent();if(E1){var F1=E1.getListBinding();if(!F1){this.fireDataRequested();}if(z1&&!z1.getModel()){return null;}var G1=this.oBindingContexts[undefined];var H1=this.getInParameters();var I1=false;if(z1&&f.hasChanged(G1,z1)){I1=true;}var J1=w.call(this,H1,I1,z1,G1);D1=S.resolve().then(function(){return y.call(this,J1);}.bind(this)).then(function(){return S.resolve().then(function(){if(j){return E1.getTextForKey(i,$.call(this,A1,H1,false,J1,z1),Z.call(this,B1,true),C1);}else{return E1.getKeyForText(i,$.call(this,undefined,H1,false,J1,z1),C1);}}.bind(this)).then(function(D1){x.call(this,J1,I1);return z.call(this,D1);}.bind(this)).unwrap();}.bind(this)).unwrap();}return D1;};function w(j,z1,A1,B1){var C1=[];for(var i=0;i<j.length;i++){var D1=j[i];var E1=D1.getBinding("value");if(E1){var F1=E1.getPath();var G1=E1.getContext();if(z1&&(G1===B1||(!G1&&B1))){if(A1.getProperty(F1)===undefined){var H1=E1.getModel();C1.push(H1.bindProperty(F1,A1));}}else{if(!G1||G1.getProperty(F1)===undefined||E1.getValue()===undefined||!e(D1.validateProperty("value",G1.getProperty(F1)),D1.getValue())){C1.push(E1);}}}}return C1;}function x(j,z1){if(!z1){return;}for(var i=0;i<j.length;i++){j[i].destroy();}}function y(i){if(i.length===0){return null;}this.initControlDelegate();if(this.bDelegateInitialized){return this.getControlDelegate().checkBindingsPending(this.getPayload(),i);}else{return this.awaitControlDelegate().then(function(){return this.getControlDelegate().checkBindingsPending(this.getPayload(),i);}.bind(this));}}function z(i){if(i&&typeof i==="object"){i=m({},i);if(i.inParameters){i.inParameters=U.call(this,i.inParameters);}if(i.outParameters){i.outParameters=W.call(this,i.outParameters);}}return i;}s.prototype._isTextOrKeyRequestSupported=function(){var i=this.getContent();return!!i;};s.prototype.isUsableForValidation=function(){var i=this.getContent();return!!i;};function A(z1){var A1=z1.getParameter("selectedItems");var B1=z1.getParameter("itemPress");var C1;var D1=this.getConditions();var E1;var i=0;var j=0;var F1=false;var G1=this.getMaxConditions();for(i=D1.length-1;i>=0;i--){E1=D1[i];E1.inParameters=Y.call(this,E1.inParameters);E1.outParameters=Z.call(this,E1.outParameters);if(E1.validated===b.Validated){F1=false;for(j=0;j<A1.length;j++){C1=A1[j];if(E1.values[0]===C1.key&&(!E1.inParameters||!C1.inParameters||e(E1.inParameters,C1.inParameters))&&(!E1.outParameters||!C1.outParameters||e(E1.outParameters,C1.outParameters))){F1=true;if(E1.values[1]!==C1.description&&C1.description){if(E1.values.length===1){E1.values.push(C1.description);}else{E1.values[1]=C1.description;}}break;}}if(!F1){D1.splice(i,1);}}}for(i=0;i<A1.length;i++){C1=A1[i];F1=false;for(j=0;j<D1.length;j++){E1=D1[j];if(E1.validated===b.Validated&&E1.values[0]===C1.key&&(!E1.inParameters||e(E1.inParameters,C1.inParameters))&&(!E1.outParameters||e(E1.outParameters,C1.outParameters))){F1=true;E1.inParameters=C1.inParameters;E1.outParameters=C1.outParameters;break;}}if(!F1){E1=C.createItemCondition(C1.key,C1.description,C1.inParameters,C1.outParameters);E1.validated=b.Validated;D1.push(E1);}}if(G1>0&&D1.length>G1){D1.splice(0,D1.length-G1);}for(i=0;i<D1.length;i++){E1=D1[i];if(E1.inParameters){E1.inParameters=U.call(this,E1.inParameters);}else{delete E1.inParameters;}if(E1.outParameters){E1.outParameters=W.call(this,E1.outParameters);}else{delete E1.outParameters;}}if(this._bDialogOpen){this.setProperty("conditions",D1,true);}else{var H1=false;var I1=false;if(this.getMaxConditions()===1||B1){this.close();I1=true;}if(this.getMaxConditions()===1){H1=true;}this.setProperty("conditions",D1,true);this.fireSelect({conditions:D1,add:H1,close:I1});}}function E(i){var j=i.getParameter("contentChange");var z1=this.getContent();var A1=z1.getAsyncKeyText();if(j){var B1=this.getAggregation("_popover");var C1=this.getAggregation("_dialog");if(z1){if(B1&&this._bOpenIfContent){var D1=this._getField();if(D1){z1.fieldHelpOpen(true);B1.openBy(this._getControlForSuggestion());a1.call(this);}this._bOpenIfContent=false;}else if(C1){var E1=C1.getContent()[0];h1.call(this,E1,z1.getDialogContent());}}}if(!A1){this.fireDataUpdate();}}function G(j){var z1=false;var A1=this.isOpen()&&this.getShowConditionPanel();for(var i=0;i<j.length;i++){var B1=j[i];if(!B1.validated){a.checkConditionValidated(B1);z1=true;}}if(A1&&!this._iConditionsTimer){this._iConditionsTimer=setTimeout(function(){this._iConditionsTimer=null;H.call(this);}.bind(this),0);}if(z1){this.setConditions(j);}else{I.call(this);}}function H(){var j=false;var z1=this.getConditions();for(var i=0;i<z1.length;i++){var A1=z1[i];var B1=a.getOperator(A1.operator);try{B1.validate(A1.values,this._getFormatOptions().valueType);}catch(C1){j=true;}}this.setProperty("_enableOK",!j,true);}function I(){if(!this._oField){return;}var j=this.getContent();if(j){var z1=this.getConditions();var A1=[];for(var i=0;i<z1.length;i++){var B1=z1[i];if(B1.validated===b.Validated){A1.push({key:B1.values[0],description:B1.values[1],inParameters:Y.call(this,B1.inParameters),outParameters:Z.call(this,B1.outParameters)});}}if(!e(A1,j.getSelectedItems())){j.setSelectedItems(A1);}}}function J(i){var j=this.getFilterFields();if(!j){return;}var z1=t1.call(this,j);var A1=z1.length>0?z1[0].values[0]:"";if(i===A1){return;}v1.call(this,j);i=i.trim();if(i){this._bOwnFilterChange=false;var B1=C.createCondition("StartsWith",[i],undefined,undefined,b.NotValidated);u1.call(this,j,B1);}a1.call(this,true);}function K(i,j){var z1=i.getHelpPath();var A1=false;if(j==="remove"){this._oObserver.unobserve(i);if(this._getField()&&this.isOpen()){A1=N.call(this,z1);}}else{this._oObserver.observe(i,{properties:true});if(this._getField()&&this.isOpen()){var B1=i.getValue();var C1=i.getUseConditions();var D1=i.getInitialValueFilterEmpty();A1=N.call(this,z1);A1=L.call(this,z1,B1,C1,D1)||A1;I.call(this);}}a1.call(this,true);}function L(j,z1,A1,B1){var C1;var D1=false;if(j&&(z1||(B1&&!A1))){if(A1){if(Array.isArray(z1)){for(var i=0;i<z1.length;i++){C1=m({},z1[i]);if(C1.inParameters){C1.inParameters=Y.call(this,C1.inParameters);}if(C1.outParameters){C1.outParameters=Z.call(this,C1.outParameters);}u1.call(this,j,C1);D1=true;}}}else{if(!z1&&B1){C1=C.createCondition("Empty",[]);C1.isEmpty=false;}else{C1=C.createItemCondition(z1);C1.validated=b.Validated;}u1.call(this,j,C1);D1=true;}}return D1;}function N(i){var j=false;if(i&&t1.call(this,i).length>0){v1.call(this,i);j=true;}return j;}function P(i,j,z1,A1,B1){if(this._bNoInOutFilterUpdate){return;}if(!this._iUpdateTimer){this._iUpdateTimer=setTimeout(function(){this._iUpdateTimer=undefined;this.fireDataUpdate();}.bind(this),0);}if(!this._getField()||!this.isOpen()){return;}var C1=false;C1=N.call(this,i);C1=L.call(this,i,j,A1,B1)||C1;I.call(this);a1.call(this,true);}function Q(i,j,z1,A1,B1){if(!this._getField()||!this.isOpen()){return;}var C1=false;C1=N.call(this,j);C1=L.call(this,i,z1,A1,B1)||C1;a1.call(this,true);}function T(){var j=this.getInParameters();var z1=false;for(var i=0;i<j.length;i++){var A1=j[i];var B1=A1.getHelpPath();var C1=A1.getValue();var D1=A1.getUseConditions();var E1=A1.getInitialValueFilterEmpty();z1=N.call(this,B1)||z1;z1=L.call(this,B1,C1,D1,E1)||z1;}if(z1||(this._bApplyFilter&&this._bPendingFilterUpdate)){this._bPendingFilterUpdate=false;a1.call(this,true);}}s.prototype.onFieldChange=function(){var z1=this.getOutParameters();y1.call(this);var A1=w.call(this,z1,false);S.resolve().then(function(){return y.call(this,A1);}.bind(this)).then(function(){if(this.bIsDestroyed){return;}var B1=this.getConditions();for(var i=0;i<B1.length;i++){var C1=B1[i];if(C1.outParameters){for(var D1 in C1.outParameters){for(var j=0;j<z1.length;j++){var E1=z1[j];var F1=E1.getValue();var G1=E1.getUseConditions();var H1=true;if(E1.getMode()===O.WhenEmpty){if(G1){H1=!F1||(Array.isArray(F1)&&F1.length===0);}else{H1=!F1;}}if(H1){if(G1){var I1;if(!E1.getHelpPath()){I1=C.createCondition("EQ",[E1.getFixedValue()],undefined,undefined,b.NotValidated);}else if(E1.getFieldPath()===D1){I1=C.createCondition("EQ",[C1.outParameters[D1]],undefined,undefined,b.Validated);}else{continue;}if(!F1){F1=[];}if(!Array.isArray(F1)){throw new Error("Value on OutParameter must be an array "+E1);}if(a.indexOfCondition(I1,F1)<0){I1.validated=b.Validated;F1.push(I1);E1.setValue(F1);}}else{if(!E1.getHelpPath()){E1.setValue(E1.getFixedValue());}else if(E1.getFieldPath()===D1){E1.setValue(C1.outParameters[D1]);}}}}}}}}.bind(this)).unwrap();};function U(i){return X.call(this,i,this.getInParameters());}function W(i){return X.call(this,i,this.getOutParameters());}function X(j,z1){if(!j||z1.length===0){return null;}var A1={};for(var i=0;i<z1.length;i++){var B1=z1[i];var C1=B1.getHelpPath();var D1=B1.getFieldPath();if(C1&&D1){for(var E1 in j){if(C1===E1){A1[D1]=j[E1];break;}}}else if(!C1&&D1&&B1.getFixedValue){A1[D1]=B1.getFixedValue();}}return A1;}function Y(i){return $.call(this,i,this.getInParameters());}function Z(i,j){return $.call(this,i,this.getOutParameters(),j);}function $(z1,A1,B1,C1,D1){var E1;var F1;var G1;var H1;var i=0;if(A1.length>0){if(!z1){if(!B1){var I1=this.getBindingContext();for(i=0;i<A1.length;i++){F1=A1[i];G1=F1.getHelpPath();var J1=F1.getValue();if(C1||D1){var K1=F1.getBinding("value");var L1=false;if(K1){for(var j=0;j<C1.length;j++){if(K1.getPath()===C1[j].getPath()){J1=C1[j].getValue();L1=true;break;}}if(!L1&&D1&&(!K1.getContext()||(K1.getContext()!==D1&&K1.getContext()===I1))){J1=D1.getProperty(K1.getPath());}}}if(G1){if(!E1){E1={};}if(F1.getUseConditions()){if(J1.length>0){E1[G1]=J1[0].values[0];}}else{E1[G1]=J1;}}}}}else{for(var M1 in z1){for(i=0;i<A1.length;i++){F1=A1[i];G1=F1.getHelpPath();H1=F1.getFieldPath();if(H1&&H1===M1&&G1){if(!E1){E1={};}E1[G1]=z1[M1];}}}}}return E1;}function a1(i){if(i){if(!this._iFilterTimer){this._iFilterTimer=setTimeout(function(){this._iFilterTimer=undefined;a1.call(this);}.bind(this),0);}return;}else if(this._iFilterTimer){clearTimeout(this._iFilterTimer);this._iFilterTimer=undefined;}if((!this.isOpen()&&!this._bNavigateRunning&&!this._bOpen)||this._bClosing||!this._bApplyFilter){this._bPendingFilterUpdate=true;return;}if(this._bFilterWaitingForBinding){return;}var j=this.getInParameters();var z1=w.call(this,j,false);var A1=y.call(this,z1);if(A1 instanceof Promise){A1.then(function(){this._bFilterWaitingForBinding=false;a1.call(this,true);}.bind(this));this._bFilterWaitingForBinding=true;return;}var B1=this.getContent();if(B1){var C1=s1.call(this);var D1;if(C1){D1=C1.getInternalConditions();}else{D1=this._oConditions;}var E1=b1.call(this,D1);var F1=c.createFilters(D1,E1);var G1=[];var H1=D1["$search"];var I1;if(F1){G1.push(F1);}if(H1&&H1.length>0){I1=H1[0].values[0];}B1.applyFilters(G1,I1);}}function b1(j){var z1=this.getFilterBar();var A1=this.getInParameters();var B1;var C1;if(z1){B1=c.createConditionTypesMapFromFilterBar(j,z1);}else{B1={};for(C1 in j){B1[C1]={type:null};}}for(C1 in B1){if(!B1[C1].type){for(var i=0;i<A1.length;i++){var D1=A1[i];if(D1.getHelpPath()===C1){B1[C1].type=D1.getDataType();break;}}}}return B1;}s.prototype.getMaxConditions=function(){if(this._oField&&this._oField.getMaxConditionsForHelp){return this._oField.getMaxConditionsForHelp();}else if(this._oField&&this._oField.getMaxConditions){return this._oField.getMaxConditions();}else{return 1;}};s.prototype.getDisplay=function(){if(this._oField&&this._oField.getDisplay){return this._oField.getDisplay();}};s.prototype.getRequired=function(){if(this._oField&&this._oField.getRequired){return this._oField.getRequired();}else{return false;}};s.prototype.getDataType=function(){if(this._oField.getDataType){return this._oField.getDataType();}else{return"sap.ui.model.type.String";}};s.prototype._getFormatOptions=function(){if(this._oField&&this._oField._getFormatOptions){return this._oField._getFormatOptions();}else{return{};}};s.prototype._getKeyPath=function(){var i=this.getKeyPath();if(!i&&this._oField&&this._oField.getFieldPath&&this._oField.getFieldPath()){i=this._oField.getFieldPath();}return i;};s.prototype.clone=function(i,j){var z1=this.getContent();var A1=this.getFilterBar();if(z1){z1.detachEvent("navigate",v,this);z1.detachEvent("selectionChange",A,this);z1.detachEvent("dataUpdate",E,this);}if(A1){A1.detachEvent("search",q1,this);}var B1=F.prototype.clone.apply(this,arguments);if(z1){z1.attachEvent("navigate",v,this);z1.attachEvent("selectionChange",A,this);z1.attachEvent("dataUpdate",E,this);}if(A1){A1.attachEvent("search",q1,this);}return B1;};function c1(){var i;if((!k||!B||!V||!l||!n||!o||!p)&&!this._bDialogRequested){k=sap.ui.require("sap/m/Dialog");B=sap.ui.require("sap/m/Button");V=sap.ui.require("sap/ui/mdc/field/ValueHelpPanel");l=sap.ui.require("sap/ui/mdc/field/DefineConditionPanel");n=sap.ui.require("sap/ui/model/base/ManagedObjectModel");o=sap.ui.require("sap/ui/mdc/filterbar/vh/FilterBar");p=sap.ui.require("sap/ui/mdc/FilterField");if(!k||!B||!V||!l||!n||!o||!p){sap.ui.require(["sap/m/Dialog","sap/m/Button","sap/ui/mdc/field/ValueHelpPanel","sap/ui/mdc/field/DefineConditionPanel","sap/ui/model/base/ManagedObjectModel","sap/ui/mdc/filterbar/vh/FilterBar","sap/ui/mdc/FilterField"],f1.bind(this));this._bDialogRequested=true;}}if(k&&B&&V&&l&&n&&o&&p&&!this._bDialogRequested){if(!this._oResourceBundle){this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");}var j=new B(this.getId()+"-ok",{text:this._oResourceBundle.getText("valuehelp.OK"),enabled:"{$help>/_enableOK}",type:q.Emphasized,press:k1.bind(this)});var z1=new B(this.getId()+"-cancel",{text:this._oResourceBundle.getText("valuehelp.CANCEL"),press:l1.bind(this)});this._oManagedObjectModel=new n(this);var A1=g1.call(this);i=new k(this.getId()+"-dialog",{contentHeight:d1(),contentWidth:e1(),horizontalScrolling:false,verticalScrolling:false,title:"{$help>/title}",resizable:true,draggable:true,content:[A1],afterOpen:m1.bind(this),afterClose:n1.bind(this),buttons:[j,z1]}).setModel(this._oManagedObjectModel,"$help");i.isPopupAdaptationAllowed=function(){return false;};this.setAggregation("_dialog",i,true);this.setModel(new R({bundleName:"sap/ui/mdc/messagebundle",async:false}),"$i18n");o1.call(this,this.getShowConditionPanel());}return i;}function d1(){if(D.system.desktop){return"700px";}if(D.system.tablet){return D.orientation.landscape?"600px":"600px";}}function e1(){if(D.system.desktop){return"1080px";}if(D.system.tablet){return D.orientation.landscape?"920px":"600px";}}function f1(i,j,z1,A1,B1,C1,D1){k=i;B=j;V=z1;l=A1;n=B1;o=C1;p=D1;this._bDialogRequested=false;if(!this._bIsBeingDestroyed){c1.call(this);if(this._bOpen){this.open();}}}function g1(){var i=this.getContent();var j=s1.call(this);var z1=new V(this.getId()+"-VHP",{height:"100%",showFilterbar:!!j,formatOptions:this._getFormatOptions()});z1.setModel(this._oManagedObjectModel,"$help");if(i){i.initialize(false);h1.call(this,z1,i.getDialogContent());}if(j){z1.setFilterbar(j);}return z1;}function h1(i,j){i.setTable(j);}function i1(i,j){var z1=this.getAggregation("_popover");var A1=this.getAggregation("_dialog");if(i==="remove"){j.detachEvent("navigate",v,this);j.detachEvent("selectionChange",A,this);j.detachEvent("dataUpdate",E,this);j=undefined;}else{j.attachEvent("navigate",v,this);j.attachEvent("selectionChange",A,this);j.attachEvent("dataUpdate",E,this);I.call(this);}this.fireDataUpdate();if(this._bNavigate){this.navigate(this._iStep);}else if(z1){z1.invalidate();var B1=this.getFilterValue();if(B1){J.call(this,B1);}T.call(this);if(j&&this._bOpenIfContent){j.initialize(true);var C1=this._getField();if(C1){j.fieldHelpOpen(true);z1.openBy(this._getControlForSuggestion());}this._bOpenIfContent=false;}}else if(j&&this._bOpenIfContent){this._bOpenIfContent=false;this.open(true);}if(A1){if(j){j.initialize(false);var D1=A1.getContent()[0];D1.setShowTokenizer(this.getMaxConditions()!==1);h1.call(this,D1,j.getDialogContent());if(A1.isOpen()||this._bOpen){j.fieldHelpOpen(false);}}}}function j1(){var i=this.getAggregation("_dialog");if(!i){i=c1.call(this);}return i;}function k1(i){this.close();var j=this.getConditions();j=C._removeEmptyConditions(j);a.updateConditionsValues(j);this.setProperty("conditions",j,true);this._bOK=true;}function l1(i){this.close();this.setProperty("conditions",this._aOldConditions,true);}function m1(i){}function n1(i){this._bDialogOpen=false;this._aOldConditions=undefined;this._handleAfterClose(i);if(this._bOK){var j=this.getConditions();this.fireSelect({conditions:j,add:false,close:true});}this._bOK=undefined;this.setProperty("_enableOK",true,true);if(this._iConditionsTimer){clearTimeout(this._iConditionsTimer);this._iConditionsTimer=null;}}function o1(i){var j=this.getAggregation("_dialog");if(j&&this._oField){var z1=j.getContent()[0];if(i){if(!z1._oDefineConditionPanel){var A1=new l(this.getId()+"-DCP",{label:"{$help>/title}"});z1.setDefineConditions(A1);}}else{z1.setDefineConditions();}}}function p1(i,j,z1){if(i==="remove"){j.detachEvent("search",q1,this);if(!z1){var A1=j.getBasicSearchField();if(A1&&A1._bCreadedByFVH){j.setBasicSearchField();A1.destroy();}}j=undefined;}else{j.attachEvent("search",q1,this);}var B1=this.getAggregation("_dialog");if(B1){var C1=B1.getContent()[0];C1.setFilterbar(j);C1.setShowFilterbar(!!j);if(this.isOpen()){r1.call(this);if(!z1||i==="remove"){w1.call(this,i==="remove");}}}}function q1(i){var j=s1.call(this);if(j){var z1=this.getFilterFields();if(z1&&!this._bUpdateFilterAfterClose){var A1=t1.call(this,z1);var B1=A1.length>0?A1[0].values[0]:"";if(B1!==this.getFilterValue()){this.setProperty("filterValue",B1,true);}}if(this._bApplyFilter||(!this._bApplyFilter&&(i||j.getLiveMode()))){this._bApplyFilter=true;a1.call(this,true);}}}function r1(){var i=s1.call(this);if(i){i.setInternalConditions({});}J.call(this,this.getFilterValue());T.call(this);}function s1(){var i=this.getFilterBar();if(!i){i=this.getAggregation("_filterBar");}return i;}function t1(i){var j=s1.call(this);var z1;if(j){z1=j.getInternalConditions();}else{z1=this._oConditions;}return z1[i]||[];}function u1(i,j){var z1=s1.call(this);var A1;if(z1){A1=z1.getInternalConditions();}else{A1=this._oConditions;}if(!A1[i]){A1[i]=[];}A1[i].push(j);if(z1){z1.setInternalConditions(A1);}}function v1(i){var j=s1.call(this);var z1;if(j){z1=j.getInternalConditions();}else{z1=this._oConditions;}if(z1[i]&&z1[i].length>0){z1[i]=[];}if(j){z1=j.setInternalConditions(z1);}}function w1(i){if(i){if(!this._iSearchFieldTimer){this._iSearchFieldTimer=setTimeout(function(){this._iSearchFieldTimer=undefined;w1.call(this,false);}.bind(this),0);}return;}else if(this._iSearchFieldTimer){clearTimeout(this._iSearchFieldTimer);this._iSearchFieldTimer=null;}var j=this.getFilterFields();var z1=this.getContent();if(j&&z1){var A1=s1.call(this);if(!A1){A1=new o(this.getId()+"-FB",{liveMode:!z1.isSuspended(),showGoButton:false});this.setAggregation("_filterBar",A1,true);}if(!A1.getBasicSearchField()){var B1=new p(this.getId()+"-search",{conditions:"{$filters>/conditions/"+j+"}",placeholder:"{$i18n>filterbar.SEARCH}",label:"{$i18n>filterbar.SEARCH}",maxConditions:1,width:"50%"});B1._bCreadedByFVH=true;A1.setBasicSearchField(B1);}}}function x1(){var i=this.getContent();if(i){return i.getSuggestionContent();}}function y1(){var i=this._oField?this._oField.getBindingContext():null;this.setBindingContext(i);}s.prototype.getScrollDelegate=function(){var i=this.getAggregation("_dialog");if(i&&(i.isOpen()||i.oPopup.getOpenState()===r.OPENING)){var j=this.getContent();var z1=j&&j.getDialogContent();if(z1&&z1.getScrollDelegate){return z1.getScrollDelegate();}else{return undefined;}}else{return F.prototype.getScrollDelegate.apply(this,arguments);}};s.prototype._fireOpen=function(i){if(!this._bOpenHandled){return F.prototype._fireOpen.apply(this,arguments);}return true;};s.prototype.getRoleDescription=function(i){if(!i||i===1){return null;}else if(!this.getContent()&&this.getShowConditionPanel()&&!this.getNoDialog()){return null;}else{if(!this._oResourceBundleM){this._oResourceBundleM=sap.ui.getCore().getLibraryResourceBundle("sap.m");}return this._oResourceBundleM.getText("MULTICOMBOBOX_ARIA_ROLE_DESCRIPTION");}};s.prototype.getValueHelpEnabled=function(){if(this.getNoDialog()){return false;}else{return true;}};return s;});
