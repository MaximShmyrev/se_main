/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./Control","./ActionToolbar","./table/TableSettings","./table/GridTableType","./table/ResponsiveTableType","./table/PropertyHelper","./mixin/FilterIntegrationMixin","./library","sap/m/Text","sap/m/Title","sap/m/ColumnHeaderPopover","sap/m/ColumnPopoverSortItem","sap/m/OverflowToolbar","sap/m/library","sap/ui/core/Core","sap/ui/core/format/NumberFormat","sap/ui/core/dnd/DragDropInfo","sap/ui/core/Item","sap/ui/core/format/ListFormat","sap/ui/events/KeyCodes","sap/ui/model/Sorter","sap/ui/dom/containsOrEquals","sap/base/strings/capitalize","sap/base/util/deepEqual","sap/ui/core/InvisibleMessage","sap/ui/core/InvisibleText"],function(C,A,T,G,R,P,F,l,a,b,c,d,O,M,e,N,D,I,L,K,S,f,g,h,i,j){"use strict";var k=l.SelectionMode;var m=l.TableType;var n=l.RowAction;var o=M.ToolbarDesign;var p=M.ToolbarStyle;var s="sap.ui.mdc.IFilter";var q=new window.WeakMap();var r=function(Q){if(!q.has(Q)){q.set(Q,{oFilterInfoBar:null});}return q.get(Q);};function t(Q,V){sap.ui.require(["sap/m/MessageToast"],function(U){var W=e.getLibraryResourceBundle("sap.ui.mdc");U.show(W.getText(Q,V));});}var u=C.extend("sap.ui.mdc.Table",{metadata:{library:"sap.ui.mdc",designtime:"sap/ui/mdc/designtime/table/Table.designtime",interfaces:["sap.ui.mdc.IFilterSource","sap.ui.mdc.IxState"],defaultAggregation:"columns",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null,invalidate:true},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null,invalidate:true},rowAction:{type:"sap.ui.mdc.RowAction[]",defaultValue:[]},p13nMode:{type:"sap.ui.mdc.TableP13nMode[]",defaultValue:[]},delegate:{type:"object",defaultValue:{name:"sap/ui/mdc/TableDelegate",payload:{}}},headerLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:sap.ui.core.TitleLevel.Auto},rowsBindingInfo:{type:"object",defaultValue:null},autoBindOnInit:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},headerVisible:{type:"boolean",group:"Misc",defaultValue:true},selectionMode:{type:"sap.ui.mdc.SelectionMode",defaultValue:k.None},showRowCount:{type:"boolean",group:"Misc",defaultValue:true},threshold:{type:"int",group:"Appearance",defaultValue:-1},noDataText:{type:"string"},sortConditions:{type:"object"},filterConditions:{type:"object",defaultValue:{}},enableExport:{type:"boolean",defaultValue:false},busyIndicatorDelay:{type:"int",defaultValue:100}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},type:{type:"sap.ui.mdc.table.TableTypeBase",altTypes:["sap.ui.mdc.TableType"],multiple:false},columns:{type:"sap.ui.mdc.table.Column",multiple:true},creationRow:{type:"sap.ui.mdc.table.CreationRow",multiple:false},actions:{type:"sap.ui.core.Control",multiple:true,forwarding:{getter:"_createToolbar",aggregation:"actions"}},variant:{type:"sap.ui.fl.variants.VariantManagement",multiple:false},quickFilter:{type:"sap.ui.core.Control",multiple:false},rowSettings:{type:"sap.ui.mdc.table.RowSettings",multiple:false}},associations:{filter:{type:s,multiple:false}},events:{rowPress:{parameters:{bindingContext:{type:"sap.ui.model.Context"}}},selectionChange:{parameters:{bindingContext:{type:"sap.ui.model.Context"},selected:{type:"boolean"},selectAll:{type:"boolean"}}},beforeExport:{parameters:{exportSettings:{type:"object"},userExportSettings:{type:"object"}}},paste:{parameters:{data:{type:"string[][]"}}}}},constructor:function(){this._oTableReady=new Promise(this._resolveTable.bind(this));this._pFullInitialize=new Promise(this._resolveFullInitialization.bind(this));this._oAdaptationController=null;C.apply(this,arguments);this.bCreated=true;this._doOneTimeOperations();this._initializeContent();},renderer:{apiVersion:2,render:function(Q,U){Q.openStart("div",U);Q.class("sapUiMdcTable");Q.style("height",U.getHeight());Q.style("width",U.getWidth());Q.openEnd();Q.renderControl(U.getAggregation("_content"));Q.close("div");}}});var v=["variant","quickFilter"];F.call(u.prototype);v.forEach(function(Q){var U=g(Q),V="_o"+U,W="get"+U,X="set"+U,Y="destroy"+U;u.prototype[W]=function(){return this[V];};u.prototype[Y]=function(){var Z=this[V];this[X]();if(Z){Z.destroy();}return this;};u.prototype[X]=function(Z){this.validateAggregation(Q,Z,false);var $=this._createToolbar(),_=Z!==this[V];if(!Z||_){$.removeBetween((this[W]()));this[V]=Z;}if(_&&Z){this._setToolbarBetween($);}return this;};});u.prototype.init=function(){C.prototype.init.apply(this,arguments);this.mSkipPropagation={rowSettings:true};var Q=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");this.setProperty("adaptationConfig",{itemConfig:{changeOperations:{add:"addColumn",remove:"removeColumn",move:"moveColumn"},adaptationUI:"sap/ui/mdc/p13n/panels/SelectionPanel",containerSettings:{title:Q.getText("table.SETTINGS_COLUMN")}}});};u.prototype.applySettings=function(){C.prototype.applySettings.apply(this,arguments);this.initControlDelegate();};u.prototype._setToolbarBetween=function(Q){[this._oVariant,this._oQuickFilter].forEach(function(U){if(U){Q.addBetween(U);}});};u.prototype.initialized=function(){return this._oTableReady;};u.prototype._resolveTable=function(Q,U){this._fResolve=Q;this._fReject=U;};u.prototype._fullyInitialized=function(){return this._pFullInitialize;};u.prototype._resolveFullInitialization=function(Q,U){this._fnResolveFullInit=Q;this._fnRejectFullInit=U;};u.prototype._getStringType=function(Q){var U,V=U=Q||this.getType();if(!V){U=m.Table;}else if(typeof V==="object"){if(V.isA("sap.ui.mdc.table.ResponsiveTableType")){U=m.ResponsiveTable;}else{U=m.Table;}}return U;};u.prototype._updateTypeSettings=function(){var Q=this.getType();if(Q&&typeof Q==="object"){Q.updateTableSettings();}else{if(Q==="ResponsiveTable"){Q=R;}else{Q=G;}Q.updateDefault(this._oTable);}};u.prototype.scrollToIndex=function(Q){return new Promise(function(U,V){if(!this._oTable){return V();}if(typeof Q!=="number"){return V("The iIndex parameter has to be a number");}if(this._getStringType()===m.ResponsiveTable){this._oTable.scrollToIndex(Q).then(U).catch(V);}else{if(Q===-1){Q=this.getRowBinding()?this.getRowBinding().getLength():0;}if(this._oTable._setFirstVisibleRowIndex(Q)){this._oTable.attachEventOnce("rowsUpdated",function(){U();});}else{U();}}}.bind(this));};u.prototype.focusRow=function(Q,U){return this.scrollToIndex(Q).then(function(){return this._oTable._setFocus(Q,U);}.bind(this));};u.prototype.setType=function(Q){var U=this._getStringType(Q);var V=this._getStringType();this.setAggregation("type",Q,true);if(U===V&&this._oTable){this._updateTypeSettings();return this;}if(this.bCreated){if(this._oTable){if(V==="ResponsiveTable"){this._oTable.setHeaderToolbar();}else{this._oTable.removeExtension(this._oToolbar);}this._oTable.destroy("KeepDom");this._oTable=null;this._bTableExists=false;}else{this._onAfterTableCreated();this._onAfterFullInitialization();}if(this._oTemplate){this._oTemplate.destroy();this._oTemplate=null;}this._oTableReady=new Promise(this._resolveTable.bind(this));this._bFullyInitialized=false;this._pFullInitialize=new Promise(this._resolveFullInitialization.bind(this));this._initializeContent();}return this;};u.prototype.setRowSettings=function(Q){var U=this._getStringType();this.setAggregation("rowSettings",Q,true);if(this._oTable){if(U==="ResponsiveTable"){R.updateRowSettings(this._oTemplate,Q);this.checkAndRebind();}else{G.updateRowSettings(this._oTable,Q);}}return this;};u.prototype.setHeaderLevel=function(Q){if(this.getHeaderLevel()===Q){return this;}this.setProperty("headerLevel",Q,true);this._oTitle&&this._oTitle.setLevel(Q);return this;};u.prototype.focus=function(Q){var U=this.getDomRef();if(this._oTable&&U&&!f(U,document.activeElement)){this._oTable.focus();}};u.prototype.setBusy=function(Q){this.setProperty('busy',Q,true);if(this._oTable){this._oTable.setBusy(Q);}return this;};u.prototype.setBusyIndicatorDelay=function(Q){this.setProperty('busyIndicatorDelay',Q,true);if(this._oTable){this._oTable.setBusyIndicatorDelay(Q);}return this;};u.prototype.setSelectionMode=function(Q){var U=this.getSelectionMode();this.setProperty("selectionMode",Q,true);if(this._oTable&&U!=this.getSelectionMode()){this._updateSelectionBehavior();}return this;};u.prototype.setRowAction=function(Q){var U=this.getRowAction();this.setProperty("rowAction",Q,true);if(!h(U.sort(),this.getRowAction().sort())){this._updateRowAction();}return this;};u.prototype.setCreationRow=function(Q){this.setAggregation("creationRow",Q,true);if(Q){Q.update();}return this;};u.prototype.setP13nMode=function(Q){var U=this.getP13nMode();this.setProperty("p13nMode",Q,true);if(!h(U.sort(),this.getP13nMode().sort())){w(this);}return this;};function w(Q){if(Q._oToolbar){Q._oToolbar.destroyEnd();Q._getP13nButtons().forEach(function(V){Q._oToolbar.addEnd(V);});}if(Q._oTable){var U=Q._oTable.getDragDropConfig()[0];if(U){U.setEnabled(Q.getP13nMode().indexOf("Column")>-1);}}if(Q.isFilteringEnabled()){y(Q);}x(Q);}u.prototype.setFilterConditions=function(Q){this.setProperty("filterConditions",Q,true);var U=this.getInbuiltFilter();if(U){U.setFilterConditions(Q);}x(this);return this;};function x(Q){var U=B(Q);var V=E(Q);var W=H(Q);if(!U){return;}if(W.length===0||!Q.isFilteringEnabled()){var X=U.getDomRef();if(X&&X.contains(document.activeElement)){Q.focus();}U.setVisible(false);return;}Q._fullyInitialized().then(function(){var Y=W.map(function(a1){return Q.getPropertyHelper().getLabel(a1);});var Z=e.getLibraryResourceBundle("sap.ui.mdc");var $=L.getInstance();var _=Z.getText("table.FILTER_INFO",$.format(Y));U.setVisible(true);V.setText(_);});}function y(Q){if(!Q._oTable){return;}var U=B(Q);if(!U){U=z(Q);}if(Q._bMobileTable){if(Q._oTable.getInfoToolbar()!==U){Q._oTable.setInfoToolbar(U);Q._oTable.addAriaLabelledBy(E(Q));}}else if(Q._oTable.indexOfExtension(U)===-1){Q._oTable.insertExtension(U,1);Q._oTable.addAriaLabelledBy(E(Q));}}function z(Q){var U=Q.getId()+"-filterInfoBar";var V=r(Q).oFilterInfoBar;if(V&&!V.bIsDestroyed){V.destroy();}V=new O({id:U,active:true,design:o.Info,visible:false,content:[new a({id:U+"-text",wrapping:false})],press:function(){T.showPanel(Q,"Filter",V);}});V.focus=function(){if(this.getDomRef()){O.prototype.focus.apply(this,arguments);}else{Q.focus();}};r(Q).oFilterInfoBar=V;x(Q);return V;}function B(Q){var U=r(Q).oFilterInfoBar;if(U&&(U.bIsDestroyed||U.bIsBeingDestroyed)){return null;}return r(Q).oFilterInfoBar;}function E(Q){var U=B(Q);return U?U.getContent()[0]:null;}u.prototype.setThreshold=function(Q){this.setProperty("threshold",Q,true);if(!this._oTable){return this;}Q=this.getThreshold()>-1?this.getThreshold():undefined;if(this._bMobileTable){this._oTable.setGrowingThreshold(Q);}else{this._oTable.setThreshold(Q);}return this;};u.prototype._onFilterProvided=function(Q){this._updateInnerTableNoDataText();};u.prototype._onFilterRemoved=function(Q){this._updateInnerTableNoDataText();};u.prototype._onFiltersChanged=function(Q){if(this.isTableBound()&&Q.getParameter("conditionsBased")){this._oTable.setShowOverlay(true);}};u.prototype._onFilterSearch=function(Q){this._bIgnoreChange=true;this._bAnnounceTableUpdate=true;};u.prototype.setNoDataText=function(Q){this.setProperty("noDataText",Q,true);this._updateInnerTableNoDataText();return this;};u.prototype._updateInnerTableNoDataText=function(){if(!this._oTable){return;}var Q=this._getNoDataText();if(this._bMobileTable){this._oTable.setNoDataText(Q);}else{this._oTable.setNoData(Q);}};u.prototype._getNoDataText=function(){var Q=this.getNoDataText();if(Q){return Q;}var U=e.getLibraryResourceBundle("sap.ui.mdc");if(!this.isTableBound()){if(this.getFilter()){return U.getText("table.NO_DATA_WITH_FILTERBAR");}return U.getText("table.NO_DATA");}return U.getText("table.NO_RESULTS");};u.prototype._updateRowAction=function(){if(!this._oTable){return;}var Q=this.getRowAction().indexOf(n.Navigation)>-1;var U=this._bMobileTable?R:G;U.updateRowAction(this,Q,this._bMobileTable?undefined:this._onRowActionPress);};u.prototype._initializeContent=function(){var Q,U=this._getStringType();if(U==="ResponsiveTable"){Q=R;}else{Q=G;}var V=[this.awaitControlDelegate(),Q.loadTableModules(),this.retrieveAdaptationController()];if(this.isFilteringEnabled()){V.push(this.retrieveInbuiltFilter());}Promise.all(V).then(function(){if(this.bIsDestroyed){return;}var W=this.getControlDelegate();if(W.preInit){this._pDelegatePreInit=W.preInit(this);}if(!this._bTableExists&&U===this._getStringType()){this._bMobileTable=U==="ResponsiveTable";this._createContent();this._bTableExists=true;}}.bind(this));};u.prototype._doOneTimeOperations=function(){if(!this.bColumnsOrdered){this.bColumnsOrdered=true;this._orderColumns();}};u.prototype._onAfterTableCreated=function(Q){if(Q&&this._fResolve){this._fResolve(this);}else if(this._fReject){this._fReject(this);}delete this._fResolve;delete this._fReject;};u.prototype._onAfterFullInitialization=function(Q){if(Q&&this._fnResolveFullInit){this._fnResolveFullInit(this);}else if(this._fnRejectFullInit){this._fnRejectFullInit(this);}delete this._fnResolveFullInit;delete this._fnRejectFullInit;};u.prototype._createContent=function(){this._createToolbar();this._createTable();this._updateRowAction();this.getColumns().forEach(this._insertInnerColumn,this);this.setAggregation("_content",this._oTable);this._onAfterTableCreated(true);var Q=this.initialized().then(function(){this.initPropertyHelper(P);var U=this.getCreationRow();if(U){U.update();}if(this.getAutoBindOnInit()){this.checkAndRebind();}return this.awaitPropertyHelper();}.bind(this));Promise.all([Q,this._pDelegatePreInit]).then(function(){delete this._pDelegatePreInit;this._bFullyInitialized=true;this._onAfterFullInitialization(true);}.bind(this));};u.prototype.setHeader=function(Q){this.setProperty("header",Q,true);this._updateHeaderText();this._updateExportState(true);return this;};u.prototype.setHeaderVisible=function(V){this.setProperty("headerVisible",V,true);if(this._oTitle){this._oTitle.setWidth(this.getHeaderVisible()?undefined:"0px");}return this;};u.prototype.setEnableExport=function(Q){if(Q!==this.getEnableExport()){this.setProperty("enableExport",Q,true);if(Q&&!this._oExportButton&&this._oToolbar){this._oToolbar.addEnd(this._getExportButton());}else if(this._oExportButton){this._oExportButton.setVisible(Q);}}return this;};u.prototype._createToolbar=function(){if(!this._oToolbar){this._oTitle=new b(this.getId()+"-title",{text:this.getHeader(),width:this.getHeaderVisible()?undefined:"0px",level:this.getHeaderLevel()});this._oToolbar=new A(this.getId()+"-toolbar",{design:o.Transparent,style:this._getStringType()===m.ResponsiveTable?p.Standard:p.Clear,begin:[this._oTitle],end:[this._getP13nButtons(),this._getExportButton()]});}return this._oToolbar;};u.prototype._getVisibleProperties=function(){var Q=[],U;this.getColumns().forEach(function(V,W){U=V&&V.getDataProperty();if(U){Q.push({name:U});}});return Q;};u.prototype.getConditions=function(){return this.getInbuiltFilter()?this.getInbuiltFilter().getConditions():[];};u.prototype._getSortedProperties=function(){return this.getSortConditions()?this.getSortConditions().sorters:[];};function H(Q){var U=Q.getFilterConditions();return Object.keys(U).filter(function(V){return U[V].length>0;});}u.prototype.getCurrentState=function(){var Q={};var U=this.getP13nMode();if(U.indexOf("Column")>-1){Q.items=this._getVisibleProperties();}if(this.isSortingEnabled()){Q.sorters=this._getSortedProperties();}if(this.isFilteringEnabled()){Q.filter=this.getFilterConditions();}return Q;};u.prototype.isFilteringEnabled=function(){return this.getP13nMode().indexOf("Filter")>-1;};u.prototype.retrieveInbuiltFilter=function(){var Q=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");return C.prototype.retrieveInbuiltFilter.call(this,this._registerInnerFilter).then(function(U){var V={adaptationUI:U,applyFilterChangeOn:U,initializeControl:U.createFilterFields,sortData:false,containerSettings:{title:Q.getText("filter.PERSONALIZATION_DIALOG_TITLE")}};this.enhanceAdaptationConfig({filterConfig:V});return U;}.bind(this));};u.prototype.isSortingEnabled=function(){return this.getP13nMode().indexOf("Sort")>-1;};u.prototype._getP13nButtons=function(){var Q=this.getP13nMode();var U=[];if(this.isSortingEnabled()){U.push(T.createSortButton(this.getId(),[this._showSort,this]));}if(this.isFilteringEnabled()){U.push(T.createFilterButton(this.getId(),[this._showFilter,this]));}if(Q.indexOf("Column")>-1){U.push(T.createColumnsButton(this.getId(),[this._showSettings,this]));}return U;};u.prototype._getExportButton=function(){if(!this.getEnableExport()){return null;}var Q={fileName:this.getHeader()};if(!this._cachedExportSettings){this._cachedExportSettings=Q;}if(!this._oExportButton){this._oExportButton=T.createExportButton(this.getId(),{"default":[function(){this._onExport(Q);},this],"exportAs":[this._onExportAs,this]});}this._updateExportState();return this._oExportButton;};u.prototype._updateExportState=function(U){var Q=this._getRowBinding();if(this._oExportButton){this._oExportButton.setEnabled(!!(Q&&Q.getLength()>0));if(U&&this._cachedExportSettings){this._cachedExportSettings.fileName=this.getHeader();}}};u.prototype._createExportColumnConfiguration=function(Q){var U=Q&&Q.splitCells;var V=this.getColumns();return this._fullyInitialized().then(function(){var W=this.getPropertyHelper();var X=[];V.forEach(function(Y){var Z=W.getColumnExportSettings(Y,U);X=X.concat(Z);},this);return[X,W];}.bind(this));};u.prototype._onExport=function(Q){return this._createExportColumnConfiguration(Q).then(function(U){var V=U[0];var W=U[1];if(!V||!V.length){sap.ui.require(["sap/m/MessageBox"],function(Z){Z.error(e.getLibraryResourceBundle("sap.ui.mdc").getText("table.NO_COLS_EXPORT"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});}.bind(this));return;}var X=this._getRowBinding();var Y={workbook:{columns:V},dataSource:X,fileName:Q?Q.fileName:this.getHeader()};this._loadExportLibrary().then(function(){sap.ui.require(["sap/ui/export/ExportUtils","sap/ui/export/Spreadsheet"],function(Z,$){var _=Promise.resolve();if(Q.includeFilterSettings){_=Z.parseFilterConfiguration(X,function(a1){return W.getLabel(a1);}).then(function(a1){if(a1){Y.workbook.context={metaSheetName:a1.name,metainfo:[a1]};}});}_.then(function(){var a1={splitCells:false,includeFilterSettings:false};if(Q){a1.splitCells=Q.splitCells;a1.includeFilterSettings=Q.includeFilterSettings;}var b1=new $(Y);b1.attachBeforeExport(function(c1){this.fireBeforeExport({exportSettings:c1.getParameter("exportSettings"),userExportSettings:a1});},this);b1.build().finally(function(){b1.destroy();});}.bind(this));}.bind(this));}.bind(this));}.bind(this));};u.prototype._onExportAs=function(){var Q=this;this._loadExportLibrary().then(function(){sap.ui.require(['sap/ui/export/ExportUtils'],function(U){U.getExportSettingsViaDialog(Q._cachedExportSettings,Q).then(function(V){Q._cachedExportSettings=V;Q._onExport(V);});});});};u.prototype._loadExportLibrary=function(){if(!this._oExportLibLoadPromise){this._oExportLibLoadPromise=e.loadLibrary("sap.ui.export",true);}return this._oExportLibLoadPromise;};u.prototype.onkeydown=function(Q){if(Q.isMarked()){return;}if((Q.metaKey||Q.ctrlKey)&&Q.shiftKey&&Q.which===K.E){if(this.getEnableExport()&&this._oExportButton&&this._oExportButton.getEnabled()){this._onExportAs();Q.setMarked();Q.preventDefault();}}};u.prototype._createTable=function(){var Q=this.getThreshold()>-1?this.getThreshold():undefined;var U=this.getRowSettings()?this.getRowSettings().getAllSettings():{};if(this._bMobileTable){this._oTable=R.createTable(this.getId()+"-innerTable",{autoPopinMode:true,growing:true,sticky:["ColumnHeaders","HeaderToolbar","InfoToolbar"],itemPress:[this._onItemPress,this],selectionChange:[this._onSelectionChange,this],growingThreshold:Q,noDataText:this._getNoDataText(),headerToolbar:this._oToolbar,ariaLabelledBy:[this._oTitle]});this._oTemplate=R.createTemplate(this.getId()+"-innerTableRow",U);this._createColumn=u.prototype._createMobileColumn;this._sAggregation="items";this._oTable.bindRows=this._oTable.bindItems;this._oTable.bActiveHeaders=true;this._oTable.attachEvent("columnPress",this._onResponsiveTableColumnPress,this);}else{this._oTable=G.createTable(this.getId()+"-innerTable",{enableBusyIndicator:true,enableColumnReordering:false,threshold:Q,cellClick:[this._onCellClick,this],noData:this._getNoDataText(),extension:[this._oToolbar],ariaLabelledBy:[this._oTitle],plugins:[G.createMultiSelectionPlugin(this,[this._onRowSelectionChange,this])],columnSelect:[this._onGridTableColumnPress,this],rowSettingsTemplate:U});this._createColumn=u.prototype._createColumn;this._sAggregation="rows";}this._updateTypeSettings();this._updateSelectionBehavior();var V=new D({sourceAggregation:"columns",targetAggregation:"columns",dropPosition:"Between",enabled:this.getP13nMode().indexOf("Column")>-1,drop:[this._onColumnRearrange,this]});V.bIgnoreMetadataCheck=true;this._oTable.addDragDropConfig(V);this._oTable.setBusyIndicatorDelay(this.getBusyIndicatorDelay());this._oTable.attachPaste(this._onInnerTablePaste,this);if(this.isFilteringEnabled()){y(this);}};u.prototype._updateSelectionBehavior=function(){var Q=this._bMobileTable?R:G;Q.updateSelection(this);};u.prototype._onColumnRearrange=function(Q){var U=Q.getParameter("draggedControl");var V=Q.getParameter("droppedControl");if(U===V){return;}var W=Q.getParameter("dropPosition");var X=this._oTable.indexOfColumn(U);var Y=this._oTable.indexOfColumn(V);var Z=Y+(W=="Before"?0:1)+(X<Y?-1:0);T.moveColumn(this,X,Z);};u.prototype._onColumnPress=function(Q){var U,V=Q.getParent(),W;U=V.indexOfColumn(Q);W=this.getColumns()[U];this._fullyInitialized().then(function(){if(this.isSortingEnabled()){var X=this.getPropertyHelper().getSortableProperties(W.getDataProperty()).map(function($){return new I({text:$.getLabel(),key:$.getName()});});if(X.length>0){if(this._oPopover){this._oPopover.destroy();}this._oPopover=new c({items:[new d({items:X,sort:[this._onCustomSort,this]})]});Q.addDependent(this._oPopover);}}var Y=this.getControlDelegate();var Z=Y.addColumnMenuItems&&Y.addColumnMenuItems(this,W);Z&&Z.forEach(function($){$&&this._createPopover($,Q);}.bind(this));this._oPopover&&this._oPopover.openBy(Q);}.bind(this));};u.prototype._createPopover=function(Q,U){if(this._oPopover){this._oPopover.addItem(Q);}else{this._oPopover=new c({items:Q});U.addDependent(this._oPopover);}};u.prototype._onCustomSort=function(Q){var U=Q.getParameter("property");T.createSort(this,U,true);};u.prototype._insertInnerColumn=function(Q,U){if(!this._oTable){return;}var V=this._createColumn(Q);J(this,Q,V,U);var W=this.getControlDelegate();W&&W._onColumnChange&&W._onColumnChange(this);if(U===undefined){this._oTable.addColumn(V);}else{this._oTable.insertColumn(V,U);}};u.prototype._orderColumns=function(){var Q,U=[],V=this.getColumns();V.forEach(function(W){Q=W.getInitialIndex();if(Q>-1){U.push({index:Q,column:this.removeColumn(W)});}},this);U.sort(function(W,X){return W-X;});U.forEach(function(W){this.insertColumn(W.column,W.index);},this);};function J(Q,U,V,W){var X=U.getTemplate(true);if(!Q._bMobileTable){var Y=U.getCreationTemplate(true);[X,Y].forEach(function(Z){if(!Z){return;}if(Z.setWrapping){Z.setWrapping(false);}if(Z.setRenderWhitespace){Z.setRenderWhitespace(false);}});V.setTemplate(X);V.setCreationTemplate(Y);}else if(W>=0){Q._oTemplate.insertCell(X,W);Q._oTable.getItems().forEach(function(Z){Z.insertAggregation("cells",new j(),W,true);});}else{Q._oTemplate.addCell(X);}}u.prototype._createColumn=function(Q){return G.createColumn(Q.getId()+"-innerColumn",{width:Q.getWidth(),minWidth:Math.round(Q.getMinWidth()*parseFloat(M.BaseFontSize)),hAlign:Q.getHAlign(),label:Q.getColumnHeaderControl(this._bMobileTable)});};u.prototype._createMobileColumn=function(Q){return R.createColumn(Q.getId()+"-innerColumn",{width:Q.getWidth(),autoPopinWidth:Q.getMinWidth(),hAlign:Q.getHAlign(),header:Q.getColumnHeaderControl(this._bMobileTable),importance:Q.getImportance(),popinDisplay:"Inline"});};u.prototype.moveColumn=function(Q,U){var V;this.removeAggregation("columns",Q,true);this.insertAggregation("columns",Q,U,true);if(this._oTable){V=this._oTable.removeColumn(Q.getId()+"-innerColumn");this._oTable.insertColumn(V,U);if(this._bMobileTable){this._updateColumnTemplate(Q,U);}}};u.prototype.removeColumn=function(Q){Q=this.removeAggregation("columns",Q,true);if(this._oTable){var U=this._oTable.removeColumn(Q.getId()+"-innerColumn");U.destroy();var V=this.getControlDelegate();V&&V._onColumnChange&&V._onColumnChange(this);if(this._bMobileTable){this._updateColumnTemplate(Q,-1);}}return Q;};u.prototype.addColumn=function(Q){this.addAggregation("columns",Q,true);this._insertInnerColumn(Q);return this;};u.prototype.insertColumn=function(Q,U){this.insertAggregation("columns",Q,U,true);this._insertInnerColumn(Q,U);return this;};u.prototype._updateColumnTemplate=function(Q,U){var V,W;if(this._oTemplate){V=Q.getTemplate(true);W=this._oTemplate.indexOfCell(V);u._removeItemCell(this._oTemplate,W,U);}if(W>-1){this._oTable.getItems().forEach(function(X){if(X.removeCell){u._removeItemCell(X,W,U);}});}};u._removeItemCell=function(Q,U,V){var W=Q.removeCell(U);if(W){if(V>-1){Q.insertCell(W,V);}else{W.destroy();}}};u.prototype._onItemPress=function(Q){this.fireRowPress({bindingContext:Q.getParameter("listItem").getBindingContext()});};u.prototype._onSelectionChange=function(Q){var U=Q.getParameter("selectAll");this.fireSelectionChange({bindingContext:Q.getParameter("listItem").getBindingContext(),selected:Q.getParameter("selected"),selectAll:U});if(U){var V=this.getRowBinding();if(V&&this._oTable){var W=V.getLength();var X=this._oTable.getItems().length;var Y=V.isLengthFinal();if(X!=W||!Y){t("table.SELECTION_LIMIT_MESSAGE",[X]);}}}};u.prototype._onResponsiveTableColumnPress=function(Q){this._onColumnPress(Q.getParameter("column"));};u.prototype._onCellClick=function(Q){this.fireRowPress({bindingContext:Q.getParameter("rowBindingContext")});};u.prototype._onRowActionPress=function(Q){var U=Q.getParameter("row");this.fireRowPress({bindingContext:U.getBindingContext()});};u.prototype._onRowSelectionChange=function(Q){if(!this._bSelectionChangedByAPI){this.fireSelectionChange({bindingContext:Q.getParameter("rowContext"),selected:Q.getSource().isIndexSelected(Q.getParameter("rowIndex")),selectAll:Q.getParameter("selectAll")});}};u.prototype._onGridTableColumnPress=function(Q){Q.preventDefault();this._onColumnPress(Q.getParameter("column"));};u.prototype.getSelectedContexts=function(){if(this._oTable){if(this._bMobileTable){return this._oTable.getSelectedContexts();}var Q=this._oTable.getPlugins()[0].getSelectedIndices();return Q.map(function(U){return this._oTable.getContextByIndex(U);},this);}return[];};u.prototype.clearSelection=function(){if(this._oTable){if(this._bMobileTable){this._oTable.removeSelections(true);}else{this._bSelectionChangedByAPI=true;this._oTable.getPlugins()[0].clearSelection();this._bSelectionChangedByAPI=false;}}};u.prototype._registerInnerFilter=function(Q){Q.attachSearch(function(){this.rebind();},this);};u.prototype.isTableBound=function(){return this._oTable?this._oTable.isBound(this._bMobileTable?"items":"rows"):false;};u.prototype.bindRows=function(Q){if(!this.bDelegateInitialized||!this._oTable){return;}this.getControlDelegate().updateBindingInfo(this,this.getPayload(),Q);if(Q&&Q.path){this._oTable.setShowOverlay(false);if(this._bMobileTable&&this._oTemplate){Q.template=this._oTemplate;}else{delete Q.template;}if(!Q.parameters){Q.parameters={};}Q.sorter=this._getSorters();u._addBindingListener(Q,"dataRequested",this._onDataRequested.bind(this));u._addBindingListener(Q,"dataReceived",this._onDataReceived.bind(this));u._addBindingListener(Q,"change",this._onBindingChange.bind(this));this._updateColumnsBeforeBinding(Q);this.getControlDelegate().rebindTable(this,Q);this._updateInnerTableNoDataText();}};u.prototype._onDataRequested=function(){this._bIgnoreChange=true;};u.prototype._onDataReceived=function(){this._bIgnoreChange=false;this._updateHeaderText();this._updateExportState();};u.prototype._onBindingChange=function(){if(this._bIgnoreChange){return;}this._updateHeaderText();};u.prototype._updateHeaderText=function(){var Q,U;if(!this._oNumberFormatInstance){this._oNumberFormatInstance=N.getFloatInstance();}if(this._oTitle&&this.getHeader()){Q=this.getHeader();if(this.getShowRowCount()){U=this._getRowCount();var V=this._oNumberFormatInstance.format(U);if(V){Q+=" ("+V+")";}}this._oTitle.setText(Q);}if(!this._bIgnoreChange&&this._bAnnounceTableUpdate){this._bAnnounceTableUpdate=false;this._announceTableUpdate(U);}};u.prototype._announceTableUpdate=function(Q){var U=i.getInstance();if(U){var V=e.getLibraryResourceBundle("sap.ui.mdc");var W=this.getHeader();if(Q===undefined&&this._getRowCount()>0){U.announce(V.getText("table.ANNOUNCEMENT_TABLE_UPDATED",[W]));}else if(Q>1){U.announce(V.getText("table.ANNOUNCEMENT_TABLE_UPDATED_MULT",[W,Q]));}else if(Q===1){U.announce(V.getText("table.ANNOUNCEMENT_TABLE_UPDATED_SING",[W,Q]));}else{U.announce(V.getText("table.ANNOUNCEMENT_TABLE_UPDATED_NOITEMS",[W]));}}};u.prototype._updateColumnsBeforeBinding=function(Q){var U=[].concat(Q.sorter||[]);var V=this.getColumns();var W=this._bMobileTable;var X=this.getPropertyHelper();V.forEach(function(Y){var Z=e.byId(Y.getId()+"-innerColumn");var $=X.getSortableProperties(Y.getDataProperty()).map(function(b1){return b1.getPath();});if($.length>0){var _=U.find(function(_){return $.indexOf(_.sPath)>-1;});var a1=_&&_.bDescending?"Descending":"Ascending";if(W){Z.setSortIndicator(_?a1:"None");}else{Z.setSorted(!!_).setSortOrder(a1);}}});};u.prototype._getRowCount=function(){var Q=this._getRowBinding();if(!Q){return 0;}var U;if(Q.isLengthFinal()){U=Q.getLength();}if(U<0||U==="0"){U=0;}return U;};u.prototype.getRowBinding=function(){return this._getRowBinding();};u.prototype._getRowBinding=function(){if(this._oTable){return this._oTable.getBinding(this._sAggregation);}};u._addBindingListener=function(Q,U,V){if(!Q.events){Q.events={};}if(!Q.events[U]){Q.events[U]=V;}else{var W=Q.events[U];Q.events[U]=function(){V.apply(this,arguments);W.apply(this,arguments);};}};u.prototype.rebindTable=function(){this.rebind();};u.prototype.rebind=function(){if(this._bFullyInitialized){this.bindRows(this.getRowsBindingInfo()||{});}else{this._fullyInitialized().then(this.rebind.bind(this));}};u.prototype._showSettings=function(Q){T.showPanel(this,"Columns",Q.getSource());};u.prototype._showSort=function(Q){T.showPanel(this,"Sort",Q.getSource());};u.prototype._showFilter=function(Q){T.showPanel(this,"Filter",Q.getSource());};u.prototype._getSorters=function(){var Q=this.getSortConditions()?this.getSortConditions().sorters:[];var U=[],V=this.getPropertyHelper();Q.forEach(function(W){var X=V.getPath(W.name);U.push(new S(X,W.descending));});return U;};u.prototype._onInnerTablePaste=function(Q){this.firePaste({data:Q.getParameter("data")});};u.prototype.exit=function(){if(this._oTemplate){this._oTemplate.destroy();}this._oTemplate=null;this._oTable=null;if(this._oToolbar&&!this._bTableExists){this._oToolbar.destroy();}this._oToolbar=null;this._oTitle=null;this._oNumberFormatInstance=null;v.forEach(function(Q){var U=g(Q),V="_o"+U;this[V]=null;},this);this._oTableReady=null;this._fReject=null;this._fResolve=null;this._pFullInitialize=null;this._fnRejectFullInit=null;this._fnResolveFullInit=null;C.prototype.exit.apply(this,arguments);};return u;});
