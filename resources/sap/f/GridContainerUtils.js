/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/InvisibleRenderer","sap/ui/Device"],function(L,I,D){"use strict";return{isGridSupportedByBrowser:function(){return!D.browser.msie;},findDropTargetsAbove:function(g,i){return this._findDropTargets(g,i,this._isAbove);},findDropTargetsBelow:function(g,i){return this._findDropTargets(g,i,this._isBelow);},getItemWrapper:function(i){var o=i.getDomRef(),a;if(o){return o.parentElement;}a=document.getElementById(I.createInvisiblePlaceholderId(i));if(a){return a.parentElement;}return null;},createConfig:function(g,i){return{grid:g,item:i};},makeMatrix:function(g){var G=g.getDomRef(),m=window.getComputedStyle(G),b=this.isGridSupportedByBrowser(),c=b?m.gridTemplateRows.split(/\s+/):[],C=b?m.gridTemplateColumns.split(/\s+/).length:g.IeColumns,r=b?c.length:g.IeRows,M=Array.from(new Array(r),function(){return new Array(C).fill(false);}),l=g.getActiveLayoutSettings(),o={gap:l.getGapInPx(),row:l.getRowSizeInPx(),column:l.getMinColumnSizeInPx()||l.getColumnSizeInPx(),cssRows:c},i=g.getItems();if(!i.length){return[];}i.forEach(function(a){if(!a.getVisible()){return;}var w=this.getItemWrapper(a),p=this._getPosition(w.getBoundingClientRect(),g,o);this._addToMatrix(M,p,w);}.bind(this));return M;},_findDropTargets:function(g,i,m){var t=[],o=this.getItemWrapper(i),c=g.getItems().filter(function(a){return m(o,this.getItemWrapper(a));}.bind(this)),C=this.createConfig(g,this._findClosest(i,c),i,m);if(C.item){t.push(C);}else{t=Array.from(document.querySelectorAll(".sapFGridContainer")).filter(function(a){return m(o,a);}).map(function(g){var n=jQuery(g).control(0);var a=this.createConfig(n,this._findClosest(i,n.getItems()),i,m);a.distFromItemToGrid=this._getDistance(i,n,m);return a;}.bind(this)).sort(function(a,b){return a.distFromItemToGrid-b.distFromItemToGrid;});}return t;},_getPosition:function(i,g,l){var G=g.getDomRef().getBoundingClientRect(),t=Math.round(i.top-G.top),a=Math.round(i.left-G.left),s=Math.floor(t/(l.row+l.gap)),S=Math.floor(a/(l.column+l.gap)),o=g.getActiveLayoutSettings(),e=o.calculateRowsForItem(i.height),E=o.calculateColumnsForItem(i.width);if(g.getInlineBlockLayout()&&this.isGridSupportedByBrowser()){s=this._findStartRowOnInlineBlockLayout(t,l);e=1;}return{xFrom:s,xTo:e+s,yFrom:S,yTo:E+S};},_findStartRowOnInlineBlockLayout:function(t,l){var s=0,S=0,i;for(i=0;i<l.cssRows.length;i++){S+=Math.floor(Number.parseFloat(l.cssRows[i])+l.gap);if(t<S){break;}s++;}return s;},_addToMatrix:function(m,p,d){var r,c;for(r=p.xFrom;r<p.xTo;r++){for(c=p.yFrom;c<p.yTo;c++){m[r][c]=d;}}},_findClosest:function(i,c,m){var C=null,f=Number.POSITIVE_INFINITY;c.forEach(function(o){var d=this._getDistance(i,o,m);if(d<f){C=o;f=d;}}.bind(this));return C;},_getDistance:function(a,b,m){var r=a.getDomRef().getBoundingClientRect(),R=b.getDomRef().getBoundingClientRect();var c={x:R.left};if(m===this._isAbove){c.y=R.top+R.height;}else{c.y=R.top;}var d={x:c.x+R.width,y:c.y};var e={x:r.left+r.width/2,y:r.top+r.height/2};var n=(d.x-c.x)*(d.x-c.x)+(d.y-c.y)*(d.y-c.y);var C=((e.x-c.x)*(d.x-c.x)+(e.y-c.y)*(d.y-c.y))/n;var P={};if(C<0){P.x=c.x;P.y=c.y;}else if(C>1){P.x=d.x;P.y=d.y;}else{P.x=c.x+C*(d.x-c.x);P.y=c.y+C*(d.y-c.y);}var f=(P.x-e.x),g=(P.y-e.y),h=f*f+g*g;if(h>Number.MAX_SAFE_INTEGER){L.warning("Maximum safe integer value exceeded.",h,"GridContainerUtils");}return h;},_isAbove:function(a,b){var y=a.getBoundingClientRect().top,Y=b.getBoundingClientRect().top;return Y-y<0;},_isBelow:function(a,b){var y=a.getBoundingClientRect().top,Y=b.getBoundingClientRect().top;return Y-y>0;}};});
