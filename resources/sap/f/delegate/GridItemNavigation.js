/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/f/GridContainerUtils","sap/ui/core/delegate/ItemNavigation","sap/ui/events/KeyCodes","sap/base/Log","sap/f/library"],function(G,I,K,L,l){"use strict";var N=l.NavigationDirection;var a=I.extend("sap.f.delegate.GridItemNavigation",{metadata:{library:"sap.f",properties:{},events:{}}});a.prototype.onfocusin=function(e){I.prototype.onfocusin.call(this,e);var g=jQuery(this.oDomRef).control(0),m=G.makeMatrix(g);if(e.target===this.oDomRef){this._mCurrentPosition=this._findPositionInMatrix(m,this.getItemDomRefs().indexOf(this.iFocusedIndex));}};a.prototype.onsapfocusleave=function(e){I.prototype.onsapfocusleave.call(this,e);this._mCurrentPosition=null;};a.prototype.onsapnext=function(e){this._moveFocus(e);};a.prototype.onsapprevious=function(e){this._moveFocus(e);};a.prototype._moveFocus=function(e){var i=this.getItemDomRefs();if(i.indexOf(e.target)===-1){return;}e.preventDefault();var c=e.target,g=e.srcControl,m=G.makeMatrix(g),s=this._findPositionInMatrix(m,c);if(!this._mCurrentPosition){this._mCurrentPosition={column:s.column,row:s.row};}switch(e.keyCode){case K.ARROW_DOWN:this._moveFocusDown(s,m,c,e);break;case K.ARROW_RIGHT:this._moveFocusRight(s,m,c,e);break;case K.ARROW_UP:this._moveFocusUp(s,m,c,e);break;case K.ARROW_LEFT:this._moveFocusLeft(s,m,c,e);break;default:break;}};a.prototype._moveFocusDown=function(s,m,c,e){var i=this.getItemDomRefs(),n;s.column=this._mCurrentPosition.column;while(s.row<m.length&&(m[s.row][s.column]===c||m[s.row][s.column]===false)){s.row+=1;}if(s.row>=m.length){this._onBorderReached(e);return;}L.info("Grid matrix position:"+s.row,s.column);n=m[s.row][s.column];if(n){this._mCurrentPosition=s;this.focusItem(i.indexOf(n),e);}else{this._onBorderReached(e);}};a.prototype._moveFocusRight=function(s,m,c,e){var i=this.getItemDomRefs(),n;s.row=this._mCurrentPosition.row;while(s.column<m[s.row].length&&(m[s.row][s.column]===c||m[s.row][s.column]===false)){s.column+=1;}if(s.column>=m[s.row].length){this._onBorderReached(e);return;}L.info("Grid matrix position:"+s.row,s.column);n=m[s.row][s.column];if(n){this._mCurrentPosition=s;this.focusItem(i.indexOf(n),e);}else{this._onBorderReached(e);}};a.prototype._moveFocusUp=function(s,m,c,e){var i=this.getItemDomRefs(),n;s.column=this._mCurrentPosition.column;while(s.row>=0&&(m[s.row][s.column]===c||m[s.row][s.column]===false)){s.row-=1;}if(s.row<0){this._onBorderReached(e);return;}L.info("Grid matrix position:"+s.row,s.column);n=m[s.row][s.column];if(n){while(s.row>0&&m[s.row-1][s.column]===n){s.row-=1;}this._mCurrentPosition=s;this.focusItem(i.indexOf(n),e);}else{this._onBorderReached(e);}};a.prototype._moveFocusLeft=function(s,m,c,e){var i=this.getItemDomRefs(),n;s.row=this._mCurrentPosition.row;while(s.column>=0&&(m[s.row][s.column]===c||m[s.row][s.column]===false)){s.column-=1;}if(s.column<0){this._onBorderReached(e);return;}L.info("Grid matrix position:"+s.row,s.column);n=m[s.row][s.column];if(n){while(s.column>0&&m[s.row][s.column-1]===n){s.column-=1;}this._mCurrentPosition=s;this.focusItem(i.indexOf(n),e);}else{this._onBorderReached(e);}};a.prototype._findPositionInMatrix=function(m,i){var M=null;m.some(function(b,c){var r=b.indexOf(i);if(r!==-1){M={};M.row=c;M.column=r;return true;}return false;});return M;};a.prototype._onBorderReached=function(e){var g=e.srcControl,d;switch(e.keyCode){case K.ARROW_RIGHT:d=N.Right;break;case K.ARROW_LEFT:d=N.Left;break;case K.ARROW_DOWN:d=N.Down;break;case K.ARROW_UP:d=N.Up;break;}g.onItemNavigationBorderReached({event:e,row:this._mCurrentPosition.row,column:this._mCurrentPosition.column,direction:d});};a.prototype.focusItemByDirection=function(g,d,r,c){var C,m=G.makeMatrix(g),R,i,b;switch(d){case N.Right:i=r;b=-1;R=m[r];if(R){do{C=R[++b];}while(!C);}break;case N.Left:i=r;b=m[0].length;R=m[r];if(R){do{C=R[--b];}while(!C);}while(C&&b>0&&m[r][b-1]===C){b--;}break;case N.Down:i=-1;b=c;do{C=m[++i][c];}while(!C);break;case N.Up:i=m.length;b=c;do{C=m[--i][c];}while(!C);while(C&&i>0&&m[i-1][c]===C){i--;}break;}if(!C){return;}this._mCurrentPosition={column:b,row:i};C.focus();};return a;});
